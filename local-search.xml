<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>LeetCode 81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II</title>
    <link href="/2020/08/17/LeetCode-81-search-in-rotated-sorted-array-ii/"/>
    <url>/2020/08/17/LeetCode-81-search-in-rotated-sorted-array-ii/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array-ii/" target="_blank" rel="noopener">81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II</a></p><p>æœ¬é¢˜åŠ å…¥é‡å¤æ•°å­—ï¼Œæ‰€ä»¥åœ¨åˆ¤æ–­å“ªä¸€éƒ¨åˆ†æœ‰åºæ—¶ï¼Œè‹¥ <code>nums[left] == nums[mid]</code> å¯èƒ½å‡ºç°åˆ¤æ–­ä¸å‡ºæ¥çš„æƒ…å†µï¼Œä¸€å¼€å§‹ä¸€ç›´å¡ç€ï¼Œåæ¥å‘ç°åªè¦ä¸¢å¼ƒä¸€ä¸ªé‡å¤æ•°å­—ï¼Œåˆ™ä¸‹ä¸€æ¬¡å°±å¯æˆåŠŸåˆ¤æ–­ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> target)</span> </span>&#123;        <span class="hljs-keyword">if</span> (nums.length == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125;        <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> right = nums.length - <span class="hljs-number">1</span>;        <span class="hljs-keyword">while</span> (left &lt; right) &#123;            <span class="hljs-keyword">int</span> mid = left + (right - left) / <span class="hljs-number">2</span>;            <span class="hljs-keyword">if</span> (target == nums[mid]) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125;            <span class="hljs-keyword">if</span> (nums[left] &lt; nums[mid]) &#123;                <span class="hljs-comment">// å·¦åŠéƒ¨åˆ†æœ‰åº</span>                <span class="hljs-keyword">if</span> (target &gt;= nums[left] &amp;&amp; target &lt;= nums[mid]) &#123;                    right = mid;                &#125; <span class="hljs-keyword">else</span> &#123;                    left = mid + <span class="hljs-number">1</span>;                &#125;            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nums[left] &gt; nums[mid]) &#123;                <span class="hljs-comment">// å³åŠéƒ¨åˆ†æœ‰åº</span>                <span class="hljs-keyword">if</span> (target &gt; nums[mid] &amp;&amp; target &lt;= nums[right]) &#123;                    left = mid + <span class="hljs-number">1</span>;                &#125; <span class="hljs-keyword">else</span> &#123;                    right = mid;                &#125;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-comment">// nums[left] == nums[mid] æ—¶æ— æ³•åˆ¤æ–­å“ªéƒ¨åˆ†æœ‰åºï¼Œåˆ™ä¸¢å¼ƒä¸€ä¸ªé‡å¤æ•°å­—</span>                <span class="hljs-comment">// [1,3,1,1,1]</span>                <span class="hljs-comment">// [1,3,1,1]</span>                left++;            &#125;        &#125;        <span class="hljs-keyword">return</span> nums[left] == target;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>äºŒåˆ†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 74. æœç´¢äºŒç»´çŸ©é˜µ</title>
    <link href="/2020/08/17/LeetCode-74-search-a-2d-matrix/"/>
    <url>/2020/08/17/LeetCode-74-search-a-2d-matrix/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/search-a-2d-matrix/" target="_blank" rel="noopener">74. æœç´¢äºŒç»´çŸ©é˜µ</a><br />ä¸€å¼€å§‹ç”¨ <code>i = mid / rows</code> è®¡ç®—è¡Œæ•°ï¼Œå¯¼è‡´ä½ç½®è®¡ç®—ä¸æ­£ç¡®ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">searchMatrix</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[][] matrix, <span class="hljs-keyword">int</span> target)</span> </span>&#123;        <span class="hljs-keyword">int</span> rows = matrix.length;        <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125;        <span class="hljs-keyword">int</span> cols = matrix[<span class="hljs-number">0</span>].length;        <span class="hljs-keyword">if</span> (cols == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125;        <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> right = rows * cols - <span class="hljs-number">1</span>;        <span class="hljs-keyword">while</span> (left &lt; right) &#123;            <span class="hljs-keyword">int</span> mid = left + (right - left) / <span class="hljs-number">2</span>;            <span class="hljs-comment">// è¡Œæ•°æ˜¯å¯¹æ¯è¡Œå¤§å°è¿›è¡Œæ•´é™¤ï¼Œ</span>            <span class="hljs-comment">// åˆ—æ•°æ˜¯å¯¹æ¯è¡Œå¤§å°è¿›è¡Œå–ä½™</span>            <span class="hljs-keyword">int</span> i = mid / cols;            <span class="hljs-keyword">int</span> j = mid % cols;            <span class="hljs-keyword">if</span> (matrix[i][j] == target) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matrix[i][j] &lt; target) &#123;                <span class="hljs-comment">// ä¸ä½¿ç”¨ left = mid</span>                <span class="hljs-comment">// åŸå› åœ¨äºå‘ä¸Šå–æ•´æ—¶ matrix å¯èƒ½ä¼šè¶Šç•Œï¼Œæ‰€ä»¥é‡‡ç”¨å‘ä¸‹å–æ•´</span>                left = mid + <span class="hljs-number">1</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                right = mid;            &#125;        &#125;        <span class="hljs-keyword">return</span> matrix[left / cols][left % cols] == target;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>äºŒåˆ†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</title>
    <link href="/2020/08/17/LeetCode-33-search-in-rotated-sorted-array/"/>
    <url>/2020/08/17/LeetCode-33-search-in-rotated-sorted-array/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/" target="_blank" rel="noopener">33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</a></p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> target)</span> </span>&#123;        <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> right = nums.length - <span class="hljs-number">1</span>;        <span class="hljs-keyword">while</span> (left &lt; right) &#123;            <span class="hljs-keyword">int</span> mid = left + (right - left + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;            <span class="hljs-keyword">if</span> (nums[mid] == target) &#123;                <span class="hljs-keyword">return</span> mid;            &#125;            <span class="hljs-keyword">if</span> (nums[left] &lt; nums[mid]) &#123;                <span class="hljs-comment">// 1. å·¦åŠéƒ¨åˆ† [left, mid] æœ‰åº</span>                <span class="hljs-keyword">if</span> (target &gt;= nums[left] &amp;&amp; target &lt; nums[mid]) &#123;                    <span class="hljs-comment">// 1.1 target in [left, mid]</span>                    <span class="hljs-comment">// left &lt;= target &lt; mid.....right</span>                    <span class="hljs-comment">// [left, mid - 1]</span>                    right = mid - <span class="hljs-number">1</span>;                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-comment">// 1.2 target in [mid + 1, right]</span>                    <span class="hljs-comment">// [mid, right]</span>                    left = mid;                &#125;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-comment">// 2. å³åŠéƒ¨åˆ† [mid, right] æœ‰åº</span>                <span class="hljs-keyword">if</span> (target &gt; nums[mid] &amp;&amp; target &lt;= nums[right]) &#123;                    <span class="hljs-comment">// 2.1 target in [mid, right]</span>                    <span class="hljs-comment">// left.....mid &lt; target &lt;= right</span>                    <span class="hljs-comment">// [mid, right]</span>                    left = mid;                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-comment">// 2.2 target in [left, mid - 1]</span>                    <span class="hljs-comment">// [left, mid - 1]</span>                    right = mid - <span class="hljs-number">1</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> nums[left] == target ? left : -<span class="hljs-number">1</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>äºŒåˆ†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°</title>
    <link href="/2020/08/16/LeetCode-367.%20valid-perfect-square/"/>
    <url>/2020/08/16/LeetCode-367.%20valid-perfect-square/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/valid-perfect-square/" target="_blank" rel="noopener">367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°</a></p><p>ä¸¤ç§è§£æ³•éƒ½å‡»è´¥ <code>100%</code></p><h1 id="äºŒåˆ†æ³•"><a class="markdownIt-Anchor" href="#äºŒåˆ†æ³•"></a> äºŒåˆ†æ³•</h1><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isPerfectSquare</span><span class="hljs-params">(<span class="hljs-keyword">int</span> num)</span> </span>&#123;    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-keyword">long</span> left = <span class="hljs-number">1</span>;    <span class="hljs-keyword">long</span> right = num / <span class="hljs-number">2</span>;    <span class="hljs-keyword">while</span> (left &lt; right) &#123;        <span class="hljs-keyword">long</span> mid = left + (right - left + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;        <span class="hljs-keyword">long</span> prod = mid * mid;        <span class="hljs-keyword">if</span> (prod == num) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prod &gt; num) &#123;            right = mid - <span class="hljs-number">1</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            left = mid;        &#125;    &#125;    <span class="hljs-keyword">return</span> left * left == num;&#125;</code></pre><h1 id="ç‰›é¡¿è¿­ä»£æ³•"><a class="markdownIt-Anchor" href="#ç‰›é¡¿è¿­ä»£æ³•"></a> ç‰›é¡¿è¿­ä»£æ³•</h1><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isPerfectSquare</span><span class="hljs-params">(<span class="hljs-keyword">int</span> num)</span> </span>&#123;    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-keyword">long</span> x = num / <span class="hljs-number">2</span>;    <span class="hljs-keyword">while</span> (x * x &gt; num) &#123;        x = (x + num / x) / <span class="hljs-number">2</span>;    &#125;    <span class="hljs-keyword">return</span> x * x == num;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>äºŒåˆ†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 69. x çš„å¹³æ–¹æ ¹</title>
    <link href="/2020/08/15/LeetCode-69-sqrtx/"/>
    <url>/2020/08/15/LeetCode-69-sqrtx/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/sqrtx/" target="_blank" rel="noopener">69. x çš„å¹³æ–¹æ ¹</a></p><h1 id="äºŒåˆ†"><a class="markdownIt-Anchor" href="#äºŒåˆ†"></a> äºŒåˆ†</h1><blockquote><p><code>sqrt(x) &lt;= x / 2</code><br />ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹ <code>&lt;=</code> è¿™ä¸ªæ•°çš„ä¸€åŠï¼Œæ‰€ä»¥å³è¾¹ç•Œæœ€å¤§ <code>= x / 2</code></p></blockquote><ul><li>å…ˆå†™åˆ†æ”¯é€»è¾‘ï¼Œå†å†³å®šä¸­é—´æ•°æ˜¯å¦ä¸Šå–æ•´ï¼›</li><li>åªè¦çœ‹åˆ° <code>left = mid</code> ï¼Œå®ƒå¯¹åº”çš„å–ä¸­ä½æ•°çš„å–æ³•ä¸€å®šæ˜¯ <code>mid = left + (right - left + 1) / 2;</code>ã€‚</li></ul><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">mySqrt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;    <span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-keyword">long</span> left = <span class="hljs-number">1</span>;    <span class="hljs-keyword">long</span> right = x / <span class="hljs-number">2</span>;    <span class="hljs-comment">// æ’é™¤å…ƒç´ ï¼Œä½¿ç”¨ &lt;ï¼Œæ¯æ¬¡éƒ½ä½¿ç”¨ [left, right] æŸ¥æ‰¾</span>    <span class="hljs-comment">// æŸ¥æ‰¾å…ƒç´ ï¼Œä½¿ç”¨ &lt;=</span>    <span class="hljs-keyword">while</span> (left &lt; right) &#123;        <span class="hljs-comment">// +1 å‘ä¸Šå–æ•´ï¼Œé¿å…æ­»å¾ªç¯</span>        <span class="hljs-comment">// ä¸ä½¿ç”¨ (left + right) / 2 æ˜¯ä¸ºäº†é¿å… long æº¢å‡º</span>        <span class="hljs-keyword">long</span> mid = left + (right - left + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;        <span class="hljs-keyword">if</span> (mid * mid &gt; x) &#123;            <span class="hljs-comment">// [left, mid - 1]</span>            right = mid - <span class="hljs-number">1</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// [mid, right]</span>            left = mid;        &#125;    &#125;    <span class="hljs-comment">// é€€å‡ºå¾ªç¯æ—¶ left == right</span>    <span class="hljs-comment">// è¿˜å‰©ä¸€ä¸ªå…ƒç´ æ²¡æœ‰æŸ¥æ‰¾ï¼Œ</span>    <span class="hljs-comment">// å› ä¸ºç­”æ¡ˆä¸€å®šå­˜åœ¨ï¼Œå³ä¸€å®šåœ¨æœç´¢åŒºé—´ï¼Œå‰©ä¸‹çš„å…ƒç´ å°±æ˜¯é—®é¢˜ç­”æ¡ˆ</span>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)left;&#125;</code></pre><h1 id="ç‰›é¡¿è¿­ä»£æ³•"><a class="markdownIt-Anchor" href="#ç‰›é¡¿è¿­ä»£æ³•"></a> ç‰›é¡¿è¿­ä»£æ³•</h1><p>è¦ä½¿ç”¨ <code>double</code> ç±»å‹ï¼Œä¸€å¼€å§‹ä½¿ç”¨ <code>float</code> ç²¾åº¦ä¸å¤Ÿï¼Œæœ‰ä¸‰ä¸ªæµ‹è¯•ç”¨ä¾‹æ— æ³•é€šè¿‡ã€‚</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mo>âˆ’</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">f(x) = x^2 - a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>+</mo><msup><mi>f</mi><mo mathvariant="normal">â€²</mo></msup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>âˆ’</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y = f(x_n) + f&#x27;(x_n)(x - x_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>âˆ’</mo><mfrac><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><mrow><msup><mi>f</mi><mo mathvariant="normal">â€²</mo></msup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">x = x_n - \frac{f(x_n)}{f&#x27;(x_n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>âˆ’</mo><mfrac><mrow><msubsup><mi>x</mi><mi>n</mi><mn>2</mn></msubsup><mo>âˆ’</mo><mi>a</mi></mrow><mrow><mn>2</mn><msub><mi>x</mi><mi>n</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">x = x_n - \frac{x_n^2 - a}{2x_n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.5792199999999998em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1341199999999998em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5102em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo>+</mo><mfrac><mi>a</mi><msub><mi>x</mi><mi>n</mi></msub></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x = \frac{1}{2}(x_n + \frac{a}{x_n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1951em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">mySqrt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;    <span class="hljs-keyword">double</span> cur = <span class="hljs-number">1.0</span>;    <span class="hljs-keyword">double</span> pre = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span> (Math.abs(cur - pre) &gt; <span class="hljs-number">1e-6</span>) &#123;        pre = cur;        cur = (cur + x / cur) / <span class="hljs-number">2</span>;    &#125;    System.out.println(cur);    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)cur;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>äºŒåˆ†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 45. è·³è·ƒæ¸¸æˆ II</title>
    <link href="/2020/08/14/LeetCode-45-jump-game-ii/"/>
    <url>/2020/08/14/LeetCode-45-jump-game-ii/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/jump-game-ii/" target="_blank" rel="noopener">45. è·³è·ƒæ¸¸æˆ II</a></p><p>æœ¬é¢˜åœ¨ <a href="https://leetcode-cn.com/problems/jump-game/" target="_blank" rel="noopener">55. è·³è·ƒæ¸¸æˆ</a> åŸºç¡€ä¸ŠåŠ äº†ä¸ªæœ€å°æ¬¡æ•°ï¼Œå…¶å®ä¹Ÿæ˜¯è®¡ç®—æ¯ä¸ªä½ç½®èƒ½è·³åˆ°çš„æœ€è¿œè·ç¦»ï¼Œå…³é”®åœ¨äºè¦ä¿å­˜ä¸Šä¸€æ¬¡çš„æœ€è¿œè¾¹ç•Œï¼Œç”¨æ¥åˆ¤æ–­è·³è·ƒçš„æ¬¡æ•°ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">jump</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;        <span class="hljs-keyword">int</span> pos = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> begin = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> end = <span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span> (pos &lt; nums.length - <span class="hljs-number">1</span>) &#123;            <span class="hljs-comment">// æœ¬æ¬¡èƒ½è·³åˆ°çš„æœ€è¿œä½ç½®</span>            <span class="hljs-keyword">int</span> max = pos;            <span class="hljs-comment">// æ¯æ¬¡éƒ½åœ¨ [begin, end] åŒºé—´é‡Œæ‰¾åˆ°èƒ½è·³åˆ°çš„æœ€è¿œä½ç½®</span>            <span class="hljs-comment">// ä¸€ä¸ªåŒºé—´è¡¨ç¤ºä¸€æ¬¡è·³è·ƒçš„æ‰€æœ‰å¯èƒ½èµ·ç‚¹ï¼Œé€‰å–èƒ½è·³åˆ°çš„æœ€è¿œä½ç½®</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = begin; i &lt;= end; i++) &#123;                max = Math.max(max, i + nums[i]);            &#125;            <span class="hljs-comment">// æ›´æ–°ä¸‹ä¸€æ¬¡è·³çš„åŒºé—´</span>            begin = end + <span class="hljs-number">1</span>;            end = max;            <span class="hljs-comment">// æ›´æ–°æœ€è¿œä½ç½®</span>            pos = max;            count++;        &#125;        <span class="hljs-keyword">return</span> count;    &#125;</code></pre><p>ä¼˜åŒ–ï¼šè®¡ç®—ä»æ¯ä¸ªä½ç½®èƒ½è·³åˆ°çš„æœ€è¿œè·ç¦»ã€‚æ¯æ¬¡æœ€è¿œï¼Œæœ€ç»ˆæœ€è¿œï¼Œåˆ™è·³è·ƒæ¬¡æ•°æœ€å°‘ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">jump</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;        <span class="hljs-comment">// ä¸€æ¬¡è·³è·ƒå¯åˆ°è¾¾çš„æœ€è¿œä½ç½®</span>        <span class="hljs-keyword">int</span> end = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> max = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;            <span class="hljs-comment">// è‹¥ä¸Šä¸€æ¬¡å·²åˆ°è¾¾ç»ˆç‚¹ï¼Œåˆ™ç»“æŸ</span>            <span class="hljs-keyword">if</span> (end == nums.length - <span class="hljs-number">1</span>) &#123;                <span class="hljs-keyword">return</span> count;            &#125;            <span class="hljs-comment">// è®¡ç®—ä»ç¬¬ i ä¸ªä½ç½®èµ·è·³çš„æœ€è¿œä½ç½®</span>            max = Math.max(max, i + nums[i]);            <span class="hljs-comment">// ä¸€æ¬¡è·³è·ƒåˆ°è¾¾ç»ˆç‚¹ï¼Œæ›´æ–°è·³è·ƒæ¬¡æ•°å’Œä¸‹ä¸€æ¬¡çš„è·³è·ƒè¾¹ç•Œ</span>            <span class="hljs-keyword">if</span> (end == i) &#123;                count++;                end = max;            &#125;        &#125;        <span class="hljs-keyword">return</span> count;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>è´ªå¿ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 55. è·³è·ƒæ¸¸æˆ</title>
    <link href="/2020/08/14/LeetCode-55-jump-game/"/>
    <url>/2020/08/14/LeetCode-55-jump-game/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/jump-game/" target="_blank" rel="noopener">55. è·³è·ƒæ¸¸æˆ</a></p><p>(ğŸ™ƒä¸€å¼€å§‹è¿˜ç”¨çš„å›æº¯ã€‚ã€‚ã€‚)<br />å…³é”®åœ¨äºï¼šè‹¥èƒ½è·³åˆ°ç¬¬ <code>i</code> ä¸ªä½ç½®ï¼Œåˆ™åœ¨è¿™ä¹‹å‰çš„æ‰€æœ‰ä½ç½®éƒ½èƒ½åˆ°è¾¾ï¼Œæ‰€ä»¥åªè¦è®¡ç®—ä»ç¬¬ <code>i</code> ä¸ªä½ç½®èµ·è·³èƒ½è·³åˆ°çš„æœ€è¿œä½ç½®ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">canJump</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;        <span class="hljs-keyword">int</span> maxPos = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;            <span class="hljs-comment">// è‹¥èƒ½è·³åˆ°çš„æœ€è¿œä½ç½® &lt; å½“å‰ä½ç½®</span>            <span class="hljs-comment">// è¯´æ˜è¿å½“å‰ä½ç½®éƒ½è·³ä¸åˆ°ï¼Œä¹Ÿå°±è·³ä¸åˆ°ç»ˆç‚¹äº†</span>            <span class="hljs-keyword">if</span> (maxPos &lt; i) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            &#125;            <span class="hljs-comment">// èƒ½è·³åˆ°ç¬¬ i ä¸ªä½ç½®çš„æƒ…å†µä¸‹ï¼Œ</span>            <span class="hljs-comment">// è®¡ç®—ä»ç¬¬ i ä¸ªä½ç½®èµ·è·³ï¼Œèƒ½è·³åˆ°çš„æœ€è¿œä½ç½®</span>            <span class="hljs-comment">// æœ€è¿œ = max(æœ¬æ¬¡èµ·è·³ï¼Œä¸Šæ¬¡æœ€è¿œä½ç½®)</span>            maxPos = Math.max(i + nums[i], maxPos);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>è´ªå¿ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InnoDB é”</title>
    <link href="/2020/08/14/InnoDB-Lock/"/>
    <url>/2020/08/14/InnoDB-Lock/</url>
    
    <content type="html"><![CDATA[<h1 id="innodb-ä¸­çš„é”"><a class="markdownIt-Anchor" href="#innodb-ä¸­çš„é”"></a> <code>InnoDB</code> ä¸­çš„é”</h1><h2 id="è¡¨çº§é”å’Œè¡Œçº§é”"><a class="markdownIt-Anchor" href="#è¡¨çº§é”å’Œè¡Œçº§é”"></a> è¡¨çº§é”å’Œè¡Œçº§é”</h2><table><thead><tr><th style="text-align:center">é”ç±»å‹</th><th style="text-align:center">å¼€é”€</th><th style="text-align:center">åŠ é”é€Ÿåº¦</th><th style="text-align:center">æ­»é”</th><th style="text-align:center">ç²’åº¦</th><th style="text-align:center">é”å†²çª</th><th style="text-align:center">å¹¶å‘æ€§</th></tr></thead><tbody><tr><td style="text-align:center">è¡¨çº§é”ï¼ˆ<code>table lock</code>ï¼‰</td><td style="text-align:center">å°</td><td style="text-align:center">å¿«</td><td style="text-align:center">æ— </td><td style="text-align:center">å¤§</td><td style="text-align:center">é«˜</td><td style="text-align:center">ä½</td></tr><tr><td style="text-align:center">è¡Œçº§é”ï¼ˆ<code>row lock</code>ï¼‰</td><td style="text-align:center">å¤§</td><td style="text-align:center">æ…¢</td><td style="text-align:center">æœ‰</td><td style="text-align:center">å°</td><td style="text-align:center">å°</td><td style="text-align:center">é«˜</td></tr></tbody></table><p>åº”è¯¥å°½é‡åªé”å®šéœ€è¦ä¿®æ”¹çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„èµ„æºã€‚é”å®šçš„æ•°æ®é‡è¶Šå°‘ï¼Œé”ç«äº‰çš„å‘ç”Ÿé¢‘ç‡å°±è¶Šå°ï¼Œç³»ç»Ÿçš„å¹¶å‘ç¨‹åº¦å°±è¶Šé«˜ã€‚ä½†æ˜¯åŠ é”éœ€è¦æ¶ˆè€—èµ„æºï¼Œé”çš„å„ç§æ“ä½œï¼ˆåŒ…æ‹¬è·å–é”ã€é‡Šæ”¾é”ã€ä»¥åŠæ£€æŸ¥é”çŠ¶æ€ï¼‰éƒ½ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚å› æ­¤é”ç²’åº¦è¶Šå°ï¼Œç³»ç»Ÿå¼€é”€å°±è¶Šå¤§ã€‚</p><p>ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒçš„é”ç²’åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><ul><li><code>InnoDB</code> è¡Œé”å’Œè¡¨é”éƒ½æ”¯æŒã€‚</li><li><code>MyISAM</code> åªæ”¯æŒè¡¨é”ã€‚</li></ul><p>åœ¨ <code>InnoDB</code> ä¸­ï¼Œè¡Œé”æ˜¯é€šè¿‡ç»™ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œ<code>InnoDB</code> å°†ä¼šé€šè¿‡éšè—çš„èšç°‡ç´¢å¼•æ¥å¯¹è®°å½•åŠ é”ã€‚</p><h2 id="è¡Œçº§é”çš„ç±»å‹"><a class="markdownIt-Anchor" href="#è¡Œçº§é”çš„ç±»å‹"></a> è¡Œçº§é”çš„ç±»å‹</h2><p><code>InnoDB</code> å®ç°äº†å¦‚ä¸‹ä¸¤ç§æ ‡å‡†çš„è¡Œçº§é”ï¼š</p><ol><li>å…±äº«é”ï¼ˆè¯»é”ã€<code>S</code> é”ï¼‰ï¼šå…è®¸äº‹åŠ¡è¯»ä¸€è¡Œæ•°æ®ã€‚</li><li>æ’ä»–é”(å†™é”ã€<code>X</code> é”)ï¼šå…è®¸äº‹åŠ¡åˆ é™¤æˆ–æ›´æ–°ä¸€è¡Œæ•°æ®ã€‚</li></ol><p><code>InnoDB</code> æ”¯æŒåœ¨ä¸åŒç²’åº¦ä¸Šè¿›è¡ŒåŠ é”æ“ä½œï¼Œç§°ä¸ºæ„å‘é”ï¼Œå³ä¸º<strong>è¡¨çº§åˆ«çš„é”</strong>ï¼Œå¯¹ç¨‹åºå‘˜é€æ˜ã€‚è‹¥å¯¹ç»†ç²’åº¦çš„å¯¹è±¡è¿›è¡Œä¸Šé”ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦å¯¹ç²—ç²’åº¦çš„å¯¹è±¡ä¸Šé”ã€‚<br />ä¸¤ç§æ„å‘é”ï¼š</p><ol><li>æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æƒ³è¦è·å¾—ä¸€å¼ è¡¨ä¸­æŸå‡ è¡Œçš„å…±äº«é”ã€‚</li><li>æ„å‘æ’ä»–é”ï¼šäº‹åŠ¡æƒ³è¦è·å¾—ä¸€å¼ è¡¨ä¸­æŸå‡ è¡Œçš„æ’ä»–é”ã€‚</li></ol><h2 id="ä¸€è‡´æ€§éé”å®šè¯»"><a class="markdownIt-Anchor" href="#ä¸€è‡´æ€§éé”å®šè¯»"></a> ä¸€è‡´æ€§éé”å®šè¯»</h2><p>æŒ‡çš„æ˜¯ <code>InnoDB</code> é€šè¿‡è¡Œå¤šç‰ˆæœ¬æ§åˆ¶çš„æ–¹å¼æ¥è¯»å–å½“å‰æ‰§è¡Œæ—¶é—´æ•°æ®åº“ä¸­è¡Œçš„æ•°æ®ã€‚<br />å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡Œ <code>DELETE</code> æˆ– <code>UPDATE</code> æ“ä½œï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šç­‰å¾…è¡Œé”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯å»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200814141414.png" srcset="/img/loading.gif" alt="" /></p><p>é»˜è®¤é…ç½®ä¸‹ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸º <code>REPREATABLE READ</code>ã€‚</p><ul><li>åœ¨ <code>READ COMMITTED</code> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„<strong>æœ€æ–°ä¸€ä»½</strong>å¿«ç…§æ•°æ®ã€‚</li><li>åœ¨ <code>REPREATABLE READ</code> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œéä¸€è‡´æ€§è¯»æ€»æ˜¯è¯»å–<strong>äº‹åŠ¡å¼€å§‹æ—¶</strong>çš„è¡Œæ•°æ®ç‰ˆæœ¬ã€‚</li></ul><h2 id="ä¸€è‡´æ€§é”å®šè¯»"><a class="markdownIt-Anchor" href="#ä¸€è‡´æ€§é”å®šè¯»"></a> ä¸€è‡´æ€§é”å®šè¯»</h2><p><code>InnoDB</code> å¯¹äº <code>SELECT</code> è¯­å¥æ”¯æŒä¸¤ç§ä¸€è‡´æ€§çš„é”å®šè¯»æ“ä½œï¼š</p><ol><li><code>SELECT Â·Â·Â· FOR UPDATE</code>: å¯¹è¯»å–çš„è¡ŒåŠ ä¸€ä¸ª <code>X</code> é”ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹å·²é”å®šçš„è¡ŒåŠ ä»»ä½•é”ã€‚</li><li><code>SELECT Â·Â·Â· LOCK IN SHARE MODE</code>: å¯¹è¯»å–çš„è¡ŒåŠ ä¸€ä¸ª <code>S</code> é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥å‘è¢«é”å®šçš„è¡ŒåŠ  <code>S</code> é”ï¼Œå¦‚æœåŠ  <code>X</code> é”ï¼Œåˆ™ä¼šè¢«é˜»å¡ã€‚</li></ol><p>åœ¨ä½¿ç”¨ä¸Šè¿°ä¸¤å¥ <code>SELECT</code> è¯­å¥æ—¶ï¼ŒåŠ¡å¿…åŠ ä¸Š <code>BEGIN, START TRANSACTION</code> æˆ–è€… <code>SET AUTOCOMMIT = 0</code>ï¼Œå› ä¸ºä»–ä»¬å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå½“äº‹åŠ¡æäº¤äº†ï¼Œé”ä¹Ÿå°±é‡Šæ”¾äº†ã€‚</p><h2 id="è‡ªå¢é•¿ä¸é”"><a class="markdownIt-Anchor" href="#è‡ªå¢é•¿ä¸é”"></a> è‡ªå¢é•¿ä¸é”</h2><p>æ¯ä¸ªå«æœ‰è‡ªå¢é•¿å€¼çš„è¡¨éƒ½æœ‰ä¸€ä¸ªè‡ªå¢é•¿è®¡æ•°å™¨ï¼ˆ<code>auto-increment counter</code>ï¼‰ï¼Œå½“è¡¨è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œè¿™ä¸ªè®¡æ•°å™¨ä¼šè¢«åˆå§‹åŒ–ï¼Œæ’å…¥æ“ä½œä¼šæ ¹æ®è¿™ä¸ªè‡ªå¢é•¿çš„è®¡æ•°å™¨åŠ  <code>1</code> èµ‹äºˆè‡ªå¢é•¿åˆ—ã€‚<br />è¿™ä¸ªå®ç°æ–¹å¼ç§°ä½œ <code>AUTO-INC Locking</code>ã€‚è¿™ç§é”å…¶å®æ˜¯é‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼Œä¸ºäº†æé«˜æ’å…¥çš„æ€§èƒ½ï¼Œ<strong>é”ä¸æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å®Œæˆåé‡Šæ”¾ï¼Œè€Œæ˜¯åœ¨å®Œæˆå¯¹è‡ªå¢é•¿å€¼æ’å…¥çš„ <code>SQL</code> è¯­å¥åé‡Šæ”¾</strong>ã€‚</p><p>åœ¨ <code>InnoDB</code> ä¸­ï¼Œè‡ªå¢é•¿å€¼çš„åˆ—å¿…é¡»æ˜¯ç´¢å¼•ï¼ŒåŒæ—¶å¿…é¡»æ˜¯ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—ã€‚å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªåˆ—ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ <code>MyISAM</code> æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="è¡Œé”çš„ä¸‰ç§ç®—æ³•"><a class="markdownIt-Anchor" href="#è¡Œé”çš„ä¸‰ç§ç®—æ³•"></a> è¡Œé”çš„ä¸‰ç§ç®—æ³•</h1><ul><li><code>Record Lock</code>: å•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚</li><li><code>Gap Lock</code>: é—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…å«è®°å½•æœ¬èº«ã€‚</li><li><code>Next-Key Lock</code>: <code>Gap Lock + Record Lock</code>ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</li></ul><p>åŠ é”è§„åˆ™ï¼š</p><p>åœ¨ <code>READ COMMITTED</code> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œé‡‡ç”¨ <code>Record Lock</code>ã€‚<br />åœ¨ <code>REPREATABLE READ</code> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œé‡‡ç”¨ <code>Next-Key Lock</code>ã€‚</p><ul><li><p>å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œ<code>Next-Key Lock</code> ä¼šé™çº§ä¸º <code>Record Lock</code>ï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚</p></li><li><p>è€Œå¯¹äºè¾…åŠ©ç´¢å¼•ï¼Œä¼šåŠ ä¸Š <code>Next-Key Lock</code>ï¼Œè¿˜ä¼šå¯¹è¾…åŠ©ç´¢å¼•çš„ä¸‹ä¸€ä¸ªé”®å€¼åŠ ä¸Š <code>Gap Lock</code>ã€‚</p></li></ul><h1 id="äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸é”é—®é¢˜"><a class="markdownIt-Anchor" href="#äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸é”é—®é¢˜"></a> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸é”é—®é¢˜</h1><h2 id="éš”ç¦»çº§åˆ«"><a class="markdownIt-Anchor" href="#éš”ç¦»çº§åˆ«"></a> éš”ç¦»çº§åˆ«</h2><table><thead><tr><th style="text-align:center">éš”ç¦»çº§åˆ«</th><th style="text-align:center">è„è¯»</th><th style="text-align:center">ä¸å¯é‡å¤è¯»</th><th style="text-align:center">å¹»è¯»</th></tr></thead><tbody><tr><td style="text-align:center">è¯»æœªæäº¤ï¼ˆ<code>READ UNCOMMITTED</code>ï¼‰</td><td style="text-align:center"><code>Y</code></td><td style="text-align:center"><code>Y</code></td><td style="text-align:center"><code>Y</code></td></tr><tr><td style="text-align:center">è¯»å·²æäº¤ï¼ˆ<code>READ COMMITTED</code>ï¼‰</td><td style="text-align:center"><code>N</code></td><td style="text-align:center"><code>Y</code></td><td style="text-align:center"><code>Y</code></td></tr><tr><td style="text-align:center">å¯é‡å¤è¯»ï¼ˆ<code>REPREATABLE READ</code>ï¼‰</td><td style="text-align:center"><code>N</code></td><td style="text-align:center"><code>N</code></td><td style="text-align:center"><code>Y</code> (<code>InnoDB</code> - <code>N</code>)</td></tr><tr><td style="text-align:center">ä¸²è¡ŒåŒ–ï¼ˆ<code>SERIALIZABLE</code>ï¼‰</td><td style="text-align:center"><code>N</code></td><td style="text-align:center"><code>N</code></td><td style="text-align:center"><code>N</code></td></tr></tbody></table><h2 id="è„è¯»"><a class="markdownIt-Anchor" href="#è„è¯»"></a> è„è¯»</h2><blockquote><p>é’ˆå¯¹æœªæäº¤æ•°æ®</p></blockquote><p>è„è¯»æŒ‡çš„æ˜¯åœ¨<strong>ä¸åŒçš„äº‹åŠ¡</strong>ä¸‹ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥è¯»åˆ°å¦å¤–äº‹åŠ¡<strong>æœªæäº¤</strong>çš„æ•°æ®ã€‚</p><p>è„è¯»å‘ç”Ÿçš„æ¡ä»¶æ˜¯éœ€è¦äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸º <code>READ UNCOMMITTED</code>ï¼Œè€Œç›®å‰ç»å¤§éƒ¨åˆ†çš„æ•°æ®åº“éƒ½è‡³å°‘è®¾ç½®æˆ <code>READ COMMITTED</code>ã€‚</p><h2 id="ä¸å¯é‡å¤è¯»"><a class="markdownIt-Anchor" href="#ä¸å¯é‡å¤è¯»"></a> ä¸å¯é‡å¤è¯»</h2><blockquote><p>é’ˆå¯¹å…¶ä»–äº‹åŠ¡æäº¤å‰åï¼Œè¯»å–<strong>æ•°æ®æœ¬èº«</strong>çš„å¯¹æ¯”<br />é‡ç‚¹åœ¨äºåŒä¸€æ¡æ•°æ®è¢«ä¿®æ”¹äº†</p></blockquote><p>ä¸å¯é‡å¤è¯»æ˜¯æŒ‡åœ¨<strong>åŒä¸€äº‹åŠ¡</strong>ä¸‹ï¼Œåœ¨ä¸¤æ¬¡è¯»åŒä¸€ä¸ªæ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¼è‡´ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€æ ·ã€‚</p><p><code>InnoDB</code> åœ¨ <code>REPREATABLE READ</code> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œé‡‡ç”¨ <code>Next-Key Lock</code> è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚</p><h2 id="å¹»è¯»"><a class="markdownIt-Anchor" href="#å¹»è¯»"></a> å¹»è¯»</h2><blockquote><p>é’ˆå¯¹å…¶ä»–äº‹åŠ¡æäº¤å‰åï¼Œè¯»å–<strong>æ•°æ®æ¡æ•°</strong>çš„å¯¹æ¯”<br />é‡ç‚¹åœ¨äºè¡¨ä¸­æ•°æ®çš„<strong>æ–°å¢</strong>æˆ–è€…<strong>åˆ é™¤</strong></p></blockquote><p>å¹»è¯»æ˜¯æŒ‡åœ¨<strong>åŒä¸€äº‹åŠ¡</strong>ä¸‹ï¼Œ<strong>è¿ç»­æ‰§è¡Œä¸¤æ¬¡åŒæ ·çš„ <code>SQL</code> è¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœ</strong>ï¼Œç¬¬äºŒæ¬¡çš„ <code>SQL</code> è¯­å¥å¯èƒ½ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚</p><p><code>InnoDB</code> åœ¨ <code>REPREATABLE READ</code> äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œé‡‡ç”¨ <code>Next-Key Lock</code> å·²ç»èƒ½é¿å…å¹»è¯»çš„äº§ç”Ÿã€‚<br />è€Œå…¶ä»–æ•°æ®åº“ï¼Œå¦‚ <code>ORACLE</code> å¯èƒ½éœ€è¦åœ¨ <code>SERIALIZABLE</code> ä¸‹æ‰èƒ½è§£å†³å¹»è¯»ã€‚</p><h2 id="ç‰ˆæœ¬é“¾"><a class="markdownIt-Anchor" href="#ç‰ˆæœ¬é“¾"></a> ç‰ˆæœ¬é“¾</h2><p>æ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬ï¼Œéƒ½ä¼šè®°å½•ä¸€æ¡ <code>undo</code> æ—¥å¿—ï¼Œæ¯æ¡ <code>undo</code> æ—¥å¿—ä¹Ÿéƒ½æœ‰ä¸€ä¸ª <code>roll_pointer</code> å±æ€§ã€‚</p><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200814164939.png" srcset="/img/loading.gif" alt="" /></p><p>å¯¹è¯¥è®°å½•æ¯æ¬¡æ›´æ–°åï¼Œéƒ½ä¼šå°†æ—§å€¼æ”¾åˆ°ä¸€æ¡ <code>undo</code> æ—¥å¿—ä¸­ï¼Œå°±ç®—æ˜¯è¯¥è®°å½•çš„ä¸€ä¸ªæ—§ç‰ˆæœ¬ï¼Œéšç€æ›´æ–°æ¬¡æ•°çš„å¢å¤šï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šè¢« <code>roll_pointer</code> å±æ€§è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé“¾è¡¨ç§°ä¹‹ä¸ºç‰ˆæœ¬é“¾ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰è®°å½•æœ€æ–°çš„å€¼ã€‚å¦å¤–ï¼Œæ¯ä¸ªç‰ˆæœ¬ä¸­è¿˜åŒ…å«ç”Ÿæˆè¯¥ç‰ˆæœ¬æ—¶å¯¹åº”çš„äº‹åŠ¡ <code>id</code>ã€‚</p><h2 id="readview"><a class="markdownIt-Anchor" href="#readview"></a> <code>ReadView</code></h2><ul><li>å¯¹äºä½¿ç”¨ <code>READ UNCOMMITTED</code> éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œç›´æ¥è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å°±å¥½äº†ã€‚</li><li>å¯¹äºä½¿ç”¨ <code>SERIALIZABLE</code> éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œä½¿ç”¨åŠ é”çš„æ–¹å¼æ¥è®¿é—®è®°å½•ã€‚</li><li>å¯¹äºä½¿ç”¨ <code>READ COMMITTED</code> å’Œ <code>REPEATABLE READ</code> éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå°±éœ€è¦ç”¨åˆ°ç‰ˆæœ¬é“¾äº†ï¼Œæ ¸å¿ƒé—®é¢˜å°±æ˜¯ï¼š<strong>éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„</strong>ã€‚</li></ul><p><code>ReadView</code> ä¸­ä¸»è¦åŒ…å«å½“å‰ç³»ç»Ÿä¸­è¿˜æœ‰å“ªäº›æ´»è·ƒçš„è¯»å†™äº‹åŠ¡ï¼ŒæŠŠå®ƒä»¬çš„äº‹åŠ¡ <code>id</code> æ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚è¿™æ ·åœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œå°±å¯åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ã€‚</p><ul><li><p><code>READ COMMITTED</code>ï¼šæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ª <code>ReadView</code>ï¼Œæ¯æ¬¡éƒ½å¯åˆ¤æ–­äº‹åŠ¡æ˜¯å¦æäº¤ã€‚</p></li><li><p><code>REPEATABLE READ</code>ï¼šåœ¨ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ç”Ÿæˆä¸€ä¸ª <code>ReadView</code>ï¼Œæ¯æ¬¡è®¿é—®æ—¶éƒ½è¯»å–æœ€åˆçš„ç‰ˆæœ¬ã€‚</p></li></ul><h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1><ul><li><a href="https://juejin.im/post/6844903808376504327" target="_blank" rel="noopener">MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«å’ŒMVCC</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>é”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 874. æ¨¡æ‹Ÿè¡Œèµ°æœºå™¨äºº</title>
    <link href="/2020/08/13/LeetCode-874-walking-robot-simulation/"/>
    <url>/2020/08/13/LeetCode-874-walking-robot-simulation/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/walking-robot-simulation/" target="_blank" rel="noopener">874. æ¨¡æ‹Ÿè¡Œèµ°æœºå™¨äºº</a></p><p>ä¸€å¼€å§‹ç”¨çš„ <code>findObstacle()</code>ï¼Œæ¯èµ°ä¸€æ­¥éƒ½è¦éå† <code>obstacles</code>ï¼Œæ•ˆç‡å¾ˆæ…¢ï¼Œå®˜æ–¹é¢˜è§£é‡‡å–<strong>å°†éšœç¢ç¼–ç </strong>çš„æ–¹å¼ï¼Œè¿™æ ·åªè¦ <code>O(1)</code> å°±å¯ä»¥å®Œæˆåˆ¤æ–­ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">robotSim</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] commands, <span class="hljs-keyword">int</span>[][] obstacles)</span> </span>&#123;        <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span>[][] dirs = &#123;                <span class="hljs-comment">// åŒ—ï¼š0</span>                &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;,                <span class="hljs-comment">// ä¸œï¼š1</span>                &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,                <span class="hljs-comment">// å—ï¼š2</span>                &#123;<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>&#125;,                <span class="hljs-comment">// è¥¿ï¼š3</span>                &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,        &#125;;        <span class="hljs-keyword">int</span> dir = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> max = <span class="hljs-number">0</span>;        <span class="hljs-comment">// å°†éšœç¢ç¼–ç ï¼ŒåŠ å¿«åˆ¤æ–­æ•ˆç‡</span>        Set&lt;Long&gt; obstacleSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] ob : obstacles) &#123;            <span class="hljs-keyword">long</span> ox = ob[<span class="hljs-number">0</span>] + <span class="hljs-number">30000</span>;            <span class="hljs-keyword">long</span> oy = ob[<span class="hljs-number">1</span>] + <span class="hljs-number">30000</span>;            obstacleSet.add((ox &lt;&lt; <span class="hljs-number">16</span>) + oy);        &#125;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> step : commands) &#123;            <span class="hljs-keyword">if</span> (step == -<span class="hljs-number">1</span>) &#123;                <span class="hljs-comment">// å³è½¬</span>                dir = (dir + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>;            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step == -<span class="hljs-number">2</span>) &#123;                <span class="hljs-comment">// å·¦è½¬</span>                dir = (dir + <span class="hljs-number">3</span>) % <span class="hljs-number">4</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-comment">// å‘å‰èµ° step æ­¥ï¼Œç›´åˆ°é‡ä¸Šéšœç¢ç‰©</span>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; step; i++) &#123;                    <span class="hljs-keyword">long</span> nx = x + dirs[dir][<span class="hljs-number">0</span>] + <span class="hljs-number">30000</span>;                    <span class="hljs-keyword">long</span> ny = y + dirs[dir][<span class="hljs-number">1</span>] + <span class="hljs-number">30000</span>;                    <span class="hljs-keyword">if</span> (!obstacleSet.contains((nx &lt;&lt; <span class="hljs-number">16</span>) + ny)) &#123;                        x = x + dirs[dir][<span class="hljs-number">0</span>];                        y = y + dirs[dir][<span class="hljs-number">1</span>];                        max = Math.max(max, x * x + y * y);                    &#125;                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> max;    &#125;<span class="hljs-comment">//////////////////////// obsolete ////////////////////////////////</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">findObstacle</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span>[][] obstacles)</span> </span>&#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] ob : obstacles) &#123;            <span class="hljs-keyword">if</span> (ob[<span class="hljs-number">0</span>] == x &amp;&amp; ob[<span class="hljs-number">1</span>] == y) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>è´ªå¿ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 455. åˆ†å‘é¥¼å¹²</title>
    <link href="/2020/08/13/LeetCode-455-assign-cookies/"/>
    <url>/2020/08/13/LeetCode-455-assign-cookies/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/assign-cookies/" target="_blank" rel="noopener">455. åˆ†å‘é¥¼å¹²</a></p><p>ä¼˜å…ˆç”¨å°é¥¼å¹²æ»¡è¶³èƒƒå£å°çš„å­©å­</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">findContentChildren</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] g, <span class="hljs-keyword">int</span>[] s)</span> </span>&#123;        Arrays.sort(g);        Arrays.sort(s);        <span class="hljs-keyword">int</span> child = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> cookie = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span> (child &lt; g.length &amp;&amp; cookie &lt; s.length) &#123;            <span class="hljs-comment">// æ»¡è¶³è¦æ±‚ï¼Œæ¢ä¸‹ä¸€ä¸ªå°å­©</span>            <span class="hljs-keyword">if</span> (s[cookie] &gt;= g[child]) &#123;                count++;                child++;            &#125;            <span class="hljs-comment">// ä¸‹ä¸€ä¸ªé¥¼å¹²</span>            cookie++;        &#125;        <span class="hljs-keyword">return</span> count;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>è´ªå¿ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</title>
    <link href="/2020/08/12/LeetCode-122-best-time-to-buy-and-sell-stock-ii/"/>
    <url>/2020/08/12/LeetCode-122-best-time-to-buy-and-sell-stock-ii/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/" target="_blank" rel="noopener">122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a></p><h1 id="è´ªå¿ƒ"><a class="markdownIt-Anchor" href="#è´ªå¿ƒ"></a> è´ªå¿ƒ</h1><blockquote><p>è´ªå¿ƒçš„æ€æƒ³åœ¨äºæ¯ä¸€æ­¥ä½œå‡ºçš„å†³ç­–åœ¨ç°åœ¨çœ‹æ¥æ€»æ˜¯æœ€å¥½çš„ï¼Œå®ƒä¸å…³å¿ƒè¿‡å»æˆ–è€…æœªæ¥çš„çŠ¶æ€ã€‚</p></blockquote><p>åªè¦ä»Šå¤©çš„ä»·æ ¼é«˜äºæ˜å¤©å°±è®¡ç®—æ”¶ç›Šï¼šç›¸å½“äºåœ¨ä»Šå¤©åˆ¤æ–­ï¼šæ˜¯å¦ä¹°å…¥æ˜¨å¤©ï¼Œå–å‡ºä»Šå¤©ã€‚è¿™æ ·æ¯ä¸€å¤©éƒ½æœ‰æ”¶ç›Šï¼Œæœ€ç»ˆçš„æ”¶ç›Šå°±æ˜¯æœ€å¤§çš„ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">maxProfit</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] prices)</span> </span>&#123;        <span class="hljs-keyword">int</span> profit = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; prices.length; i++) &#123;            <span class="hljs-keyword">int</span> cur = prices[i] - prices[i - <span class="hljs-number">1</span>];            <span class="hljs-keyword">if</span> (cur &gt; <span class="hljs-number">0</span>)&#123;                profit += cur;            &#125;        &#125;        <span class="hljs-keyword">return</span> profit;    &#125;</code></pre><h1 id="åŠ¨æ€è§„åˆ’"><a class="markdownIt-Anchor" href="#åŠ¨æ€è§„åˆ’"></a> åŠ¨æ€è§„åˆ’</h1><p><strong>1. çŠ¶æ€ <code>dp[i][j]</code></strong>:</p><p>ç¬¬ <code>i</code> å¤©æ‰€èƒ½è·å¾—çš„æœ€å¤§åˆ©æ¶¦ï¼Œ<code>j = 0</code>: ç¬¬ <code>i</code> å¤©æŒæœ‰ç°é‡‘ï¼Œ<code>j = 1</code>: ç¬¬ <code>i</code> å¤©æŒæœ‰è‚¡ç¥¨ã€‚</p><p><strong>2. çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</strong></p><p>æ¯ä¸€å¤©å¯èƒ½æŒæœ‰è‚¡ç¥¨æˆ–ç°é‡‘ã€‚</p><ul><li>è‹¥ç¬¬ <code>i</code> å¤©æŒæœ‰è‚¡ç¥¨ (<code>dp[i][0]</code>)ï¼š<ul><li>ç¬¬ <code>i - 1</code> å¤©æŒæœ‰è‚¡ç¥¨ï¼Œåˆ™ç¬¬ <code>i</code> å¤©æ— æ“ä½œã€‚</li><li>ç¬¬ <code>i - 1</code> å¤©æŒæœ‰ç°é‡‘ï¼Œåˆ™ç¬¬ <code>i</code> å¤©ä¹°å…¥æ–°è‚¡ç¥¨  (<code>+prices[i]</code>)ã€‚</li></ul></li><li>è‹¥ç¬¬ <code>i</code> å¤©æŒæœ‰ç°é‡‘ (<code>dp[i][1]</code>)ï¼š<ul><li>ç¬¬ <code>i - 1</code> å¤©æŒæœ‰è‚¡ç¥¨ï¼Œåˆ™ç¬¬ <code>i</code> å¤©å–å‡º (<code>-prices[i]</code>)ã€‚</li><li>ç¬¬ <code>i - 1</code> å¤©æŒæœ‰ç°é‡‘ï¼Œåˆ™ç¬¬ <code>i</code> å¤©æ— æ“ä½œã€‚</li></ul></li></ul><p><strong>3. ç»“æŸ</strong></p><p>è¾“å‡ºæœ€åä¸€å¤©æŒæœ‰ç°é‡‘ (<code>dp[len - 1][0]</code>)ï¼ŒæŒæœ‰ç°é‡‘çš„æƒ…å†µä¸‹æ‰ä¼šæŠŠä¹‹å‰çš„è‚¡ç¥¨å–å‡ºï¼Œè‹¥æœ€åä¸€å¤©æŒæœ‰è‚¡ç¥¨ï¼Œé‡‘é¢è¿˜ä¼šæ›´å°‘ <code>dp[len - 1][0] &gt; dp[len - 1][1]</code>ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">maxProfit</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] prices)</span> </span>&#123;        <span class="hljs-keyword">int</span>[][] dp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[prices.length][<span class="hljs-number">2</span>];        dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;        dp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = -prices[<span class="hljs-number">0</span>];        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; prices.length; i++) &#123;            <span class="hljs-comment">// ç¬¬ i å¤©æŒæœ‰ç°é‡‘</span>            dp[i][<span class="hljs-number">0</span>] = Math.max(dp[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>], dp[i - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + prices[i]);            <span class="hljs-comment">// ç¬¬ i å¤©æŒæœ‰è‚¡ç¥¨</span>            dp[i][<span class="hljs-number">1</span>] = Math.max(dp[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - prices[i], dp[i - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);        &#125;        <span class="hljs-keyword">return</span> dp[prices.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>];    &#125;</code></pre><p><strong>çŠ¶æ€å‹ç¼©</strong></p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">maxProfit</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] prices)</span> </span>&#123;        <span class="hljs-comment">// ä»Šå¤©æŒæœ‰ç°é‡‘</span>        <span class="hljs-keyword">int</span> cash = <span class="hljs-number">0</span>;        <span class="hljs-comment">// ä»Šå¤©æŒæœ‰è‚¡ç¥¨</span>        <span class="hljs-keyword">int</span> hold = <span class="hljs-number">0</span>;                <span class="hljs-comment">// æ˜¨å¤©æŒæœ‰ç°é‡‘</span>        <span class="hljs-keyword">int</span> preCash = <span class="hljs-number">0</span>;        <span class="hljs-comment">// æ˜¨å¤©æŒæœ‰è‚¡ç¥¨</span>        <span class="hljs-keyword">int</span> preHold = -prices[<span class="hljs-number">0</span>];                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> price : prices) &#123;            cash = Math.max(preCash, preHold + price);            hold = Math.max(preHold, preCash - price);                        preCash = cash;            preHold = hold;        &#125;        <span class="hljs-keyword">return</span> cash;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>è´ªå¿ƒ</tag>
      
      <tag>åŠ¨æ€è§„åˆ’</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 860. æŸ æª¬æ°´æ‰¾é›¶</title>
    <link href="/2020/08/11/LeetCode-860-lemonade-change/"/>
    <url>/2020/08/11/LeetCode-860-lemonade-change/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/lemonade-change/" target="_blank" rel="noopener">860. æŸ æª¬æ°´æ‰¾é›¶</a></p><blockquote><p>ä¸å¸¦é›¶é’±ä½ ä¹°ä»€ä¹ˆæŸ æª¬æ°´ï¼ï¼ï¼</p></blockquote><p>è™½ç„¶æœ‰ç‚¹è´ªå¿ƒçš„æ€æƒ³ï¼Œæˆ‘æ„Ÿè§‰è¿™é¢˜åœ¨æç¬‘ã€‚ã€‚ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lemonadeChange</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] bills)</span> </span>&#123;        <span class="hljs-keyword">if</span> (bills.length == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;        <span class="hljs-keyword">int</span> five = <span class="hljs-number">0</span>, ten = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> money : bills) &#123;            <span class="hljs-keyword">switch</span> (money) &#123;                <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:                    five++;                    <span class="hljs-keyword">break</span>;                <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:                    five--;                    ten++;                    <span class="hljs-keyword">break</span>;                <span class="hljs-keyword">case</span> <span class="hljs-number">20</span>:                    <span class="hljs-keyword">if</span> (ten &gt; <span class="hljs-number">0</span>) &#123;                        five--;                        ten--;                    &#125; <span class="hljs-keyword">else</span> &#123;                        five -= <span class="hljs-number">3</span>;                    &#125;                    <span class="hljs-keyword">break</span>;                <span class="hljs-keyword">default</span>:                    <span class="hljs-keyword">break</span>;            &#125;            <span class="hljs-keyword">if</span> (five &lt; <span class="hljs-number">0</span>) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>è´ªå¿ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 529. æ‰«é›·æ¸¸æˆ</title>
    <link href="/2020/08/11/LeetCode-529-minesweeper/"/>
    <url>/2020/08/11/LeetCode-529-minesweeper/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/minesweeper/" target="_blank" rel="noopener">529. æ‰«é›·æ¸¸æˆ</a></p><h1 id="dfs"><a class="markdownIt-Anchor" href="#dfs"></a> DFS</h1><blockquote><p>æ‰¾å‘¨å›´çš„é›·å’Œè¿›å…¥ä¸‹ä¸€å±‚é€’å½’éƒ½æ˜¯åœ¨ <strong>å…«ä¸ªæ–¹å‘</strong> æ¸¸èµ°ã€‚</p></blockquote><p>å…¸å‹çš„ <code>DFS</code>ã€‚</p><p>è‹¥ <code>click</code> ä½ç½®ä¸º <code>M</code>ï¼Œæ ‡è®°è¿”å›ï¼Œå¦åˆ™è¿›å…¥é€’å½’ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯æ–°çš„ä½ç½®ä¸èƒ½è¶Šç•Œï¼Œä¸”æœªè¢«æ ‡è®°è¿‡ã€‚</p><ol><li>è‹¥å‘¨å›´æœ‰é›·ï¼Œéå†å‘¨å›´çš„å…«ä¸ªä½ç½®ï¼Œæ‰¾åˆ°é›·çš„æ•°é‡ï¼Œæ ‡è®°åè¿”å›</li><li>è‹¥å‘¨å›´æ²¡æœ‰é›·ï¼Œæ ‡è®°ä¸º <code>B</code>ï¼Œéå†å‘¨å›´å…«ä¸ªä½ç½®ï¼Œè¿›å…¥é€’å½’ã€‚</li></ol><pre><code class="hljs java"><span class="hljs-keyword">int</span>[][] dirs = &#123;            <span class="hljs-comment">// ä¸Šï¼š(x - 1, y)</span>            &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,            <span class="hljs-comment">// ä¸‹ï¼š(x + 1, y)</span>            &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,            <span class="hljs-comment">// å·¦ï¼š(x, y - 1)</span>            &#123;<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>&#125;,            <span class="hljs-comment">// å³ï¼š(x, y + 1)</span>            &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;,            <span class="hljs-comment">// å·¦ä¸Šï¼š(x - 1, y - 1)</span>            &#123;-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>&#125;,            <span class="hljs-comment">// å³ä¸Šï¼Œ(x - 1, y + 1)</span>            &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;,            <span class="hljs-comment">// å·¦ä¸‹ï¼š(x + 1, y - 1)</span>            &#123;<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>&#125;,            <span class="hljs-comment">// å³ä¸‹ï¼š(x + 1, y + 1)</span>            &#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;    &#125;;    <span class="hljs-keyword">boolean</span>[][] used;        <span class="hljs-keyword">public</span> <span class="hljs-keyword">char</span>[][] updateBoard(<span class="hljs-keyword">char</span>[][] board, <span class="hljs-keyword">int</span>[] click) &#123;        <span class="hljs-keyword">if</span> (notInArea(click[<span class="hljs-number">0</span>], click[<span class="hljs-number">1</span>], board)) &#123;            <span class="hljs-keyword">return</span> board;        &#125;        <span class="hljs-keyword">if</span> (board[click[<span class="hljs-number">0</span>]][click[<span class="hljs-number">1</span>]] == <span class="hljs-string">'M'</span>) &#123;            board[click[<span class="hljs-number">0</span>]][click[<span class="hljs-number">1</span>]] = <span class="hljs-string">'X'</span>;            <span class="hljs-keyword">return</span> board;        &#125; <span class="hljs-keyword">else</span> &#123;            used = <span class="hljs-keyword">new</span> <span class="hljs-keyword">boolean</span>[board.length][board[<span class="hljs-number">0</span>].length];            dfs(click[<span class="hljs-number">0</span>], click[<span class="hljs-number">1</span>], board);        &#125;        <span class="hljs-keyword">return</span> board;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">char</span>[][] board)</span> </span>&#123;        used[x][y] = <span class="hljs-keyword">true</span>;        <span class="hljs-keyword">int</span> mineCount = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] dir : dirs) &#123;            <span class="hljs-keyword">int</span> newX = x + dir[<span class="hljs-number">0</span>];            <span class="hljs-keyword">int</span> newY = y + dir[<span class="hljs-number">1</span>];            <span class="hljs-keyword">if</span> (notInArea(newX, newY, board)) &#123;                <span class="hljs-keyword">continue</span>;            &#125;            <span class="hljs-keyword">if</span> (board[newX][newY] == <span class="hljs-string">'M'</span>) &#123;                mineCount++;            &#125;        &#125;        <span class="hljs-comment">// æ‰¾åˆ°åœ°é›·è¿”å›ä¸Šä¸€å±‚</span>        <span class="hljs-keyword">if</span> (mineCount &gt; <span class="hljs-number">0</span>) &#123;            board[x][y] = (<span class="hljs-keyword">char</span>) (mineCount + <span class="hljs-string">'0'</span>);            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// æœªæ‰¾åˆ°é›·ï¼Œè¿›è¡Œæ ‡è®°ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªä½ç½®</span>        board[x][y] = <span class="hljs-string">'B'</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] dir : dirs) &#123;            <span class="hljs-keyword">int</span> newX = x + dir[<span class="hljs-number">0</span>];            <span class="hljs-keyword">int</span> newY = y + dir[<span class="hljs-number">1</span>];            <span class="hljs-keyword">if</span> (notInArea(newX, newY, board) || used[newX][newY]) &#123;                <span class="hljs-keyword">continue</span>;            &#125;            dfs(newX, newY, board);        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">notInArea</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">char</span>[][] board)</span> </span>&#123;        <span class="hljs-keyword">return</span> x &lt; <span class="hljs-number">0</span> || x &gt;= board.length                || y &lt; <span class="hljs-number">0</span> || y &gt;= board[<span class="hljs-number">0</span>].length;    &#125;</code></pre><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><pre><code class="hljs java"><span class="hljs-keyword">int</span>[][] dirs = &#123;        <span class="hljs-comment">// ä¸Šï¼š(x - 1, y)</span>        &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,        <span class="hljs-comment">// ä¸‹ï¼š(x + 1, y)</span>        &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,        <span class="hljs-comment">// å·¦ï¼š(x, y - 1)</span>        &#123;<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>&#125;,        <span class="hljs-comment">// å³ï¼š(x, y + 1)</span>        &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;,        <span class="hljs-comment">// å·¦ä¸Šï¼š(x - 1, y - 1)</span>        &#123;-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>&#125;,        <span class="hljs-comment">// å³ä¸Šï¼Œ(x - 1, y + 1)</span>        &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;,        <span class="hljs-comment">// å·¦ä¸‹ï¼š(x + 1, y - 1)</span>        &#123;<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>&#125;,        <span class="hljs-comment">// å³ä¸‹ï¼š(x + 1, y + 1)</span>        &#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;&#125;;<span class="hljs-keyword">boolean</span>[][] used;<span class="hljs-keyword">public</span> <span class="hljs-keyword">char</span>[][] updateBoard(<span class="hljs-keyword">char</span>[][] board, <span class="hljs-keyword">int</span>[] click) &#123;    <span class="hljs-keyword">if</span> (notInArea(click[<span class="hljs-number">0</span>], click[<span class="hljs-number">1</span>], board)) &#123;        <span class="hljs-keyword">return</span> board;    &#125;    <span class="hljs-keyword">if</span> (board[click[<span class="hljs-number">0</span>]][click[<span class="hljs-number">1</span>]] == <span class="hljs-string">'M'</span>) &#123;        board[click[<span class="hljs-number">0</span>]][click[<span class="hljs-number">1</span>]] = <span class="hljs-string">'X'</span>;        <span class="hljs-keyword">return</span> board;    &#125;    used = <span class="hljs-keyword">new</span> <span class="hljs-keyword">boolean</span>[board.length][board[<span class="hljs-number">0</span>].length];    Queue&lt;<span class="hljs-keyword">int</span>[]&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();    queue.add(click);    <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;        <span class="hljs-keyword">int</span>[] cur = queue.poll();        used[cur[<span class="hljs-number">0</span>]][cur[<span class="hljs-number">1</span>]] = <span class="hljs-keyword">true</span>;        <span class="hljs-keyword">int</span> mineCount = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] dir : dirs) &#123;            <span class="hljs-keyword">int</span> newX = cur[<span class="hljs-number">0</span>] + dir[<span class="hljs-number">0</span>];            <span class="hljs-keyword">int</span> newY = cur[<span class="hljs-number">1</span>] + dir[<span class="hljs-number">1</span>];            <span class="hljs-keyword">if</span> (notInArea(newX, newY, board)) &#123;                <span class="hljs-keyword">continue</span>;            &#125;            <span class="hljs-keyword">if</span> (board[newX][newY] == <span class="hljs-string">'M'</span>) &#123;                mineCount++;            &#125;        &#125;        <span class="hljs-keyword">if</span> (mineCount &gt; <span class="hljs-number">0</span>) &#123;            board[cur[<span class="hljs-number">0</span>]][cur[<span class="hljs-number">1</span>]] = (<span class="hljs-keyword">char</span>) (mineCount + <span class="hljs-string">'0'</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            board[cur[<span class="hljs-number">0</span>]][cur[<span class="hljs-number">1</span>]] = <span class="hljs-string">'B'</span>;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] dir : dirs) &#123;                <span class="hljs-keyword">int</span> newX = cur[<span class="hljs-number">0</span>] + dir[<span class="hljs-number">0</span>];                <span class="hljs-keyword">int</span> newY = cur[<span class="hljs-number">1</span>] + dir[<span class="hljs-number">1</span>];                <span class="hljs-keyword">if</span> (notInArea(newX, newY, board) || used[newX][newY]) &#123;                    <span class="hljs-keyword">continue</span>;                &#125;                queue.add(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[]&#123;newX, newY&#125;);                <span class="hljs-comment">// é¿å…è¶…æ—¶</span>                used[newX][newY] = <span class="hljs-keyword">true</span>;            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> board;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">notInArea</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">char</span>[][] board)</span> </span>&#123;    <span class="hljs-keyword">return</span> x &lt; <span class="hljs-number">0</span> || x &gt;= board.length            || y &lt; <span class="hljs-number">0</span> || y &gt;= board[<span class="hljs-number">0</span>].length;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>DFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 200. å²›å±¿æ•°é‡</title>
    <link href="/2020/08/10/LeetCode-200-number-of-islands/"/>
    <url>/2020/08/10/LeetCode-200-number-of-islands/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/number-of-islands/" target="_blank" rel="noopener">200. å²›å±¿æ•°é‡</a></p><h1 id="dfs"><a class="markdownIt-Anchor" href="#dfs"></a> DFS</h1><pre><code class="hljs java"><span class="hljs-keyword">int</span> rows;    <span class="hljs-keyword">int</span> cols;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å·²è¢«è®¿é—®çš„æ•°ç»„</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">boolean</span>[][] visited;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ç§»åŠ¨æ–¹å‘</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">int</span>[][] dir = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[][]&#123;            <span class="hljs-comment">// ä¸Š: (x - 1, y)</span>            &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,            <span class="hljs-comment">// å³: (x, y + 1)</span>            &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;,            <span class="hljs-comment">// ä¸‹: (x + 1, y)</span>            &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,            <span class="hljs-comment">// å·¦: (x, y - 1)</span>            &#123;<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>&#125;    &#125;;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">numIslands</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[][] grid)</span> </span>&#123;        rows = grid.length;        <span class="hljs-keyword">if</span> (rows &lt; <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;        &#125;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        cols = grid[<span class="hljs-number">0</span>].length;        visited = <span class="hljs-keyword">new</span> <span class="hljs-keyword">boolean</span>[rows][cols];        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++) &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; cols; j++) &#123;                <span class="hljs-comment">// å½“å‰ä½ç½®æœªè®¿é—®è¿‡ &amp;&amp; æ˜¯é™†åœ°</span>                <span class="hljs-keyword">if</span> (!visited[i][j] &amp;&amp; grid[i][j] == <span class="hljs-string">'1'</span>) &#123;                    <span class="hljs-comment">// åªè¦æœªè®¿é—®è¿‡ä¸”ä¸º 1 è‚¯å®šå­˜åœ¨ä¸€ä¸ªå²›å±¿</span>                    <span class="hljs-comment">// éœ€è¦åšçš„å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªå²›å±¿è¿é€šçš„æ‰€æœ‰ä½ç½®</span>                    count++;                    dfs(grid, i, j);                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> count;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[][] grid, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;        visited[x][y] = <span class="hljs-keyword">true</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; dir.length; i++) &#123;            <span class="hljs-keyword">int</span> nextX = x + dir[i][<span class="hljs-number">0</span>];            <span class="hljs-keyword">int</span> nextY = y + dir[i][<span class="hljs-number">1</span>];            <span class="hljs-comment">// æ–°ä½ç½® æœªè¶Šç•Œ &amp;&amp; æœªè®¿é—®è¿‡ &amp;&amp; æ˜¯é™†åœ°</span>            <span class="hljs-keyword">if</span> (inArea(nextX, nextY) &amp;&amp; !visited[nextX][nextY] &amp;&amp; grid[nextX][nextY] == <span class="hljs-string">'1'</span>) &#123;                dfs(grid, nextX, nextY);            &#125;        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">inArea</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;        <span class="hljs-keyword">return</span> x &gt;= <span class="hljs-number">0</span> &amp;&amp; x &lt; rows &amp;&amp; y &gt;= <span class="hljs-number">0</span> &amp;&amp; y &lt; cols;    &#125;</code></pre><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><pre><code class="hljs java"><span class="hljs-keyword">int</span> rows;<span class="hljs-keyword">int</span> cols;<span class="hljs-comment">/**</span><span class="hljs-comment"> * å·²è¢«è®¿é—®çš„æ•°ç»„</span><span class="hljs-comment"> */</span><span class="hljs-keyword">boolean</span>[][] visited;<span class="hljs-comment">/**</span><span class="hljs-comment"> * ç§»åŠ¨æ–¹å‘</span><span class="hljs-comment"> */</span><span class="hljs-keyword">int</span>[][] dir = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[][]&#123;        <span class="hljs-comment">// ä¸Š: (x - 1, y)</span>        &#123;-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,        <span class="hljs-comment">// å³: (x, y + 1)</span>        &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;,        <span class="hljs-comment">// ä¸‹: (x + 1, y)</span>        &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,        <span class="hljs-comment">// å·¦: (x, y - 1)</span>        &#123;<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>&#125;&#125;;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;    <span class="hljs-keyword">int</span> x;    <span class="hljs-keyword">int</span> y;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;        <span class="hljs-keyword">this</span>.x = x;        <span class="hljs-keyword">this</span>.y = y;    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">numIslands</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[][] grid)</span> </span>&#123;    rows = grid.length;    <span class="hljs-keyword">if</span> (rows &lt; <span class="hljs-number">1</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;    cols = grid[<span class="hljs-number">0</span>].length;    visited = <span class="hljs-keyword">new</span> <span class="hljs-keyword">boolean</span>[rows][cols];    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++) &#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; cols; j++) &#123;            <span class="hljs-comment">// å½“å‰ä½ç½®æœªè®¿é—®è¿‡ &amp;&amp; æ˜¯é™†åœ°</span>            <span class="hljs-keyword">if</span> (!visited[i][j] &amp;&amp; grid[i][j] == <span class="hljs-string">'1'</span>) &#123;                <span class="hljs-comment">// åªè¦æœªè®¿é—®è¿‡ä¸”ä¸º 1 è‚¯å®šå­˜åœ¨ä¸€ä¸ªå²›å±¿</span>                <span class="hljs-comment">// éœ€è¦åšçš„å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªå²›å±¿è¿é€šçš„æ‰€æœ‰ä½ç½®</span>                count++;                Queue&lt;Node&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();                visited[i][j] = <span class="hljs-keyword">true</span>;                queue.offer(<span class="hljs-keyword">new</span> Node(i, j));                <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;                    Node cur = queue.poll();                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; dir.length; k++) &#123;                        <span class="hljs-keyword">int</span> nextX = cur.x + dir[k][<span class="hljs-number">0</span>];                        <span class="hljs-keyword">int</span> nextY = cur.y + dir[k][<span class="hljs-number">1</span>];                        <span class="hljs-comment">// æ–°ä½ç½® æœªè¶Šç•Œ &amp;&amp; æœªè®¿é—®è¿‡ &amp;&amp; æ˜¯é™†åœ°</span>                        <span class="hljs-keyword">if</span> (inArea(nextX, nextY) &amp;&amp; !visited[nextX][nextY] &amp;&amp; grid[nextX][nextY] == <span class="hljs-string">'1'</span>) &#123;                            queue.offer(<span class="hljs-keyword">new</span> Node(nextX, nextY));                            visited[nextX][nextY] = <span class="hljs-keyword">true</span>;                        &#125;                    &#125;                &#125;            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> count;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">inArea</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;    <span class="hljs-keyword">return</span> x &gt;= <span class="hljs-number">0</span> &amp;&amp; x &lt; rows &amp;&amp; y &gt;= <span class="hljs-number">0</span> &amp;&amp; y &lt; cols;&#125;</code></pre><h1 id="å¹¶æŸ¥é›†"><a class="markdownIt-Anchor" href="#å¹¶æŸ¥é›†"></a> å¹¶æŸ¥é›†</h1><pre><code class="hljs java"><span class="hljs-comment">// TODO</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>DFS</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 126. å•è¯æ¥é¾™ II</title>
    <link href="/2020/08/09/LeetCode-126-word-ladder-ii/"/>
    <url>/2020/08/09/LeetCode-126-word-ladder-ii/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/word-ladder-ii/" target="_blank" rel="noopener">126. å•è¯æ¥é¾™ II</a></p><ul><li>æ‰¾çš„æ˜¯æœ€çŸ­è·¯å¾„ï¼Œä¸”å¯èƒ½æœ‰å¤šä¸ª</li><li>ä¸€å¼€å§‹ç”¨çš„ <code>List</code> å­˜æ”¾æ¯å±‚å…ƒç´ ï¼Œç»“æœ å›æº¯çš„æ—¶å€™éš¾ä»¥è®¿é—®ä¸‹ä¸€å±‚ï¼Œæœ€å¥½ç”¨ <code>Map</code> å­˜æ”¾</li><li>ï¼ï¼æœ€çŸ­è·¯å¾„è¦åŠæ—¶å‰ªæ</li><li>ï¼ï¼ä¸èƒ½ç”¨ <code>used</code> æ•°ç»„æ ‡è®°è®¿é—®è¿‡çš„å…ƒç´ ï¼Œè€Œæ˜¯æ ‡è®°å½“å‰å±‚å’Œä»¥ä¸Šå±‚å·²ç»è®¿é—®è¿‡çš„æ•°ç»„ï¼Œå› ä¸ºè‹¥å­˜åœ¨å¤šä¸ªæœ€çŸ­è·¯å¾„ï¼Œå…ƒç´ å¯èƒ½é‡å¤ä½¿ç”¨ï¼Œ<code>used</code> æ•°ç»„æ ‡è®°åä¼šæŠŠä¸‹å±‚çš„å…ƒç´ ä¹Ÿæ ‡è®°ï¼Œä¼šå¯¼è‡´æ¼è§£ã€‚</li></ul><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;List&lt;String&gt;&gt; findLadders(String beginWord, String endWord, List&lt;String&gt; wordList) &#123;        List&lt;List&lt;String&gt;&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">if</span> (!wordList.contains(endWord)) &#123;            <span class="hljs-keyword">return</span> res;        &#125;        <span class="hljs-comment">// boolean[] used = new boolean[wordList.size()];</span>        Queue&lt;String&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();        queue.offer(beginWord);        <span class="hljs-comment">// int start = wordList.indexOf(beginWord);</span>        <span class="hljs-comment">// if (start != -1) &#123;</span>        <span class="hljs-comment">//     used[start] = true;</span>        <span class="hljs-comment">// &#125;</span>        <span class="hljs-keyword">boolean</span> found = <span class="hljs-keyword">false</span>;        <span class="hljs-comment">// key: å½“å‰å±‚æ¯ä¸€ä¸ªå•è¯ value: æ¯ä¸ªå•è¯å¯¹åº”çš„ä¸‹ä¸€å±‚æ‰€æœ‰å•è¯</span>        Map&lt;String, HashSet&lt;String&gt;&gt; successors = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        Set&lt;String&gt; level = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();        Set&lt;String&gt; visited = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;            <span class="hljs-keyword">int</span> size = queue.size();            <span class="hljs-keyword">while</span> (size-- &gt; <span class="hljs-number">0</span>) &#123;                String word = queue.poll();                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; wordList.size(); i++) &#123;                    String candidate = wordList.get(i);                    <span class="hljs-comment">// ä¸‹ä¸€å±‚ candidate æœªè¢«ä½¿ç”¨ &amp;&amp; å¯ä»¥æ¥é¾™</span>                    <span class="hljs-keyword">if</span> (!visited.contains(candidate) &amp;&amp; canLadder(word, candidate)) &#123;                        <span class="hljs-comment">// System.out.println(word + " -&gt; " + candidate);</span>                        <span class="hljs-keyword">if</span> (endWord.equals(candidate)) &#123;                            found = <span class="hljs-keyword">true</span>;                        &#125;                        <span class="hljs-keyword">if</span> (!level.contains(candidate))&#123;                            <span class="hljs-comment">// used[i] = true;</span>                            queue.offer(candidate);                            level.add(candidate);                        &#125;                        successors.computeIfAbsent(word, e -&gt; <span class="hljs-keyword">new</span> HashSet&lt;&gt;());                        successors.get(word).add(candidate);                    &#125;                &#125;            &#125;            <span class="hljs-comment">// è‹¥ found ä¸º trueï¼Œè¯´æ˜å·²æ‰¾åˆ° end çš„è·¯å¾„</span>            <span class="hljs-comment">// å¯ä¿è¯ä¸ºæœ€çŸ­è·¯å¾„</span>            <span class="hljs-comment">// ! ç¬¬ä¸€æ¬¡æäº¤æ²¡ AC çš„åŸå› ï¼šå¿˜äº†æ‰¾æœ€çŸ­è·¯å¾„ï¼ŒæŠŠæ‰€æœ‰è·¯å¾„éƒ½æ‰¾å‡ºæ¥äº†</span>            <span class="hljs-keyword">if</span> (found) &#123;                <span class="hljs-keyword">break</span>;            &#125;            System.out.println(level.toString());            visited.addAll(level);            level.clear();        &#125;        System.out.println(successors.toString());        <span class="hljs-comment">// æœªæ‰¾åˆ°ï¼Œè¿”å›ç©ºé›†</span>        <span class="hljs-keyword">if</span> (!found) &#123;            <span class="hljs-keyword">return</span> res;        &#125;        List&lt;String&gt; path = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        path.add(beginWord);        dfs(beginWord, endWord, path, successors, res);        System.out.println(res);        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(String beginWord, String endWord, List&lt;String&gt; path, Map&lt;String, HashSet&lt;String&gt;&gt; successors, List&lt;List&lt;String&gt;&gt; res)</span> </span>&#123;        <span class="hljs-keyword">if</span> (endWord.equals(beginWord)) &#123;            res.add(<span class="hljs-keyword">new</span> ArrayList&lt;&gt;(path));            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// ï¼åŠæ—¶å‰ªæï¼Œå¦åˆ™ NPE</span>        <span class="hljs-keyword">if</span> (!successors.containsKey(beginWord)) &#123;            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// é€‰æ‹©é˜Ÿåˆ—ï¼šæ˜¯å½“å‰ å•è¯ çš„ä¸‹ä¸€å±‚ï¼Œ</span>        <span class="hljs-comment">// æ‰€ä»¥å¦‚æœç”¨ List æ¥ä¿å­˜æ¯ä¸€å±‚çš„è¯ï¼Œè·å–ä¸‹ä¸€å±‚å°±ä¼šæ¯”è¾ƒéº»çƒ¦</span>        HashSet&lt;String&gt; successor = successors.get(beginWord);        <span class="hljs-keyword">for</span> (String word : successor) &#123;            <span class="hljs-keyword">if</span> (path.contains(word)) &#123;                <span class="hljs-keyword">continue</span>;            &#125;            path.add(word);            dfs(word, endWord, path, successors, res);            path.remove(word);        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">canLadder</span><span class="hljs-params">(String word, String candidate)</span> </span>&#123;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; word.length(); i++) &#123;            <span class="hljs-keyword">if</span> (word.charAt(i) != candidate.charAt(i)) &#123;                <span class="hljs-keyword">if</span> (++count &gt; <span class="hljs-number">1</span>) &#123;                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>DFS</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 127. å•è¯æ¥é¾™</title>
    <link href="/2020/08/08/LeetCode-127-word-ladder/"/>
    <url>/2020/08/08/LeetCode-127-word-ladder/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/word-ladder/" target="_blank" rel="noopener">127. å•è¯æ¥é¾™</a></p><p>å’Œ 433.æœ€å°åŸºå› é‚£é¢˜å¾ˆåƒï¼Œä¸è¿‡æœ¬é¢˜å˜å¼‚çš„å­—æ¯æ˜¯ä¸ç¡®å®šçš„ï¼Œä¸å†æ˜¯ <code>ACGT</code>ï¼Œè‹¥ç”¨å›æº¯ä¼šè¶…æ—¶ã€‚</p><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ladderLength</span><span class="hljs-params">(String beginWord, String endWord, List&lt;String&gt; wordList)</span> </span>&#123;        <span class="hljs-comment">// ! endWord ä¸åœ¨ wordList ä¸­ç›´æ¥è¿”å›</span>        <span class="hljs-keyword">if</span> (!wordList.contains(endWord)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;        &#125;        <span class="hljs-keyword">boolean</span>[] used = <span class="hljs-keyword">new</span> <span class="hljs-keyword">boolean</span>[wordList.size()];        LinkedList&lt;String&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();        <span class="hljs-comment">// å°† beginWord åŠ å…¥é˜Ÿåˆ—ï¼Œæ ‡è®°è®¿é—®æ•°ç»„</span>        queue.offer(beginWord);        <span class="hljs-keyword">int</span> start = wordList.indexOf(beginWord);        <span class="hljs-keyword">if</span> (start != -<span class="hljs-number">1</span>) &#123;            used[start] = <span class="hljs-keyword">true</span>;        &#125;        <span class="hljs-keyword">int</span> step = <span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;            step++;            <span class="hljs-comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ ç›¸å½“äºä¸Šä¸€ä¸ª word å¯å‘ä¸‹æ¥é¾™çš„æ‰€æœ‰é€‰æ‹©</span>            <span class="hljs-keyword">int</span> size = queue.size();            <span class="hljs-keyword">while</span> (size-- &gt; <span class="hljs-number">0</span>) &#123;                String word = queue.poll();                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; wordList.size(); i++) &#123;                    String candidate = wordList.get(i);                    <span class="hljs-comment">// è‹¥å·²ç»è®¿é—®è¿‡ || word æ— æ³•æ¥é¾™åˆ° candidateï¼Œåˆ™è·³è¿‡ </span>                    <span class="hljs-keyword">if</span> (used[i] || !canLadder(word, candidate)) &#123;                        <span class="hljs-keyword">continue</span>;                    &#125;                    <span class="hljs-comment">// candidate åˆ°è¾¾ endï¼Œè¿”å›</span>                    <span class="hljs-keyword">if</span> (endWord.equals(candidate)) &#123;                        <span class="hljs-keyword">return</span> step + <span class="hljs-number">1</span>;                    &#125; <span class="hljs-keyword">else</span> &#123;                        <span class="hljs-comment">// æ ‡è®°è®¿é—®æ•°ç»„ï¼Œå°† candidate åŠ å…¥é˜Ÿåˆ—</span>                        used[i] = <span class="hljs-keyword">true</span>;                        queue.offer(candidate);                    &#125;                &#125;            &#125;        &#125;        <span class="hljs-comment">// ï¼ï¼ï¼è¿”å› 0ï¼Œä¸æ˜¯ step</span>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">canLadder</span><span class="hljs-params">(String word, String candidate)</span> </span>&#123;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; candidate.length(); i++) &#123;            <span class="hljs-keyword">if</span> (word.charAt(i) != candidate.charAt(i)) &#123;                <span class="hljs-keyword">if</span> (++count &gt; <span class="hljs-number">1</span>) &#123;                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;</code></pre><h1 id="åŒå‘-bfs"><a class="markdownIt-Anchor" href="#åŒå‘-bfs"></a> åŒå‘ BFS</h1><p>é‡‡ç”¨å·¦å³ä¸¤ä¸ªæ‰©æ•£é›†åˆï¼Œå½“é›†åˆé‡å¤å³è¡¨ç¤ºæ‰©æ•£ç»“æŸã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ladderLength</span><span class="hljs-params">(String beginWord, String endWord, List&lt;String&gt; wordList)</span> </span>&#123;        <span class="hljs-comment">// ä¸ç”¨ set ç«Ÿç„¶è¶…æ—¶äº†ï¼</span>        Set&lt;String&gt; wordSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(wordList);        <span class="hljs-keyword">if</span> (!wordSet.contains(endWord)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;        &#125;        <span class="hljs-comment">// æ ‡è®°å·²è®¿é—®è¿‡çš„å…ƒç´ </span>        Set&lt;String&gt; used = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();        <span class="hljs-comment">// å·¦è¾¹æ‰©æ•£é›†åˆï¼Œæ¯æ¬¡éƒ½å‡è®¾è¯¥é›†åˆå…ƒç´ æœ€å°‘ï¼Œåˆ™æ‰©æ•£é€Ÿåº¦æ›´å¿«</span>        Set&lt;String&gt; beginSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();        beginSet.add(beginWord);        <span class="hljs-comment">// å³è¾¹æ‰©æ•£é›†åˆ</span>        Set&lt;String&gt; endSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();        endSet.add(endWord);        <span class="hljs-keyword">int</span> step = <span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span> (!beginSet.isEmpty() &amp;&amp; !endSet.isEmpty()) &#123;            step++;            <span class="hljs-comment">// ä½¿ beginSet çš„å…ƒç´ æœ€å°‘</span>            <span class="hljs-keyword">if</span> (beginSet.size() &gt; endSet.size()) &#123;                Set&lt;String&gt; tmp = beginSet;                beginSet = endSet;                endSet = tmp;            &#125;            <span class="hljs-comment">// ä¸‹ä¸€å±‚æ‰©æ•£çš„é›†åˆ</span>            Set&lt;String&gt; nextLevel = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();            <span class="hljs-keyword">for</span> (String word : beginSet) &#123;                <span class="hljs-keyword">char</span>[] words = word.toCharArray();                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; words.length; i++) &#123;                    <span class="hljs-keyword">char</span> old = words[i];                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> c = <span class="hljs-string">'a'</span>; c &lt;= <span class="hljs-string">'z'</span>; c++) &#123;                        <span class="hljs-keyword">if</span> (old == c) &#123;                            <span class="hljs-keyword">continue</span>;                        &#125;                        words[i] = c;                        String nextWord = String.valueOf(words);                        <span class="hljs-comment">// æ–°å…ƒç´ å¿…é¡»å­˜åœ¨äºæä¾›çš„ list ä¸­</span>                        <span class="hljs-keyword">if</span> (wordSet.contains(nextWord)) &#123;                            <span class="hljs-comment">// å³è¾¹é›†åˆåŒ…å«è¯¥å…ƒç´ ï¼Œè¯´æ˜æ‰©æ•£é‡å¤ï¼Œç›´æ¥è¿”å›</span>                            <span class="hljs-keyword">if</span> (endSet.contains(nextWord)) &#123;                                <span class="hljs-keyword">return</span> step + <span class="hljs-number">1</span>;                            &#125;                            <span class="hljs-comment">// åŠ å…¥ä¸‹ä¸€å±‚æ‰©æ•£é›†åˆ</span>                            <span class="hljs-keyword">if</span> (!used.contains(nextWord)) &#123;                                nextLevel.add(nextWord);                                <span class="hljs-comment">// æ ‡è®°å·²è®¿é—®</span>                                used.add(nextWord);                            &#125;                        &#125;                    &#125;                    words[i] = old;                &#125;            &#125;            <span class="hljs-comment">// è®¾ç½®ä¸‹ä¸€å±‚çš„æ‰©æ•£é›†åˆ</span>            beginSet = nextLevel;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 515. åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼</title>
    <link href="/2020/08/07/LeetCode-515-find-largest-value-in-each-tree-row/"/>
    <url>/2020/08/07/LeetCode-515-find-largest-value-in-each-tree-row/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/find-largest-value-in-each-tree-row/" target="_blank" rel="noopener">515. åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼</a></p><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><p>å±‚æ¬¡éå†</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">largestValues</span><span class="hljs-params">(TreeNode root)</span> </span>&#123;        List&lt;Integer&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">return</span> res;        &#125;        LinkedList&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();        queue.add(root);        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;            <span class="hljs-keyword">int</span> max = Integer.MIN_VALUE;            <span class="hljs-keyword">int</span> size = queue.size();            <span class="hljs-keyword">while</span> (size-- &gt; <span class="hljs-number">0</span>) &#123;                TreeNode p = queue.poll();                max = Math.max(p.val, max);                <span class="hljs-keyword">if</span> (p.left != <span class="hljs-keyword">null</span>) &#123;                    queue.offer(p.left);                &#125;                <span class="hljs-keyword">if</span> (p.right != <span class="hljs-keyword">null</span>) &#123;                    queue.offer(p.right);                &#125;            &#125;            res.add(max);        &#125;        <span class="hljs-keyword">return</span> res;    &#125;</code></pre><h1 id="dfs"><a class="markdownIt-Anchor" href="#dfs"></a> DFS</h1><p>åˆ¤æ–­æ˜¯å¦åˆ°äº†æ–°çš„ä¸€å±‚ï¼š<code>res</code> ä¸­ä¿å­˜çš„æ˜¯æ¯ä¸€å±‚çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥ <code>res.size()</code> ç­‰äºéå†è¿‡çš„å±‚æ•°ï¼Œè‹¥ <code>res.size() &lt; level</code> è¡¨ç¤ºåˆ°äº†æ–°å±‚ã€‚</p><pre><code class="hljs java">List&lt;Integer&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">largestValues</span><span class="hljs-params">(TreeNode root)</span> </span>&#123;        <span class="hljs-keyword">if</span> (root != <span class="hljs-keyword">null</span>) &#123;            dfs(root, <span class="hljs-number">1</span>);        &#125;        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(TreeNode root, <span class="hljs-keyword">int</span> level)</span> </span>&#123;        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// éå†åˆ°äº†ä¸‹ä¸€å±‚ï¼Œæ·»åŠ æ–°å…ƒç´ </span>        <span class="hljs-keyword">if</span> (res.size() &lt; level) &#123;            res.add(root.val);        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// è®¡ç®—å½“å‰å±‚çš„æœ€å¤§å€¼</span>            <span class="hljs-keyword">int</span> levelMax = Math.max(root.val, res.get(level - <span class="hljs-number">1</span>));            res.set(level - <span class="hljs-number">1</span>, levelMax);        &#125;        dfs(root.left, level + <span class="hljs-number">1</span>);        dfs(root.right, level + <span class="hljs-number">1</span>);    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>DFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 22. æ‹¬å·ç”Ÿæˆ</title>
    <link href="/2020/08/07/LeetCode-22-generate-parentheses/"/>
    <url>/2020/08/07/LeetCode-22-generate-parentheses/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/generate-parentheses/submissions/" target="_blank" rel="noopener">22. æ‹¬å·ç”Ÿæˆ</a></p><h1 id="å›æº¯"><a class="markdownIt-Anchor" href="#å›æº¯"></a> å›æº¯</h1><pre><code class="hljs java">List&lt;String&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">generateParenthesis</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;        <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> res;        &#125;        backtrack(n, n, <span class="hljs-string">""</span>);        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è·¯å¾„ï¼šç”Ÿæˆçš„æ‹¬å·å­—ç¬¦ä¸²</span><span class="hljs-comment">     * é€‰æ‹©åˆ—è¡¨ï¼šè·¯å¾„ä¸­å¯æ”¾ç½®çš„å·¦å³æ‹¬å·æ•°é‡</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> left  å·¦æ‹¬å·å‰©ä½™æ•°é‡</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> right å³æ‹¬å·å‰©ä½™æ•°é‡</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> path  è·¯å¾„</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">backtrack</span><span class="hljs-params">(<span class="hljs-keyword">int</span> left, <span class="hljs-keyword">int</span> right, String path)</span> </span>&#123;        <span class="hljs-comment">// å·¦æ‹¬å·å‰©ä½™ &gt; å³æ‹¬å·å‰©ä½™ï¼šå‰ªæ</span>        <span class="hljs-comment">// e.g. )</span>        <span class="hljs-keyword">if</span> (left &gt; right) &#123;            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-keyword">if</span> (left == <span class="hljs-number">0</span> &amp;&amp; right == <span class="hljs-number">0</span>) &#123;            res.add(path);            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// å·¦è¾¹å¯æ”¾ç½®å·¦æ‹¬å·</span>        <span class="hljs-comment">// e.g. ()</span>        <span class="hljs-keyword">if</span> (left &gt; <span class="hljs-number">0</span>) &#123;            backtrack(left - <span class="hljs-number">1</span>, right, path + <span class="hljs-string">"("</span>);        &#125;        <span class="hljs-comment">// å·¦æ‹¬å·å‰©ä½™ &lt; å³æ‹¬å·å‰©ä½™ï¼šå³è¾¹å¯æ”¾ç½®å³æ‹¬å·</span>        <span class="hljs-comment">// e.g. ((, (</span>        <span class="hljs-keyword">if</span> (left &lt; right) &#123;            backtrack(left, right - <span class="hljs-number">1</span>, path + <span class="hljs-string">")"</span>);        &#125;    &#125;</code></pre><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;    String path;    <span class="hljs-keyword">int</span> left;    <span class="hljs-keyword">int</span> right;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> path  å½“å‰ç»“ç‚¹äº§ç”Ÿçš„è·¯å¾„</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> left  å·¦è¾¹å‰©ä½™æ‹¬å·</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> right å³è¾¹å‰©ä½™æ‹¬å·</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span><span class="hljs-params">(String path, <span class="hljs-keyword">int</span> left, <span class="hljs-keyword">int</span> right)</span> </span>&#123;        <span class="hljs-keyword">this</span>.path = path;        <span class="hljs-keyword">this</span>.left = left;        <span class="hljs-keyword">this</span>.right = right;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">generateParenthesis</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;        List&lt;String&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">1</span>) &#123;            <span class="hljs-keyword">return</span> res;        &#125;        LinkedList&lt;Node&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();        queue.offer(<span class="hljs-keyword">new</span> Node(<span class="hljs-string">""</span>, n, n));        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;            Node q = queue.poll();            <span class="hljs-comment">// å·¦å³æ‹¬å·å‡å·²ç”¨å®Œ</span>            <span class="hljs-keyword">if</span> (q.left == <span class="hljs-number">0</span> &amp;&amp; q.right == <span class="hljs-number">0</span>) &#123;                res.add(q.path);            &#125;            <span class="hljs-comment">// å·¦æ‹¬å·å‰©ä½™</span>            <span class="hljs-keyword">if</span> (q.left &gt; <span class="hljs-number">0</span>) &#123;                queue.offer(<span class="hljs-keyword">new</span> Node(q.path + <span class="hljs-string">"("</span>, q.left - <span class="hljs-number">1</span>, q.right));            &#125;            <span class="hljs-comment">// å³æ‹¬å·å‰©ä½™</span>            <span class="hljs-keyword">if</span> (q.right &gt; <span class="hljs-number">0</span> &amp;&amp; q.right &gt; q.left) &#123;                queue.offer(<span class="hljs-keyword">new</span> Node(q.path + <span class="hljs-string">")"</span>, q.left, q.right - <span class="hljs-number">1</span>));            &#125;        &#125;        <span class="hljs-keyword">return</span> res;    &#125;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>DFS</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InnoDB ç´¢å¼•</title>
    <link href="/2020/08/07/InnoDB-index/"/>
    <url>/2020/08/07/InnoDB-index/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a class="markdownIt-Anchor" href="#ä»‹ç»"></a> ä»‹ç»</h1><h2 id="b-æ ‘"><a class="markdownIt-Anchor" href="#b-æ ‘"></a> <code>B+</code> æ ‘</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200807153046.png" srcset="/img/loading.gif" alt="" /></p><blockquote><p>ğŸ™ƒåˆæ˜¯è€ƒç ”å†…å®¹ã€‚</p></blockquote><p>ä¸€æ£µ <code>m</code> é˜¶ <code>B+</code> æ ‘éœ€æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š</p><ul><li>æ¯ä¸ªåˆ†æ”¯ç»“ç‚¹æœ€å¤šæœ‰ <code>m</code> æ£µå­æ ‘ï¼ˆå­ç»“ç‚¹ï¼‰ã€‚</li><li>éå¶æ ¹ç»“ç‚¹è‡³å°‘æœ‰ä¸¤æ£µå­æ ‘ï¼Œå…¶ä»–æ¯ä¸ªåˆ†æ”¯ç»“ç‚¹è‡³å°‘æœ‰ <code>âŒˆm / 2âŒ‰</code> æ£µå­æ ‘ã€‚</li><li><strong>ç»“ç‚¹çš„å­æ ‘ä¸ªæ•°ä¸å…³é”®å­—ä¸ªæ•°ç›¸ç­‰</strong>ã€‚</li><li>æ‰€æœ‰å¶å­ç»“ç‚¹åŒ…å«<strong>å…¨éƒ¨å…³é”®å­—</strong>åŠæŒ‡å‘ç›¸åº”è®°å½•çš„<strong>æŒ‡é’ˆ</strong>ï¼Œå¶å­ç»“ç‚¹ä¸­å…³é”®å­—æŒ‰å¤§å°æ’åºï¼Œç›¸é‚»å¶ç»“ç‚¹æŒ‰å¤§å°é¡ºåº<strong>ç›¸äº’é“¾æ¥</strong>èµ·æ¥ã€‚</li><li>æ‰€æœ‰åˆ†æ”¯ç»“ç‚¹ä¸­ä»…åŒ…å«å®ƒçš„å„ä¸ªå­ç»“ç‚¹ä¸­<strong>å…³é”®å­—çš„æœ€å¤§å€¼</strong>åŠæŒ‡å‘å…¶å­ç»“ç‚¹çš„<strong>æŒ‡é’ˆ</strong>ã€‚</li></ul><p><code>m</code> é˜¶ <code>B+</code> æ ‘ä¸ <code>m</code> é˜¶ <code>B</code> æ ‘çš„åŒºåˆ«ï¼š</p><ol><li><strong>å­æ ‘å’Œç»“ç‚¹çš„å…³ç³»ï¼š</strong><br /><code>B+</code> æ ‘ <code>n</code> ä¸ªå…³é”®å­—çš„ç»“ç‚¹åªå«æœ‰ <code>n</code> æ£µå­æ ‘ï¼Œ<strong>å³æ¯ä¸ªå…³é”®å­—å¯¹åº”ä¸€æ£µå­æ ‘</strong>ï¼›<br /><code>B</code> æ ‘ <code>n</code> ä¸ªå…³é”®å­—çš„ç»“ç‚¹å«æœ‰ <code>n + 1</code> æ£µå­æ ‘ã€‚</li><li><strong>ç»“ç‚¹å…³é”®å­—ä¸ªæ•°</strong><br /><code>B+</code> æ ‘éæ ¹ç»“ç‚¹å…³é”®å­—ä¸ªæ•°ï¼š<code>âŒˆm / 2âŒ‰ &lt;= n &lt;= m</code>ï¼Œæ ¹ç»“ç‚¹ï¼š<code>1 &lt;= n &lt;= m</code>ï¼›<br /><code>B</code> æ ‘éæ ¹ç»“ç‚¹å…³é”®å­—ä¸ªæ•°ï¼š<code>âŒˆm / 2âŒ‰ - 1 &lt;= n &lt;= m - 1</code>ï¼Œæ ¹ç»“ç‚¹ï¼š<code>1 &lt;= n &lt;= m - 1</code></li><li><strong>å¶å­ç»“ç‚¹å’Œéå¶ç»“ç‚¹</strong><br /><code>B+</code> æ ‘å¶ç»“ç‚¹åŒ…å«ä¿¡æ¯ï¼Œæ‰€æœ‰<strong>éå¶ç»“ç‚¹ä»…èµ·åˆ°ç´¢å¼•ä½œç”¨</strong>ï¼Œéå¶ç»“ç‚¹ä¸­çš„æ¯ä¸ªç´¢å¼•é¡¹å€¼å«æœ‰å­æ ‘æœ€å¤§å…³é”®å­—å’ŒæŒ‡å‘å­æ ‘çš„æŒ‡é’ˆï¼Œ<strong>ä¸å«è¯¥å…³é”®å­—çš„å­˜å‚¨åœ°å€</strong>ã€‚</li><li><strong>å…³é”®å­—é‡å¤æ€§</strong><br /><code>B+</code> æ ‘ä¸­å¶ç»“ç‚¹åŒ…å«å…¨éƒ¨å…³é”®å­—ï¼Œ<strong>å³å…³é”®å­—ä¼šå’Œéå¶ç»“ç‚¹é‡å¤</strong>ï¼›<br /><code>B</code> æ ‘ä¸­å¶ç»“ç‚¹åŒ…å«çš„å…³é”®å­—å’Œå…¶ä»–ç»“ç‚¹åŒ…å«çš„å…³é”®å­—æ˜¯<strong>ä¸é‡å¤</strong>çš„ã€‚</li><li><strong>æŸ¥æ‰¾è¿‡ç¨‹</strong><br /><code>B+</code> æ ‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œå¦‚æœéå¶ç»“ç‚¹ä¸Šçš„å…³é”®å­—ç­‰äºç»™å®šå€¼æ—¶å¹¶ä¸ç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å‘ä¸‹æŸ¥æ‰¾ç›´åˆ°å¶ç»“ç‚¹ä¸ºæ­¢ã€‚æ¯æ¬¡æŸ¥æ‰¾éƒ½æ˜¯ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶ç»“ç‚¹çš„è·¯å¾„ã€‚</li></ol><h2 id="ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#ä¼˜ç‚¹"></a> ä¼˜ç‚¹</h2><p><code>B+</code> æ ‘ç´¢å¼•æŒ‰ç…§é¡ºåºå­˜å‚¨ï¼Œå¯ä»¥ç”¨æ¥åš <code>ORDER BY</code> å’Œ <code>GROUP</code> æ“ä½œã€‚<br />å› ä¸ºç´¢å¼•ä¸­å­˜å‚¨äº†å®é™…çš„åˆ—å€¼ï¼Œè¦†ç›–ç´¢å¼•åªéœ€è¦é€‚ç”¨ç´¢å¼•å°±èƒ½å®ŒæˆæŸ¥è¯¢ã€‚</p><ul><li>ç´¢å¼•å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</li><li>ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ã€‚</li><li>ç´¢å¼•å¯ä»¥å°†éšæœº <code>IO</code> å˜ä¸ºé¡ºåº <code>IO</code>ã€‚</li></ul><h2 id="ä¸ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ"><a class="markdownIt-Anchor" href="#ä¸ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ"></a> ä¸ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ</h2><p>åœ¨èŒƒå›´æŸ¥æ‰¾ã€<code>JOIN</code> é“¾æ¥æ“ä½œç­‰æƒ…å†µä¸‹ï¼Œä¼˜åŒ–å™¨ç›´æ¥è¿›è¡Œå…¨è¡¨çš„æ‰«ææ¥å¾—åˆ°æ•°æ®ã€‚<br />å½“ç”¨æˆ·è¦é€‰å–çš„æ•°æ®æ˜¯æ•´è¡Œä¿¡æ¯ï¼Œè€Œç´¢å¼•ä¸èƒ½è¦†ç›–åˆ°è¦æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œåœ¨é€šè¿‡ç´¢å¼•æŸ¥åˆ°æŒ‡å®šæ•°æ®åï¼Œè¿˜è¦ä¸€æ¬¡ä¹¦ç­¾è®¿é—®æ¥æŸ¥æ‰¾æ•´è¡Œçš„ä¿¡æ¯ã€‚</p><p>å¯ä½¿ç”¨å…³é”®å­— <code>FORCE INDEX</code> æ¥å¼ºåˆ¶ä½¿ç”¨æŸä¸ªç´¢å¼•ã€‚</p><ul><li>è¡¨è®°å½•å¤ªå°‘</li><li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨</li><li>æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå‡åŒ€çš„è¡¨å­—æ®µï¼Œåªåº”è¯¥ä¸ºæœ€ç»å¸¸æŸ¥è¯¢å’Œæœ€ç»å¸¸æ’åºçš„æ•°æ®åˆ—å»ºç«‹ç´¢å¼•ï¼ˆå¦‚æœæŸä¸ªæ•°æ®ç±»åŒ…å«å¤ªå¤šçš„é‡å¤æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•æ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼‰</li><li><strong>é¢‘ç¹æ›´æ–°</strong>çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ï¼ˆä¼šåŠ é‡ <code>IO</code> è´Ÿæ‹…ï¼‰</li><li><code>where</code> æ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•</li></ul><h2 id="éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ"><a class="markdownIt-Anchor" href="#éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ"></a> éœ€è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µ</h2><ul><li>ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•</li><li>é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</li><li>æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•</li><li>å•é”®/ç»„åˆç´¢å¼•çš„é€‰æ‹©é—®é¢˜ï¼Œé«˜å¹¶å‘ä¸‹å€¾å‘åˆ›å»ºç»„åˆç´¢å¼•</li><li>æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µï¼Œæ’åºå­—æ®µé€šè¿‡ç´¢å¼•è®¿é—®å¤§å¹…æé«˜æ’åºé€Ÿåº¦</li><li>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–åˆ†ç»„å­—æ®µ</li></ul><h1 id="ç´¢å¼•ç±»å‹"><a class="markdownIt-Anchor" href="#ç´¢å¼•ç±»å‹"></a> ç´¢å¼•ç±»å‹</h1><blockquote><p><code>InnoDB</code> çš„ç´¢å¼•æ˜¯è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œä½¿ç”¨ <code>B+</code> æ ‘ç´¢å¼•ã€‚<br /><code>B+</code> æ ‘ç´¢å¼•å¹¶ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªç»™å®šé”®å€¼çš„å…·ä½“è¡Œï¼Œå®ƒåªèƒ½æ‰¾åˆ°è¢«æŸ¥æ‰¾æ•°æ®è¡Œæ‰€åœ¨çš„é¡µï¼Œç„¶åé€šè¿‡æŠŠé¡µè¯»å…¥å†…å­˜ï¼Œåœ¨å†…å­˜ä¸­æŸ¥æ‰¾æƒ³è¦çš„æ•°æ®ã€‚</p></blockquote><h2 id="1-b-æ ‘ç´¢å¼•"><a class="markdownIt-Anchor" href="#1-b-æ ‘ç´¢å¼•"></a> 1. <code>B+</code> æ ‘ç´¢å¼•</h2><p><code>B+</code> æ ‘ç´¢å¼•èƒ½å¤ŸåŠ å¿«è®¿é—®æ•°æ®çš„é€Ÿåº¦ï¼Œå› ä¸ºå­˜å‚¨å¼•æ“<strong>ä¸å†éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æ</strong>æ¥è·å–æ•°æ®ï¼Œè€Œæ˜¯ä»ç´¢å¼•çš„æ ¹èŠ‚ç‚¹å¼€å§‹è¿›è¡Œæœç´¢ã€‚</p><ul><li>æ ¹èŠ‚ç‚¹å­˜æ”¾äº†<strong>æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆ</strong>ï¼Œå­˜å‚¨å¼•æ“æ ¹æ®è¿™äº›æŒ‡é’ˆå‘ä¸‹å±‚æŸ¥æ‰¾ï¼Œé€šè¿‡æ¯”è¾ƒèŠ‚ç‚¹é¡µçš„å€¼å’Œè¦æŸ¥æ‰¾çš„å€¼å¯ä»¥æ‰¾åˆ°åˆé€‚çš„æŒ‡é’ˆè¿›å…¥ä¸‹å±‚å­èŠ‚ç‚¹ã€‚</li><li>å¶å­èŠ‚ç‚¹æŒ‡å‘çš„æ˜¯<strong>è¢«ç´¢å¼•çš„æ•°æ®</strong>ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„èŠ‚ç‚¹é¡µã€‚</li></ul><p>ç´¢å¼•åˆ—æ˜¯æŒ‰<strong>é¡ºåºç»„ç»‡</strong>å­˜å‚¨çš„ï¼Œæ‰€ä»¥å¾ˆé€‚åˆæŸ¥æ‰¾èŒƒå›´æ•°æ®ï¼Œå¤šä¸ªå€¼è¿›è¡Œæ’åºçš„ä¾æ®æ˜¯ <code>CREATE TABLE</code> è¯­å¥ä¸­å®šä¹‰ç´¢å¼•æ—¶åˆ—çš„é¡ºåºã€‚</p><h3 id="é™åˆ¶"><a class="markdownIt-Anchor" href="#é™åˆ¶"></a> é™åˆ¶</h3><ul><li><strong>å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹æŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•</strong>ã€‚å¦‚ <code>key(last_name,first_name, dob)</code> æ— æ³•ç”¨äºæŸ¥æ‰¾ç‰¹å®šçš„ <code>first_name</code> å’Œ <code>dob</code>ã€‚</li><li><strong>ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—</strong>ã€‚å¦‚ä¸èƒ½æŸ¥æ‰¾ <code>last_name</code> å’Œ <code>dob</code> ä¸ºç‰¹å®šå€¼çš„è®°å½•ã€‚å¦‚æœä¸æŒ‡å®š <code>first_name</code>ï¼Œåˆ™åªèƒ½ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚</li><li>å¦‚æœæŸ¥è¯¢ä¸­æœ‰æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ã€‚</li></ul><h3 id="èšé›†ç´¢å¼•"><a class="markdownIt-Anchor" href="#èšé›†ç´¢å¼•"></a> èšé›†ç´¢å¼•</h3><p>èšé›†ç´¢å¼•æŒ‰ç…§æ¯å¼ è¡¨çš„ä¸»é”®æ„é€ ä¸€æ£µ <code>B+</code> æ ‘ï¼Œå¶å­ç»“ç‚¹ä¸­å­˜æ”¾çš„ä¸ºæ•´å¼ è¡¨çš„è¡Œè®°å½•æ•°æ®ï¼Œå¶å­ç»“ç‚¹ä¹Ÿç§°ä¸ºæ•°æ®é¡µã€‚<strong>ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚</strong> å®ƒå¯¹äºä¸»é”®çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾éå¸¸å¿«ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200811143800.png" srcset="/img/loading.gif" alt="" /><br />èšé›†ç´¢å¼•çš„å­˜å‚¨å¹¶ä¸æ˜¯ç‰©ç†ä¸Šè¿ç»­çš„ï¼ˆç»´æŠ¤æˆæœ¬é«˜ï¼‰ï¼Œè€Œæ˜¯<strong>é€»è¾‘ä¸Šè¿ç»­</strong>çš„ã€‚</p><ul><li>é¡µé€šè¿‡åŒå‘é“¾è¡¨é“¾æ¥ï¼Œé¡µæŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’åºã€‚<br />å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œ<code>InnoDB</code> ä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ã€‚<br />å¦‚æœæ²¡æœ‰è¿™æ ·çš„ä¸»é”®ï¼Œ<code>InnoDB</code> ä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšé›†ç´¢å¼•ã€‚</li><li>é¡µä¸­çš„è®°å½•é€šè¿‡åŒå‘é“¾è¡¨é“¾æ¥ï¼Œç‰©ç†å­˜å‚¨ä¸Šä¹Ÿå¯ä»¥ä¸æŒ‰ç…§ä¸»é”®å­˜å‚¨ã€‚</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¯ä»¥æŠŠç›¸å…³æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ï¼Œå‡å°‘ç£ç›˜ <code>IO</code>ã€‚</li><li>æ•°æ®è®¿é—®æ›´å¿«ã€‚ç´¢å¼•å’Œæ•°æ®éƒ½åœ¨åŒä¸€ä¸ª <code>B+</code> æ ‘ä¸­ã€‚</li><li>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨é¡µèŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºã€‚æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯åŠ è½½æ•°æ®åˆ° <code>InnoDB</code> è¡¨ä¸­é€Ÿåº¦æœ€å¿«çš„æ–¹å¼ã€‚</li><li>æ›´æ–°èšé›†ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ï¼Œå› ä¸ºä¼šå¼ºåˆ¶ <code>InnoDB</code> å°†æ¯ä¸ªè¢«æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚</li><li>å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œå°¤å…¶æ˜¯è¡Œæ¯”è¾ƒç¨€ç–ï¼Œæˆ–è€…ç”±äºé¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™ã€‚</li><li>äºŒçº§ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰å¯èƒ½å¾ˆå¤§ï¼Œå› ä¸ºäºŒçº§ç´¢å¼•çš„å¶å­ç»“ç‚¹åŒ…å«äº†å¼•ç”¨è¡Œçš„ä¸»é”®åˆ—ã€‚</li><li>äºŒçº§ç´¢å¼•éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚</li></ul><h3 id="è¾…åŠ©ç´¢å¼•éèšé›†ç´¢å¼•"><a class="markdownIt-Anchor" href="#è¾…åŠ©ç´¢å¼•éèšé›†ç´¢å¼•"></a> è¾…åŠ©ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰</h3><p>è¾…åŠ©ç´¢å¼•ä¸­ï¼Œå¶å­ç»“ç‚¹å¹¶ä¸åŒ…å«è¡Œè®°å½•çš„å…¨éƒ¨æ•°æ®ã€‚å¶å­ç»“ç‚¹é™¤äº†åŒ…å«é”®å€¼ä»¥å¤–ï¼Œæ¯ä¸ªå¶å­ç»“ç‚¹ä¸­çš„ç´¢å¼•è¡Œè¿˜åŒ…å«äº†ä¸€ä¸ªä¹¦ç­¾ï¼Œè¯¥ä¹¦ç­¾ç”¨æ¥å‘Šè¯‰ <code>InnoDB</code> å“ªé‡Œå¯ä»¥æ‰¾åˆ°ä¸ç´¢å¼•ç›¸å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p><p>è¾…åŠ©ç´¢å¼•çš„å­˜åœ¨å¹¶ä¸å½±å“æ•°æ®åœ¨èšé›†ç´¢å¼•ä¸­çš„ç»„ç»‡ï¼Œå› æ­¤<strong>ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªè¾…åŠ©ç´¢å¼•ã€‚</strong></p><h3 id="è¦†ç›–ç´¢å¼•"><a class="markdownIt-Anchor" href="#è¦†ç›–ç´¢å¼•"></a> è¦†ç›–ç´¢å¼•</h3><blockquote><p>æŸ¥è¯¢åªè¦è®¿é—®ç´¢å¼•ï¼Œè€Œæ— é¡»è®¿é—®æ•°æ®è¡Œã€‚</p></blockquote><p>è¦†ç›–ç´¢å¼•ä»è¾…åŠ©ç´¢å¼•ä¸­å°±å¯ä»¥å¾—åˆ°æŸ¥è¯¢çš„è®°å½•ï¼Œè€Œä¸éœ€è¦æŸ¥è¯¢èšé›†ç´¢å¼•ä¸­çš„è®°å½•ã€‚å¥½å¤„æ˜¯è¾…åŠ©ç´¢å¼•ä¸åŒ…å«æ•´è¡Œè®°å½•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ•…å…¶å¤§å°è¦è¿œå°äºèšé›†ç´¢å¼•ï¼Œå› æ­¤å¯ä»¥å‡å°‘å¤§é‡ <code>IO</code>ã€‚</p><p>ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„ç´¢å¼•éƒ½å¯ä»¥æˆä¸ºè¦†ç›–ç´¢å¼•ã€‚<strong>è¦†ç›–ç´¢å¼•å¿…é¡»è¦å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼</strong>ï¼Œè€Œå“ˆå¸Œç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•ç­‰éƒ½ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œæ‰€ä»¥ <code>MySQL</code> åªèƒ½ä½¿ç”¨ <code>B+</code> æ ‘ç´¢å¼•åšè¦†ç›–ç´¢å¼•ã€‚</p><h3 id="è”åˆç´¢å¼•"><a class="markdownIt-Anchor" href="#è”åˆç´¢å¼•"></a> è”åˆç´¢å¼•</h3><p>è”åˆç´¢å¼•æ˜¯æŒ‡å¯¹è¡¨ä¸Šçš„å¤šä¸ªåˆ—è¿›è¡Œç´¢å¼•ã€‚å…¶é”®å€¼çš„æ•°é‡ä¸æ˜¯ <code>1</code>ï¼Œè€Œæ˜¯å¤§äºç­‰äº <code>2</code>ã€‚</p><h2 id="2-å“ˆå¸Œç´¢å¼•"><a class="markdownIt-Anchor" href="#2-å“ˆå¸Œç´¢å¼•"></a> 2. å“ˆå¸Œç´¢å¼•</h2><blockquote><p>åœ¨ <code>MySQL</code> ä¸­ï¼Œåªæœ‰ <code>Memory</code> å¼•æ“æ˜¾å¼æ”¯æŒå“ˆå¸Œç´¢å¼•ï¼Œå®ƒè¿˜æ”¯æŒéå”¯ä¸€å“ˆå¸Œç´¢å¼•ï¼Œå¦‚æœå¤šä¸ªåˆ—çš„å“ˆå¸Œå€¼ç›¸åŒï¼Œä½¿ç”¨é“¾è¡¨å­˜æ”¾è®°å½•æŒ‡é’ˆã€‚</p></blockquote><p>å“ˆå¸Œç´¢å¼•ï¼ˆ<code>hash index</code>ï¼‰åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰<strong>ç²¾ç¡®åŒ¹é…</strong>ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚</p><p>å¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œå­˜å‚¨å¼•æ“ä¼šå¯¹<strong>æ‰€æœ‰çš„ç´¢å¼•åˆ—</strong>è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼ˆ<code>hash code</code>ï¼‰ï¼Œå“ˆå¸Œç´¢å¼•å°†æ‰€æœ‰çš„å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒåŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚</p><h3 id="é™åˆ¶-2"><a class="markdownIt-Anchor" href="#é™åˆ¶-2"></a> é™åˆ¶</h3><ul><li>åªåŒ…å«<strong>å“ˆå¸Œå€¼</strong>å’Œ<strong>æŒ‡é’ˆ</strong>ï¼Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­çš„å€¼æ¥é¿å…è¯»å–è¡Œã€‚</li><li><strong>ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢</strong>ã€‚</li><li>å“ˆå¸Œç´¢å¼•æ•°æ®å¹¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•ç”¨äºæ’åºã€‚</li><li>ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—åŒ¹é…æŸ¥æ‰¾ï¼Œå› ä¸ºå“ˆå¸Œç´¢å¼•å§‹ç»ˆä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹æ¥è®¡ç®—å“ˆå¸Œå€¼ã€‚</li><li>å‡ºç°å“ˆå¸Œå†²çªï¼Œå¿…é¡»éå†é“¾è¡¨ä¸­æ‰€æœ‰æŒ‡é’ˆã€‚</li><li>å¦‚æœå“ˆå¸Œå†²çªå¾ˆå¤šï¼Œç´¢å¼•ç»´æŠ¤æ“ä½œçš„ä»£ä»·å¾ˆé«˜ã€‚</li></ul><h3 id="è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•"><a class="markdownIt-Anchor" href="#è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•"></a> è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</h3><p>å½“ <code>InnoDB</code> æ³¨æ„åˆ°æŸäº›ç´¢å¼•å€¼è¢«ä½¿ç”¨å¾—å¾ˆé¢‘ç¹æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨å†…å­˜ä¸­åŸºäº <code>B+</code> æ ‘ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®© <code>B+</code> æ ‘ç´¢å¼•ä¹Ÿå…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œå¦‚å¿«é€Ÿå“ˆå¸ŒæŸ¥æ‰¾ã€‚</p><h2 id="3-å…¨æ–‡ç´¢å¼•"><a class="markdownIt-Anchor" href="#3-å…¨æ–‡ç´¢å¼•"></a> 3. å…¨æ–‡ç´¢å¼•</h2><p>å…¨æ–‡ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ç´¢å¼•ï¼Œå®ƒæŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼ã€‚å…¨æ–‡ç´¢å¼•ç±»ä¼¼äºæœç´¢å¼•æ“ï¼Œé€‚ç”¨äº <code>MATCH AGAINST</code> è€Œä¸æ˜¯ç®€å•çš„ <code>WHERE</code> æ¡ä»¶åŒ¹é…ã€‚</p><h1 id="é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"><a class="markdownIt-Anchor" href="#é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥"></a> é«˜æ€§èƒ½çš„ç´¢å¼•ç­–ç•¥</h1><h2 id="ç‹¬ç«‹çš„åˆ—"><a class="markdownIt-Anchor" href="#ç‹¬ç«‹çš„åˆ—"></a> ç‹¬ç«‹çš„åˆ—</h2><blockquote><p>å¦‚æœæŸ¥è¯¢çš„åˆ—ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œ<code>MySQL</code> å°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚</p></blockquote><p>ç‹¬ç«‹çš„åˆ—ï¼šç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ã€‚</p><h2 id="å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§"><a class="markdownIt-Anchor" href="#å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§"></a> å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§</h2><blockquote><p>ç´¢å¼•é€‰æ‹©æ€§ = ä¸é‡å¤çš„ç´¢å¼•å€¼ / è®°å½•æ€»æ•°( <code>#T</code>)ï¼ŒèŒƒå›´ä» <code>1 / #T</code> åˆ° <code>1</code> ä¹‹é—´ï¼Œé€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå› ä¸ºé€‰æ‹©æ€§é«˜çš„ç´¢å¼•å¯ä»¥åœ¨æŸ¥æ‰¾æ—¶è¿‡æ»¤æ›´å¤šçš„è¡Œã€‚</p></blockquote><p>é€‰æ‹©æŸä¸ªåˆ—é€‰æ‹©æ€§é«˜çš„å‰ç¼€è¿›è¡ŒæŸ¥è¯¢ã€‚ä½†å‰ç¼€ç´¢å¼•æ— æ³•è¿›è¡Œ <code>ORDER BY</code> å’Œ <code>GROUP</code> æ“ä½œã€‚</p><h2 id="é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—"><a class="markdownIt-Anchor" href="#é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—"></a> é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—</h2><p>ç»éªŒæ³•åˆ™ï¼šå°†é€‰æ‹©æ€§é«˜çš„ç´¢å¼•åˆšåˆ°ç´¢å¼•æœ€å‰åˆ—ã€‚ï¼ˆå¹¶ä¸é€‚ç”¨æ‰€æœ‰æƒ…å†µï¼Œä¹Ÿè¦è€ƒè™‘ <code>WHERE</code> å­å¥ä¸­çš„æ’åºï¼Œåˆ†ç»„å’ŒèŒƒå›´æ¡ä»¶ç­‰å…¶ä»–å› ç´ ï¼‰</p><h2 id="èšé›†ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•"><a class="markdownIt-Anchor" href="#èšé›†ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•"></a> èšé›†ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•</h2><h2 id="ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"><a class="markdownIt-Anchor" href="#ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"></a> ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº</h2><p><code>MySQL</code> å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•æ—¢æ»¡è¶³æ’åºï¼Œåˆç”¨äºæŸ¥æ‰¾è¡Œã€‚å› æ­¤ï¼Œå¦‚æœå¯èƒ½ï¼Œè®¾è®¡ç´¢å¼•æ—¶åº”è¯¥å°½å¯èƒ½åœ°åŒæ—¶æ»¡è¶³è¿™ä¸¤ç§ä»»åŠ¡ã€‚<br />åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’Œ <code>ORDER BY</code> å­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘ï¼ˆå€’åºæˆ–æ­£åºï¼‰éƒ½ä¸€æ ·æ—¶ï¼Œ<code>MySQL</code> æ‰èƒ½ä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚</p><h2 id="å†—ä½™å’Œé‡å¤ç´¢å¼•"><a class="markdownIt-Anchor" href="#å†—ä½™å’Œé‡å¤ç´¢å¼•"></a> å†—ä½™å’Œé‡å¤ç´¢å¼•</h2><ul><li>é‡å¤ç´¢å¼•æ˜¯æŒ‡åœ¨ç›¸åŒçš„åˆ—ä¸ŠæŒ‰ç…§ç›¸åŒçš„é¡ºåºåˆ›å»ºç›¸åŒç±»å‹çš„ç´¢å¼•ã€‚åº”è¯¥é¿å…åˆ›å»ºé‡å¤ç´¢å¼•ã€‚</li><li>å¦‚æœåˆ›å»ºäº†ç´¢å¼• <code>(A, B)</code>ï¼Œå†åˆ›å»ºç´¢å¼• <code>(A)</code> å°±æ˜¯å†—ä½™ç´¢å¼•ï¼Œå› ä¸ºè¿™åªæ˜¯å‰ä¸€ä¸ªç´¢å¼•çš„å‰ç¼€ç´¢å¼•ã€‚<br />ä½†æ˜¯å¦‚æœåˆ›å»º <code>(B, A), (B)</code>ï¼Œåˆ™ä¸æ˜¯å†—ä½™ç´¢å¼•ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ <code>(A, B)</code> çš„æœ€å·¦å‰ç¼€åˆ—ã€‚<br />å…¶ä»–ä¸åŒç±»å‹çš„ç´¢å¼•ï¼ˆå“ˆå¸Œç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ï¼‰ä¹Ÿä¸æ˜¯ <code>B+</code> æ ‘ç´¢å¼•çš„å†—ä½™ç´¢å¼•ï¼Œæ— è®ºå®ƒä»¬è¦†ç›–çš„ç´¢å¼•åˆ—æ˜¯ä»€ä¹ˆã€‚</li></ul><h2 id="æœªä½¿ç”¨çš„ç´¢å¼•åˆ—"><a class="markdownIt-Anchor" href="#æœªä½¿ç”¨çš„ç´¢å¼•åˆ—"></a> æœªä½¿ç”¨çš„ç´¢å¼•åˆ—</h2><p>å»ºè®®åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•åˆ—ã€‚</p><h2 id="ç´¢å¼•å’Œé”"><a class="markdownIt-Anchor" href="#ç´¢å¼•å’Œé”"></a> ç´¢å¼•å’Œé”</h2><ul><li><strong>ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢é”å®šæ›´å°‘çš„è¡Œ</strong>ã€‚å¦‚æœæŸ¥è¯¢ä»ä¸è®¿é—®é‚£äº›ä¸éœ€è¦çš„è¡Œï¼Œé‚£ä¹ˆä¼šé”å®šæ›´å°‘çš„è¡Œã€‚</li><li><code>InnoDB</code> åªæœ‰åœ¨è®¿é—®è¡Œçš„æ—¶å€™æ‰ä¼šå¯¹å…¶åŠ é”ï¼Œè€Œç´¢å¼•èƒ½å‡å°‘è®¿é—®è¡Œçš„æ¬¡æ•°ï¼Œä»è€Œ<strong>å‡å°‘é”çš„æ•°é‡</strong>ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 433. æœ€å°åŸºå› å˜åŒ–</title>
    <link href="/2020/08/06/LeetCode-433-minimum-genetic-mutation/"/>
    <url>/2020/08/06/LeetCode-433-minimum-genetic-mutation/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/minimum-genetic-mutation/" target="_blank" rel="noopener">433. æœ€å°åŸºå› å˜åŒ–</a></p><h1 id="å›æº¯"><a class="markdownIt-Anchor" href="#å›æº¯"></a> å›æº¯</h1><p>ç¬¬ä¸€æ¬¡è§£æ³•å‡»è´¥ <code>100%</code> ç”¨æˆ·ã€‚</p><p>æ¯ä¸€æ¬¡çš„å˜å¼‚éƒ½å¯åœ¨åŸºå› åº“ä¸­æ‰¾åˆ°ï¼Œå› æ­¤ä»åŸºå› åº“ä¸­æ„å»ºå†³ç­–æ ‘ï¼Œä¸å½“å‰åŸºå› ç›¸å·®ä¸€ä¸ªç¢±åŸºä¸”åœ¨ä¹‹å‰çš„é€‰æ‹©è·¯å¾„ä¸­æœªå‡ºç°çš„åŸºå› å³ä¸ºä¸‹ä¸€æ­¥å˜å¼‚çš„åŸºå› ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">int</span> minStep = Integer.MAX_VALUE;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">minMutation</span><span class="hljs-params">(String start, String end, String[] bank)</span> </span>&#123;        dfs(start, end, <span class="hljs-number">0</span>, bank);        <span class="hljs-keyword">return</span> minStep == Integer.MAX_VALUE ? -<span class="hljs-number">1</span> : minStep;    &#125;    List&lt;String&gt; selectedList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-comment">/**</span><span class="hljs-comment">     * é€‰æ‹©é˜Ÿåˆ—ï¼šbank ä¸­åœ¨å†³ç­–æ ‘ä¸­æœªé€‰æ‹©çš„å…ƒç´ </span><span class="hljs-comment">     * è·¯å¾„ï¼šselectedList</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> start å½“å‰å˜å¼‚åˆ°çš„åŸºå› </span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end   æœ€ç»ˆçš„åŸºå› </span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> count éœ€è¦å˜ä¸ºæœ€ç»ˆåŸºå› çš„æ¬¡æ•°</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> bank  é€‰æ‹©é˜Ÿåˆ—</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(String start, String end, <span class="hljs-keyword">int</span> count, String[] bank)</span> </span>&#123;        <span class="hljs-comment">// å½“å‰æ­¥æ•° &gt; æœ€å°æ­¥æ•°ï¼šå‰ªæ</span>        <span class="hljs-keyword">if</span> (count &gt; minStep) &#123;            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// è‹¥ å½“å‰åŸºå›  å¯ä»¥å˜ä¸º æœ€ç»ˆåŸºå› </span>        <span class="hljs-comment">// åˆ™è®¡ç®—æœ€å°æ­¥æ•°ï¼Œç»“æŸé€’å½’</span>        <span class="hljs-keyword">if</span> (start.equals(end)) &#123;            minStep = Math.min(minStep, count);            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-keyword">for</span> (String candidate : bank) &#123;            <span class="hljs-comment">// è‹¥ candidate ä¸åœ¨å†³ç­–æ ‘ä¸­ &amp;&amp; start å¯å˜å¼‚ä¸º candidate</span>            <span class="hljs-comment">// åˆ™è¿›å…¥å†³ç­–</span>            <span class="hljs-keyword">if</span> (notSelected(candidate) &amp;&amp; canMutate(start, candidate)) &#123;                selectedList.add(candidate);                dfs(candidate, end, count + <span class="hljs-number">1</span>, bank);                selectedList.remove(candidate);            &#125;        &#125;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * åˆ¤æ–­ start åŸºå› æ˜¯å¦å¯ä»¥å˜ä¸º candidate åŸºå› </span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> start</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> candidate</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">canMutate</span><span class="hljs-params">(String start, String candidate)</span> </span>&#123;        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; start.length(); i++) &#123;            <span class="hljs-keyword">if</span> (start.charAt(i) != candidate.charAt(i)) &#123;                <span class="hljs-keyword">if</span> (++count &gt; <span class="hljs-number">1</span>) &#123;                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * åˆ¤æ–­åœ¨ä¹‹å‰çš„è·¯å¾„ä¸­æ˜¯å¦æœªé€‰æ‹© candidate</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> candidate</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">notSelected</span><span class="hljs-params">(String candidate)</span> </span>&#123;        <span class="hljs-keyword">return</span> !selectedList.contains(candidate);    &#125;</code></pre><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><p>æ¯æ¬¡å˜å¼‚ä¸€ä¸ªç¢±åŸºï¼Œé˜Ÿåˆ—ä¸­ä¿å­˜çš„å³ä¸ºå½“å‰å¯å˜å¼‚çš„æ‰€æœ‰åŸºå› ï¼Œä¸”è¿™äº›åŸºå› éƒ½åœ¨åŸºå› åº“ä¸­æœªè¢«å˜å¼‚è¿‡ã€‚<br />ç›¸å½“äºæ„å»ºä¸€æ£µæ ‘ï¼Œè¿›è¡Œæ ‘çš„å±‚æ¬¡éå†ã€‚<br />éœ€è¦æ³¨æ„çš„æ˜¯å˜å¼‚å®Œåçš„ç¢±åŸºéœ€è¦æ¢å¤åŸæ ·ï¼Œå¦åˆ™åœ¨ä¸‹ä¸€æ¬¡è·å–æ–°åŸºå› æ—¶å¯èƒ½å¯¼è‡´å¤šä¸ªç¢±åŸºéƒ½å‘ç”Ÿäº†å˜å¼‚ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">minMutation</span><span class="hljs-params">(String start, String end, String[] bank)</span> </span>&#123;        Set&lt;String&gt; unSelectedSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(bank));        <span class="hljs-keyword">if</span> (!unSelectedSet.contains(end)) &#123;            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">char</span>[] mutGenes = &#123;<span class="hljs-string">'A'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'G'</span>, <span class="hljs-string">'T'</span>&#125;;        LinkedList&lt;String&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();        queue.add(start);        unSelectedSet.remove(start);        <span class="hljs-keyword">int</span> step = <span class="hljs-number">0</span>;        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;            step++;            <span class="hljs-comment">// é˜Ÿåˆ—ä¸­ä¿å­˜çš„æ˜¯ä¸€ä¸ªåŸºå› ä¸€æ¬¡å˜å¼‚å¯ä»¥äº§ç”Ÿçš„æ–°åŸºå› åºåˆ—</span>            <span class="hljs-comment">// é˜Ÿåˆ—ä¸ºç©ºåˆ™è¡¨ç¤ºè¿™æ¬¡çš„åºåˆ—å˜å¼‚ç»“æŸï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡éå†</span>            <span class="hljs-keyword">int</span> size = queue.size();            <span class="hljs-keyword">while</span> (size-- &gt; <span class="hljs-number">0</span>) &#123;                <span class="hljs-comment">// åŸºå› </span>                <span class="hljs-keyword">char</span>[] genes = queue.poll().toCharArray();                <span class="hljs-comment">// 1. å¯¹æ¯ä¸ªåŸºå› ä½å˜å¼‚</span>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; genes.length; i++) &#123;                    <span class="hljs-comment">// ä¿å­˜æ—§çš„ç¢±åŸº</span>                    <span class="hljs-keyword">char</span> oldGene = genes[i];                    <span class="hljs-comment">// 2. åŸºå› çš„æ¯ä¸€ä½ä¾æ¬¡è¿›è¡Œ ACGT å˜å¼‚</span>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> mutGene : mutGenes) &#123;                        genes[i] = mutGene;                        <span class="hljs-comment">// 3. è·å–ç¢±åŸºå˜å¼‚åçš„æ–°åŸºå› </span>                        String newGene = String.valueOf(genes);                        <span class="hljs-comment">// 4. å˜åˆ° endï¼Œç›´æ¥è¿”å›</span>                        <span class="hljs-keyword">if</span> (end.equals(newGene)) &#123;                            <span class="hljs-keyword">return</span> step;                            <span class="hljs-comment">// 5. åœ¨æœªå˜å¼‚çš„åŸºå› åº“ä¸­æ‰¾åˆ°æ–°åŸºå› </span>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (unSelectedSet.contains(newGene)) &#123;                            unSelectedSet.remove(newGene);                            queue.offer(newGene);                        &#125;                    &#125;                    <span class="hljs-comment">// å˜å¼‚çš„åŸºå› ä½è¦æ¢å¤åŸæ¥çš„ç¢±åŸº</span>                    <span class="hljs-comment">// å¦åˆ™åœ¨ 3 ä¸­è·å–çš„æ–°åŸºå› ä¼šå˜æˆ TTTT*ï¼Œè¿›è€Œå½±å“ 4, 5</span>                    genes[i] = oldGene;                &#125;            &#125;        &#125;        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 102. äºŒå‰æ ‘çš„å±‚åºéå†</title>
    <link href="/2020/08/06/LeetCode-102-binary-tree-level-order-traversal/"/>
    <url>/2020/08/06/LeetCode-102-binary-tree-level-order-traversal/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/" target="_blank" rel="noopener">äºŒå‰æ ‘çš„å±‚åºéå†</a></p><p>ä¸»è¦åœ¨äºåˆ¤æ–­æ¯ä¸€å±‚æœ‰å“ªäº›ç»“ç‚¹ï¼šéå†ä¹‹å‰å…ˆä¿å­˜æ¯å±‚ç»“ç‚¹æ•°ï¼Œç„¶åæŒ‰å±‚å¤„ç†ç»“ç‚¹ã€‚</p><h1 id="bfs"><a class="markdownIt-Anchor" href="#bfs"></a> BFS</h1><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;        List&lt;List&lt;Integer&gt;&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">return</span> res;        &#125;        LinkedList&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();        queue.add(root);        <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;            <span class="hljs-comment">// ä¿å­˜å½“å‰å±‚çš„ç»“ç‚¹æ•°</span>            <span class="hljs-keyword">int</span> n = queue.size();            List&lt;Integer&gt; level = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();            <span class="hljs-comment">// éå†å½“å‰å±‚çš„ç»“ç‚¹</span>            <span class="hljs-keyword">while</span> (n-- &gt; <span class="hljs-number">0</span>) &#123;                <span class="hljs-comment">// å¯¹å¤´å‡ºé˜Ÿï¼Œå¹¶å°†å·¦å³ç»“ç‚¹å…¥é˜Ÿ</span>                <span class="hljs-comment">// å½“æœ¬è½®å¾ªç¯ç»“æŸåï¼Œé˜Ÿåˆ—é‡Œéƒ½æ˜¯åŒä¸€å±‚çš„ç»“ç‚¹</span>                TreeNode p = queue.poll();                level.add(p.val);                <span class="hljs-keyword">if</span> (p.left != <span class="hljs-keyword">null</span>) &#123;                    queue.add(p.left);                &#125;                <span class="hljs-keyword">if</span> (p.right != <span class="hljs-keyword">null</span>) &#123;                    queue.add(p.right);                &#125;            &#125;            <span class="hljs-comment">// å°†å½“å‰å±‚åŠ å…¥ç»“æœ</span>            res.add(level);        &#125;        <span class="hljs-keyword">return</span> res;    &#125;</code></pre><h1 id="dfs"><a class="markdownIt-Anchor" href="#dfs"></a> DFS</h1><pre><code class="hljs java">List&lt;List&lt;Integer&gt;&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">public</span> List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;        dfs(root, <span class="hljs-number">1</span>);        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(TreeNode root, <span class="hljs-keyword">int</span> level)</span> </span>&#123;        <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-keyword">if</span> (res.size() &lt; level) &#123;            res.add(<span class="hljs-keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(root.val)));        &#125; <span class="hljs-keyword">else</span> &#123;            res.get(level - <span class="hljs-number">1</span>).add(root.val);        &#125;        dfs(root.left, level + <span class="hljs-number">1</span>);        dfs(root.right, level + <span class="hljs-number">1</span>);    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>DFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InnoDB è¡¨</title>
    <link href="/2020/08/06/InnoDB-table/"/>
    <url>/2020/08/06/InnoDB-table/</url>
    
    <content type="html"><![CDATA[<h1 id="ç´¢å¼•ç»„ç»‡è¡¨"><a class="markdownIt-Anchor" href="#ç´¢å¼•ç»„ç»‡è¡¨"></a> ç´¢å¼•ç»„ç»‡è¡¨</h1><p>åœ¨ <code>InnoDB</code> ä¸­ï¼Œè¡¨éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆ<code>index organized table</code>ï¼‰ã€‚å¦‚æœåœ¨åˆ›å»ºè¡¨æ—¶æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ä¸»é”®ï¼Œåˆ™ä¼šæŒ‰ä»¥ä¸‹æ–¹å¼é€‰æ‹©æˆ–åˆ›å»ºä¸»é”®ï¼š</p><ul><li>é¦–å…ˆåˆ¤æ–­è¡¨ä¸­æ˜¯å¦æœ‰<strong>éç©ºçš„å”¯ä¸€ç´¢å¼•</strong>ï¼ˆ<code>Unique NOT NULL</code>ï¼‰ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¯¥åˆ—ä¸ºä¸»é”®ï¼›</li><li>å¦åˆ™ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>6</code> å­—èŠ‚å¤§å°çš„æŒ‡é’ˆã€‚</li></ul><p>å½“è¡¨ä¸­æœ‰å¤šä¸ªéç©ºå”¯ä¸€ç´¢å¼•æ—¶ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“å°†é€‰æ‹©å»ºè¡¨æ—¶ç¬¬ä¸€ä¸ªå®šä¹‰çš„éç©ºå”¯ä¸€ç´¢å¼•ï¼ˆ<strong>ç´¢å¼•çš„é¡ºåº</strong>ï¼‰ä¸ºä¸»é”®ã€‚</p><h1 id="innodb-é€»è¾‘å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#innodb-é€»è¾‘å­˜å‚¨ç»“æ„"></a> <code>InnoDB</code> é€»è¾‘å­˜å‚¨ç»“æ„</h1><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805154705.png" srcset="/img/loading.gif" alt="" /></p><p>æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨è¡¨ç©ºé—´ï¼Œè¡¨ç©ºé—´ç”±æ®µï¼ˆ<code>segment</code>ï¼‰ã€åŒºï¼ˆ<code>extent</code>ï¼‰ã€é¡µï¼ˆ<code>page</code>ï¼‰ç»„æˆã€‚</p><h2 id="æ®µ"><a class="markdownIt-Anchor" href="#æ®µ"></a> æ®µ</h2><ul><li>æ•°æ®æ®µï¼š<code>B+</code> æ ‘çš„å¶å­èŠ‚ç‚¹ï¼ˆ<code>Leaf node segment</code>ï¼‰</li><li>ç´¢å¼•æ®µï¼š<code>B+</code> æ ‘çš„éå¶å­èŠ‚ç‚¹ï¼ˆ<code>Non-Leaf node segment</code>ï¼‰</li><li>å›æ»šæ®µï¼š<code>Rollback segment</code></li></ul><h2 id="åŒº"><a class="markdownIt-Anchor" href="#åŒº"></a> åŒº</h2><p>åŒºæ˜¯ç”±è¿ç»­é¡µç»„æˆçš„ç©ºé—´ï¼Œ<strong>åœ¨ä»»ä½•æƒ…å†µä¸‹æ¯ä¸ªåŒºçš„å¤§å°éƒ½ä¸º <code>1MB</code>ã€‚</strong> ä¸ºäº†ä¿è¯åŒºä¸­é¡µçš„è¿ç»­æ€§ï¼Œ<code>InnoDB</code> ä¸€æ¬¡ä»ç£ç›˜ç”³è¯· <code>4 ~ 5</code> ä¸ªåŒºï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡µçš„å¤§å°ä¸º <code>16KB</code>ï¼Œå³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰ <code>64</code> ä¸ªè¿ç»­çš„é¡µã€‚</p><h2 id="é¡µ"><a class="markdownIt-Anchor" href="#é¡µ"></a> é¡µ</h2><p>é¡µæ˜¯ <code>InnoDB</code> ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚å¯é€šè¿‡ <code>innodb_page_size</code> å°†é¡µçš„å¤§å°è®¾ç½®ä¸º <code>4K</code>ã€<code>8K</code>ã€<code>16K</code>ã€‚</p><h2 id="è¡Œ"><a class="markdownIt-Anchor" href="#è¡Œ"></a> è¡Œ</h2><p>æ•°æ®æŒ‰è¡Œå­˜æ”¾ï¼Œæ¯é¡µæœ€å¤šå­˜æ”¾ <code>16KB / 2 - 200 = 7992</code> è¡Œçš„è®°å½•ã€‚</p><h1 id="innodb-è¡Œè®°å½•æ ¼å¼"><a class="markdownIt-Anchor" href="#innodb-è¡Œè®°å½•æ ¼å¼"></a> <code>InnoDB</code> è¡Œè®°å½•æ ¼å¼</h1><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805164415.png" srcset="/img/loading.gif" alt="" /></p><h2 id="compact-è¡Œè®°å½•æ ¼å¼"><a class="markdownIt-Anchor" href="#compact-è¡Œè®°å½•æ ¼å¼"></a> <code>Compact</code> è¡Œè®°å½•æ ¼å¼</h2><p>å…¶ç›®çš„æ˜¯é«˜æ•ˆåœ°å­˜å‚¨æ•°æ®ï¼Œä¸€ä¸ªé¡µä¸­å­˜æ”¾çš„æ•°æ®è¶Šå¤šï¼Œå…¶æ€§èƒ½å°±è¶Šé«˜ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805162732.png" srcset="/img/loading.gif" alt="" /></p><h2 id="redundant-è¡Œè®°å½•æ ¼å¼"><a class="markdownIt-Anchor" href="#redundant-è¡Œè®°å½•æ ¼å¼"></a> <code>Redundant</code> è¡Œè®°å½•æ ¼å¼</h2><p><code>Redundant</code> æ˜¯ <code>MySQL 5.0</code> ä¹‹å‰çš„è¡Œè®°å½•å­˜å‚¨æ–¹å¼ï¼Œå®ƒæ˜¯ä¸ºäº†å…¼å®¹ä¹‹å‰ç‰ˆæœ¬çš„é¡µæ ¼å¼ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805162855.png" srcset="/img/loading.gif" alt="" /></p><h2 id="è¡Œæº¢å‡ºæ•°æ®"><a class="markdownIt-Anchor" href="#è¡Œæº¢å‡ºæ•°æ®"></a> è¡Œæº¢å‡ºæ•°æ®</h2><p>å¦‚æœé¡µä¸­åªèƒ½å­˜æ”¾ä¸‹ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆ <code>InnoDB</code> ä¼šè‡ªåŠ¨å°†è¡Œæ•°æ®å­˜æ”¾åˆ°æº¢å‡ºé¡µä¸­ã€‚</p><h2 id="compressed-å’Œ-dynamic-è¡Œè®°å½•æ ¼å¼"><a class="markdownIt-Anchor" href="#compressed-å’Œ-dynamic-è¡Œè®°å½•æ ¼å¼"></a> <code>Compressed</code> å’Œ <code>Dynamic</code> è¡Œè®°å½•æ ¼å¼</h2><p>è¿™ä¸¤ç§è®°å½•æ ¼å¼å¯¹äºå­˜æ”¾åœ¨ <code>BLOB</code> ä¸­çš„æ•°æ®é‡‡ç”¨äº†å®Œå…¨çš„è¡Œæº¢å‡ºçš„æ–¹å¼ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805163825.png" srcset="/img/loading.gif" alt="" /><br />æ•°æ®é¡µä¸­åªå­˜æ”¾ <code>20</code> ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼Œå®é™…æ•°æ®éƒ½å­˜æ”¾åœ¨ <code>Off Page</code> ä¸­ã€‚</p><h1 id="çº¦æŸ"><a class="markdownIt-Anchor" href="#çº¦æŸ"></a> çº¦æŸ</h1><h2 id="æ•°æ®å®Œæ•´æ€§"><a class="markdownIt-Anchor" href="#æ•°æ®å®Œæ•´æ€§"></a> æ•°æ®å®Œæ•´æ€§</h2><ul><li><strong>å®ä½“å®Œæ•´æ€§</strong>ï¼šä¿è¯è¡¨ä¸­æœ‰ä¸€ä¸ªä¸»é”®ã€‚</li><li><strong>åŸŸå®Œæ•´æ€§</strong>ï¼šä¿è¯æ•°æ®<strong>æ¯åˆ—çš„å€¼</strong>æ»¡è¶³ç‰¹å®šçš„æ¡ä»¶ã€‚<ul><li>é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ç¡®ä¿ä¸€ä¸ªæ•°æ®å€¼æ»¡è¶³ç‰¹å®šæ¡ä»¶</li><li>å¤–é”®çº¦æŸ</li><li>è§¦å‘å™¨</li><li><code>DEFAULT</code> çº¦æŸ</li></ul></li><li><strong>å‚ç…§å®Œæ•´æ€§</strong>ï¼šä¿è¯<strong>ä¸¤å¼ è¡¨</strong>ä¹‹é—´çš„å…³ç³»ã€‚<ul><li><code>Primary Key</code></li><li><code>Unique Key</code></li><li><code>Foreigh Key</code></li><li><code>Default</code></li><li><code>NOT NULL</code></li></ul></li></ul><h2 id="çº¦æŸçš„åˆ›å»º"><a class="markdownIt-Anchor" href="#çº¦æŸçš„åˆ›å»º"></a> çº¦æŸçš„åˆ›å»º</h2><ol><li>è¡¨å»ºç«‹æ—¶è¿›è¡Œçº¦æŸå®šä¹‰</li><li>åˆ©ç”¨ <code>ALTER TABLE</code> å‘½ä»¤è¿›è¡Œåˆ›å»ºçº¦æŸ</li></ol><h2 id="çº¦æŸå’Œç´¢å¼•çš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#çº¦æŸå’Œç´¢å¼•çš„åŒºåˆ«"></a> çº¦æŸå’Œç´¢å¼•çš„åŒºåˆ«</h2><ul><li>çº¦æŸæ˜¯ä¸€ä¸ª<strong>é€»è¾‘æ¦‚å¿µ</strong>ï¼Œç”¨æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼›</li><li>ç´¢å¼•æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œæ—¢æœ‰<strong>é€»è¾‘æ¦‚å¿µ</strong>ï¼Œåœ¨æ•°æ®åº“ä¸­è¿˜ä»£è¡¨ç€<strong>ç‰©ç†å­˜å‚¨</strong>çš„æ–¹å¼ã€‚</li></ul><h1 id="è§†å›¾"><a class="markdownIt-Anchor" href="#è§†å›¾"></a> è§†å›¾</h1><blockquote><p>è§†å›¾æ˜¯ä¸€ä¸ªå‘½åçš„è™šè¡¨ï¼Œç”±ä¸€ä¸ª <code>SQL</code> æŸ¥è¯¢å®šä¹‰ï¼Œè§†å›¾ä¸­çš„æ•°æ®æ²¡æœ‰å®é™…çš„ç‰©ç†å­˜å‚¨ã€‚</p></blockquote><p>è§†å›¾çš„ä¸»è¦ç”¨é€”æ˜¯è¢«ç”¨åšä¸€ä¸ªæŠ½è±¡è£…ç½®ï¼Œç¨‹åºæœ¬èº«ä¸éœ€è¦å…³å¿ƒåŸºè¡¨ï¼ˆ<code>base table</code>ï¼‰çš„ç»“æ„ï¼Œåªéœ€è¦æŒ‰ç…§è§†å›¾å®šä¹‰æ¥<strong>è·å–æ•°æ®æˆ–æ›´æ–°æ•°æ®</strong>ã€‚</p><ul><li>é€šè¿‡å®šä¹‰è§†å›¾ <code>WITH CHECK OPTION</code> å¯å¯¹åŸºæœ¬è¡¨è¿›è¡Œæ›´æ–°ã€‚</li><li><code>SHOW TABLES</code> å‘½ä»¤ä¹Ÿä¼šæŠŠè§†å›¾ä½œä¸ºè¡¨æ˜¾ç¤ºå‡ºæ¥ã€‚</li></ul><h1 id="åˆ†åŒºè¡¨"><a class="markdownIt-Anchor" href="#åˆ†åŒºè¡¨"></a> åˆ†åŒºè¡¨</h1><blockquote><p>åˆ†åŒºçš„è¿‡ç¨‹æ˜¯å°†ä¸€ä¸ªè¡¨æˆ–ç´¢å¼•åˆ†è§£ä¸ºå¤šä¸ªæ›´å°ã€æ›´å¯ç®¡ç†çš„éƒ¨åˆ†ã€‚æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¯ä»¥ç‹¬è‡ªå¤„ç†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªæ›´å¤§å¯¹è±¡çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚<br />ä»é€»è¾‘ä¸Šè®²ï¼Œåªæœ‰ä¸€ä¸ªè¡¨æˆ–ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ˜¯åœ¨ç‰©ç†ä¸Šè¿™ä¸ªè¡¨æˆ–ç´¢å¼•å¯èƒ½ç”±æ•°åä¸ªç‰©ç†åˆ†åŒºç»„æˆã€‚</p></blockquote><ul><li><code>MySQL</code> æ”¯æŒ<strong>æ°´å¹³åˆ†åŒº</strong>ï¼Œå¹¶ä¸æ”¯æŒå‚ç›´åˆ†åŒºï¼›</li><li><code>MySQL</code> çš„åˆ†åŒºæ˜¯<strong>å±€éƒ¨åˆ†åŒºç´¢å¼•</strong>ï¼Œä¸€ä¸ªåˆ†åŒºä¸­æ—¢å­˜æ”¾äº†æ•°æ®åˆå­˜æ”¾äº†ç´¢å¼•ã€‚</li></ul><h2 id="åˆ†åŒºç±»å‹"><a class="markdownIt-Anchor" href="#åˆ†åŒºç±»å‹"></a> åˆ†åŒºç±»å‹</h2><ul><li><code>RANGE</code> åˆ†åŒºï¼šè¡Œæ•°æ®åŸºäºå±äºä¸€ä¸ªç»™å®šè¿ç»­åŒºé—´çš„åˆ—å€¼è¢«æ”¾å…¥åˆ†åŒºã€‚</li><li><code>LIST</code> åˆ†åŒºï¼šå’Œ <code>RANGE</code> åˆ†åŒºç±»ä¼¼ï¼Œåªæ˜¯ <code>LIST</code> åˆ†åŒºé¢å‘çš„æ˜¯ç¦»æ•£çš„å€¼ã€‚</li><li><code>HASH</code> åˆ†åŒºï¼šæ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„è¡¨è¾¾å¼çš„è¿”å›å€¼æ¥è¿›è¡Œåˆ†åŒºã€‚</li><li><code>KEY</code> åˆ†åŒºï¼šæ ¹æ® <code>MySQL</code> æä¾›çš„å“ˆå¸Œå‡½æ•°æ¥è¿›è¡Œåˆ†åŒºã€‚</li><li><code>COLUMNS</code> åˆ†åŒºï¼šä¸åŒäºä»¥ä¸Šå››ç§ï¼Œè¯¥åˆ†åŒºå¯ä»¥ç›´æ¥ä½¿ç”¨éæ•´å½¢çš„æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œåˆ†åŒºæ ¹æ®ç±»å‹æ¯”è¾ƒè€Œå¾—ï¼Œä¸éœ€è¦è½¬åŒ–ä¸ºæ•´å½¢ã€‚</li></ul><h2 id="å­åˆ†åŒº"><a class="markdownIt-Anchor" href="#å­åˆ†åŒº"></a> å­åˆ†åŒº</h2><p>å­åˆ†åŒºæ˜¯åœ¨åˆ†åŒºçš„åŸºç¡€ä¸Šå†è¿›è¡Œåˆ†åŒºã€‚<code>MySQL</code> å…è®¸åœ¨ <code>RANGE</code> å’Œ <code>LIST</code> çš„åˆ†åŒºä¸Šå†è¿›è¡Œ <code>HASH</code> æˆ– <code>KEY</code> çš„å­åˆ†åŒºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 51. Nçš‡å</title>
    <link href="/2020/08/05/LeetCode-51-n-queens/"/>
    <url>/2020/08/05/LeetCode-51-n-queens/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/n-queens/" target="_blank" rel="noopener">51. Nçš‡å</a></p><p>æ£‹ç›˜æ¯ä¸€è¡Œç›¸å½“äºå†³ç­–æ ‘çš„æ¯ä¸€å±‚ï¼Œæ¯è¡Œçš„ä»»æ„ä¸€åˆ—éƒ½å¯æ”¾ç½®çš‡åã€‚å› æ­¤ï¼Œä» <strong>æ¯ä¸€è¡Œ</strong> å¼€å§‹ï¼Œé€‰æ‹©è¯¥è¡Œçš„ <strong>æ¯ä¸€åˆ—</strong> ä½œä¸ºé€‰æ‹©åˆ—è¡¨è¿›è¡Œé€’å½’ï¼Œè¯¥è¡Œä»¥ä¸Šçš„æ‰€æœ‰è¡Œæ­¤æ—¶éƒ½æ­£ç¡®æ”¾ç½®äº†çš‡åï¼Œå½“è¡Œæ•°è¾¾åˆ°æ£‹ç›˜æ·±åº¦æ—¶ç»“æŸé€’å½’ï¼Œè¿”å›æœ¬æ¬¡é€’å½’çš„ç»“æœã€‚</p><pre><code class="hljs java">List&lt;List&lt;String&gt;&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">public</span> List&lt;List&lt;String&gt;&gt; solveNQueens(<span class="hljs-keyword">int</span> n) &#123;        <span class="hljs-keyword">char</span>[][] board = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[n][n];        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span>[] row : board) &#123;            Arrays.fill(row, <span class="hljs-string">'.'</span>);        &#125;        backtrack(board, <span class="hljs-number">0</span>);        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> board æ£‹ç›˜</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> row   è¡Œå·</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">backtrack</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[][] board, <span class="hljs-keyword">int</span> row)</span> </span>&#123;        <span class="hljs-comment">// è¡Œæ•°è¾¾åˆ°æ£‹ç›˜æœ€åä¸€è¡Œç»“æŸ</span>        <span class="hljs-comment">// æ­¤æ—¶æ£‹ç›˜å·²æ­£ç¡®æ”¾ç½®çš‡åï¼Œè¿”å›æœ¬è½®ç»“æœ</span>        <span class="hljs-keyword">if</span> (row == board.length) &#123;            res.add(genBoard(board));            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// è·¯å¾„ï¼šrow è¡Œä¸Šé¢çš„é‚£äº›è¡Œéƒ½æˆåŠŸæ”¾ç½®äº† Q</span>        <span class="hljs-keyword">char</span>[] line = board[row];        <span class="hljs-comment">// é€‰æ‹©åˆ—è¡¨ï¼šç¬¬ row è¡Œçš„æ¯ä¸€åˆ—éƒ½æ˜¯ Q çš„å¯é€‰ä½ç½®</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> col = <span class="hljs-number">0</span>; col &lt; line.length; col++) &#123;            <span class="hljs-comment">// æ’é™¤ä¸åˆæ³•é€‰æ‹©</span>            <span class="hljs-comment">// è‹¥å½“å‰ (row, col) ä½ç½®ä¸æ»¡è¶³ï¼Œåˆ™è¿›å…¥è¯¥è¡Œçš„ä¸‹ä¸€åˆ—</span>            <span class="hljs-keyword">if</span> (!isValid(board, row, col)) &#123;                <span class="hljs-keyword">continue</span>;            &#125;            <span class="hljs-comment">// åšé€‰æ‹©</span>            board[row][col] = <span class="hljs-string">'Q'</span>;            <span class="hljs-comment">// è¿›å…¥ä¸‹ä¸€è¡Œå†³ç­–</span>            backtrack(board, row + <span class="hljs-number">1</span>);            <span class="hljs-comment">// æ’¤é”€é€‰æ‹©</span>            board[row][col] = <span class="hljs-string">'.'</span>;        &#125;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å› ä¸ºå…¶å®ƒä½ç½®è¿˜å¤„äºåˆå§‹çŠ¶æ€</span><span class="hljs-comment">     * åªéœ€è¦éªŒè¯æ¯ä¸€åˆ—ï¼Œå·¦ä¸Šå’Œå³ä¸Šä½ç½®æ˜¯å¦æœ‰çš‡å</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> board æ£‹ç›˜</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> row   å½“å‰è¡Œ</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> col   å½“å‰åˆ—</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å½“å‰ä½ç½®æ˜¯å¦å¯ä»¥æ”¾ç½® çš‡å</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isValid</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[][] board, <span class="hljs-keyword">int</span> row, <span class="hljs-keyword">int</span> col)</span> </span>&#123;        <span class="hljs-comment">// éªŒè¯ col æ‰€åœ¨åˆ—æ˜¯å¦æœ‰çš‡å</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span>[] line : board) &#123;            <span class="hljs-keyword">if</span> (<span class="hljs-string">'Q'</span> == line[col]) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            &#125;        &#125;        <span class="hljs-comment">// éªŒè¯å½“å‰ä½ç½®å·¦ä¸Šè§’æ˜¯å¦æœ‰çš‡å</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = row - <span class="hljs-number">1</span>, j = col - <span class="hljs-number">1</span>;             i &gt;= <span class="hljs-number">0</span> &amp;&amp; j &gt;= <span class="hljs-number">0</span>;             i--, j--) &#123;            <span class="hljs-keyword">if</span> (<span class="hljs-string">'Q'</span> == board[i][j]) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            &#125;        &#125;        <span class="hljs-comment">// éªŒè¯å½“å‰ä½ç½®å³ä¸Šè§’æ˜¯å¦æœ‰çš‡å</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = row - <span class="hljs-number">1</span>, j = col + <span class="hljs-number">1</span>;             i &gt;= <span class="hljs-number">0</span> &amp;&amp; j &lt; board.length;             i--, j++) &#123;            <span class="hljs-keyword">if</span> (<span class="hljs-string">'Q'</span> == board[i][j]) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title">genBoard</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[][] board)</span> </span>&#123;        List&lt;String&gt; bd = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span>[] line : board) &#123;            bd.add(String.valueOf(line));        &#125;        <span class="hljs-keyword">return</span> bd;    &#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InnoDB æ–‡ä»¶</title>
    <link href="/2020/08/05/InnoDB-file/"/>
    <url>/2020/08/05/InnoDB-file/</url>
    
    <content type="html"><![CDATA[<h1 id="å‚æ•°æ–‡ä»¶"><a class="markdownIt-Anchor" href="#å‚æ•°æ–‡ä»¶"></a> å‚æ•°æ–‡ä»¶</h1><blockquote><p>å‘Šè¯‰ <code>MySQL</code> å®ä¾‹å¯åŠ¨æ—¶åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‡å®šæŸäº›åˆå§‹åŒ–å‚æ•°ï¼Œè¿™äº›å‚æ•°å®šä¹‰äº†æŸç§å†…å­˜ç»“æ„çš„å¤§å°ç­‰è®¾ç½®ã€‚</p></blockquote><p><code>MySQL</code> å®ä¾‹å¯ä»¥ä¸éœ€è¦å‚æ•°æ–‡ä»¶ï¼Œè¿™æ—¶æ‰€æœ‰çš„å‚æ•°å€¼å–å†³äºç¼–è¯‘ <code>MySQL</code> æ—¶æŒ‡å®šçš„é»˜è®¤å€¼å’Œæºä»£ç ä¸­æŒ‡å®šå‚æ•°çš„é»˜è®¤å€¼ã€‚</p><p>å‚æ•°ç±»å‹ï¼š</p><ul><li><strong>åŠ¨æ€å‚æ•°</strong> - å¯ä»¥åœ¨ <code>MySQL</code> å®ä¾‹è¿è¡Œä¸­è¿›è¡Œæ›´æ”¹</li><li><strong>é™æ€å‚æ•°</strong> - åœ¨æ•´ä¸ªå®ä¾‹ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸å¾—è¿›è¡Œä¿®æ”¹</li></ul><h1 id="æ—¥å¿—æ–‡ä»¶"><a class="markdownIt-Anchor" href="#æ—¥å¿—æ–‡ä»¶"></a> æ—¥å¿—æ–‡ä»¶</h1><blockquote><p>æ—¥å¿—æ–‡ä»¶è®°å½•äº†å½±å“ <code>MySQL</code> æ•°æ®åº“çš„å„ç§ç±»å‹æ´»åŠ¨ã€‚</p></blockquote><ul><li><p><strong>é”™è¯¯æ—¥å¿—ï¼ˆ<code>error log</code>ï¼‰</strong><br />è®°å½• MySQL çš„å¯åŠ¨ã€è¿è¡Œã€å…³é—­è¿‡ç¨‹ã€‚ä¸ä»…è®°å½•æ‰€æœ‰é”™è¯¯ä¿¡æ¯ï¼Œä¹Ÿè®°å½•ä¸€äº›è­¦å‘Šæˆ–æ­£ç¡®çš„ä¿¡æ¯ã€‚<br />å¯é€šè¿‡å‘½ä»¤ <code>SHOW VARIABLES LIKE 'log_error'</code> æ¥å®šä½è¯¥æ–‡ä»¶</p></li><li><p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆ<code>slow log</code>ï¼‰</strong><br />å®šä½å¯èƒ½å­˜åœ¨é—®é¢˜çš„ <code>SQL</code> è¯­å¥ï¼Œä»è€Œè¿›è¡Œ <code>SQL</code> è¯­å¥å±‚é¢çš„ä¼˜åŒ–ã€‚<br />å¯é€šè¿‡è®¾ç½®å‚æ•° <code>long_query_time</code> æ¥è®¾ç½®é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º <code>10</code>ï¼‰ï¼Œå°†è¿è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰ <code>SQL</code> è¯­å¥éƒ½è®°å½•åˆ°è¯¥æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p></li><li><p><strong>æŸ¥è¯¢æ—¥å¿—ï¼ˆ<code>log</code>ï¼‰</strong><br />è®°å½•æ‰€æœ‰å¯¹ <code>MySQL</code> æ•°æ®åº“è¯·æ±‚çš„ä¿¡æ¯ï¼Œæ— è®ºè¿™äº›è¯·æ±‚æ˜¯å¦å¾—åˆ°äº†æ­£ç¡®çš„æ‰§è¡Œã€‚<br />é»˜è®¤æ–‡ä»¶åä¸ºï¼š<code>ä¸»æœºå.log</code></p></li><li><p><strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆ<code>binlog</code>ï¼‰</strong><br />è®°å½•å¯¹ <code>MySQL</code> æ•°æ®åº“æ‰§è¡Œæ›´æ”¹çš„æ‰€æœ‰æ“ä½œï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ <code>SELECT</code> å’Œ <code>SHOW</code> è¿™ç±»æ“ä½œã€‚<br />ä½œç”¨ï¼š</p><ul><li>æ¢å¤ï¼ˆ<code>recovery</code>ï¼‰ï¼šæ•°æ®æ¢å¤</li><li>å¤åˆ¶ï¼ˆ<code>replication</code>ï¼‰ï¼šä¸»ä»åŒæ­¥</li><li>å®¡è®¡ï¼ˆ<code>audit</code>ï¼‰ï¼šåˆ¤æ–­æ˜¯å¦æœ‰å¯¹æ•°æ®åº“è¿›è¡Œæ³¨å…¥æ”»å‡»</li></ul></li></ul><h1 id="å¥—æ¥å­—æ–‡ä»¶"><a class="markdownIt-Anchor" href="#å¥—æ¥å­—æ–‡ä»¶"></a> å¥—æ¥å­—æ–‡ä»¶</h1><p>åœ¨ <code>UNIX</code> ç³»ç»Ÿä¸‹æœ¬åœ°è¿æ¥ <code>MySQL</code> å¯ä»¥é‡‡ç”¨ <code>UNIX</code> åŸŸå¥—æ¥å­—æ–¹å¼ï¼Œé€šè¿‡å¥—æ¥å­—ï¼ˆ<code>socket</code>ï¼‰æ–‡ä»¶è¿æ¥ã€‚</p><h1 id="pid-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#pid-æ–‡ä»¶"></a> <code>pid</code> æ–‡ä»¶</h1><p>å½“ <code>MySQL</code> å®ä¾‹å¯åŠ¨æ—¶ï¼Œä¼šå°†è‡ªå·±çš„è¿›ç¨‹ <code>ID</code> å†™å…¥ä¸€ä¸ª <code>pid</code> æ–‡ä»¶ä¸­ã€‚<br />é»˜è®¤ä½äºæ•°æ®åº“ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸ºï¼š<code>ä¸»æœºå.pid</code>ã€‚</p><h1 id="è¡¨ç»“æ„å®šä¹‰æ–‡ä»¶"><a class="markdownIt-Anchor" href="#è¡¨ç»“æ„å®šä¹‰æ–‡ä»¶"></a> è¡¨ç»“æ„å®šä¹‰æ–‡ä»¶</h1><p><code>MySQL</code> çš„æ•°æ®å­˜å‚¨æ˜¯æ ¹æ®è¡¨è¿›è¡Œçš„ï¼Œæ¯ä¸ªè¡¨/è§†å›¾éƒ½æœ‰ä¸€ä¸ªä»¥ <code>frm</code> ä¸ºåç¼€åçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è®°å½•äº†è¯¥è¡¨çš„è¡¨ç»“æ„å®šä¹‰ã€‚</p><h1 id="innodb-å­˜å‚¨å¼•æ“æ–‡ä»¶"><a class="markdownIt-Anchor" href="#innodb-å­˜å‚¨å¼•æ“æ–‡ä»¶"></a> <code>InnoDB</code> å­˜å‚¨å¼•æ“æ–‡ä»¶</h1><p>ä»¥ä¸Šæ–‡ä»¶éƒ½æ˜¯ <code>MySQL</code> æ•°æ®åº“æœ¬èº«çš„æ–‡ä»¶ï¼Œè€Œ <code>InnoDB</code> å­˜å‚¨å¼•æ“è¿˜æœ‰å…¶è‡ªå·±ç‹¬æœ‰çš„æ–‡ä»¶ã€‚</p><h2 id="è¡¨ç©ºé—´æ–‡ä»¶"><a class="markdownIt-Anchor" href="#è¡¨ç©ºé—´æ–‡ä»¶"></a> è¡¨ç©ºé—´æ–‡ä»¶</h2><p><code>InnoDB</code> é‡‡ç”¨å°†å­˜å‚¨çš„è¡¨ç©ºé—´ï¼ˆ<code>tablespace</code>ï¼‰è¿›è¡Œå­˜æ”¾çš„è®¾è®¡ï¼Œé»˜è®¤é…ç½®ä¸‹åˆå§‹å¤§å°ä¸º <code>10MB</code>ï¼Œæ–‡ä»¶åä¸º <code>ibdata1</code>ã€‚<br />è¡¨ç©ºé—´åˆ†ä¸ºå…±äº«è¡¨ç©ºé—´ä¸ç‹¬ç«‹è¡¨ç©ºé—´ï¼Œç”¨æˆ·å¯ä»¥å°†æ¯ä¸ªåŸºäº <code>InnoDB</code> å­˜å‚¨å¼•æ“çš„è¡¨äº§ç”Ÿä¸€ä¸ªç‹¬ç«‹è¡¨ç©ºé—´ï¼Œå•ç‹¬çš„è¡¨ç©ºé—´æ–‡ä»¶ä»…å­˜å‚¨è¯¥è¡¨çš„æ•°æ®ã€ç´¢å¼•å’Œæ’å…¥ç¼“å†² <code>BITMAP</code> ç­‰ä¿¡æ¯ï¼Œå…¶ä½™ä¿¡æ¯è¿˜æ˜¯å­˜æ”¾åœ¨é»˜è®¤çš„è¡¨ç©ºé—´ä¸­ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805144502.png" srcset="/img/loading.gif" alt="" /></p><h2 id="é‡åšæ—¥å¿—æ–‡ä»¶"><a class="markdownIt-Anchor" href="#é‡åšæ—¥å¿—æ–‡ä»¶"></a> é‡åšæ—¥å¿—æ–‡ä»¶</h2><p>å½“å®ä¾‹æˆ–ä»‹è´¨å¤±è´¥ï¼ˆ<code>media failure</code>ï¼‰æ—¶ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“ä¼šä½¿ç”¨é‡åšæ—¥å¿—æ¢å¤åˆ°å®ä¾‹æ­£å¸¸çš„æ—¶åˆ»ï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>æ¯ä¸ª <code>InnoDB</code> å­˜å‚¨å¼•æ“è‡³å°‘æœ‰ <code>1</code> ä¸ªé‡åšæ—¥å¿—æ–‡ä»¶ç»„ï¼Œæ¯ä¸ªæ–‡ä»¶ç»„ä¸‹è‡³å°‘æœ‰ <code>2</code> ä¸ªé‡åšæ—¥å¿—æ–‡ä»¶ã€‚</p><p>é‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°å¯¹å­˜å‚¨å¼•æ“çš„æ€§èƒ½æœ‰éå¸¸å¤§çš„å½±å“ã€‚</p><ul><li>å¦‚æœå¤ªå¤§ï¼Œåœ¨æ¢å¤æ—¶å¯èƒ½éœ€è¦å¾ˆé•¿çš„æ—¶é—´ï¼›</li><li>å¦‚æœå¤ªå°ï¼Œå¯èƒ½å¯¼è‡´ä¸€ä¸ªäº‹åŠ¡çš„æ—¥å¿—éœ€è¦å¤šæ¬¡åˆ‡æ¢é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œè¿˜ä¼šå‘†æ»é¢‘ç¹åœ°å‘ç”Ÿ <code>async checkpoint</code>ï¼Œå¯¼è‡´æ€§èƒ½çš„æŠ–åŠ¨ã€‚</li></ul><p><strong>ä¸äºŒè¿›åˆ¶æ—¥å¿—çš„åŒºåˆ«</strong>ï¼š</p><ul><li>äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ä¸ <code>MySQL</code> æ•°æ®åº“æœ‰å…³çš„æ—¥å¿—è®°å½•ï¼ŒåŒ…æ‹¬<strong>æ‰€æœ‰å­˜å‚¨å¼•æ“</strong>çš„æ—¥å¿—ã€‚<br /><code>InnoDB</code> çš„é‡åšæ—¥å¿—åªè®°å½•<strong>è¯¥å­˜å‚¨å¼•æ“æœ¬èº«</strong>çš„äº‹åŠ¡æ—¥å¿—ã€‚</li><li>äºŒè¿›åˆ¶æ—¥å¿—è®°å½•å…³äºä¸€ä¸ªäº‹åŠ¡çš„<strong>å…·ä½“æ“ä½œå†…å®¹</strong>ã€‚<br />é‡åšæ—¥å¿—è®°å½•çš„æ˜¯æ¯ä¸ªé¡µçš„<strong>ç‰©ç†æ›´æ”¹</strong>æƒ…å†µã€‚</li><li>äºŒè¿›åˆ¶æ—¥å¿—ä»…åœ¨äº‹åŠ¡æäº¤å‰è¿›è¡Œæäº¤ï¼Œ<strong>åªå†™ç£ç›˜ä¸€æ¬¡</strong>ã€‚<br />è€Œäº‹åŠ¡è¿›è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­æœ‰é‡åšæ—¥å¿—æ¡ç›®è¢«å†™å…¥åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ä¸­ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200805150220.png" srcset="/img/loading.gif" alt="" /><br /><strong>å†™å…¥æµç¨‹</strong>ï¼šå…ˆå†™å…¥ä¸€ä¸ªé‡åšæ—¥å¿—ç¼“å†²ï¼ˆ<code>redo log buffer</code>ï¼‰ä¸­ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„æ¡ä»¶é¡ºåºåœ°å†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚<br /><strong>å†™å…¥æ¡ä»¶</strong>ï¼š</p><ul><li>ä¸»çº¿ç¨‹æ¯ç§’å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œä¸è®ºäº‹åŠ¡æ˜¯å¦å·²ç»æäº¤ã€‚</li><li>åœ¨æäº¤ï¼ˆ<code>commit</code>ï¼‰æ“ä½œæ—¶ï¼Œè®¾ç½® <code>innodb_flush_log_at_trx_commit = 1</code>ï¼Œåœ¨ <code>commit</code> æäº¤æ—¶å°†é‡åšæ—¥å¿—ç¼“å†²åŒæ­¥å†™åˆ°ç£ç›˜ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</title>
    <link href="/2020/08/04/LeetCode-17-letter-combinations-of-a-phone-number/"/>
    <url>/2020/08/04/LeetCode-17-letter-combinations-of-a-phone-number/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/letter-combinations-of-a-phone-number/" target="_blank" rel="noopener">17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</a></p><h1 id="å›æº¯"><a class="markdownIt-Anchor" href="#å›æº¯"></a> å›æº¯</h1><p>é€‰æ‹©åˆ—è¡¨ï¼šæ¯ä¸ª <code>digit</code> å¯¹åº”çš„å­—æ¯åˆ—è¡¨<br />è·¯å¾„ï¼šå·²é€‰å­—æ¯ç»„åˆ + é€‰æ‹©åˆ—è¡¨çš„å­—æ¯<br />ç»ˆæ­¢æ¡ä»¶ï¼šé€’å½’æ·±åº¦è¾¾åˆ° <code>digits</code> çš„é•¿åº¦</p><pre><code class="hljs java"><span class="hljs-comment">// 2 ~ 9 æ¯ä¸ªä½ç½®æ‰€å¯¹åº”çš„é€‰æ‹©åˆ—è¡¨</span>String[] map = &#123;<span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"abc"</span>, <span class="hljs-string">"def"</span>, <span class="hljs-string">"ghi"</span>, <span class="hljs-string">"jkl"</span>, <span class="hljs-string">"mno"</span>, <span class="hljs-string">"pqrs"</span>, <span class="hljs-string">"tuv"</span>, <span class="hljs-string">"wxyz"</span>&#125;;List&lt;String&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">letterCombinations</span><span class="hljs-params">(String digits)</span> </span>&#123;    <span class="hljs-keyword">if</span> (digits.length() == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> res;    &#125;    combine(digits, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>);    <span class="hljs-keyword">return</span> res;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> digits</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> path   å½“å‰å·²é€‰æ‹©çš„ç»„åˆè·¯å¾„</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> len    å½“å‰é€’å½’åˆ°çš„ digits ä½ç½®</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">combine</span><span class="hljs-params">(String digits, String path, <span class="hljs-keyword">int</span> len)</span> </span>&#123;    <span class="hljs-comment">// é€’å½’æ·±åº¦ä¸º digits çš„é•¿åº¦</span>    <span class="hljs-keyword">if</span> (len == digits.length()) &#123;        res.add(path);        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-comment">// æ‰¾åˆ°å½“å‰ digit æ‰€å¯¹åº”çš„å­—æ¯ç»„åˆ</span>    <span class="hljs-keyword">char</span> c = digits.charAt(len);    <span class="hljs-keyword">int</span> pos = c - <span class="hljs-string">'0'</span>;    <span class="hljs-comment">// æ‰€éœ€è¦çš„é€‰æ‹©åˆ—è¡¨</span>    String candidateString = map[pos];    <span class="hljs-comment">// æšä¸¾æ¯ä¸ªå­—æ¯ç»„åˆ</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; candidateString.length(); i++) &#123;        <span class="hljs-comment">// è·¯å¾„ä¸ºï¼šä¸Šä¸€è½®çš„è·¯å¾„ + é€‰æ‹©åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—æ¯</span>        <span class="hljs-comment">// é€’å½’æ·±åº¦/è·¯å¾„é•¿åº¦ + 1</span>        combine(digits, path + candidateString.charAt(i), len + <span class="hljs-number">1</span>);    &#125;&#125;</code></pre><p><code>8.16</code> æŒ‰ç…§æ¨¡æ¿çš„å›æº¯è§£æ³•ï¼šæ·»åŠ  <code>add</code>ï¼Œ<code>remove</code> æ“ä½œã€‚<br />ä¸€å¼€å§‹ <code>path</code> ä½¿ç”¨çš„æ˜¯ <code>List</code>ï¼Œæ€»æ˜¯æ— æ³•é€šè¿‡ï¼Œåæ¥å‘ç°è‹¥æ˜¯ <code>digits</code> ç”±åŒä¸€ä¸ªæ•°å­—ç»„æˆçš„æƒ…å†µä¸‹ï¼Œè·¯å¾„ä¸­çš„å…ƒç´ å¯èƒ½æ˜¯é‡å¤çš„ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>list.remove()</code> æ“ä½œä¼šåˆ é™¤é”™è¯¯ä½ç½®çš„å…ƒç´ ï¼Œä½¿ç”¨æ ˆçš„æ€æƒ³å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><pre><code class="hljs java">List&lt;String&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();String[] num2Str = &#123;<span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"abc"</span>, <span class="hljs-string">"def"</span>, <span class="hljs-string">"ghi"</span>, <span class="hljs-string">"jkl"</span>, <span class="hljs-string">"mno"</span>, <span class="hljs-string">"pqrs"</span>, <span class="hljs-string">"tuv"</span>, <span class="hljs-string">"wxyz"</span>&#125;;<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">letterCombinations</span><span class="hljs-params">(String digits)</span> </span>&#123;    <span class="hljs-keyword">if</span> (digits.length() == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-comment">// ä½¿ç”¨ StringBuilder</span>    <span class="hljs-comment">// å¦‚æœä½¿ç”¨ Listï¼Œå½“ä¾‹å­ä¸º "999" ç­‰ç›¸åŒæ•°å­—æ—¶ï¼Œåœ¨å›æº¯æ—¶ remove ä¼šå‡ºé”™</span>    StringBuilder path = <span class="hljs-keyword">new</span> StringBuilder();    backtrack(<span class="hljs-number">0</span>, path, digits);    <span class="hljs-keyword">return</span> res;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">backtrack</span><span class="hljs-params">(<span class="hljs-keyword">int</span> len, StringBuilder path, String digits)</span> </span>&#123;    <span class="hljs-keyword">if</span> (len == digits.length()) &#123;        res.add(path.toString());        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-keyword">int</span> pos = digits.charAt(len) - <span class="hljs-string">'0'</span>;    String str = num2Str[pos];    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; str.length(); j++) &#123;        String candidate = String.valueOf(str.charAt(j));        <span class="hljs-comment">// æœ«å°¾æ·»åŠ </span>        path.append(candidate);        backtrack(len + <span class="hljs-number">1</span>, path, digits);        <span class="hljs-comment">// æœ«å°¾åˆ é™¤</span>        path.deleteCharAt(path.length() - <span class="hljs-number">1</span>);    &#125;&#125;</code></pre><h1 id="é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#é˜Ÿåˆ—"></a> é˜Ÿåˆ—</h1><blockquote><p>â€˜â€™<br />a, b, c<br />b, c, ad, ae, af<br />â€¦</p></blockquote><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">letterCombinations</span><span class="hljs-params">(String digits)</span> </span>&#123;    List&lt;String&gt; res = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">if</span> (digits.length() == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> res;    &#125;    <span class="hljs-comment">// 2 ~ 9 æ¯ä¸ªä½ç½®æ‰€å¯¹åº”çš„é€‰æ‹©åˆ—è¡¨</span>    String[] map = &#123;<span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"abc"</span>, <span class="hljs-string">"def"</span>, <span class="hljs-string">"ghi"</span>, <span class="hljs-string">"jkl"</span>, <span class="hljs-string">"mno"</span>, <span class="hljs-string">"pqrs"</span>, <span class="hljs-string">"tuv"</span>, <span class="hljs-string">"wxyz"</span>&#125;;    <span class="hljs-comment">// æ·»åŠ ç©ºå…ƒç´ ï¼Œåˆå§‹åŒ–æ—¶ä½¿ç¬¬ä¸€ä¸ªä½ç½®çš„å­—æ¯å…¥é˜Ÿ</span>    res.add(<span class="hljs-string">""</span>);    <span class="hljs-comment">// 1. éå† digits e.g. "23"</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; digits.length(); i++) &#123;        <span class="hljs-keyword">int</span> pos = digits.charAt(i) - <span class="hljs-string">'0'</span>;        <span class="hljs-comment">// é€‰æ‹©åˆ—è¡¨ e.g. "def"</span>        String candidateStr = map[pos];        <span class="hljs-comment">// 2. éå†é˜Ÿåˆ—ï¼Œç»„åˆå­—æ¯ res: a, b, c</span>        <span class="hljs-comment">// !! å…ˆç¼“å­˜å½“å‰çš„é˜Ÿåˆ—é•¿åº¦ï¼Œå¦åˆ™åŠ¨æ€ add path æ—¶ï¼Œé˜Ÿåˆ—é•¿åº¦åœ¨å˜åŒ–</span>        <span class="hljs-keyword">int</span> size = res.size();        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; size; j++) &#123;            <span class="hljs-comment">// é˜Ÿå¤´å‡ºé˜Ÿ e.g. a</span>            String path = res.remove(<span class="hljs-number">0</span>);            <span class="hljs-comment">// 3. ç»„åˆé˜Ÿå¤´å’Œé€‰æ‹©åˆ—è¡¨</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; candidateStr.length(); k++) &#123;                <span class="hljs-comment">// b, c, ad, ae, af</span>                res.add(path + candidateStr.charAt(k));            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>BFS</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>InnoDB å­˜å‚¨å¼•æ“</title>
    <link href="/2020/08/04/InnoDB-engine/"/>
    <url>/2020/08/04/InnoDB-engine/</url>
    
    <content type="html"><![CDATA[<h1 id="mysql-ä½“ç³»ç»“æ„"><a class="markdownIt-Anchor" href="#mysql-ä½“ç³»ç»“æ„"></a> MySQL ä½“ç³»ç»“æ„</h1><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200804132116.png" srcset="/img/loading.gif" alt="" /></p><ul><li>è¿æ¥æ± ç»„ä»¶</li><li>ç®¡ç†æœåŠ¡å’Œå·¥å…·ç±»</li><li><code>SQL</code> æ¥å£ç»„ä»¶</li><li>æŸ¥è¯¢åˆ†æå™¨ç»„ä»¶</li><li>ä¼˜åŒ–å™¨ç»„ä»¶</li><li>ç¼“å†²ç»„ä»¶</li><li>æ’ä»¶å¼å­˜å‚¨å¼•æ“</li><li>ç‰©ç†æ–‡ä»¶</li></ul><blockquote><p>å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ã€‚</p></blockquote><h1 id="innodb-ä½“ç³»æ¶æ„"><a class="markdownIt-Anchor" href="#innodb-ä½“ç³»æ¶æ„"></a> <code>InnoDB</code> ä½“ç³»æ¶æ„</h1><p><code>InnoDB</code> å­˜å‚¨å¼•æ“æœ‰å¤šä¸ªå†…å­˜å—ï¼Œå¯ä»¥è®¤ä¸ºè¿™äº›å†…å­˜å—ç»„æˆäº†ä¸€ä¸ªå¤§çš„å†…å­˜æ± ï¼šè´Ÿè´£ä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>ç»´æŠ¤æ‰€æœ‰è¿›ç¨‹ã€çº¿ç¨‹éœ€è¦è®¿é—®çš„å¤šä¸ªå†…éƒ¨æ•°æ®ç»“æ„</li><li>ç¼“å­˜ç£ç›˜æ•°æ®</li><li>é‡åšæ—¥å¿—ç¼“å†²</li></ul><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200804133649.png" srcset="/img/loading.gif" alt="" /></p><p>åå°çº¿ç¨‹çš„ä¸»è¦ä½œç”¨æ˜¯<strong>è´Ÿè´£åˆ·æ–°å†…å­˜æ± ä¸­çš„æ•°æ®</strong>ï¼Œä¿è¯ç¼“å†²æ± ä¸­çš„å†…å­˜ç¼“å­˜çš„æ˜¯æœ€è¿‘çš„æ•°æ®ã€‚æ­¤å¤–å°†å·²ä¿®æ”¹çš„æ•°æ®æ–‡ä»¶åˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ï¼ŒåŒæ—¶ä¿è¯åœ¨æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ <code>InnoDB</code> èƒ½æ¢å¤åˆ°æ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚</p><h2 id="åå°çº¿ç¨‹"><a class="markdownIt-Anchor" href="#åå°çº¿ç¨‹"></a> åå°çº¿ç¨‹</h2><ul><li><p><code>Master Thread</code><br /><code>Master Thread</code> æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„åå°çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„<strong>æ•°æ®å¼‚æ­¥åˆ·æ–°</strong>åˆ°ç£ç›˜ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚åŒ…æ‹¬è„é¡µçš„åˆ·æ–°ã€åˆå¹¶æ’å…¥ç¼“å†²ã€<code>UNDO</code> é¡µçš„å›æ”¶ç­‰ã€‚</p></li><li><p><code>IO Thread</code><br /><code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­å¤§é‡ä½¿ç”¨äº† <code>AIO</code> æ¥å¤„ç†å†™è¯·æ±‚ï¼Œ<code>IO Thread</code> çš„å·¥ä½œä¸»è¦æ˜¯è´Ÿè´£è¿™äº› <strong><code>IO</code> è¯·æ±‚çš„å›è°ƒå¤„ç†</strong>ã€‚</p></li><li><p><code>Purge Thread</code><br />äº‹åŠ¡è¢«æäº¤åï¼Œå…¶æ‰€ä½¿ç”¨çš„ <code>undolog</code> å¯èƒ½ä¸å†éœ€è¦ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ <code>Purge Thread</code> æ¥<strong>å›æ”¶</strong>å·²ç»ä½¿ç”¨å¹¶åˆ†é…çš„ <code>undo</code> é¡µã€‚</p></li><li><p><code>Page Cleaner Thread</code><br />å…¶ä½œç”¨æ˜¯å°†<strong>è„é¡µçš„åˆ·æ–°æ“ä½œ</strong>éƒ½æ”¾å…¥åˆ°å•ç‹¬çš„çº¿ç¨‹ä¸­æ¥å®Œæˆï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å‡è½» <code>Master Thread</code> çš„å·¥ä½œåŠå¯¹äºç”¨æˆ·æŸ¥è¯¢çº¿ç¨‹çš„é˜»å¡ï¼Œè¿›ä¸€æ­¥æé«˜ <code>InnoDB</code> çš„æ€§èƒ½ã€‚</p></li></ul><h2 id="å†…å­˜"><a class="markdownIt-Anchor" href="#å†…å­˜"></a> å†…å­˜</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200804135715.png" srcset="/img/loading.gif" alt="" /></p><h3 id="ç¼“å†²æ± "><a class="markdownIt-Anchor" href="#ç¼“å†²æ± "></a> ç¼“å†²æ± </h3><p><code>InnoDB</code> å­˜å‚¨å¼•æ“æ˜¯åŸºäºç£ç›˜å­˜å‚¨çš„ï¼Œå¹¶å°†å…¶ä¸­çš„è®°å½•æŒ‰ç…§é¡µçš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚<br />å¯¹äºæ•°æ®åº“ä¸­é¡µçš„ä¿®æ”¹æ“ä½œï¼Œé¦–å…ˆä¿®æ”¹åœ¨ç¼“å†²æ± ä¸­çš„é¡µï¼Œç„¶åå†é€šè¿‡ <code>Checkpoint</code> æœºåˆ¶åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚</p><h3 id="lru-list-free-list-flush-list"><a class="markdownIt-Anchor" href="#lru-list-free-list-flush-list"></a> <code>LRU List</code>, <code>Free List</code>, <code>Flush List</code></h3><p><code>InnoDB</code> å­˜å‚¨å¼•æ“ä¸­ï¼Œ<code>LRU List</code> ä¸­è¿˜åŠ å…¥äº† <code>midpoint</code> ä½ç½®ï¼Œ<code>midpoint</code> ä¹‹åçš„åˆ—è¡¨ç§°ä¸º <code>old</code> åˆ—è¡¨ï¼Œ ä¹‹å‰çš„åˆ—è¡¨ç§°ä¸º <code>new</code> åˆ—è¡¨ï¼Œ<code>new</code> åˆ—è¡¨ä¸­çš„é¡µéƒ½æ˜¯æœ€ä¸ºæ´»è·ƒçš„çƒ­ç‚¹æ•°æ®ã€‚æ–°è¯»å–åˆ°çš„é¡µï¼Œå¹¶ä¸æ˜¯ç›´æ¥æ”¾å…¥ <code>LRU</code> åˆ—è¡¨çš„é¦–éƒ¨ï¼Œè€Œæ˜¯æ”¾å…¥ <code>LRU</code> åˆ—è¡¨çš„ <code>midpoint</code> ä½ç½®ã€‚åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œè¿™ä¸ªä½ç½®åœ¨ <code>LRU</code> åˆ—è¡¨é•¿åº¦çš„ <code>5/8</code> å¤„ã€‚</p><blockquote><p>é‚£ä¸ºä»€ä¹ˆä¸é‡‡ç”¨æœ´ç´ çš„ <code>LRU</code> ç®—æ³•ï¼Œç›´æ¥å°†è¯»å–çš„é¡µæ”¾å…¥åˆ° <code>LRU List</code> çš„é¦–éƒ¨å‘¢ï¼Ÿ<br />è‹¥ç›´æ¥å°†è¯»å–åˆ°çš„é¡µæ”¾äººåˆ° <code>LRU</code> çš„é¦–éƒ¨ï¼Œé‚£ä¹ˆæŸäº› <code>SQL</code> æ“ä½œå¯èƒ½ä¼šä½¿ç¼“å†²æ± ä¸­çš„çƒ­ç‚¹æ•°æ®è¢«åˆ·æ–°ï¼Œè€Œåœ¨ä¸‹ä¸€æ¬¡éœ€è¦è¯»å–è¯¥é¡µæ—¶ï¼Œéœ€è¦å†æ¬¡è®¿é—®ç£ç›˜ã€‚<br />å¸¸è§çš„è¿™ç±»æ“ä½œä¸º<strong>ç´¢å¼•</strong>æˆ–<strong>æ•°æ®çš„æ‰«æ</strong>æ“ä½œã€‚è¿™ç±»æ“ä½œéœ€è¦è®¿é—®è¡¨ä¸­çš„è®¸å¤šé¡µï¼Œç”šè‡³æ˜¯å…¨éƒ¨çš„é¡µï¼Œè€Œè¿™äº›é¡µé€šå¸¸æ¥è¯´åˆä»…åœ¨è¿™æ¬¡æŸ¥è¯¢æ“ä½œä¸­éœ€è¦ï¼Œå¹¶ä¸æ˜¯æ´»è·ƒçš„çƒ­ç‚¹æ•°æ®ã€‚</p></blockquote><p><code>LRU List</code> ç”¨æ¥ç®¡ç†å·²ç»è¯»å–çš„é¡µï¼Œä½†å½“æ•°æ®åº“åˆšå¯åŠ¨æ—¶ï¼Œ<code>LRU List</code> æ˜¯ç©ºçš„ï¼Œå³æ²¡æœ‰ä»»ä½•çš„é¡µã€‚è¿™æ—¶é¡µéƒ½å­˜æ”¾åœ¨ <code>Free List</code> ä¸­ã€‚å½“éœ€è¦ä»ç¼“å†²æ± ä¸­åˆ†é¡µæ—¶ï¼Œé¦–å…ˆä» <code>Free List</code> ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å¯ç”¨çš„ç©ºé—²é¡µ</p><ul><li>è‹¥æœ‰åˆ™å°†è¯¥é¡µä» <code>Free List</code> ä¸­åˆ é™¤ï¼Œæ”¾å…¥åˆ° <code>LRU List</code> ä¸­ã€‚</li><li>å¦åˆ™ï¼Œæ ¹æ® <code>LRU</code> ç®—æ³•ï¼Œæ·˜æ±° <code>LRU List</code> æœ«å°¾çš„é¡µï¼Œå°†è¯¥å†…å­˜ç©ºé—´åˆ†é…ç»™æ–°çš„é¡µã€‚</li></ul><ul><li><code>page made young</code>: é¡µä» <code>LRU List</code> çš„ <code>old</code> éƒ¨åˆ†åŠ å…¥åˆ° <code>new</code> éƒ¨åˆ†ã€‚</li><li><code>page not made young</code>: å› ä¸º <code>innodb-old_blocks-time</code> çš„è®¾ç½®è€Œå¯¼è‡´é¡µæ²¡æœ‰ä» <code>old</code> éƒ¨åˆ†ç§»åŠ¨åˆ° <code>new</code> éƒ¨åˆ†ã€‚</li></ul><p>å½“ <code>LRU List</code> ä¸­çš„é¡µè¢«ä¿®æ”¹åï¼Œç§°è¯¥é¡µä¸ºè„é¡µï¼ˆ<code>dirty page</code>ï¼‰ï¼Œå³ç¼“å†²æ± ä¸­çš„é¡µå’Œç£ç›˜ä¸Šçš„é¡µæ•°æ®äº§ç”Ÿäº†ä¸ä¸€è‡´ã€‚è¿™æ—¶å€™æ•°æ®åº“ä¼šé€šè¿‡ <code>checkpoint</code> æœºåˆ¶å°†è„é¡µåˆ·æ–°å›ç£ç›˜ï¼Œè€Œ <code>Flush List</code> ä¸­çš„é¡µå³ä¸ºè„é¡µåˆ—è¡¨ã€‚æ³¨æ„è„é¡µä¹Ÿå­˜åœ¨äº <code>LRU List</code> ä¸­ã€‚</p><h3 id="é‡åšæ—¥å¿—ç¼“å†²"><a class="markdownIt-Anchor" href="#é‡åšæ—¥å¿—ç¼“å†²"></a> é‡åšæ—¥å¿—ç¼“å†²</h3><p><code>InnoDB</code> å¼•æ“é¦–å…ˆå°†é‡åšæ—¥å¿—ä¿¡æ¯å…ˆæ”¾åˆ°é‡åšæ—¥å¿—ç¼“å†²åŒº(<code>redo log buffer</code>)ï¼Œç„¶åæŒ‰ä¸€å®šé¢‘ç‡åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ã€‚é‡åšæ—¥å¿—ç¼“å†²ä¸éœ€è¦è®¾ç½®å¾ˆå¤§ï¼Œä¸€èˆ¬æ¯ä¸€ç§’éƒ½ä¼šåˆ·æ–° <code>redo log buffer</code>ï¼Œé…ç½®çš„å¤§å°åªéœ€è¦ä¿è¯æ¯ç§’äº§ç”Ÿçš„äº‹åŠ¡åœ¨è¿™ä¸ªç¼“å†²åŒºå¤§å°ä¹‹å†…å³å¯ã€‚é€šè¿‡å‚æ•° <code>innodb_log_buffer_size</code> è®¾ç½®ã€‚<br />åœ¨ä¸‹åˆ—æƒ…å†µä¸‹ä¼šå°†é‡åšæ—¥å¿—ç¼“å†²ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜é‡åšæ—¥å¿—æ–‡ä»¶ä¸­ï¼š</p><ul><li><code>Master Thread</code> æ¯ä¸€ç§’ä¸­åˆ·æ–°ä¸€æ¬¡ï¼›</li><li>æ¯ä¸ªäº‹åŠ¡æäº¤æ—¶ä¼šåˆ·æ–°ï¼›</li><li>å½“é‡åšæ—¥å¿—ç¼“å†²åŒºç©ºé—´å°äº <code>1/2</code> æ—¶ä¼šåˆ·æ–°ã€‚</li></ul><h3 id="é¢å¤–çš„å†…å­˜æ± "><a class="markdownIt-Anchor" href="#é¢å¤–çš„å†…å­˜æ± "></a> é¢å¤–çš„å†…å­˜æ± </h3><p>é¢å¤–çš„å†…å­˜æ± ç”¨æ¥å¯¹ä¸€äº›æ•°æ®ç»“æ„æœ¬èº«çš„å†…å­˜è¿›è¡Œåˆ†é…ï¼Œä¾‹å¦‚ç¼“å†²æ§åˆ¶å¯¹è±¡(<code>buffer control block</code>)è®°å½•çš„ <code>LRU</code>ï¼Œé”ï¼Œç­‰å¾…ç­‰ä¿¡æ¯ã€‚é¢å¤–çš„å†…å­˜æ± ä¸å¤Ÿæ—¶ä¼šä»ç¼“å†²æ± ä¸­è¿›è¡Œç”³è¯·ã€‚å› æ­¤ï¼Œåœ¨ç”³è¯·äº†å¾ˆå¤§çš„ <code>InnoDB</code> ç¼“å†²æ± æ—¶ï¼Œé¢å¤–çš„å†…å­˜æ± ä¹Ÿè¦é€‚å½“çš„è°ƒå¤§ã€‚é€šè¿‡å‚æ•° <code>innodb_additional_mem_pool_size</code> æ¥è®¾ç½®å¤§å°ã€‚</p><h1 id="checkpoint-æŠ€æœ¯"><a class="markdownIt-Anchor" href="#checkpoint-æŠ€æœ¯"></a> <code>Checkpoint</code> æŠ€æœ¯</h1><p>ä½œç”¨ï¼šå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ã€‚<br />ç›®çš„ï¼š</p><ul><li>ç¼©çŸ­æ•°æ®åº“çš„æ¢å¤æ—¶é—´</li><li>ç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜</li><li>é‡åšæ—¥å¿—ä¸å¯ç”¨æ—¶ï¼Œåˆ·æ–°è„é¡µ</li></ul><p>ç±»å‹ï¼š</p><ul><li><code>Sharp Checkpoint</code> - æ•°æ®åº“å…³é—­æ—¶å°†æ‰€æœ‰çš„è„é¡µéƒ½åˆ·æ–°å›ç£ç›˜ã€‚</li><li><code>Fuzzy Checkpoint</code>:<ul><li><code>Master THread Checkpoint</code> - æ¯ç§’æˆ–æ¯åç§’åˆ·æ–°</li><li><code>FLUSH_LRU_LIST Checkpoint</code> - è„é¡µæ¥è‡ªäº <code>LRU List</code></li><li><code>Async/Sync Flush Checkpoint</code> - é‡åšæ—¥å¿—ä¸å¯ç”¨ï¼Œå¼ºåˆ¶åˆ·æ–°è„é¡µ</li><li><code>Dirty Page too mush Checkpoint</code> - è„é¡µå¤ªå¤šå¼ºåˆ¶åˆ·æ–°</li></ul></li></ul><h1 id="master-thread-å·¥ä½œæ–¹å¼"><a class="markdownIt-Anchor" href="#master-thread-å·¥ä½œæ–¹å¼"></a> <code>Master Thread</code> å·¥ä½œæ–¹å¼</h1><p><code>Master Thread</code> å…·æœ‰<strong>æœ€é«˜çš„çº¿ç¨‹ä¼˜å…ˆçº§åˆ«</strong>ï¼Œå…¶å†…éƒ¨ç”±å¤šä¸ªå¾ªç¯ç»„æˆ</p><ul><li>ä¸»å¾ªç¯ï¼ˆ<code>loop</code>ï¼‰</li><li>åå°å¾ªç¯ï¼ˆ<code>background loop</code>ï¼‰</li><li>åˆ·æ–°å¾ªç¯ï¼ˆ<code>lush loop</code>ï¼‰</li><li>æš‚åœå¾ªç¯ï¼ˆ<code>suspend loop</code>ï¼‰</li></ul><h2 id="ä¸»å¾ªç¯"><a class="markdownIt-Anchor" href="#ä¸»å¾ªç¯"></a> ä¸»å¾ªç¯</h2><p>å¤§å¤šæ•°çš„æ“ä½œéƒ½æ˜¯åœ¨<strong>ä¸»å¾ªç¯</strong>ä¸­ï¼Œå…¶ä¸­åŒ…æ‹¬æ¯ç§’çš„æ“ä½œå’Œæ¯ <code>10</code> ç§’çš„æ“ä½œã€‚</p><p>æ¯ç§’çš„æ“ä½œï¼š</p><ul><li>æ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ï¼Œå³ä½¿è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤ï¼ˆæ€»æ˜¯ï¼‰</li><li>åˆå¹¶æ’å…¥ç¼“å†²ï¼ˆå‰ä¸€ç§’ <code>IO</code> å°äº <code>5</code> æ¬¡ï¼‰</li><li>è‡³å¤šåˆ·æ–° <code>100</code> ä¸ª è„é¡µåˆ°ç£ç›˜ï¼ˆè„é¡µæ¯”ä¾‹è¶…è¿‡é˜ˆå€¼ï¼‰</li><li>å¦‚æœæ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼Œåˆ‡æ¢åˆ°åå°å¾ªç¯</li></ul><p>æ¯ <code>10</code> ç§’çš„æ“ä½œï¼š</p><ul><li>åˆ·æ–° <code>100</code> ä¸ªè„é¡µåˆ°ç£ç›˜ï¼ˆè¿‡å» <code>10</code> ç§’ <code>IO</code> å°äº <code>200</code> æ¬¡ï¼‰</li><li>åˆå¹¶è‡³å¤š <code>5</code> ä¸ªæ’å…¥ç¼“å†²ï¼ˆæ€»æ˜¯ï¼‰</li><li>å°†æ—¥å¿—ç¼“å†²åˆ·æ–°åˆ°ç£ç›˜ ï¼ˆæ€»æ˜¯ï¼‰</li><li>åˆ é™¤æ— ç”¨çš„ <code>undo</code> é¡µï¼ˆæ€»æ˜¯ï¼‰</li><li>åˆ·æ–° <code>100</code> ä¸ªæˆ–è€… <code>10</code> ä¸ªè„é¡µåˆ°ç£ç›˜ï¼ˆæ€»æ˜¯ï¼‰</li></ul><h2 id="åå°å¾ªç¯"><a class="markdownIt-Anchor" href="#åå°å¾ªç¯"></a> åå°å¾ªç¯</h2><blockquote><p>å½“å‰æ²¡æœ‰ç”¨æˆ·æ´»åŠ¨ï¼ˆæ•°æ®åº“ç©ºé—²æ—¶ï¼‰æˆ–æ•°æ®åº“å…³é—­æ—¶ï¼Œåˆ‡æ¢åˆ°åå°å¾ªç¯ã€‚<br />æ“ä½œï¼š</p></blockquote><ul><li>åˆ é™¤æ— ç”¨çš„ <code>undo</code> é¡µï¼ˆæ€»æ˜¯ï¼‰</li><li>åˆå¹¶ <code>20</code> ä¸ªæ’å…¥ç¼“å†²ï¼ˆæ€»æ˜¯ï¼‰</li><li>è°ƒå›åˆ°ä¸»å¾ªç¯ï¼ˆæ€»æ˜¯ï¼‰</li><li>ä¸æ–­åˆ·æ–° <code>100</code> ä¸ªé¡µç›´åˆ°ç¬¦åˆæ¡ä»¶ï¼ˆå¯èƒ½ï¼Œè·³è½¬åˆ° <code>flush loop</code> ä¸­å®Œæˆï¼‰</li></ul><h1 id="innodb-å…³é”®ç‰¹æ€§"><a class="markdownIt-Anchor" href="#innodb-å…³é”®ç‰¹æ€§"></a> <code>InnoDB</code> å…³é”®ç‰¹æ€§</h1><h2 id="æ’å…¥ç¼“å†²"><a class="markdownIt-Anchor" href="#æ’å…¥ç¼“å†²"></a> æ’å…¥ç¼“å†²</h2><h3 id="insert-buffer"><a class="markdownIt-Anchor" href="#insert-buffer"></a> <code>Insert Buffer</code></h3><p>å¯¹äº<strong>éèšé›†ç´¢å¼•</strong>çš„æ’å…¥æˆ–æ›´æ–°æ“ä½œï¼Œä¸æ˜¯æ¯ä¸€æ¬¡ç›´æ¥æ’å…¥åˆ°ç´¢å¼•é¡µä¸­ï¼Œè€Œæ˜¯å…ˆåˆ¤æ–­æ’å…¥çš„éèšé›†ç´¢å¼•é¡µæ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ï¼Œè‹¥åœ¨åˆ™ç›´æ¥æ’å…¥ï¼›è‹¥ä¸åœ¨ï¼Œåˆ™å…ˆæ”¾å…¥åˆ°ä¸€ä¸ª <code>Insert Buffr</code> å¯¹è±¡ä¸­ã€‚<br />ç„¶åå†ä»¥ä¸€å®šé¢‘ç‡å’Œæƒ…å†µè¿›è¡Œæ’å…¥ç¼“å†²çš„åˆå¹¶æ“ä½œï¼Œå°†å¤šä¸ªæ’å…¥åˆå¹¶åˆ°ä¸€ä¸ªæ“ä½œä¸­ã€‚</p><p>ä½¿ç”¨æ¡ä»¶ï¼š</p><ol><li>ç´¢å¼•æ˜¯è¾…åŠ©ç´¢å¼•</li><li>ç´¢å¼•ä¸æ˜¯å”¯ä¸€çš„</li></ol><h3 id="change-buffer"><a class="markdownIt-Anchor" href="#change-buffer"></a> <code>Change Buffer</code></h3><p><code>Change Buffer</code> å¯è§†ä¸º <code>Insert Buffer</code> çš„å‡çº§ï¼Œå¯ä»¥å¯¹ <code>DML</code> æ“ä½œï¼š<code>INSERT</code>, <code>DELETE</code>, <code>UPDATE</code> éƒ½è¿›è¡Œç¼“å†²ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>Insert Buffer</code>, <code>Delete Buffer</code>, <code>Purge Buffer</code>ã€‚</p><p>é€‚ç”¨å¯¹è±¡ä¾ç„¶æ˜¯<strong>éå”¯ä¸€çš„è¾…åŠ©ç´¢å¼•</strong>ã€‚<br /><code>Insert/Change Buffer</code> æ˜¯ä¸€æ£µ <code>B+</code> æ ‘ã€‚</p><p>æ“ä½œè¿‡ç¨‹ï¼š</p><ol><li>å°†è®°å½•æ ‡è®°ä¸ºå·²åˆ é™¤ï¼ˆ<code>Delete Buffer</code>ï¼‰ï¼›</li><li>çœŸæ­£å°†è®°å½•åˆ é™¤ï¼ˆ<code>Purge Buffer</code>ï¼‰ã€‚</li></ol><h3 id="merge-insert-buffer"><a class="markdownIt-Anchor" href="#merge-insert-buffer"></a> <code>Merge Insert Buffer</code></h3><p><code>Merge Insert Buffer</code> çš„æ“ä½œå¯èƒ½å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼š</p><ul><li>è¾…åŠ©ç´¢å¼•é¡µè¢«è¯»å–åˆ°ç¼“å†²æ± æ—¶ï¼›</li><li><code>Insert Buffer Bitmap</code> é¡µè¿½è¸ªåˆ°è¯¥è¾…åŠ©ç´¢å¼•é¡µå·²æ— å¯ç”¨ç©ºé—´æ—¶ï¼›</li><li><code>Master Thread</code>ï¼šæ¯ç§’æˆ–æ¯ <code>10</code> ç§’ã€‚</li></ul><h2 id="ä¸¤æ¬¡å†™"><a class="markdownIt-Anchor" href="#ä¸¤æ¬¡å†™"></a> ä¸¤æ¬¡å†™</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200804162449.png" srcset="/img/loading.gif" alt="" /></p><ol><li>å½“åˆ·æ–°ç¼“å†²æ± è„é¡µæ—¶ï¼Œå¹¶ä¸ç›´æ¥å†™åˆ°æ•°æ®æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å…ˆæ‹·è´è‡³å†…å­˜ä¸­çš„ä¸¤æ¬¡å†™ç¼“å†²åŒºï¼›</li><li>æ¥ç€ä»ä¸¤æ¬¡å†™ç¼“å†²åŒºåˆ†ä¸¤æ¬¡å†™å…¥ç£ç›˜å…±äº«è¡¨ç©ºé—´ä¸­ï¼Œæ¯æ¬¡å†™å…¥ <code>1MB</code>ï¼›</li><li>å¾…ç¬¬2æ­¥å®Œæˆåï¼Œå†å°†ä¸¤æ¬¡å†™ç¼“å†²åŒºå†™å…¥æ•°æ®æ–‡ä»¶ã€‚</li></ol><p>è¿™æ ·å°±å¯ä»¥è§£å†³<strong>éƒ¨åˆ†å†™å¤±æ•ˆ</strong>çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ç£ç›˜å…±äº«è¡¨ç©ºé—´ä¸­å·²æœ‰æ•°æ®é¡µå‰¯æœ¬æ‹·è´ï¼Œå¦‚æœæ•°æ®åº“åœ¨é¡µå†™å…¥æ•°æ®æ–‡ä»¶çš„è¿‡ç¨‹ä¸­å®•æœºï¼Œåœ¨å®ä¾‹æ¢å¤æ—¶ï¼Œå¯ä»¥ä»å…±äº«è¡¨ç©ºé—´ä¸­æ‰¾åˆ°è¯¥é¡µå‰¯æœ¬ï¼Œå°†å…¶æ‹·è´è¦†ç›–åŸæœ‰çš„æ•°æ®é¡µï¼Œå†åº”ç”¨é‡åšæ—¥å¿—å³å¯ã€‚</p><h2 id="è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•"><a class="markdownIt-Anchor" href="#è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•"></a> è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</h2><blockquote><p><code>InnoDB</code> ä¼šè‡ªåŠ¨æ ¹æ®è®¿é—®çš„é¢‘ç‡å’Œæ¨¡å¼æ¥è‡ªåŠ¨åœ°ä¸ºæŸäº›çƒ­ç‚¹é¡µå»ºç«‹å“ˆå¸Œç´¢å¼•ã€‚å®ƒæ˜¯é€šè¿‡ç¼“å†²æ± ä¸­çš„ <code>B+</code> æ ‘æ„é€ è€Œæ¥ï¼Œä¸”ä¸éœ€è¦å¯¹æ•´ä¸ªè¡¨å»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œå› æ­¤å®ƒçš„é€Ÿåº¦éå¸¸å¿«ã€‚</p></blockquote><p><code>InnoDB</code> é‡‡ç”¨è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œå®ƒä¼šå®æ—¶ç›‘æ§è¡¨ä¸Šç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœè®¤ä¸ºå»ºç«‹å“ˆå¸Œç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œåˆ™è‡ªåŠ¨åœ¨å†…å­˜ä¸­çš„â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ç¼“å†²åŒºâ€å»ºç«‹å“ˆå¸Œç´¢å¼•ã€‚</p><h2 id="å¼‚æ­¥-io"><a class="markdownIt-Anchor" href="#å¼‚æ­¥-io"></a> å¼‚æ­¥ IO</h2><ul><li><code>AIO</code> å¯ä»¥ä½¿ç”¨æˆ·åœ¨å‘å‡ºä¸€ä¸ª <code>IO</code> è¯·æ±‚åç«‹å³å†å‘å‡ºå¦ä¸€ä¸ª <code>IO</code> è¯·æ±‚ï¼Œå½“å…¨éƒ¨è¯·æ±‚å‘é€å®Œæ¯•åï¼Œç­‰å¾…æ‰€æœ‰ <code>IO</code> æ“ä½œçš„å®Œæˆã€‚</li><li>å¯ä»¥è¿›è¡Œ <code>IO Merge</code> æ“ä½œï¼Œå°†å¤šä¸ª <code>IO</code> åˆå¹¶ä¸º <code>1</code> ä¸ª <code>IO</code>ã€‚</li></ul><h2 id="åˆ·æ–°é‚»æ¥é¡µ"><a class="markdownIt-Anchor" href="#åˆ·æ–°é‚»æ¥é¡µ"></a> åˆ·æ–°é‚»æ¥é¡µ</h2><p>å½“åˆ·æ–°ä¸€ä¸ªè„é¡µæ—¶ï¼Œ<code>InnoDB</code> ä¼šæ£€æµ‹è¯¥é¡µæ‰€åœ¨åŒºçš„æ‰€æœ‰é¡µï¼Œå¦‚æœæ˜¯è„é¡µï¼Œé‚£ä¹ˆä¸€èµ·è¿›è¡Œåˆ·æ–°ã€‚<br />å¥½å¤„æ˜¯é€šè¿‡ <code>AIO</code> å°†å¤šä¸ª <code>IO</code> å†™å…¥æ“ä½œåˆå¹¶æˆä¸€ä¸ª <code>IO</code> æ“ä½œï¼Œåœ¨ä¼ ç»Ÿæœºæ¢°ç¡¬ç›˜ä¸‹æœ‰ç€æ˜¾è‘—ä¼˜åŠ¿ã€‚è€Œå¯¹äºå›ºæ€ç¡¬ç›˜å»ºè®®å…³é—­æ­¤ç‰¹æ€§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode 169. å¤šæ•°å…ƒç´ </title>
    <link href="/2020/08/03/LeetCode-169-majority-element/"/>
    <url>/2020/08/03/LeetCode-169-majority-element/</url>
    
    <content type="html"><![CDATA[<p><a href="https://leetcode-cn.com/problems/majority-element/" target="_blank" rel="noopener">å¤šæ•°å…ƒç´ </a></p><h1 id="è§£æ³•ä¸€hashmap"><a class="markdownIt-Anchor" href="#è§£æ³•ä¸€hashmap"></a> è§£æ³•ä¸€ï¼š<code>HashMap</code></h1><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> n = nums.length;    <span class="hljs-keyword">int</span> maj = n / <span class="hljs-number">2</span>;    Map&lt;Integer, Integer&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(n);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> num : nums) &#123;        <span class="hljs-keyword">if</span> (map.get(num) != <span class="hljs-keyword">null</span>) &#123;            map.put(num, map.get(num) + <span class="hljs-number">1</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            map.put(num, <span class="hljs-number">1</span>);        &#125;    &#125;    <span class="hljs-keyword">for</span> (Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet()) &#123;        <span class="hljs-keyword">if</span> (entry.getValue() &gt; maj) &#123;            <span class="hljs-keyword">return</span> entry.getKey();        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n)</code></li><li>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(n)</code></li></ul><h1 id="è§£æ³•äºŒæ’åº"><a class="markdownIt-Anchor" href="#è§£æ³•äºŒæ’åº"></a> è§£æ³•äºŒï¼šæ’åº</h1><blockquote><p>ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p></blockquote><p>æ’åºåä¸­é—´ä½ç½®çš„å…ƒç´ ä¸€å®šæ˜¯ä¼—æ•°ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;        Arrays.sort(nums);        <span class="hljs-keyword">return</span> nums[nums.length / <span class="hljs-number">2</span>];&#125;</code></pre><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(nlogn)</code></li><li>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(logn)</code></li></ul><h1 id="è§£æ³•ä¸‰éšæœºåŒ–"><a class="markdownIt-Anchor" href="#è§£æ³•ä¸‰éšæœºåŒ–"></a> è§£æ³•ä¸‰ï¼šéšæœºåŒ–</h1><p>å› ä¸ºè¶…è¿‡ <code>n/2</code> çš„æ•°ç»„ä¸‹æ ‡è¢«ä¼—æ•°å æ®äº†ï¼Œè¿™æ ·æˆ‘ä»¬éšæœºæŒ‘é€‰ä¸€ä¸ªä¸‹æ ‡å¯¹åº”çš„å…ƒç´ å¹¶éªŒè¯ï¼Œæœ‰å¾ˆå¤§çš„æ¦‚ç‡èƒ½æ‰¾åˆ°ä¼—æ•°ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;       <span class="hljs-keyword">int</span> maj = nums.length / <span class="hljs-number">2</span>;       Random random = <span class="hljs-keyword">new</span> Random();       <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;           <span class="hljs-keyword">int</span> candidate = nums[getRandIdx(random, <span class="hljs-number">0</span>, nums.length)];           <span class="hljs-keyword">if</span> (count(nums, candidate) &gt; maj) &#123;               <span class="hljs-keyword">return</span> candidate;           &#125;       &#125;   &#125;   <span class="hljs-comment">// 1. è·å–éšæœºä½ç½®</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getRandIdx</span><span class="hljs-params">(Random random, <span class="hljs-keyword">int</span> min, <span class="hljs-keyword">int</span> max)</span> </span>&#123;       <span class="hljs-keyword">return</span> random.nextInt(max - min) + min;   &#125;   <span class="hljs-comment">// 2. è®¡ç®— candidate å‡ºç°æ¬¡æ•°</span>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">count</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> candidate)</span> </span>&#123;       <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;           <span class="hljs-keyword">if</span> (nums[i] == candidate) &#123;               count++;           &#125;       &#125;       <span class="hljs-keyword">return</span> count;   &#125;</code></pre><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šç†è®ºä¸Šæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(âˆ)</code>ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code></li><li>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(1)</code></li></ul><h1 id="æ–¹æ³•å››åˆ†æ²»"><a class="markdownIt-Anchor" href="#æ–¹æ³•å››åˆ†æ²»"></a> æ–¹æ³•å››ï¼šåˆ†æ²»</h1><p>å°†æ•°ç»„åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œç›´åˆ°æ‰€æœ‰çš„å­é—®é¢˜éƒ½æ˜¯é•¿åº¦ä¸º <code>1</code> çš„æ•°ç»„ï¼Œåˆ†åˆ«æ±‚å‡ºå·¦åŠéƒ¨åˆ†çš„ä¼—æ•° <code>leftEle</code> ä»¥åŠå³åŠéƒ¨åˆ†çš„ä¼—æ•° <code>rightEle</code>ï¼Œéšååœ¨ <code>leftEle</code> å’Œ <code>rightEle</code> ä¸­é€‰å‡ºæ­£ç¡®çš„ä¼—æ•°ã€‚</p><ul><li>å¦‚æœå›æº¯åæŸåŒºé—´çš„é•¿åº¦ä¸º <code>1</code>ï¼Œåˆ™å­æ•°ç»„ä¸­å”¯ä¸€çš„æ•°æ˜¾ç„¶æ˜¯ä¼—æ•°ï¼Œç›´æ¥è¿”å›å³å¯ã€‚</li><li>å¦‚æœå›æº¯åæŸåŒºé—´çš„é•¿åº¦å¤§äº <code>1</code>ï¼Œæˆ‘ä»¬å¿…é¡»å°†å·¦å³å­åŒºé—´çš„å€¼åˆå¹¶ã€‚<ul><li>å¦‚æœå®ƒä»¬çš„ä¼—æ•°ç›¸åŒï¼Œé‚£ä¹ˆæ˜¾ç„¶è¿™ä¸€æ®µåŒºé—´çš„ä¼—æ•°æ˜¯å®ƒä»¬ç›¸åŒçš„å€¼ã€‚</li><li>å¦‚æœå®ƒä»¬çš„ä¼—æ•°ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒä¸¤ä¸ªä¼—æ•°åœ¨æ•´ä¸ªåŒºé—´å†…å‡ºç°çš„æ¬¡æ•°æ¥å†³å®šè¯¥åŒºé—´çš„ä¼—æ•°ã€‚</li></ul></li></ul><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    <span class="hljs-keyword">return</span> majEle(nums, <span class="hljs-number">0</span>, nums.length - <span class="hljs-number">1</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majEle</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> low, <span class="hljs-keyword">int</span> high)</span> </span>&#123;    <span class="hljs-comment">// 1. æ•°ç»„åŒºé—´ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç›´æ¥è¿”å›</span>    <span class="hljs-keyword">if</span> (low == high) &#123;        <span class="hljs-keyword">return</span> nums[low];    &#125;    <span class="hljs-comment">// 2. åŒºé—´ä¸­å­˜åœ¨å¤šä¸ªå…ƒç´ ï¼Œè®¡ç®—å·¦å³éƒ¨åˆ†çš„ä¼—æ•°</span>    <span class="hljs-keyword">int</span> mid = (high - low) / <span class="hljs-number">2</span> + low;    <span class="hljs-keyword">int</span> leftEle = majEle(nums, low, mid);    <span class="hljs-keyword">int</span> rightEle = majEle(nums, mid + <span class="hljs-number">1</span>, high);    <span class="hljs-comment">//  2.1 å·¦å³éƒ¨åˆ†çš„ä¼—æ•°ç›¸ç­‰</span>    <span class="hljs-keyword">if</span> (leftEle == rightEle) &#123;        <span class="hljs-keyword">return</span> leftEle;    &#125;    <span class="hljs-comment">// 2.2 å·¦å³éƒ¨åˆ†ä¼—æ•°ä¸ç­‰ï¼Œåˆ™è®¡ç®—ä»–ä»¬åœ¨æ•´ä¸ªåŒºé—´çš„å‡ºç°æ¬¡æ•°</span>    <span class="hljs-keyword">int</span> lCount = count(nums, leftEle, low, high);    <span class="hljs-keyword">int</span> rCount = count(nums, rightEle, low, high);    <span class="hljs-keyword">return</span> lCount &gt; rCount ? leftEle : rightEle;&#125;<span class="hljs-comment">// è®¡ç®— candidate å‡ºç°æ¬¡æ•°</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">count</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> candidate, <span class="hljs-keyword">int</span> low, <span class="hljs-keyword">int</span> high)</span> </span>&#123;    <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = low; i &lt;= high; i++) &#123;        <span class="hljs-keyword">if</span> (nums[i] == candidate) &#123;            count++;        &#125;    &#125;    <span class="hljs-keyword">return</span> count;&#125;</code></pre><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(nlogn)</code>ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(logn)</code>ã€‚å°½ç®¡åˆ†æ²»ç®—æ³•æ²¡æœ‰ç›´æ¥åˆ†é…é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½†åœ¨é€’å½’çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†é¢å¤–çš„æ ˆç©ºé—´ã€‚ç®—æ³•æ¯æ¬¡å°†æ•°ç»„ä»ä¸­é—´åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæ‰€ä»¥æ•°ç»„é•¿åº¦å˜ä¸º <code>1</code> ä¹‹å‰éœ€è¦è¿›è¡Œ <code>O(logn)</code> æ¬¡é€’å½’ï¼Œå³ç©ºé—´å¤æ‚åº¦ä¸º <code>O(logn)</code>ã€‚</li></ul><h1 id="æ–¹æ³•äº”boyer-moore-æŠ•ç¥¨ç®—æ³•"><a class="markdownIt-Anchor" href="#æ–¹æ³•äº”boyer-moore-æŠ•ç¥¨ç®—æ³•"></a> æ–¹æ³•äº”ï¼š<code>Boyer-Moore</code> æŠ•ç¥¨ç®—æ³•</h1><ul><li><p>æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªå€™é€‰ä¼—æ•° <code>candidate</code> å’Œå®ƒå‡ºç°çš„æ¬¡æ•° <code>count</code>ã€‚åˆå§‹æ—¶ <code>candidate</code> å¯ä»¥ä¸ºä»»æ„å€¼ï¼Œ<code>count</code> ä¸º 0ï¼›</p></li><li><p>æˆ‘ä»¬éå†æ•°ç»„ <code>nums</code> ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´  <code>x</code>ï¼Œåœ¨åˆ¤æ–­ <code>x</code> ä¹‹å‰ï¼Œå¦‚æœ <code>count</code> çš„å€¼ä¸º 0ï¼Œæˆ‘ä»¬å…ˆå°† <code>x</code> çš„å€¼èµ‹äºˆ <code>candidate</code>ï¼Œéšåæˆ‘ä»¬åˆ¤æ–­ xï¼š</p><ul><li><p>å¦‚æœ <code>x</code> ä¸ <code>candidate</code> ç›¸ç­‰ï¼Œé‚£ä¹ˆè®¡æ•°å™¨ <code>count + 1</code>ï¼›</p></li><li><p>å¦‚æœ <code>x</code> ä¸ <code>candidate</code> ä¸ç­‰ï¼Œé‚£ä¹ˆè®¡æ•°å™¨ <code>count - 1</code>ã€‚</p></li></ul></li><li><p>åœ¨éå†å®Œæˆåï¼Œ<code>candidate</code> å³ä¸ºæ•´ä¸ªæ•°ç»„çš„ä¼—æ•°ã€‚</p></li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„è¾“å…¥æ•°ç»„ä¸º <code>[1, 1, 0, 0, 0, 1, 0]</code>ï¼Œé‚£ä¹ˆ <code>0</code> å°±æ˜¯å¤šæ•°å…ƒç´ ã€‚<br />é¦–å…ˆï¼Œ<code>candidate</code> è¢«è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªå…ƒç´  <code>1</code>ï¼Œ<code>count</code> ä¹Ÿå˜æˆ <code>1</code>ï¼Œç”±äº <code>1</code> ä¸æ˜¯å¤šæ•°å…ƒç´ ï¼Œæ‰€ä»¥å½“æ‰«æåˆ°æ•°ç»„æŸä¸ªä½ç½®æ—¶ï¼Œ<code>count</code> ä¸€å®šä¼šå‡ä¸º <code>0</code> ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå½“æ‰«æåˆ°ç¬¬å››ä¸ªä½ç½®æ—¶ï¼Œ<code>count</code> å˜æˆ <code>0</code>.</p><p><code>count</code> å€¼å˜åŒ–è¿‡ç¨‹ï¼š<br /><code>[1, 2, 1, 0 â€¦â€¦]</code></p><p>å½“ <code>count</code> å˜æˆ <code>0</code> æ—¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªå‡ºç°çš„ <code>1</code>ï¼Œæˆ‘ä»¬éƒ½ç”¨ä¸€ä¸ª <code>0</code> ä¸å…¶è¿›è¡ŒæŠµæ¶ˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ¶ˆè€—æ‰äº†ä¸å…¶ä¸€æ ·å¤šçš„<code>0</code>ï¼Œè€Œ <code>0</code> æ˜¯å¤šæ•°å…ƒç´ ï¼Œè¿™æ„å‘³ç€å½“æ‰«æåˆ°ç¬¬å››ä¸ªä½ç½®æ—¶ï¼Œæˆ‘ä»¬å·²ç»æœ€å¤§ç¨‹åº¦çš„æ¶ˆè€—æ‰äº†å¤šæ•°å…ƒç´ ã€‚ç„¶è€Œï¼Œå¯¹äºæ•°ç»„ä»ç¬¬äº”ä¸ªä½ç½®å¼€å§‹çš„å‰©ä½™éƒ¨åˆ†ï¼Œ<code>0</code> ä¾ç„¶æ˜¯å…¶ä¸­çš„å¤šæ•°å…ƒç´ (æ³¨æ„ï¼Œå¤šæ•°å…ƒç´ å‡ºç°æ¬¡æ•°å¤§äº <code>âŒŠ n/2 âŒ‹</code>ï¼Œè€Œæˆ‘ä»¬æ‰«æè¿‡çš„éƒ¨åˆ†ä¸­å¤šæ•°å…ƒç´ åªå ä¸€åŠï¼Œé‚£å‰©ä½™éƒ¨åˆ†ä¸­å¤šæ•°å…ƒç´ è¿˜æœ‰ä¸€åŠ)ã€‚å¦‚æœä¹‹å‰ç”¨äºæŠµæ¶ˆçš„å…ƒç´ ä¸­å­˜åœ¨éå¤šæ•°å…ƒç´ ï¼Œé‚£ä¹ˆæ•°ç»„å‰©ä½™éƒ¨åˆ†åŒ…å«çš„å¤šæ•°å…ƒç´ å°±æ›´å¤šäº†ã€‚</p><blockquote><p>æ•°ç»„ä¸­ä» <code>candidate</code> è¢«èµ‹å€¼åˆ° <code>count</code> å‡åˆ° <code>0</code> çš„é‚£ä¸€æ®µå¯ä»¥è¢«å»é™¤ï¼Œä½™ä¸‹éƒ¨åˆ†çš„å¤šæ•°å…ƒç´ ä¾ç„¶æ˜¯åŸæ•°ç»„çš„å¤šæ•°å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥ä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ‰«æåˆ°æ•°ç»„å°¾éƒ¨ï¼Œé‚£ä¹ˆ <code>count</code> å¿…ç„¶ä¼šå¤§äº <code>0</code>ï¼Œè€Œä¸”è¿™ä¸ª <code>count</code> å¯¹åº”çš„ <code>candinate</code> å°±æ˜¯åŸæ•°ç»„çš„å¤šæ•°å…ƒç´ ã€‚</p></blockquote><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> candidate = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> num : nums) &#123;        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>) &#123;            candidate = num;        &#125;        count += (candidate == num) ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">return</span> candidate;&#125;</code></pre><ul><li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n)</code>ã€‚</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(1)</code>ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VIM æŒ‡ä»¤è®°å½•</title>
    <link href="/2020/08/01/vim-command/"/>
    <url>/2020/08/01/vim-command/</url>
    
    <content type="html"><![CDATA[<p><code>vim</code> å¸¸ç”¨æŒ‡ä»¤è®°å½•</p><h1 id="å‘½ä»¤æ¨¡å¼"><a class="markdownIt-Anchor" href="#å‘½ä»¤æ¨¡å¼"></a> å‘½ä»¤æ¨¡å¼</h1><h2 id="å…‰æ ‡ç§»åŠ¨"><a class="markdownIt-Anchor" href="#å…‰æ ‡ç§»åŠ¨"></a> å…‰æ ‡ç§»åŠ¨</h2><table><thead><tr><th style="text-align:center">cmd</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center"><code>h</code></td><td style="text-align:center">å·¦ç§»ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:center"><code>l</code></td><td style="text-align:center">å³ç§»</td></tr><tr><td style="text-align:center"><code>k</code></td><td style="text-align:center">ä¸Šç§»</td></tr><tr><td style="text-align:center"><code>j</code></td><td style="text-align:center">ä¸‹ç§»</td></tr><tr><td style="text-align:center"><code>{n}{op}</code></td><td style="text-align:center"><code>10j</code> è¡¨ç¤ºä¸‹ç§» <code>10</code> è¡Œ</td></tr><tr><td style="text-align:center"><code>{n}&lt;Space&gt;</code></td><td style="text-align:center">å‘åç§»åŠ¨ <code>n</code> ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:center"><code>{n}&lt;Enter&gt;</code></td><td style="text-align:center"><strong>å‘ä¸‹ç§»åŠ¨ <code>n</code> è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>$</code></td><td style="text-align:center"><strong>ç§»åŠ¨åˆ°è¡Œé¦–</strong></td></tr><tr><td style="text-align:center"><code>0</code></td><td style="text-align:center"><strong>ç§»åŠ¨åˆ°è¡Œå°¾</strong></td></tr><tr><td style="text-align:center"><code>ctrl + f</code></td><td style="text-align:center"><strong>Page Down</strong></td></tr><tr><td style="text-align:center"><code>ctrl + b</code></td><td style="text-align:center"><strong>Page Up</strong></td></tr><tr><td style="text-align:center"><code>ctrl + d</code></td><td style="text-align:center">ä¸‹ç§»åŠé¡µ</td></tr><tr><td style="text-align:center"><code>ctrl + u</code></td><td style="text-align:center">ä¸Šç§»åŠé¡µ</td></tr><tr><td style="text-align:center"><code>H</code></td><td style="text-align:center">ç§»åŠ¨åˆ°è¿™ä¸ªå±å¹•çš„ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:center"><code>M</code></td><td style="text-align:center">ç§»åŠ¨åˆ°è¿™ä¸ªå±å¹•çš„ä¸­å¤®é‚£ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:center"><code>L</code></td><td style="text-align:center">ç§»åŠ¨åˆ°è¿™ä¸ªå±å¹•çš„æœ€åä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:center"><code>gg</code></td><td style="text-align:center"><strong>ç§»åŠ¨åˆ°æ–‡ä»¶ç¬¬ä¸€è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>G</code></td><td style="text-align:center"><strong>ç§»åŠ¨åˆ°æ–‡ä»¶æœ€åä¸€è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>{n}G</code></td><td style="text-align:center">ç§»åŠ¨åˆ°ç¬¬ <code>n</code> è¡Œ</td></tr></tbody></table><h2 id="å‰ªåˆ‡åˆ é™¤"><a class="markdownIt-Anchor" href="#å‰ªåˆ‡åˆ é™¤"></a> å‰ªåˆ‡/åˆ é™¤</h2><table><thead><tr><th style="text-align:center">cmd</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center"><code>x</code>, <code>X</code></td><td style="text-align:center">delete, backspace</td></tr><tr><td style="text-align:center"><code>{n}x</code></td><td style="text-align:center">å‘ååˆ é™¤ <code>n</code> ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:center"><code>dd</code></td><td style="text-align:center"><strong>åˆ é™¤ä¸€è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>{n}dd</code></td><td style="text-align:center"><strong>åˆ é™¤ <code>n</code> è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>d1G</code></td><td style="text-align:center">åˆ é™¤ç¬¬ä¸€è¡Œåˆ°å…‰æ ‡æ‰€åœ¨è¡Œ</td></tr><tr><td style="text-align:center"><code>dG</code></td><td style="text-align:center">åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œåˆ°æœ€åä¸€è¡Œ</td></tr><tr><td style="text-align:center"><code>d0</code></td><td style="text-align:center"><strong>åˆ é™¤å…‰æ ‡åˆ°è¯¥è¡Œé¦–éƒ¨</strong></td></tr><tr><td style="text-align:center"><code>d$</code></td><td style="text-align:center"><strong>åˆ é™¤å…‰æ ‡æ‰€åœ¨å¤„ï¼Œåˆ°è¯¥è¡Œå°¾éƒ¨(åŒ…æ‹¬å…‰æ ‡é€‰ä¸­çš„å­—ç¬¦)</strong></td></tr></tbody></table><h2 id="å¤åˆ¶"><a class="markdownIt-Anchor" href="#å¤åˆ¶"></a> å¤åˆ¶</h2><table><thead><tr><th style="text-align:center">cmd</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center"><code>y</code></td><td style="text-align:center"><code>v</code> é€‰ä¸­</td></tr><tr><td style="text-align:center"><code>yy</code></td><td style="text-align:center"><strong>å¤åˆ¶ä¸€è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>{n}yy</code></td><td style="text-align:center"><strong>å¤åˆ¶ <code>n</code> è¡Œ</strong></td></tr><tr><td style="text-align:center"><code>y1G</code></td><td style="text-align:center">å¤åˆ¶ç¬¬ä¸€è¡Œåˆ°å…‰æ ‡æ‰€åœ¨è¡Œ</td></tr><tr><td style="text-align:center"><code>yG</code></td><td style="text-align:center">å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œåˆ°æœ€åä¸€è¡Œ</td></tr><tr><td style="text-align:center"><code>y0</code></td><td style="text-align:center"><strong>å¤åˆ¶å…‰æ ‡åˆ°è¯¥è¡Œé¦–éƒ¨</strong></td></tr><tr><td style="text-align:center"><code>y$</code></td><td style="text-align:center"><strong>å¤åˆ¶å…‰æ ‡æ‰€åœ¨å¤„ï¼Œåˆ°è¯¥è¡Œå°¾éƒ¨(åŒ…æ‹¬å…‰æ ‡é€‰ä¸­çš„å­—ç¬¦)</strong></td></tr></tbody></table><h2 id="ç²˜è´´"><a class="markdownIt-Anchor" href="#ç²˜è´´"></a> ç²˜è´´</h2><table><thead><tr><th style="text-align:center">cmd</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center"><code>p</code>, <code>P</code></td><td style="text-align:center">ç²˜è´´åœ¨ä¸Š/ä¸‹ä¸€è¡Œ</td></tr><tr><td style="text-align:center"><code>J</code></td><td style="text-align:center">åˆå¹¶å…‰æ ‡æ‰€åœ¨è¡Œå’Œä¸‹ä¸€è¡Œ</td></tr></tbody></table><h2 id="æ’¤é”€-é‡åš-é‡å¤"><a class="markdownIt-Anchor" href="#æ’¤é”€-é‡åš-é‡å¤"></a> æ’¤é”€ã€é‡åšã€é‡å¤</h2><table><thead><tr><th style="text-align:center">cmd</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center"><code>u</code></td><td style="text-align:center"><strong>æ’¤é”€</strong></td></tr><tr><td style="text-align:center"><code>ctrl + r</code></td><td style="text-align:center"><strong>é‡åš</strong></td></tr><tr><td style="text-align:center"><code>.</code></td><td style="text-align:center"><strong>é‡å¤ä¸Šä¸€ä¸ªåŠ¨ä½œ</strong></td></tr></tbody></table><h1 id="æœ«è¡Œæ¨¡å¼"><a class="markdownIt-Anchor" href="#æœ«è¡Œæ¨¡å¼"></a> æœ«è¡Œæ¨¡å¼</h1><p>åªè®°å½•ä¸ç†Ÿæ‚‰çš„</p><table><thead><tr><th style="text-align:center">cmd</th><th style="text-align:center">description</th></tr></thead><tbody><tr><td style="text-align:center"><code>ZZ</code></td><td style="text-align:center">ç›¸å½“äº <code>wq</code></td></tr><tr><td style="text-align:center"><code>ZQ</code></td><td style="text-align:center">ç›¸å½“äº <code>q!</code></td></tr><tr><td style="text-align:center"><code>:w {filename}</code></td><td style="text-align:center">save as</td></tr><tr><td style="text-align:center"><code>:r {filename}</code></td><td style="text-align:center">å°† <code>filename</code> æ–‡ä»¶è¿½åŠ åˆ°å…‰æ ‡å</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Java å†…å­˜æ¨¡å‹</title>
    <link href="/2020/07/29/java-memory-model/"/>
    <url>/2020/07/29/java-memory-model/</url>
    
    <content type="html"><![CDATA[<blockquote><p><code>Java</code> å†…å­˜æ¨¡å‹ï¼ˆ<code>Java Memory Model</code>ï¼‰ï¼Œç®€ç§° <code>JMM</code>ã€‚</p><p><code>JVM</code> ä¸­è¯•å›¾å®šä¹‰ä¸€ç§ <code>JMM</code> æ¥å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© <code>Java</code> ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚</p></blockquote><h1 id="ç‰©ç†å†…å­˜æ¨¡å‹"><a class="markdownIt-Anchor" href="#ç‰©ç†å†…å­˜æ¨¡å‹"></a> ç‰©ç†å†…å­˜æ¨¡å‹</h1><p>ç‰©ç†æœºé‡åˆ°çš„å¹¶å‘é—®é¢˜ä¸è™šæ‹Ÿæœºä¸­çš„æƒ…å†µæœ‰ä¸å°‘ç›¸ä¼¼ä¹‹å¤„ï¼Œç‰©ç†æœºå¯¹å¹¶å‘çš„å¤„ç†æ–¹æ¡ˆå¯¹äºè™šæ‹Ÿæœºçš„å®ç°ä¹Ÿæœ‰ç›¸å½“å¤§çš„å‚è€ƒæ„ä¹‰ã€‚</p><h2 id="ç¡¬ä»¶å¤„ç†æ•ˆç‡"><a class="markdownIt-Anchor" href="#ç¡¬ä»¶å¤„ç†æ•ˆç‡"></a> ç¡¬ä»¶å¤„ç†æ•ˆç‡</h2><p>ç‰©ç†å†…å­˜çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šç¡¬ä»¶å¤„ç†æ•ˆç‡ã€‚</p><ul><li><p>ç»å¤§å¤šæ•°çš„è¿ç®—ä»»åŠ¡éƒ½ä¸å¯èƒ½åªé å¤„ç†å™¨â€œè®¡ç®—â€å°±èƒ½å®Œæˆï¼Œå¤„ç†å™¨è‡³å°‘éœ€è¦ä¸<strong>å†…å­˜äº¤äº’</strong>ï¼Œå¦‚è¯»å–è¿ç®—æ•°æ®ã€å­˜å‚¨è¿ç®—ç»“æœï¼Œè¿™ä¸ª <code>I/O</code> æ“ä½œæ˜¯å¾ˆéš¾æ¶ˆé™¤çš„ï¼ˆæ— æ³•ä»…é å¯„å­˜å™¨å®Œæˆæ‰€æœ‰è¿ç®—ä»»åŠ¡ï¼‰ã€‚</p></li><li><p><strong>ç”±äºè®¡ç®—æœºçš„å­˜å‚¨è®¾å¤‡ä¸å¤„ç†å™¨çš„è¿ç®—é€Ÿåº¦æœ‰å‡ ä¸ªæ•°é‡çº§çš„å·®è·</strong> ï¼Œè¿™ç§é€Ÿåº¦ä¸Šçš„çŸ›ç›¾ï¼Œä¼šé™ä½ç¡¬ä»¶çš„å¤„ç†æ•ˆç‡ã€‚æ‰€ä»¥ï¼Œç°ä»£è®¡ç®—æœºéƒ½ä¸å¾—ä¸ <strong>åŠ å…¥é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰</strong> æ¥ä½œä¸ºå†…å­˜å’Œå¤„ç†å™¨ä¹‹é—´çš„ç¼“å†²ã€‚å°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å¤åˆ¶åˆ°ç¼“å­˜ä¸­ï¼Œè®©è¿ç®—èƒ½å¿«é€Ÿè¿›è¡Œï¼Œå½“è¿ç®—ç»“æŸåå†ä»ç¼“å­˜åŒæ­¥ä¼šå†…å­˜ä¸­ï¼Œè¿™æ ·å¤„ç†å™¨å°±æ— éœ€ç­‰å¾…ç¼“æ…¢çš„å†…å­˜è¯»å†™äº†ã€‚</p></li></ul><h2 id="ç¼“å­˜ä¸€è‡´æ€§"><a class="markdownIt-Anchor" href="#ç¼“å­˜ä¸€è‡´æ€§"></a> ç¼“å­˜ä¸€è‡´æ€§</h2><p>é«˜é€Ÿç¼“å­˜è§£å†³äº† ç¡¬ä»¶æ•ˆç‡é—®é¢˜ï¼Œä½†æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ï¼ˆ<code>Cache Coherence</code>ï¼‰ã€‚</p><p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œè€Œå®ƒä»¬åˆå…±äº«åŒä¸€ä¸»å†…å­˜ã€‚å½“å¤šä¸ªå¤„ç†å™¨çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€å—ä¸»å†…å­˜åŒºåŸŸæ—¶ï¼Œå°†å¯èƒ½å¯¼è‡´å„è‡ªçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œéœ€è¦å„ä¸ªå¤„ç†å™¨è®¿é—®ç¼“å­˜æ—¶éƒ½éµå¾ªä¸€äº›åè®®ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®æ¥è¿›è¡Œæ“ä½œã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200729160602.png" srcset="/img/loading.gif" alt="" /></p><h2 id="ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–"><a class="markdownIt-Anchor" href="#ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–"></a> ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–</h2><p>é™¤äº†é«˜é€Ÿç¼“å­˜ä»¥å¤–ï¼Œä¸ºäº†ä½¿å¾—å¤„ç†å™¨å†…éƒ¨çš„è¿ç®—å•å…ƒå°½é‡è¢«å……åˆ†åˆ©ç”¨ï¼Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼ˆ<code>Out-Of-Order Execution</code>ï¼‰ä¼˜åŒ–ã€‚å¤„ç†å™¨ä¼šåœ¨è®¡ç®—ä¹‹åå°†ä¹±åºæ‰§è¡Œçš„ç»“æœé‡ç»„ï¼Œ<strong>ä¿è¯è¯¥ç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„</strong>ï¼Œä½†ä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥è®¡ç®—çš„å…ˆåé¡ºåºä¸è¾“å…¥ä»£ç ä¸­çš„é¡ºåºä¸€è‡´ã€‚</p><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200729160655.png" srcset="/img/loading.gif" alt="" /></p><p>ä¹±åºæ‰§è¡ŒæŠ€æœ¯æ˜¯å¤„ç†å™¨ä¸ºæé«˜è¿ç®—é€Ÿåº¦è€Œåšå‡ºè¿èƒŒä»£ç åŸæœ‰é¡ºåºçš„ä¼˜åŒ–ã€‚</p><ul><li><p>å•æ ¸ç¯å¢ƒä¸‹ï¼Œå¤„ç†å™¨ä¿è¯åšå‡ºçš„ä¼˜åŒ–ä¸ä¼šå¯¼è‡´æ‰§è¡Œç»“æœè¿œç¦»é¢„æœŸç›®æ ‡ï¼Œä½†åœ¨å¤šæ ¸ç¯å¢ƒä¸‹å´å¹¶éå¦‚æ­¤ã€‚</p></li><li><p>å¤šæ ¸ç¯å¢ƒä¸‹ï¼Œ å¦‚æœå­˜åœ¨ä¸€ä¸ªæ ¸çš„è®¡ç®—ä»»åŠ¡ä¾èµ–å¦ä¸€ä¸ªæ ¸çš„è®¡ç®—ä»»åŠ¡çš„ä¸­é—´ç»“æœï¼Œè€Œä¸”å¯¹ç›¸å…³æ•°æ®è¯»å†™æ²¡åšä»»ä½•é˜²æŠ¤æªæ–½ï¼Œé‚£ä¹ˆå…¶é¡ºåºæ€§å¹¶ä¸èƒ½é ä»£ç çš„å…ˆåé¡ºåºæ¥ä¿è¯ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200729160753.png" srcset="/img/loading.gif" alt="" /></p><h1 id="java-å†…å­˜æ¨¡å‹"><a class="markdownIt-Anchor" href="#java-å†…å­˜æ¨¡å‹"></a> Java å†…å­˜æ¨¡å‹</h1><p><strong>å†…å­˜æ¨¡å‹</strong> è¿™ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šåœ¨ç‰¹å®šçš„æ“ä½œåè®®ä¸‹ï¼Œå¯¹ç‰¹å®šçš„å†…å­˜æˆ–é«˜é€Ÿç¼“å­˜è¿›è¡Œè¯»å†™è®¿é—®çš„è¿‡ç¨‹æŠ½è±¡ã€‚ä¸åŒæ¶æ„çš„ç‰©ç†è®¡ç®—æœºå¯ä»¥æœ‰ä¸ä¸€æ ·çš„å†…å­˜æ¨¡å‹ï¼Œ<code>JVM</code> ä¹Ÿæœ‰è‡ªå·±çš„å†…å­˜æ¨¡å‹ã€‚</p><p><code>JVM</code> ä¸­è¯•å›¾å®šä¹‰ä¸€ç§ <code>Java</code> å†…å­˜æ¨¡å‹ï¼ˆ<code>Java Memory Model</code>, <code>JMM</code>ï¼‰æ¥<strong>å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚</strong>ï¼Œä»¥å®ç°è®© <code>Java</code> ç¨‹åº <strong>åœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœ</strong>ã€‚<code>JMM</code> å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p><h2 id="jvm-å†…å­˜ç»“æ„-vs-java-å†…å­˜æ¨¡å‹"><a class="markdownIt-Anchor" href="#jvm-å†…å­˜ç»“æ„-vs-java-å†…å­˜æ¨¡å‹"></a> JVM å†…å­˜ç»“æ„ vs Java å†…å­˜æ¨¡å‹</h2><ul><li><p><code>JVM</code> å†…å­˜ç»“æ„ï¼Œç”± <code>Java</code> è™šæ‹Ÿæœºè§„èŒƒå®šä¹‰ã€‚æè¿°çš„æ˜¯ <code>Java</code> ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”± <code>JVM</code> ç®¡ç†çš„ä¸åŒæ•°æ®åŒºåŸŸã€‚å„ä¸ªåŒºåŸŸæœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚</p></li><li><p><code>Java</code> çš„å¤šçº¿ç¨‹ä¹‹é—´æ˜¯é€šè¿‡<strong>å…±äº«å†…å­˜</strong>è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œç”±äºé‡‡ç”¨å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¼šå­˜åœ¨ä¸€ç³»åˆ—å¦‚å¯è§æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§ç­‰é—®é¢˜ï¼Œè€Œ <code>JMM</code> å°±æ˜¯å›´ç»•ç€<strong>å¤šçº¿ç¨‹é€šä¿¡</strong>ä»¥åŠä¸å…¶ç›¸å…³çš„ä¸€ç³»åˆ—ç‰¹æ€§è€Œå»ºç«‹çš„æ¨¡å‹ã€‚</p></li><li><p><code>JMM</code> å¹¶ä¸åƒ <code>JVM</code> å†…å­˜ç»“æ„ä¸€æ ·æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µã€‚</p></li></ul><h2 id="ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"><a class="markdownIt-Anchor" href="#ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜"></a> ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</h2><p><code>JMM</code> è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆ<code>Main Memory</code>ï¼‰ä¸­ã€‚</p><p>æ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„<strong>å·¥ä½œå†…å­˜</strong>ï¼ˆ<code>Working Memory</code>ï¼‰ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿ç•™äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„<strong>ä¸»å†…å­˜çš„å‰¯æœ¬</strong>ã€‚å·¥ä½œå†…å­˜æ˜¯ <code>JMM</code> çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200729161040.png" srcset="/img/loading.gif" alt="" /></p><p>çº¿ç¨‹å¯¹å˜é‡çš„<strong>æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œ</strong>ï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçš„çº¿ç¨‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œ<strong>çº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ</strong>ã€‚</p><h2 id="jmm-å†…å­˜æ“ä½œçš„é—®é¢˜"><a class="markdownIt-Anchor" href="#jmm-å†…å­˜æ“ä½œçš„é—®é¢˜"></a> JMM å†…å­˜æ“ä½œçš„é—®é¢˜</h2><ul><li><strong>å·¥ä½œå†…å­˜æ•°æ®ä¸€è‡´æ€§</strong> - å„ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®æ—¶ä¼šä¿å­˜ä½¿ç”¨åˆ°çš„ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬ï¼Œå½“å¤šä¸ªçº¿ç¨‹çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå°†å¯¼è‡´å„è‡ªçš„çš„å…±äº«å˜é‡å‰¯æœ¬ä¸ä¸€è‡´ã€‚å¦‚æœçœŸçš„å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ•°æ®åŒæ­¥å›ä¸»å†…å­˜ä»¥è°çš„å‰¯æœ¬æ•°æ®ä¸ºå‡†ï¼Ÿ <code>Java</code> å†…å­˜æ¨¡å‹ä¸»è¦é€šè¿‡ä¸€ç³»åˆ—çš„æ•°æ®åŒæ­¥åè®®ã€è§„åˆ™æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</strong> - <code>Java</code> ä¸­é‡æ’åºé€šå¸¸æ˜¯ç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œé‡‡å–çš„å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ–°æ’åºæ‰§è¡Œçš„ä¸€ç§æ‰‹æ®µã€‚é‡æ’åºåˆ†ä¸ºä¸¤ç±»ï¼š<strong>ç¼–è¯‘æœŸé‡æ’åº</strong>å’Œ<strong>è¿è¡ŒæœŸé‡æ’åº</strong>ï¼Œåˆ†åˆ«å¯¹åº”ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ç¯å¢ƒã€‚ åŒæ ·çš„ï¼ŒæŒ‡ä»¤é‡æ’åºä¸æ˜¯éšæ„é‡æ’åºï¼Œå®ƒéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š<ul><li>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœã€‚å³æ—¶ç¼–è¯‘å™¨ï¼ˆå’Œå¤„ç†å™¨ï¼‰éœ€è¦ä¿è¯ç¨‹åºèƒ½å¤Ÿéµå®ˆ <code>as-if-serial</code> å±æ€§ã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œè¦ç»™ç¨‹åºä¸€ä¸ªé¡ºåºæ‰§è¡Œçš„å‡è±¡ã€‚å³ç»è¿‡é‡æ’åºçš„æ‰§è¡Œç»“æœè¦ä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¿æŒä¸€è‡´ã€‚</li><li>å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æ’åºã€‚</li><li>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœçº¿ç¨‹å¤„ç†é€»è¾‘ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œæœ‰å¯èƒ½å› ä¸ºæŒ‡ä»¤é‡æ’åºå¯¼è‡´è¿è¡Œç»“æœä¸é¢„æœŸä¸åŒã€‚</li></ul></li></ul><h1 id="java-å†…å­˜æ¨¡å‹è§„åˆ™"><a class="markdownIt-Anchor" href="#java-å†…å­˜æ¨¡å‹è§„åˆ™"></a> Java å†…å­˜æ¨¡å‹è§„åˆ™</h1><h2 id="å†…å­˜äº¤äº’æ“ä½œçš„ä¸‰å¤§ç‰¹æ€§"><a class="markdownIt-Anchor" href="#å†…å­˜äº¤äº’æ“ä½œçš„ä¸‰å¤§ç‰¹æ€§"></a> å†…å­˜äº¤äº’æ“ä½œçš„ä¸‰å¤§ç‰¹æ€§</h2><p>Java å†…å­˜ä¸‰å¤§ç‰¹æ€§ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚</p><p>è€Œè¿™ä¸‰å¤§ç‰¹æ€§ï¼Œå½’æ ¹ç»“åº•ï¼Œæ˜¯ä¸ºäº†å®ç°å¤šçº¿ç¨‹çš„ <strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼Œä½¿å¾—ç¨‹åºåœ¨å¤šçº¿ç¨‹å¹¶å‘ï¼ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–çš„ç¯å¢ƒä¸­èƒ½å¦‚é¢„æœŸè¿è¡Œã€‚</p><h3 id="åŸå­æ€§"><a class="markdownIt-Anchor" href="#åŸå­æ€§"></a> åŸå­æ€§</h3><blockquote><p>åŸå­æ€§å³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼ˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼‰ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œã€‚å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€å¹²æ‰°ã€‚</p></blockquote><p>åœ¨ <code>Java</code> ä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤ <code>monitorenter</code> å’Œ <code>monitorexit</code>ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨ <code>Java</code> ä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯ <code>synchronized</code>ã€‚</p><p>å› æ­¤ï¼Œåœ¨ <code>Java</code> ä¸­å¯ä»¥ä½¿ç”¨ <code>synchronized</code> æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p><h3 id="å¯è§æ€§"><a class="markdownIt-Anchor" href="#å¯è§æ€§"></a> å¯è§æ€§</h3><blockquote><p>å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚</p></blockquote><p>JMM æ˜¯é€šè¿‡ â€œ<strong>å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œ å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼</strong>â€ è¿™ç§ä¾èµ–ä¸»å†…å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹å¼æ¥å®ç°çš„ã€‚</p><p><code>Java</code> å®ç°å¤šçº¿ç¨‹å¯è§æ€§çš„æ–¹å¼æœ‰ï¼š</p><ul><li><p><code>volatile</code></p></li><li><p><code>synchronized</code></p></li><li><p><code>final</code></p></li></ul><h3 id="æœ‰åºæ€§"><a class="markdownIt-Anchor" href="#æœ‰åºæ€§"></a> æœ‰åºæ€§</h3><p>æœ‰åºæ€§è§„åˆ™è¡¨ç°åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯: çº¿ç¨‹å†…å’Œçº¿ç¨‹é—´</p><ul><li><p><strong>çº¿ç¨‹å†…</strong> - ä»æŸä¸ªçº¿ç¨‹çš„è§’åº¦çœ‹æ–¹æ³•çš„æ‰§è¡Œï¼ŒæŒ‡ä»¤ä¼šæŒ‰ç…§ä¸€ç§å«â€œä¸²è¡Œâ€ï¼ˆ<code>as-if-serial</code>ï¼‰çš„æ–¹å¼æ‰§è¡Œï¼Œæ­¤ç§æ–¹å¼å·²ç»åº”ç”¨äºé¡ºåºç¼–ç¨‹è¯­è¨€ã€‚</p></li><li><p><strong>çº¿ç¨‹é—´</strong> - è¿™ä¸ªçº¿ç¨‹â€œè§‚å¯Ÿâ€åˆ°å…¶ä»–çº¿ç¨‹å¹¶å‘åœ°æ‰§è¡ŒéåŒæ­¥çš„ä»£ç æ—¶ï¼Œç”±äºæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œä»»ä½•ä»£ç éƒ½æœ‰å¯èƒ½äº¤å‰æ‰§è¡Œã€‚å”¯ä¸€èµ·ä½œç”¨çš„çº¦æŸæ˜¯ï¼šå¯¹äºåŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥å—ï¼ˆ<code>synchronized</code> å…³é”®å­—ä¿®é¥°ï¼‰ä»¥åŠ <code>volatile</code> å­—æ®µçš„æ“ä½œä»ç»´æŒç›¸å¯¹æœ‰åºã€‚</p></li></ul><p>åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>synchronized</code> å’Œ <code>volatile</code> æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚å®ç°æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š</p><ul><li><p><code>volatile</code> å…³é”®å­—ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</p></li><li><p><code>synchronized</code> å…³é”®å­—é€šè¿‡äº’æ–¥ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚</p></li></ul><h2 id="happens-before-åŸåˆ™"><a class="markdownIt-Anchor" href="#happens-before-åŸåˆ™"></a> Happens-Before åŸåˆ™</h2><blockquote><p>åœ¨ <code>JMM</code> ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨ <code>happens-before</code> å…³ç³»ã€‚</p></blockquote><ul><li><p><strong>ç¨‹åºæ¬¡åºè§„åˆ™</strong> - ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚</p></li><li><p><strong>ç®¡ç¨‹é”å®šè§„åˆ™</strong> - ä¸€ä¸ª <code>unLock</code> æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„ <code>lock</code> æ“ä½œã€‚</p></li><li><p><strong><code>volatile</code> å˜é‡è§„åˆ™</strong> - å¯¹ä¸€ä¸ª <code>volatile</code> å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚</p></li><li><p><strong>çº¿ç¨‹å¯åŠ¨è§„åˆ™</strong> - <code>Thread</code> å¯¹è±¡çš„ <code>start()</code> æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸ªä¸€ä¸ªåŠ¨ä½œã€‚</p></li><li><p><strong>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™</strong> - çº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Thread.join()</code> æ–¹æ³•ç»“æŸã€<code>Thread.isAlive()</code> çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚</p></li><li><p><strong>çº¿ç¨‹ä¸­æ–­è§„åˆ™</strong> - å¯¹çº¿ç¨‹ <code>interrupt()</code> æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡ <code>Thread.interrupted()</code>æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚</p></li><li><p><strong>å¯¹è±¡ç»ˆç»“è§„åˆ™</strong> - ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ <code>finalize()</code> æ–¹æ³•çš„å¼€å§‹ã€‚</p></li><li><p><strong>ä¼ é€’æ€§</strong> - å¦‚æœæ“ä½œ <code>A</code> å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ <code>B</code>ï¼Œè€Œæ“ä½œ <code>B</code> åˆ å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ <code>C</code>ï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œ <code>A</code> å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ <code>C</code>ã€‚</p></li></ul><h2 id="å†…å­˜å±éšœ"><a class="markdownIt-Anchor" href="#å†…å­˜å±éšœ"></a> å†…å­˜å±éšœ</h2><p><code>Java</code> ä¸­å¦‚ä½•ä¿è¯åº•å±‚æ“ä½œçš„<strong>æœ‰åºæ€§</strong>å’Œ<strong>å¯è§æ€§</strong>ï¼Ÿå¯ä»¥é€šè¿‡å†…å­˜å±éšœã€‚</p><p>å†…å­˜å±éšœæ˜¯è¢«æ’å…¥ä¸¤ä¸ª <code>CPU</code> æŒ‡ä»¤ä¹‹é—´çš„ä¸€ç§æŒ‡ä»¤ï¼Œ<strong>ç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŒ‡ä»¤å‘ç”Ÿé‡æ’åº</strong>ï¼ˆåƒå±éšœä¸€æ ·ï¼‰ï¼Œä»è€Œä¿éšœæœ‰åºæ€§çš„ã€‚å¦å¤–ï¼Œä¸ºäº†è¾¾åˆ°å±éšœçš„æ•ˆæœï¼Œå®ƒä¹Ÿä¼š<strong>ä½¿å¤„ç†å™¨å†™å…¥ã€è¯»å–å€¼ä¹‹å‰ï¼Œå°†ä¸»å†…å­˜çš„å€¼å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œæ¸…ç©ºæ— æ•ˆé˜Ÿåˆ—</strong>ï¼Œä»è€Œä¿éšœå¯è§æ€§ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="hljs bash">Store1;Store2;Load1;StoreLoad;  // å†…å­˜å±éšœStore3;Load2;Load3;</code></pre><p>å¯¹äºä¸Šé¢çš„ä¸€ç»„ <code>CPU</code> æŒ‡ä»¤ï¼Œ<code>StoreLoad</code> å±éšœä¹‹å‰çš„ <code>Store</code> æŒ‡ä»¤æ— æ³•ä¸ <code>StoreLoad</code> å±éšœä¹‹åçš„ <code>Load</code> æŒ‡ä»¤è¿›è¡Œäº¤æ¢ä½ç½®ï¼Œå³<strong>é‡æ’åº</strong>ã€‚ä½†æ˜¯ <code>StoreLoad</code> å±éšœä¹‹å‰å’Œä¹‹åçš„æŒ‡ä»¤æ˜¯å¯ä»¥äº’æ¢ä½ç½®çš„ï¼Œå³ <code>Store1</code> å¯ä»¥å’Œ <code>Store2</code> äº’æ¢ï¼Œ<code>Load2</code> å¯ä»¥å’Œ <code>Load3</code> äº’æ¢ã€‚</p><p>å¸¸è§æœ‰ 4 ç§å±éšœ</p><ul><li><p><strong><code>LoadLoad</code> å±éšœ</strong> - å¯¹äºè¿™æ ·çš„è¯­å¥ <code>Load1; LoadLoad; Load2</code>ï¼Œåœ¨ <code>Load2</code> åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯ <code>Load1</code> è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</p></li><li><p><strong><code>StoreStore</code> å±éšœ</strong> - å¯¹äºè¿™æ ·çš„è¯­å¥ <code>Store1; StoreStore; Store2</code>ï¼Œåœ¨ <code>Store2</code> åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ <code>Store1</code> çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚</p></li><li><p><strong><code>LoadStore</code> å±éšœ</strong> - å¯¹äºè¿™æ ·çš„è¯­å¥ <code>Load1; LoadStore; Store2</code>ï¼Œåœ¨ <code>Store2</code> åŠåç»­å†™å…¥æ“ä½œè¢«æ‰§è¡Œå‰ï¼Œä¿è¯ <code>Load1</code> è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</p></li><li><p><strong><code>StoreLoad</code> å±éšœ</strong> - å¯¹äºè¿™æ ·çš„è¯­å¥ <code>Store1; StoreLoad; Load2</code>ï¼Œåœ¨ <code>Load2</code> åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ <code>Store1</code> çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ï¼ˆå†²åˆ·å†™ç¼“å†²å™¨ï¼Œæ¸…ç©ºæ— æ•ˆåŒ–é˜Ÿåˆ—ï¼‰ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</p></li></ul><p><code>Java</code> ä¸­å¯¹å†…å­˜å±éšœçš„ä½¿ç”¨åœ¨ä¸€èˆ¬çš„ä»£ç ä¸­ä¸å¤ªå®¹æ˜“è§åˆ°ï¼Œå¸¸è§çš„æœ‰ <code>volatile</code> å’Œ <code>synchronized</code> å…³é”®å­—ä¿®é¥°çš„ä»£ç å—ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>Unsafe</code> è¿™ä¸ªç±»æ¥ä½¿ç”¨å†…å­˜å±éšœã€‚</p><h2 id="volatile-å˜é‡çš„ç‰¹æ®Šè§„åˆ™"><a class="markdownIt-Anchor" href="#volatile-å˜é‡çš„ç‰¹æ®Šè§„åˆ™"></a> volatile å˜é‡çš„ç‰¹æ®Šè§„åˆ™</h2><p><code>volatile</code> æ˜¯ <code>JVM</code> æä¾›çš„ <strong>æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</strong>ã€‚</p><p>ç‰¹æ€§ï¼š</p><ul><li>ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚</li><li>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</li></ul><h3 id="ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§"><a class="markdownIt-Anchor" href="#ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§"></a> ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§</h3><p>è¿™é‡Œçš„å¯è§æ€§æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº† <code>volatile</code> å˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚è€Œæ™®é€šå˜é‡ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ™®é€šå˜é‡çš„å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p><p>çº¿ç¨‹å†™ <code>volatile</code> å˜é‡çš„è¿‡ç¨‹ï¼š</p><ol><li>æ”¹å˜çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­ <code>volatile</code> å˜é‡å‰¯æœ¬çš„å€¼</li><li>å°†æ”¹å˜åçš„å‰¯æœ¬çš„å€¼ä»å·¥ä½œå†…å­˜åˆ·æ–°åˆ°ä¸»å†…å­˜</li></ol><p>çº¿ç¨‹è¯» <code>volatile</code> å˜é‡çš„è¿‡ç¨‹ï¼š</p><ul><li>ä»ä¸»å†…å­˜ä¸­è¯»å– <code>volatile</code> å˜é‡çš„æœ€æ–°å€¼åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­</li><li>ä»å·¥ä½œå†…å­˜ä¸­è¯»å– <code>volatile</code> å˜é‡çš„å‰¯æœ¬</li></ul><p>ä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æŠŠæ›´æ–°åçš„å˜é‡å€¼åŒæ—¶åˆ·æ–°å›ä¸»å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´å¾—åˆ°çš„å€¼ä¸æ˜¯é¢„æœŸç»“æœï¼š</p><h3 id="ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº"><a class="markdownIt-Anchor" href="#ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº"></a> ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</h3><ul><li><p>å½“ç¨‹åºæ‰§è¡Œåˆ° <code>volatile</code> å˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼›</p></li><li><p>åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°†åœ¨å¯¹ <code>volatile</code> å˜é‡è®¿é—®çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠ volatile å˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚</p></li></ul><h3 id="volatile-çš„åŸç†"><a class="markdownIt-Anchor" href="#volatile-çš„åŸç†"></a> volatile çš„åŸç†</h3><p>å…·ä½“å®ç°æ–¹å¼æ˜¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼š<strong>åœ¨æŒ‡ä»¤åºåˆ—ä¸­å¢åŠ å†…å­˜å±éšœ</strong>æ¥ä¿è¯ï¼Œä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„ <code>JMM</code> å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š</p><ul><li><p>åœ¨æ¯ä¸ª <code>volatile</code> å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª <code>StoreStore</code> å±éšœã€‚ è¯¥å±éšœé™¤äº†ä¿è¯äº†å±éšœä¹‹å‰çš„å†™æ“ä½œå’Œè¯¥å±éšœä¹‹åçš„å†™æ“ä½œä¸èƒ½é‡æ’åºï¼Œè¿˜ä¼šä¿è¯äº† <code>volatile</code> å†™æ“ä½œä¹‹å‰ï¼Œä»»ä½•çš„è¯»å†™æ“ä½œéƒ½ä¼šå…ˆäº <code>volatile</code> è¢«æäº¤ã€‚</p></li><li><p>åœ¨æ¯ä¸ª <code>volatile</code> å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª <code>StoreLoad</code> å±éšœã€‚ è¯¥å±éšœé™¤äº†ä½¿ <code>volatile</code> å†™æ“ä½œä¸ä¼šä¸ä¹‹åçš„è¯»æ“ä½œé‡æ’åºå¤–ï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿ <code>volatile</code> å˜é‡çš„å†™æ›´æ–°å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚</p></li><li><p>åœ¨æ¯ä¸ª <code>volatile</code> è¯»æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª <code>LoadLoad</code> å±éšœã€‚ è¯¥å±éšœé™¤äº†ä½¿ <code>volatile</code> è¯»æ“ä½œä¸ä¼šä¸ä¹‹å‰çš„å†™æ“ä½œå‘ç”Ÿé‡æ’åºå¤–ï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿ <code>volatile</code> å˜é‡è¯»å–çš„ä¸ºæœ€æ–°å€¼ã€‚</p></li><li><p>åœ¨æ¯ä¸ª <code>volatile</code> è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª <code>LoadStore</code> å±éšœã€‚ è¯¥å±éšœé™¤äº†ç¦æ­¢äº† <code>volatile</code> è¯»æ“ä½œä¸å…¶ä¹‹åçš„ä»»ä½•å†™æ“ä½œè¿›è¡Œé‡æ’åºï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿å…¶ä»–çº¿ç¨‹ <code>volatile</code> å˜é‡çš„å†™æ›´æ–°å¯¹ <code>volatile</code> è¯»æ“ä½œçš„çº¿ç¨‹å¯è§ã€‚</p></li></ul><h3 id="volatile-çš„ä½¿ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#volatile-çš„ä½¿ç”¨åœºæ™¯"></a> volatile çš„ä½¿ç”¨åœºæ™¯</h3><p>æ€»ç»“èµ·æ¥ï¼Œå°±æ˜¯â€œä¸€æ¬¡å†™å…¥ï¼Œåˆ°å¤„è¯»å–â€ï¼ŒæŸä¸€çº¿ç¨‹è´Ÿè´£æ›´æ–°å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹åªè¯»å–å˜é‡(ä¸æ›´æ–°å˜é‡)ï¼Œå¹¶æ ¹æ®å˜é‡çš„æ–°å€¼æ‰§è¡Œç›¸åº”é€»è¾‘ã€‚ä¾‹å¦‚çŠ¶æ€æ ‡å¿—ä½æ›´æ–°ï¼Œè§‚å¯Ÿè€…æ¨¡å‹å˜é‡å€¼å‘å¸ƒã€‚</p><h2 id="long-å’Œ-double-å˜é‡çš„ç‰¹æ®Šè§„åˆ™"><a class="markdownIt-Anchor" href="#long-å’Œ-double-å˜é‡çš„ç‰¹æ®Šè§„åˆ™"></a> long å’Œ double å˜é‡çš„ç‰¹æ®Šè§„åˆ™</h2><p><code>JMM</code> è¦æ±‚ <code>lock</code>ã€<code>unlock</code>ã€<code>read</code>ã€<code>load</code>ã€<code>assign</code>ã€<code>use</code>ã€<code>store</code>ã€<code>write</code> è¿™ 8 ç§æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ï¼Œä½†æ˜¯å¯¹äº 64 ä½çš„æ•°æ®ç±»å‹ï¼ˆ<code>long</code> å’Œ <code>double</code>ï¼‰ï¼Œåœ¨æ¨¡å‹ä¸­ç‰¹åˆ«å®šä¹‰ç›¸å¯¹å®½æ¾çš„è§„å®šï¼šå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« <code>volatile</code> ä¿®é¥°çš„ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ†ä¸º 2 æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå¯é€‰æ‹©ä¸ä¿è¯ 64 ä½æ•°æ®ç±»å‹çš„ <code>load</code>ã€<code>store</code>ã€<code>read</code> å’Œ <code>write</code> è¿™ 4 ä¸ªæ“ä½œçš„åŸå­æ€§ã€‚ç”±äºè¿™ç§éåŸå­æ€§ï¼Œæœ‰å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»åˆ°åŒæ­¥æœªå®Œæˆçš„â€œ32 ä½çš„åŠä¸ªå˜é‡â€çš„å€¼ã€‚</p><p>ä¸è¿‡å®é™…å¼€å‘ä¸­ï¼Œ<code>Java</code> å†…å­˜æ¨¡å‹å¼ºçƒˆå»ºè®®è™šæ‹ŸæœºæŠŠ 64 ä½æ•°æ®çš„è¯»å†™å®ç°ä¸ºå…·æœ‰åŸå­æ€§ï¼Œç›®å‰å„ç§å¹³å°ä¸‹çš„å•†ç”¨è™šæ‹Ÿæœºéƒ½é€‰æ‹©æŠŠ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œä½œä¸ºåŸå­æ“ä½œæ¥å¯¹å¾…ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ä¸€èˆ¬ä¸éœ€è¦æŠŠç”¨åˆ°çš„ <code>long</code> å’Œ <code>double</code> å˜é‡ä¸“é—¨å£°æ˜ä¸º <code>volatile</code>ã€‚</p><h2 id="final-å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™"><a class="markdownIt-Anchor" href="#final-å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™"></a> final å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>final</code> æˆå‘˜å˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–æˆ–è€…åœ¨æ„é€ å™¨ä¸­åˆå§‹åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚ <code>fina</code> å…³é”®å­—çš„å¯è§æ€§æ˜¯æŒ‡ï¼šè¢« <code>final</code> ä¿®é¥°çš„å­—æ®µåœ¨å£°æ˜æ—¶æˆ–è€…æ„é€ å™¨ä¸­ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œé‚£ä¹ˆåœ¨å…¶ä»–çº¿ç¨‹æ— é¡»åŒæ­¥å°±èƒ½æ­£ç¡®çœ‹è§ <code>final</code> å­—æ®µçš„å€¼ã€‚è¿™æ˜¯å› ä¸ºä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œ<code>final</code> å˜é‡çš„å€¼ç«‹åˆ»å›å†™åˆ°ä¸»å†…å­˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¹¶å‘-å·¥å…·ç±»</title>
    <link href="/2020/07/28/concurrent-utils/"/>
    <url>/2020/07/28/concurrent-utils/</url>
    
    <content type="html"><![CDATA[<h1 id="countdownlatch"><a class="markdownIt-Anchor" href="#countdownlatch"></a> CountDownLatch</h1><blockquote><p><code>CountDownLatch</code> ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ <code>count</code>ï¼Œè¡¨ç¤ºéœ€è¦ç­‰å¾…çš„äº‹ä»¶æ•°é‡ã€‚<code>countDown()</code> æ–¹æ³•é€’å‡è®¡æ•°å™¨ï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿã€‚è°ƒç”¨ <code>await()</code> æ–¹æ³•çš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç›´åˆ°<strong>è®¡æ•°å™¨ä¸ºé›¶</strong>ï¼Œæˆ–è€…ç­‰å¾…ä¸­çš„<strong>çº¿ç¨‹ä¸­æ–­</strong>ï¼Œæˆ–è€…<strong>ç­‰å¾…è¶…æ—¶</strong>ã€‚</p></blockquote><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200728155654.png" srcset="/img/loading.gif" alt="" /></p><p><code>CountDownLatch</code> æ˜¯åŸºäº <code>AQS</code> å®ç°çš„ã€‚</p><p><code>CountDownLatch</code> å”¯ä¸€çš„æ„é€ æ–¹æ³•ï¼š</p><pre><code class="hljs java"><span class="hljs-comment">// count è®¡æ•°å™¨</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CountDownLatch</span><span class="hljs-params">(<span class="hljs-keyword">int</span> count)</span> </span>&#123;        <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"count &lt; 0"</span>);        <span class="hljs-keyword">this</span>.sync = <span class="hljs-keyword">new</span> Sync(count);&#125;</code></pre><p><code>CountDownLatch</code> çš„é‡è¦æ–¹æ³•ï¼š</p><pre><code class="hljs java"><span class="hljs-comment">// ç­‰å¾…ç›´åˆ° count å€¼ä¸º 0  æ‰ç»§ç»­æ‰§è¡Œæˆ–å½“å‰çº¿ç¨‹è¢«ä¸­æ–­</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123; &#125;;<span class="hljs-comment">// å’Œ await() ç±»ä¼¼ï¼Œåªä¸è¿‡ç­‰å¾…ä¸€å®šçš„æ—¶é—´å count å€¼è¿˜æ²¡å˜ä¸º 0 çš„è¯å°±ä¼šç»§ç»­æ‰§è¡Œ</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">await</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123; &#125;;<span class="hljs-comment">// å°†ç»Ÿè®¡å€¼ count å‡ 1</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">countDown</span><span class="hljs-params">()</span> </span>&#123; &#125;;</code></pre><h1 id="cyclicbarrier"><a class="markdownIt-Anchor" href="#cyclicbarrier"></a> CyclicBarrier</h1><blockquote><p>å­—é¢æ„æ€æ˜¯ å¾ªç¯æ …æ ã€‚<code>CyclicBarrier</code> å¯ä»¥è®©<strong>ä¸€ç»„çº¿ç¨‹</strong>ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼ˆéµå¾ªå­—é¢æ„æ€ï¼Œä¸å¦¨ç§°è¿™ä¸ªçŠ¶æ€ä¸ºæ …æ ï¼‰ä¹‹åå†å…¨éƒ¨åŒæ—¶æ‰§è¡Œã€‚ä¹‹æ‰€ä»¥å«å¾ªç¯æ …æ æ˜¯å› ä¸ºï¼šå½“æ‰€æœ‰ç­‰å¾…çº¿ç¨‹éƒ½è¢«é‡Šæ”¾ä»¥åï¼Œ<code>CyclicBarrier</code> å¯ä»¥è¢«é‡ç”¨ã€‚</p><p><code>CyclicBarrier</code> ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ <code>count</code>ã€‚æ¯æ¬¡æ‰§è¡Œ <code>await</code> æ–¹æ³•ä¹‹åï¼Œ<code>count</code> åŠ  1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å’Œè®¾ç½®çš„å€¼ç›¸ç­‰ï¼Œç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p></blockquote><ul><li><p><code>CyclicBarrier</code> æ˜¯åŸºäº <code>ReentrantLock</code> å’Œ <code>Condition</code> å®ç°çš„ã€‚</p></li><li><p><code>CyclicBarrier</code> åº”ç”¨åœºæ™¯ï¼š<code>CyclicBarrier</code> åœ¨å¹¶è¡Œè¿­ä»£ç®—æ³•ä¸­éå¸¸æœ‰ç”¨ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200728160917.png" srcset="/img/loading.gif" alt="" /></p><p><code>CyclicBarrier</code> æä¾›äº† 2 ä¸ªæ„é€ æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CyclicBarrier</span><span class="hljs-params">(<span class="hljs-keyword">int</span> parties)</span> </span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CyclicBarrier</span><span class="hljs-params">(<span class="hljs-keyword">int</span> parties, Runnable barrierAction)</span> </span>&#123;&#125;</code></pre><ul><li><p><code>parties</code> - <code>parties</code> æ•°ç›¸å½“äºä¸€ä¸ªé˜ˆå€¼ï¼Œå½“æœ‰ <code>parties</code> æ•°é‡çš„çº¿ç¨‹åœ¨ç­‰å¾…æ—¶ï¼Œ <code>CyclicBarrier</code> å¤„äºæ …æ çŠ¶æ€ã€‚</p></li><li><p><code>barrierAction</code> - å½“ <code>CyclicBarrier</code> å¤„äºæ …æ çŠ¶æ€æ—¶æ‰§è¡Œçš„åŠ¨ä½œã€‚</p></li></ul><p>é‡è¦æ–¹æ³•ï¼š</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, BrokenBarrierException </span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">await</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException,</span><span class="hljs-function">               BrokenBarrierException,</span><span class="hljs-function">               TimeoutException </span>&#123;&#125;<span class="hljs-comment">// å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span> </span>&#123;&#125;</code></pre><ul><li><p><code>await()</code> - ç­‰å¾…è°ƒç”¨ <code>await()</code> çš„çº¿ç¨‹æ•°è¾¾åˆ°å±éšœæ•°ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ˜¯æœ€åä¸€ä¸ªåˆ°è¾¾çš„çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­æä¾›äº†éç©ºå±éšœæ“ä½œï¼Œåˆ™å½“å‰çº¿ç¨‹åœ¨å…è®¸å…¶ä»–çº¿ç¨‹ç»§ç»­ä¹‹å‰è¿è¡Œè¯¥æ“ä½œã€‚å¦‚æœåœ¨å±éšœåŠ¨ä½œæœŸé—´å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥å¼‚å¸¸å°†åœ¨å½“å‰çº¿ç¨‹ä¸­ä¼ æ’­å¹¶ä¸”å±éšœè¢«ç½®äºæ–­å¼€çŠ¶æ€ã€‚</p></li><li><p><code>await(long timeout, TimeUnit unit)</code> - ç›¸æ¯”äº <code>await()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è®©è¿™äº›çº¿ç¨‹ç­‰å¾…è‡³ä¸€å®šçš„æ—¶é—´ï¼Œå¦‚æœè¿˜æœ‰çº¿ç¨‹æ²¡æœ‰åˆ°è¾¾æ …æ çŠ¶æ€å°±ç›´æ¥è®©åˆ°è¾¾æ …æ çŠ¶æ€çš„çº¿ç¨‹æ‰§è¡Œåç»­ä»»åŠ¡ã€‚</p></li><li><p><code>reset()</code> - å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚</p></li></ul><h1 id="semaphore"><a class="markdownIt-Anchor" href="#semaphore"></a> Semaphore</h1><blockquote><p>å­—é¢æ„æ€ä¸º <strong>ä¿¡å·é‡</strong>ã€‚<code>Semaphore</code> ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªç‰¹å®šèµ„æºçš„æ“ä½œæ•°é‡ï¼Œæˆ–è€…åŒæ—¶æ‰§è¡ŒæŸä¸ªæŒ‡å®šæ“ä½œçš„æ•°é‡ã€‚</p></blockquote><p><code>Semaphore</code> ç®¡ç†ç€ä¸€ç»„è™šæ‹Ÿçš„è®¸å¯ï¼ˆ<code>permit</code>ï¼‰ï¼Œ<code>permit</code> çš„åˆå§‹æ•°é‡å¯é€šè¿‡æ„é€ æ–¹æ³•æ¥æŒ‡å®šã€‚æ¯æ¬¡æ‰§è¡Œ <code>acquire</code> æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ª <code>permit</code>ï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼›è€Œ <code>release</code> æ–¹æ³•å¯ä»¥é‡Šæ”¾ä¸€ä¸ª <code>permit</code>ã€‚</p><p><code>Semaphore</code> åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p><code>Semaphore</code> å¯ä»¥ç”¨äºå®ç°èµ„æºæ± ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€‚</p></li><li><p><code>Semaphore</code> å¯ä»¥ç”¨äºå°†ä»»ä½•ä¸€ç§å®¹å™¨å˜æˆæœ‰ç•Œé˜»å¡å®¹å™¨ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200728162824.png" srcset="/img/loading.gif" alt="" /></p><p><code>Semaphore</code> æä¾›äº† 2 ä¸ªæ„é€ æ–¹æ³•ï¼š</p><pre><code class="hljs java"><span class="hljs-comment">// åˆå§‹åŒ–å›ºå®šæ•°é‡çš„ permitï¼Œå¹¶ä¸”é»˜è®¤ä¸ºéå…¬å¹³æ¨¡å¼ã€‚</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Semaphore</span><span class="hljs-params">(<span class="hljs-keyword">int</span> permits)</span> </span>&#123;&#125;<span class="hljs-comment">// è®¾ç½®æ˜¯å¦ä¸ºå…¬å¹³æ¨¡å¼ã€‚æ‰€è°“å…¬å¹³ï¼Œæ˜¯æŒ‡ç­‰å¾…ä¹…çš„ä¼˜å…ˆè·å– permitã€‚</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Semaphore</span><span class="hljs-params">(<span class="hljs-keyword">int</span> permits, <span class="hljs-keyword">boolean</span> fair)</span> </span>&#123;&#125;</code></pre><p>é‡è¦æ–¹æ³•ï¼š</p><pre><code class="hljs java"><span class="hljs-comment">// è·å– 1 ä¸ªè®¸å¯</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;&#125;<span class="hljs-comment">//è·å– permits ä¸ªè®¸å¯</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquire</span><span class="hljs-params">(<span class="hljs-keyword">int</span> permits)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;&#125;<span class="hljs-comment">// é‡Šæ”¾ 1 ä¸ªè®¸å¯</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release</span><span class="hljs-params">()</span> </span>&#123;&#125;<span class="hljs-comment">//é‡Šæ”¾ permits ä¸ªè®¸å¯</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release</span><span class="hljs-params">(<span class="hljs-keyword">int</span> permits)</span> </span>&#123;&#125;</code></pre><h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1><ul><li><p><code>CountDownLatch</code> å’Œ <code>CyclicBarrier</code> éƒ½èƒ½å¤Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…ï¼Œåªä¸è¿‡å®ƒä»¬ä¾§é‡ç‚¹ä¸åŒï¼š</p><ul><li><p><code>CountDownLatch</code> ä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹ A ç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼›</p></li><li><p><code>CyclicBarrier</code> ä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼›</p></li><li><p>å¦å¤–ï¼Œ<code>CountDownLatch</code> æ˜¯ä¸å¯ä»¥é‡ç”¨çš„ï¼Œè€Œ <code>CyclicBarrier</code> æ˜¯å¯ä»¥é‡ç”¨çš„ã€‚</p></li></ul></li><li><p><code>Semaphore</code> å…¶å®å’Œé”æœ‰ç‚¹ç±»ä¼¼ï¼Œå®ƒä¸€èˆ¬ç”¨äºæ§åˆ¶å¯¹æŸç»„èµ„æºçš„è®¿é—®æƒé™ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
      <tag>å·¥å…·ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¹¶å‘-çº¿ç¨‹æ± </title>
    <link href="/2020/07/27/concurrent-threadpool/"/>
    <url>/2020/07/27/concurrent-threadpool/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h1><blockquote><p>çº¿ç¨‹æ± æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œç„¶ååœ¨åˆ›å»ºçº¿ç¨‹åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡ã€‚</p></blockquote><p>å¦‚æœå¹¶å‘è¯·æ±‚æ•°é‡å¾ˆå¤šï¼Œä½†æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´å¾ˆçŸ­ï¼Œå°±ä¼šå‡ºç°é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå¯èƒ½é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ—¶é—´ã€èµ„æºå¼€é”€è¦å¤§äºå®é™…å·¥ä½œçš„æ‰€éœ€ã€‚</p><p>æ­£æ˜¯ç”±äºè¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ‰å¿…è¦å¼•å…¥çº¿ç¨‹æ± ã€‚ä½¿ç”¨ <strong>çº¿ç¨‹æ± çš„å¥½å¤„</strong> æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p><strong>é™ä½èµ„æºæ¶ˆè€—</strong> - é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</p></li><li><p><strong>æé«˜å“åº”é€Ÿåº¦</strong> - å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</p></li><li><p><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong> - çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚ä½†æ˜¯è¦åšåˆ°åˆç†çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶åŸç†äº†å¦‚æŒ‡æŒã€‚</p></li></ul><h1 id="executor-æ¡†æ¶"><a class="markdownIt-Anchor" href="#executor-æ¡†æ¶"></a> <code>Executor</code> æ¡†æ¶</h1><h2 id="ç®€ä»‹-2"><a class="markdownIt-Anchor" href="#ç®€ä»‹-2"></a> ç®€ä»‹</h2><p><code>Executor</code> æ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶ï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§å°†â€ä»»åŠ¡æäº¤â€ä¸â€ä»»åŠ¡å¦‚ä½•è¿è¡Œâ€åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚</p><p>è¿˜æœ‰å…³é”®çš„ä¸€ç‚¹ï¼šæœ‰åŠ©äºé¿å… <code>this</code> é€ƒé€¸é—®é¢˜ã€‚</p><blockquote><p><code>this</code> é€ƒé€¸æ˜¯æŒ‡åœ¨æ„é€ å‡½æ•°è¿”å›ä¹‹å‰å…¶ä»–çº¿ç¨‹å°±æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨. è°ƒç”¨å°šæœªæ„é€ å®Œå…¨çš„å¯¹è±¡çš„æ–¹æ³•å¯èƒ½å¼•å‘ä»¤äººç–‘æƒ‘çš„é”™è¯¯ã€‚</p></blockquote><h2 id="æ¡†æ¶ç»“æ„"><a class="markdownIt-Anchor" href="#æ¡†æ¶ç»“æ„"></a> æ¡†æ¶ç»“æ„</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727102933.png" srcset="/img/loading.gif" alt="" /></p><h3 id="1-ä»»åŠ¡runnable-callable"><a class="markdownIt-Anchor" href="#1-ä»»åŠ¡runnable-callable"></a> 1. ä»»åŠ¡(<code>Runnable</code> / <code>Callable</code>)</h3><p>æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„ <code>Runnable</code> æ¥å£ æˆ– <code>Callable</code> æ¥å£ã€‚ä»–ä»¬çš„å®ç°ç±»éƒ½å¯ä»¥è¢« <code>ThreadPoolExecutor</code> æˆ– <code>ScheduledThreadPoolExecutor</code> æ‰§è¡Œã€‚</p><h3 id="2-ä»»åŠ¡çš„æ‰§è¡Œexecutor"><a class="markdownIt-Anchor" href="#2-ä»»åŠ¡çš„æ‰§è¡Œexecutor"></a> 2. ä»»åŠ¡çš„æ‰§è¡Œ(<code>Executor</code>)</h3><p>ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£ <code>Executor</code> ï¼Œä»¥åŠç»§æ‰¿è‡ª <code>Executor</code> æ¥å£çš„ <code>ExecutorService</code> æ¥å£ã€‚<br /><code>ThreadPoolExecutor</code> å’Œ <code>ScheduledThreadPoolExecutor</code> è¿™ä¸¤ä¸ªå…³é”®ç±»å®ç°äº† <code>ExecutorService</code> æ¥å£ã€‚</p><h4 id="21-executor"><a class="markdownIt-Anchor" href="#21-executor"></a> 2.1 <code>Executor</code></h4><p><code>Executor</code> æ¥å£ä¸­åªå®šä¹‰äº†ä¸€ä¸ª <code>execute</code> æ–¹æ³•ï¼Œç”¨äºæ¥æ”¶ä¸€ä¸ª <code>Runnable</code> å¯¹è±¡ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Executor</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span></span>;&#125;</code></pre><h4 id="22-executorservice"><a class="markdownIt-Anchor" href="#22-executorservice"></a> 2.2 <code>ExecutorService</code></h4><p><code>ExecutorService</code> æ¥å£ç»§æ‰¿äº† <code>Executor</code> æ¥å£ï¼Œå®ƒè¿˜æä¾›äº† <code>invokeAll</code>ã€<code>invokeAny</code>ã€<code>shutdown</code>ã€<code>submit</code> ç­‰æ–¹æ³•ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ExecutorService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Executor</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span></span>;    <span class="hljs-function">List&lt;Runnable&gt; <span class="hljs-title">shutdownNow</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isShutdown</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTerminated</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">awaitTermination</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException</span>;    &lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span></span>;    &lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Runnable task, T result)</span></span>;    Future&lt;?&gt; submit(Runnable task);    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)        <span class="hljs-keyword">throws</span> InterruptedException;    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,                                  <span class="hljs-keyword">long</span> timeout, TimeUnit unit)        <span class="hljs-keyword">throws</span> InterruptedException;    &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException</span>;    &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span><span class="hljs-function"><span class="hljs-params">                    <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;&#125;</code></pre><p>æ¯”äº <code>Executor</code> æ¥å£ï¼Œ<code>ExecutorService</code> æ¥å£ä¸»è¦çš„æ‰©å±•æ˜¯ï¼š</p><ul><li>æ”¯æŒæœ‰è¿”å›å€¼çš„çº¿ç¨‹ - <code>sumbit</code>ã€<code>invokeAll</code>ã€<code>invokeAny</code> æ–¹æ³•ä¸­éƒ½æ”¯æŒä¼ å…¥ <code>Callable</code> å¯¹è±¡ã€‚</li><li>æ”¯æŒç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ - <code>shutdown</code>ã€<code>shutdownNow</code>ã€<code>isShutdown</code> ç­‰æ–¹æ³•ã€‚</li></ul><h4 id="23-scheduledexecutorservice"><a class="markdownIt-Anchor" href="#23-scheduledexecutorservice"></a> 2.3 <code>ScheduledExecutorService</code></h4><p><code>ScheduledExecutorService</code> æ¥å£æ‰©å±•äº† <code>ExecutorService</code> æ¥å£ã€‚</p><p>å®ƒé™¤äº†æ”¯æŒå‰é¢ä¸¤ä¸ªæ¥å£çš„æ‰€æœ‰èƒ½åŠ›ä»¥å¤–ï¼Œè¿˜æ”¯æŒå®šæ—¶è°ƒåº¦çº¿ç¨‹ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ScheduledExecutorService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExecutorService</span> </span>&#123;    <span class="hljs-keyword">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command, <span class="hljs-keyword">long</span> delay, TimeUnit unit);    <span class="hljs-keyword">public</span> &lt;V&gt; <span class="hljs-function">ScheduledFuture&lt;V&gt; <span class="hljs-title">schedule</span><span class="hljs-params">(Callable&lt;V&gt; callable, <span class="hljs-keyword">long</span> delay, TimeUnit unit)</span></span>;    <span class="hljs-keyword">public</span> ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command,                                                  <span class="hljs-keyword">long</span> initialDelay,                                                  <span class="hljs-keyword">long</span> period,                                                  TimeUnit unit);    <span class="hljs-keyword">public</span> ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command,                                                     <span class="hljs-keyword">long</span> initialDelay,                                                     <span class="hljs-keyword">long</span> delay,                                                     TimeUnit unit);&#125;</code></pre><p>å…¶æ‰©å±•çš„æ¥å£æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š</p><ul><li><p><code>schedule</code> æ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šçš„å»¶æ—¶åæ‰§è¡Œä¸€ä¸ª <code>Runnable</code> æˆ–è€… <code>Callable</code> ä»»åŠ¡ã€‚</p></li><li><p><code>scheduleAtFixedRate</code> æ–¹æ³•å’Œ <code>scheduleWithFixedDelay</code> æ–¹æ³•å¯ä»¥æŒ‰ç…§æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚</p></li></ul><h3 id="3-å¼‚æ­¥è®¡ç®—çš„ç»“æœfuture"><a class="markdownIt-Anchor" href="#3-å¼‚æ­¥è®¡ç®—çš„ç»“æœfuture"></a> 3. å¼‚æ­¥è®¡ç®—çš„ç»“æœ(<code>Future</code>)</h3><blockquote><p><code>Future</code> æ¥å£ä»¥åŠ <code>Future</code> æ¥å£çš„å®ç°ç±» <code>FutureTask</code> ç±»éƒ½å¯ä»¥ä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚</p></blockquote><p>å½“æˆ‘ä»¬æŠŠ <code>Runnable</code> æ¥å£æˆ– <code>Callable</code> æ¥å£çš„å®ç°ç±»æäº¤ç»™ <code>ThreadPoolExecutor</code> æˆ– <code>ScheduledThreadPoolExecutor</code> æ‰§è¡Œï¼Œè°ƒç”¨ <code>submit()</code> æ–¹æ³•æ—¶ä¼šè¿”å›ä¸€ä¸ª <code>FutureTask</code> å¯¹è±¡ï¼Œå¯é€šè¿‡ <code>FutureTask.get()</code> æ•è·æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p><h2 id="executor-æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾"><a class="markdownIt-Anchor" href="#executor-æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾"></a> <code>Executor</code> æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727105429.png" srcset="/img/loading.gif" alt="" /></p><ul><li><p>ä¸»çº¿ç¨‹é¦–å…ˆè¦åˆ›å»ºå®ç° <code>Runnable</code> æˆ–è€… <code>Callable</code> æ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚</p></li><li><p>æŠŠåˆ›å»ºå®Œæˆçš„å®ç° <code>Runnable</code> / <code>Callable</code> æ¥å£çš„å¯¹è±¡æäº¤ç»™ <code>ExecutorService</code> æ‰§è¡Œï¼ˆ<code>ExecutorService.submit(Runnable task)</code>æˆ– <code>ExecutorService.submit(Callable &lt;T&gt; task)</code>ï¼‰ã€‚</p></li><li><p>å¦‚æœæ‰§è¡Œ <code>ExecutorService.submit(...)</code>ï¼Œ<code>ExecutorService</code> å°†è¿”å›ä¸€ä¸ªå®ç° <code>Future</code> æ¥å£çš„å¯¹è±¡ã€‚ç”±äº <code>FutureTask</code> å®ç°äº† <code>Runnable</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»º <code>FutureTask</code>ï¼Œç„¶åç›´æ¥äº¤ç»™ <code>ExecutorService</code> æ‰§è¡Œã€‚</p></li><li><p>æœ€åï¼Œä¸»çº¿ç¨‹å¯ä»¥æ‰§è¡Œ <code>FutureTask.get()</code> æ–¹æ³•æ¥ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œ <code>FutureTask.cancel(boolean mayInterruptIfRunning)</code>æ¥å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚</p></li></ul><h1 id="threadpoolexecutor"><a class="markdownIt-Anchor" href="#threadpoolexecutor"></a> <code>ThreadPoolExecutor</code></h1><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#ä½¿ç”¨ç¤ºä¾‹"></a> ä½¿ç”¨ç¤ºä¾‹</h2><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : ThreadPoolTest.java 2020/07/27 Mon 3:29 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolTest</span> </span>&#123;    <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CORE_POOL_SIZE = <span class="hljs-number">5</span>;    <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_POOL_SIZE = <span class="hljs-number">10</span>;    <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—å®¹é‡</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> QUEUE_CAPACITY = <span class="hljs-number">100</span>;    <span class="hljs-comment">// ç­‰å¾…æ—¶é—´</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> KEEP_ALIVE_TIME = <span class="hljs-number">1L</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹æ± </span>        ThreadPoolExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolExecutor(                CORE_POOL_SIZE,                MAX_POOL_SIZE,                KEEP_ALIVE_TIME,                TimeUnit.SECONDS,                <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(QUEUE_CAPACITY),                <span class="hljs-keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;            <span class="hljs-comment">// æ‰§è¡Œå·¥ä½œçº¿ç¨‹</span>            Runnable worker = <span class="hljs-keyword">new</span> MyRunnable(<span class="hljs-string">""</span> + i);            executor.execute(worker);            String info = String.format(<span class="hljs-string">"çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ç›®ï¼š%sï¼Œé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°ç›®ï¼š%sï¼Œå·²æ‰§è¡Œå®Œçš„ä»»åŠ¡æ•°ç›®ï¼š%s"</span>,                    executor.getPoolSize(),                    executor.getQueue().size(),                    executor.getCompletedTaskCount());            System.out.println(info);        &#125;        <span class="hljs-comment">// ç»ˆæ­¢çº¿ç¨‹æ± </span>        executor.shutdown();        <span class="hljs-keyword">while</span> (!executor.isTerminated()) &#123;        &#125;        System.out.println(<span class="hljs-string">"Finish all threads"</span>);    &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * å·¥ä½œçº¿ç¨‹ç±»</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;    <span class="hljs-keyword">private</span> String cmd;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyRunnable</span><span class="hljs-params">(String cmd)</span> </span>&#123;        <span class="hljs-keyword">this</span>.cmd = cmd;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" Start time = "</span> + <span class="hljs-keyword">new</span> Date());        processCmd();        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" End time = "</span> + <span class="hljs-keyword">new</span> Date());    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processCmd</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">try</span> &#123;            Thread.sleep(<span class="hljs-number">2000</span>);        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;            e.printStackTrace();        &#125;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">"MyRunnable&#123;"</span> +                <span class="hljs-string">"cmd='"</span> + cmd + <span class="hljs-string">'\''</span> +                <span class="hljs-string">'&#125;'</span>;    &#125;&#125;</code></pre><h2 id="æ„é€ æ–¹æ³•"><a class="markdownIt-Anchor" href="#æ„é€ æ–¹æ³•"></a> æ„é€ æ–¹æ³•</h2><p><code>ThreadPoolExecutor</code> æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯åŸºäºç¬¬å››ä¸ªå®ç°ã€‚ç¬¬å››ä¸ªæ„é€ æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize, // çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize, // çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime, // å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´</span></span><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit, // æ—¶é—´å•ä½</span></span><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue, // ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—</span></span><span class="hljs-function"><span class="hljs-params">                          ThreadFactory threadFactory, // çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯</span></span><span class="hljs-function"><span class="hljs-params">                          RejectedExecutionHandler handler // æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡</span></span><span class="hljs-function"><span class="hljs-params">                           )</span> </span>&#123;    <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||        maximumPoolSize &lt;= <span class="hljs-number">0</span> ||        maximumPoolSize &lt; corePoolSize ||        keepAliveTime &lt; <span class="hljs-number">0</span>)        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();    <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-keyword">null</span> || threadFactory == <span class="hljs-keyword">null</span> || handler == <span class="hljs-keyword">null</span>)        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();    <span class="hljs-keyword">this</span>.corePoolSize = corePoolSize;    <span class="hljs-keyword">this</span>.maximumPoolSize = maximumPoolSize;    <span class="hljs-keyword">this</span>.workQueue = workQueue;    <span class="hljs-keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);    <span class="hljs-keyword">this</span>.threadFactory = threadFactory;    <span class="hljs-keyword">this</span>.handler = handler;&#125;</code></pre><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727145107.png" srcset="/img/loading.gif" alt="" /></p><p>å‚æ•°è¯´æ˜ï¼š</p><ol><li><p><code>corePoolSize</code> - <strong>æ ¸å¿ƒçº¿ç¨‹æ•°é‡</strong>ã€‚å½“æœ‰æ–°ä»»åŠ¡é€šè¿‡ <code>execute</code> æ–¹æ³•æäº¤æ—¶ ï¼Œçº¿ç¨‹æ± ä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š</p><ul><li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº <code>corePoolSize</code>ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ã€‚</li><li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº <code>corePoolSize</code> ä¸”å°äº <code>maximumPoolSize</code>ï¼Œåˆ™åªæœ‰å½“ <code>workQueue</code> æ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼Œå¦åˆ™å°†ä»»åŠ¡å­˜å‚¨åœ¨é˜Ÿåˆ—é‡Œï¼›</li><li>å¦‚æœè®¾ç½®çš„ <code>corePoolSize</code> å’Œ <code>maximumPoolSize</code> ç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚è¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥ <code>workQueue</code> æœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥ <code>workQueue</code> ä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä» <code>workQueue</code> ä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼›</li><li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº <code>maximumPoolSize</code>ï¼Œè¿™æ—¶å¦‚æœ <code>workQueue</code> å·²ç»æ»¡äº†ï¼Œåˆ™ä½¿ç”¨ <code>handler</code> æ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼›</li><li>æ‰€ä»¥ï¼Œä»»åŠ¡æäº¤æ—¶ï¼Œåˆ¤æ–­çš„é¡ºåºä¸º <code>corePoolSize</code> =&gt; <code>workQueue</code> =&gt; <code>maximumPoolSize</code>ã€‚</li></ul></li><li><p><code>maximumPoolSize</code> - <strong>æœ€å¤§çº¿ç¨‹æ•°é‡</strong>ã€‚</p><ul><li>å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li><li>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½¿ç”¨äº†æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—è¿™ä¸ªå‚æ•°å°±æ²¡ä»€ä¹ˆæ•ˆæœã€‚</li></ul></li><li><p><code>keepAliveTime</code> - <strong>çº¿ç¨‹ä¿æŒæ´»åŠ¨çš„æ—¶é—´</strong>ã€‚</p><ul><li>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº <code>corePoolSize</code> çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† <code>keepAliveTime</code>ã€‚</li><li>æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥è°ƒå¤§è¿™ä¸ªæ—¶é—´ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚</li></ul></li><li><p><code>unit</code> - <strong><code>keepAliveTime</code> çš„æ—¶é—´å•ä½</strong>ã€‚<br />æœ‰ 7 ç§å–å€¼ã€‚å¯é€‰çš„å•ä½æœ‰å¤©ï¼ˆ<code>DAYS</code>ï¼‰ï¼Œå°æ—¶ï¼ˆ<code>HOURS</code>ï¼‰ï¼Œåˆ†é’Ÿï¼ˆ<code>MINUTES</code>ï¼‰ï¼Œæ¯«ç§’(<code>MILLISECONDS</code>)ï¼Œå¾®ç§’(<code>MICROSECONDS</code>, åƒåˆ†ä¹‹ä¸€æ¯«ç§’)å’Œæ¯«å¾®ç§’(<code>NANOSECONDS</code>, åƒåˆ†ä¹‹ä¸€å¾®ç§’)ã€‚</p></li><li><p><code>workQueue</code> - <strong>ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—</strong>ã€‚ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</p><ul><li><p><code>ArrayBlockingQueue</code> - <strong>æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</p><ul><li>æ­¤é˜Ÿåˆ—æ˜¯åŸºäº<strong>æ•°ç»„</strong>çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆ<code>FIFO</code>ï¼‰ã€‚</li><li>åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ã€‚</li></ul></li><li><p><code>LinkedBlockingQueue</code> - <strong>æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</p><ul><li>æ­¤é˜Ÿåˆ—æ˜¯åŸºäº<strong>é“¾è¡¨</strong>çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆ<code>FIFO</code>ï¼‰ã€‚</li><li>å¦‚æœåˆ›å»ºæ—¶æ²¡æœ‰æŒ‡å®šæ­¤é˜Ÿåˆ—å¤§å°ï¼Œåˆ™é»˜è®¤ä¸º <code>Integer.MAX_VALUE</code>ã€‚</li><li>ååé‡é€šå¸¸è¦é«˜äº <code>ArrayBlockingQueue</code>ã€‚</li><li>ä½¿ç”¨ <code>LinkedBlockingQueue</code> æ„å‘³ç€ï¼š <code>maximumPoolSize</code> å°†ä¸èµ·ä½œç”¨ï¼Œçº¿ç¨‹æ± èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ä¸º <code>corePoolSize</code>ï¼Œå› ä¸ºä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—ã€‚</li><li><code>Executors.newFixedThreadPool</code> ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li></ul></li><li><p><code>SynchronousQueue</code> - <strong>ä¸ä¼šä¿å­˜æäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯å°†ç›´æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡ã€‚</strong></p><ul><li>æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚</li><li>ååé‡é€šå¸¸è¦é«˜äº <code>LinkedBlockingQueue</code>ã€‚</li><li><code>Executors.newCachedThreadPool</code> ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li></ul></li></ul></li><li><p><code>threadFactory</code> - <strong>çº¿ç¨‹å·¥å‚</strong>ã€‚å¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ã€‚</p></li><li><p><code>handler</code> - <strong>é¥±å’Œç­–ç•¥</strong>ã€‚å®ƒæ˜¯ <code>RejectedExecutionHandler</code> ç±»å‹çš„å˜é‡ã€‚å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚çº¿ç¨‹æ± æ”¯æŒä»¥ä¸‹ç­–ç•¥ï¼š</p><ul><li><p><code>AbortPolicy</code> - æŠ›å‡º  <code>RejectedExecutionException</code> æ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤ç­–ç•¥ã€‚</p></li><li><p><code>DiscardPolicy</code> - ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p><code>DiscardOldestPolicy</code> - ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚</p></li><li><p><code>CallerRunsPolicy</code> - åªç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ã€‚</p></li><li><p>å¦‚æœä»¥ä¸Šç­–ç•¥éƒ½ä¸èƒ½æ»¡è¶³éœ€è¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç°           <code>RejectedExecutionHandler</code> æ¥å£æ¥å®šåˆ¶å¤„ç†ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</p></li></ul></li></ol><p>å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾ï¼š<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727145919.png" srcset="/img/loading.gif" alt="" /></p><h2 id="execute-æ–¹æ³•"><a class="markdownIt-Anchor" href="#execute-æ–¹æ³•"></a> <code>execute</code> æ–¹æ³•</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºçº¿ç¨‹æ± ä¹‹åï¼Œçº¿ç¨‹æ± ä¸­æ˜¯æ²¡æœ‰çº¿ç¨‹çš„ï¼Œéœ€è¦æäº¤ä»»åŠ¡ä¹‹åæ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚</p><p>æäº¤ä»»åŠ¡å¯ä»¥ä½¿ç”¨ <code>execute</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ <code>ThreadPoolExecutor</code> çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œäº¤ç”±çº¿ç¨‹æ± å»æ‰§è¡Œã€‚</p><p><code>execute</code> æ–¹æ³•å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727162758.png" srcset="/img/loading.gif" alt="" /></p><pre><code class="hljs java"><span class="hljs-comment">// å­˜æ”¾çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicInteger ctl = <span class="hljs-keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="hljs-number">0</span>)); <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">workerCountOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span> </span>&#123;     <span class="hljs-keyword">return</span> c &amp; CAPACITY; &#125; <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;     <span class="hljs-comment">// å¦‚æœä»»åŠ¡ä¸º nullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span>     <span class="hljs-keyword">if</span> (command == <span class="hljs-keyword">null</span>)         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();     <span class="hljs-comment">// ctl ä¸­ä¿å­˜çš„çº¿ç¨‹æ± å½“å‰çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯</span>     <span class="hljs-keyword">int</span> c = ctl.get();     <span class="hljs-comment">//  ä¸‹é¢ä¼šæ¶‰åŠåˆ° 3 æ­¥ æ“ä½œ</span>     <span class="hljs-comment">// 1.é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä¸­ä¹‹è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äº  corePoolSize</span>     <span class="hljs-comment">// å¦‚æœå°äºçš„è¯ï¼Œåˆ™åˆ›å»ºæ–°çš„æ ¸å¿ƒçº¿ç¨‹å¹¶ä¸”æ‰§è¡Œä¼ å…¥çš„ä»»åŠ¡</span>     <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;         <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-keyword">true</span>))             <span class="hljs-comment">// å¦‚æœåˆ›å»ºæ–°çš„æ ¸å¿ƒçº¿ç¨‹æˆåŠŸåˆ™ç›´æ¥è¿”å›</span>             <span class="hljs-keyword">return</span>;         <span class="hljs-comment">// è¿™é‡Œè¯´æ˜åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤±è´¥ï¼Œéœ€è¦æ›´æ–° ctl çš„ä¸´æ—¶å˜é‡ c</span>         c = ctl.get();     &#125;     <span class="hljs-comment">// 2.å¦‚æœå½“å‰ä¹‹è¡Œçš„ä»»åŠ¡æ•°é‡å¤§äºç­‰äº corePoolSize çš„æ—¶å€™å°±ä¼šèµ°åˆ°è¿™é‡Œ</span>     <span class="hljs-comment">// åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦å¤„äºè¿è¡Œä¸­çŠ¶æ€ï¼ŒåŒæ—¶å°è¯•ç”¨éé˜»å¡æ–¹æ³•å‘ä»»åŠ¡é˜Ÿåˆ—æ”¾å…¥ä»»åŠ¡</span>     <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;         <span class="hljs-keyword">int</span> recheck = ctl.get();         <span class="hljs-comment">// äºŒæ¬¡æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ RUNNING çŠ¶æ€å°±éœ€è¦ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span>         <span class="hljs-keyword">if</span> (!isRunning(recheck) &amp;&amp; remove(command))             <span class="hljs-comment">// è°ƒç”¨æ‹’ç»ç­–ç•¥å¤„ç†ä»»åŠ¡ - è¿”å›</span>             reject(command);             <span class="hljs-comment">// å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚</span>         <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)             addWorker(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);     &#125;     <span class="hljs-comment">// 3. å¦‚æœä»»åŠ¡ä¸èƒ½åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œåˆ™ä¼šå°è¯•åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ä¼ å…¥ä»»åŠ¡æ‰§è¡Œ</span>     <span class="hljs-comment">// åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤±è´¥ï¼Œæ­¤æ—¶éœ€è¦æ‹’ç»æ‰§è¡Œä»»åŠ¡</span>     <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-keyword">false</span>))         <span class="hljs-comment">// è°ƒç”¨æ‹’ç»ç­–ç•¥å¤„ç†ä»»åŠ¡ - è¿”å›</span>         reject(command); &#125;</code></pre><p>å…³äºäºŒæ¬¡æ£€æŸ¥çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ï¼š</p><blockquote><p>å¦‚æœä¸€ä¸ªä»»åŠ¡æˆåŠŸåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦äºŒæ¬¡æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼ˆå› ä¸ºæ‰€æœ‰å­˜æ´»çš„å·¥ä½œçº¿ç¨‹æœ‰å¯èƒ½åœ¨æœ€åä¸€æ¬¡æ£€æŸ¥ä¹‹åå·²ç»ç»ˆç»“ï¼‰æˆ–è€…æ‰§è¡Œå½“å‰æ–¹æ³•çš„æ—¶å€™çº¿ç¨‹æ± æ˜¯å¦å·²ç»ç»ˆç»“äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦äºŒæ¬¡æ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¿…é¡»æ—¶æŠŠä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤æˆ–è€…åœ¨æ²¡æœ‰å¯ç”¨çš„å·¥ä½œçº¿ç¨‹çš„å‰æä¸‹æ–°å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p></blockquote><h2 id="å…¶ä»–é‡è¦æ–¹æ³•"><a class="markdownIt-Anchor" href="#å…¶ä»–é‡è¦æ–¹æ³•"></a> å…¶ä»–é‡è¦æ–¹æ³•</h2><ul><li><code>submit</code> ç±»ä¼¼äº <code>execute</code>ï¼Œä½†æ˜¯é’ˆå¯¹çš„æ˜¯æœ‰è¿”å›å€¼çš„çº¿ç¨‹ã€‚<code>submit</code> æ–¹æ³•æ˜¯åœ¨ <code>ExecutorService</code> ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œåœ¨ <code>AbstractExecutorService</code> å°±å·²ç»æœ‰äº†å…·ä½“çš„å®ç°ã€‚<code>ThreadPoolExecutor</code> ç›´æ¥å¤ç”¨ <code>AbstractExecutorService</code> çš„ <code>submit</code> æ–¹æ³•ã€‚</li><li><code>shutdown</code> - ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ç»ˆæ­¢ï¼Œä½†å†ä¹Ÿä¸ä¼šæ¥å—æ–°çš„ä»»åŠ¡ã€‚</li><li><code>shutdownNow</code> - ç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œå¹¶å°è¯•æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¸…ç©ºä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œè¿”å›å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li><code>isShutdown</code> - è°ƒç”¨äº† <code>shutdown</code> æˆ– <code>shutdownNow</code> æ–¹æ³•åï¼Œ<code>isShutdown</code> æ–¹æ³•å°±ä¼šè¿”å› <code>true</code>ã€‚</li><li><code>isTerminaed</code> - å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²å…³é—­åï¼Œæ‰è¡¨ç¤ºçº¿ç¨‹æ± å…³é—­æˆåŠŸï¼Œè¿™æ—¶è°ƒç”¨ <code>isTerminaed</code> æ–¹æ³•ä¼šè¿”å› <code>true</code>ã€‚</li></ul><h1 id="scheduledthreadpoolexecutor"><a class="markdownIt-Anchor" href="#scheduledthreadpoolexecutor"></a> <code>ScheduledThreadPoolExecutor</code></h1><p><code>ScheduledThreadPoolExecutor</code> ä¸»è¦ç”¨æ¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œä»»åŠ¡ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚ è¿™ä¸ªåœ¨å®é™…é¡¹ç›®ä¸­åŸºæœ¬ä¸ä¼šè¢«ç”¨åˆ°ï¼Œå› ä¸ºæœ‰å…¶ä»–æ–¹æ¡ˆé€‰æ‹©æ¯”å¦‚ <code>quartz</code>ã€‚</p><h2 id="ç®€ä»‹-3"><a class="markdownIt-Anchor" href="#ç®€ä»‹-3"></a> ç®€ä»‹</h2><p><code>ScheduledThreadPoolExecutor</code> ä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ— <code>DelayQueue</code> å°è£…äº†ä¸€ä¸ª <code>PriorityQueue</code>ï¼Œ<code>PriorityQueue</code> ä¼šå¯¹é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œæ’åºï¼Œæ‰§è¡Œæ‰€éœ€æ—¶é—´çŸ­çš„æ”¾åœ¨å‰é¢å…ˆè¢«æ‰§è¡Œ(<code>ScheduledFutureTask</code> çš„ <code>time</code> å˜é‡å°çš„å…ˆæ‰§è¡Œ)ï¼Œå¦‚æœæ‰§è¡Œæ‰€éœ€æ—¶é—´ç›¸åŒåˆ™å…ˆæäº¤çš„ä»»åŠ¡å°†è¢«å…ˆæ‰§è¡Œ(<code>ScheduledFutureTask</code> çš„ <code>squenceNumber</code> å˜é‡å°çš„å…ˆæ‰§è¡Œ)ã€‚</p><h2 id="è¿è¡Œæœºåˆ¶"><a class="markdownIt-Anchor" href="#è¿è¡Œæœºåˆ¶"></a> è¿è¡Œæœºåˆ¶</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727200044.png" srcset="/img/loading.gif" alt="" /></p><p><code>ScheduledThreadPoolExecutor</code> çš„æ‰§è¡Œä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š</p><ul><li><p>å½“è°ƒç”¨ <code>ScheduledThreadPoolExecutor</code> çš„ <code>scheduleAtFixedRate()</code> æ–¹æ³•æˆ–è€… <code>scheduleWirhFixedDelay()</code> æ–¹æ³•æ—¶ï¼Œä¼šå‘ <code>ScheduledThreadPoolExecutor</code> çš„ <code>DelayQueue</code> æ·»åŠ ä¸€ä¸ªå®ç°äº† <code>RunnableScheduledFuture</code> æ¥å£çš„ <code>ScheduledFutureTask</code> ã€‚</p></li><li><p>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä» <code>DelayQueue</code> ä¸­è·å– <code>ScheduledFutureTask</code>ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ã€‚</p></li></ul><p><code>ScheduledThreadPoolExecutor</code> ä¸ºäº†å®ç°å‘¨æœŸæ€§çš„æ‰§è¡Œä»»åŠ¡ï¼Œå¯¹ <code>ThreadPoolExecutor</code> åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼š</p><ul><li><p>ä½¿ç”¨ <code>DelayQueue</code> ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼›</p></li><li><p>è·å–ä»»åŠ¡çš„æ–¹ä¸åŒ</p></li><li><p>æ‰§è¡Œå‘¨æœŸä»»åŠ¡åï¼Œå¢åŠ äº†é¢å¤–çš„å¤„ç†</p></li></ul><h2 id="æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„æ­¥éª¤"><a class="markdownIt-Anchor" href="#æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„æ­¥éª¤"></a> æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„æ­¥éª¤</h2><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727200325.png" srcset="/img/loading.gif" alt="" /></p><ul><li><p>çº¿ç¨‹ 1 ä» <code>DelayQueue</code> ä¸­è·å–å·²åˆ°æœŸçš„ <code>ScheduledFutureTask</code>ï¼ˆ<code>DelayQueue.take()</code>ï¼‰ã€‚åˆ°æœŸä»»åŠ¡æ˜¯æŒ‡ <code>ScheduledFutureTask</code> çš„ <code>time</code> å¤§äºç­‰äºå½“å‰ç³»ç»Ÿçš„æ—¶é—´ï¼›</p></li><li><p>çº¿ç¨‹ 1 æ‰§è¡Œè¿™ä¸ª <code>ScheduledFutureTask</code>ï¼›</p></li><li><p>çº¿ç¨‹ 1 ä¿®æ”¹ <code>ScheduledFutureTask</code> çš„ <code>time</code> å˜é‡ä¸ºä¸‹æ¬¡å°†è¦è¢«æ‰§è¡Œçš„æ—¶é—´ï¼›</p></li><li><p>çº¿ç¨‹ 1 æŠŠè¿™ä¸ªä¿®æ”¹ <code>time</code> ä¹‹åçš„ <code>ScheduledFutureTask</code> æ”¾å› <code>DelayQueue</code> ä¸­ (<code>DelayQueue.add()</code>)ã€‚</p></li></ul><h1 id="å¸¸è§çº¿ç¨‹æ± "><a class="markdownIt-Anchor" href="#å¸¸è§çº¿ç¨‹æ± "></a> å¸¸è§çº¿ç¨‹æ± </h1><p><code>JDK</code> çš„ <code>Executors</code> ç±»ä¸­æä¾›äº†å‡ ç§å…·æœ‰ä»£è¡¨æ€§çš„çº¿ç¨‹æ± ï¼Œè¿™äº›çº¿ç¨‹æ±  éƒ½æ˜¯åŸºäº <code>ThreadPoolExecutor</code> çš„å®šåˆ¶åŒ–å®ç°ã€‚</p><blockquote><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­å¼ºåˆ¶çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ <code>Executors</code> å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ <code>ThreadPoolExecutor</code> æ„é€ å‡½æ•°çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚</p></blockquote><h2 id="åˆ›å»ºçº¿ç¨‹æ± æ–¹å¼"><a class="markdownIt-Anchor" href="#åˆ›å»ºçº¿ç¨‹æ± æ–¹å¼"></a> åˆ›å»ºçº¿ç¨‹æ± æ–¹å¼</h2><ol><li>é€šè¿‡ <code>ThreadPoolExecutor</code> æ„é€ å‡½æ•°å®ç°ï¼ˆæ¨èï¼‰</li><li>é€šè¿‡ <code>Executor</code> æ¡†æ¶çš„å·¥å…·ç±» <code>Executors</code> æ¥å®ç° æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ <code>ThreadPoolExecutor</code><ul><li><code>FixedThreadPool</code></li><li><code>SingleThreadExecutor</code></li><li><code>CachedThreadPool</code></li></ul></li></ol><p><code>Executors</code> è¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</p><ul><li><code>FixedThreadPool</code> å’Œ <code>SingleThreadExecutor</code> ï¼š å…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸º <code>Integer.MAX_VALUE</code>,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ <code>OOM</code>ã€‚</li><li><code>CachedThreadPool</code> å’Œ <code>ScheduledThreadPool</code> ï¼š å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º <code>Integer.MAX_VALUE</code> ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ <code>OOM</code>ã€‚</li></ul><h2 id="fixedthreadpool"><a class="markdownIt-Anchor" href="#fixedthreadpool"></a> <code>FixedThreadPool</code></h2><p>åˆ›å»ºä¸€ä¸ª<strong>å›ºå®šå¤§å°</strong>çš„çº¿ç¨‹æ± ã€‚</p><p>æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°é‡è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™å°†æäº¤çš„ä»»åŠ¡å­˜å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚</p><p><code>FixedThreadPool</code> æ˜¯ä¸€ä¸ªå…¸å‹ä¸”ä¼˜ç§€çš„çº¿ç¨‹æ± ï¼Œå®ƒå…·æœ‰çº¿ç¨‹æ± <strong>æé«˜ç¨‹åºæ•ˆç‡</strong>å’Œ<strong>èŠ‚çœåˆ›å»ºçº¿ç¨‹æ—¶æ‰€è€—çš„å¼€é”€</strong>çš„ä¼˜ç‚¹ã€‚ä½†æ˜¯ï¼Œåœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚</p><pre><code class="hljs java"> <span class="hljs-comment">/**</span><span class="hljs-comment">  * åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± </span><span class="hljs-comment">  */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nThreads, ThreadFactory threadFactory)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolExecutor(        nThreads,        nThreads,        <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,        <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),        threadFactory);    &#125;</code></pre><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727191728.png" srcset="/img/loading.gif" alt="" /></p><p>ä¸Šå›¾è¯´æ˜ï¼š</p><ul><li><p>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äº <code>corePoolSize</code>ï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œå°±åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</p></li><li><p>å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äº <code>corePoolSize</code> åï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œä¼šå°†ä»»åŠ¡åŠ å…¥ <code>LinkedBlockingQueue</code>ï¼›</p></li><li><p>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œå®Œ æ‰‹å¤´çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä» <code>LinkedBlockingQueue</code> ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼›</p></li></ul><p><code>FixedThreadPool</code> ä½¿ç”¨æ— ç•Œé˜Ÿåˆ— <code>LinkedBlockingQueue</code>ï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸º <code>Intger.MAX_VALUE</code>ï¼‰ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ä¼šå¯¹çº¿ç¨‹æ± å¸¦æ¥å¦‚ä¸‹å½±å“ ï¼š</p><ul><li>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ° <code>corePoolSize</code> åï¼Œæ–°ä»»åŠ¡å°†åœ¨æ— ç•Œé˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œå› æ­¤çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸ä¼šè¶…è¿‡ <code>corePoolSize</code></li><li>ç”±äºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ <code>maximumPoolSize</code> å°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ï¼Œå› ä¸ºä¸å¯èƒ½å­˜åœ¨ä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æƒ…å†µ</li><li>ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ <code>keepAliveTime</code> å°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°</li><li>è¿è¡Œä¸­çš„ <code>FixedThreadPool</code>ï¼ˆæœªæ‰§è¡Œ <code>shutdown()</code> æˆ– <code>shutdownNow()</code>ï¼‰ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ¯”è¾ƒå¤šçš„æ—¶å€™ä¼šå¯¼è‡´ <code>OOM</code></li></ul><h2 id="singlethreadexecutor"><a class="markdownIt-Anchor" href="#singlethreadexecutor"></a> <code>SingleThreadExecutor</code></h2><p>åˆ›å»ºä¸€ä¸ª<strong>å•çº¿ç¨‹</strong>çš„çº¿ç¨‹æ± ã€‚</p><p>åªä¼šåˆ›å»ºå”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(<code>FIFO</code>, <code>LIFO</code>, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚ å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒ ã€‚</p><p>å•å·¥ä½œçº¿ç¨‹æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡</strong>ã€‚</p><pre><code class="hljs java">  <span class="hljs-comment">/**</span><span class="hljs-comment">   * è¿”å›åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span><span class="hljs-comment">   */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newSingleThreadExecutor</span><span class="hljs-params">(ThreadFactory threadFactory)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FinalizableDelegatedExecutorService            (<span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,                                    <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,                                    <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),                                    threadFactory));    &#125;</code></pre><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727192058.png" srcset="/img/loading.gif" alt="" /></p><p>ä¸Šå›¾è¯´æ˜ï¼š</p><ul><li><p>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº <code>corePoolSize</code>ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›</p></li><li><p>å½“å‰çº¿ç¨‹æ± ä¸­æœ‰ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹åï¼Œå°†ä»»åŠ¡åŠ å…¥ <code>LinkedBlockingQueue</code></p></li><li><p>çº¿ç¨‹æ‰§è¡Œå®Œå½“å‰çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä» <code>LinkedBlockingQueue</code> ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼›</p></li></ul><p>å½±å“ï¼š <code>SingleThreadExecutor</code> ä½¿ç”¨æ— ç•Œé˜Ÿåˆ— <code>LinkedBlockingQueue</code> ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸º <code>Intger.MAX_VALUE</code>ï¼‰ã€‚<code>SingleThreadExecutor</code> ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ä¼šå¯¹çº¿ç¨‹æ± å¸¦æ¥çš„å½±å“ä¸ <code>FixedThreadPool</code> ç›¸åŒï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ <code>OOM</code>ã€‚</p><h2 id="cachedthreadpool"><a class="markdownIt-Anchor" href="#cachedthreadpool"></a> <code>CachedThreadPool</code></h2><p>åˆ›å»ºä¸€ä¸ª<strong>å¯ç¼“å­˜</strong>çš„çº¿ç¨‹æ± ã€‚</p><ul><li><p>å¦‚æœçº¿ç¨‹æ± å¤§å°è¶…è¿‡å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹æ•°ï¼Œå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²çš„çº¿ç¨‹ï¼›</p></li><li><p>å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¾€çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡ï¼Œå³å¦‚æœå·¥ä½œçº¿ç¨‹ç©ºé—²äº†æŒ‡å®šçš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º 1 åˆ†é’Ÿï¼‰ï¼Œåˆ™è¯¥å·¥ä½œçº¿ç¨‹å°†è‡ªåŠ¨ç»ˆæ­¢ã€‚ç»ˆæ­¢åï¼Œå¦‚æœä½ åˆæäº¤äº†æ–°çš„ä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹æ± é‡æ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p></li><li><p>æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´ <code>JVM</code>ï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>CachedThreadPool</code> æ—¶ï¼Œä¸€å®šè¦æ³¨æ„<strong>æ§åˆ¶ä»»åŠ¡çš„æ•°é‡</strong>ï¼Œå¦åˆ™ï¼Œç”±äºå¤§é‡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¾ˆæœ‰ä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚</p></li></ul><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œä½†ä¼šåœ¨å…ˆå‰æ„å»ºçš„çº¿ç¨‹å¯ç”¨æ—¶é‡ç”¨å®ƒã€‚</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newCachedThreadPool</span><span class="hljs-params">(ThreadFactory threadFactory)</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">0</span>, Integer.MAX_VALUE,                                      <span class="hljs-number">60L</span>, TimeUnit.SECONDS,                                      <span class="hljs-keyword">new</span> SynchronousQueue&lt;Runnable&gt;(),                                      threadFactory);    &#125;</code></pre><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200727192747.png" srcset="/img/loading.gif" alt="" /></p><p>ä¸Šå›¾è¯´æ˜ï¼š</p><ul><li><p>é¦–å…ˆæ‰§è¡Œ <code>SynchronousQueue.offer(Runnable task)</code> æäº¤ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚å¦‚æœå½“å‰ <code>maximumPool</code> ä¸­æœ‰é—²çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ <code>SynchronousQueue.poll(keepAliveTime,TimeUnit.NANOSECONDS)</code>ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹æ‰§è¡Œ <code>offer</code> æ“ä½œä¸ç©ºé—²çº¿ç¨‹æ‰§è¡Œçš„ <code>poll</code> æ“ä½œé…å¯¹æˆåŠŸï¼Œä¸»çº¿ç¨‹æŠŠä»»åŠ¡äº¤ç»™ç©ºé—²çº¿ç¨‹æ‰§è¡Œï¼Œ<code>execute()</code> æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œå¦åˆ™æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ 2ï¼›</p></li><li><p>å½“åˆå§‹ <code>maximumPool</code> ä¸ºç©ºï¼Œæˆ–è€… <code>maximumPool</code> ä¸­æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œå°†æ²¡æœ‰çº¿ç¨‹æ‰§è¡Œ <code>SynchronousQueue.poll(keepAliveTime,TimeUnit.NANOSECONDS)</code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¥éª¤ 1 å°†å¤±è´¥ï¼Œæ­¤æ—¶ <code>CachedThreadPool</code> ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œ<code>execute</code> æ–¹æ³•æ‰§è¡Œå®Œæˆï¼›</p></li></ul><p>å½±å“ï¼š<code>CachedThreadPool</code> å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º <code>Integer.MAX_VALUE</code>ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ <code>OOM</code>ã€‚</p><h1 id="çº¿ç¨‹æ± å¤§å°ç¡®å®š"><a class="markdownIt-Anchor" href="#çº¿ç¨‹æ± å¤§å°ç¡®å®š"></a> çº¿ç¨‹æ± å¤§å°ç¡®å®š</h1><blockquote><p>ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</p><p>å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€èˆ¬çº¿ç¨‹çš„ä¸ªæ•°éƒ½å¤§äº <code>CPU</code> æ ¸å¿ƒçš„ä¸ªæ•°ï¼Œè€Œä¸€ä¸ª <code>CPU</code> æ ¸å¿ƒåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä¸ºäº†è®©è¿™äº›çº¿ç¨‹éƒ½èƒ½å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼Œ<code>CPU</code> é‡‡å–çš„ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶è½®è½¬çš„å½¢å¼ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œçš„æ—¶å€™å°±ä¼šé‡æ–°å¤„äºå°±ç»ªçŠ¶æ€è®©ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å±äºä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šå½“å‰ä»»åŠ¡åœ¨æ‰§è¡Œå®Œ <code>CPU</code> æ—¶é—´ç‰‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ä¼šå…ˆä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>ä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯<strong>è®¡ç®—å¯†é›†å‹</strong>çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦ç›¸å½“å¯è§‚çš„å¤„ç†å™¨æ—¶é—´ï¼Œåœ¨æ¯ç§’å‡ åä¸Šç™¾æ¬¡çš„åˆ‡æ¢ä¸­ï¼Œæ¯æ¬¡åˆ‡æ¢éƒ½éœ€è¦çº³ç§’é‡çº§çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ¥è¯´æ„å‘³ç€æ¶ˆè€—å¤§é‡çš„ <code>CPU</code> æ—¶é—´ï¼Œäº‹å®ä¸Šï¼Œå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤§çš„æ“ä½œã€‚</p><p><code>Linux</code> ç›¸æ¯”ä¸å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬å…¶ä»–ç±» <code>Unix</code> ç³»ç»Ÿï¼‰æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯ï¼Œå…¶ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ¨¡å¼åˆ‡æ¢çš„æ—¶é—´æ¶ˆè€—éå¸¸å°‘ã€‚</p></blockquote><p>å¦‚æœæˆ‘ä»¬è®¾ç½®çš„çº¿ç¨‹æ± æ•°é‡å¤ªå°çš„è¯ï¼Œå¦‚æœåŒä¸€æ—¶é—´æœ‰å¤§é‡ä»»åŠ¡/è¯·æ±‚éœ€è¦å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚/ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼Œç”šè‡³ä¼šå‡ºç°ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åä»»åŠ¡/è¯·æ±‚æ— æ³•å¤„ç†çš„æƒ…å†µï¼Œæˆ–è€…å¤§é‡ä»»åŠ¡å †ç§¯åœ¨ä»»åŠ¡é˜Ÿåˆ—å¯¼è‡´ <code>OOM</code>ã€‚è¿™æ ·å¾ˆæ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼ <code>CPU</code> æ ¹æœ¬æ²¡æœ‰å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®çº¿ç¨‹æ•°é‡å¤ªå¤§ï¼Œå¤§é‡çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶åœ¨äº‰å– <code>CPU</code> èµ„æºï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¢åŠ çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå½±å“äº†æ•´ä½“æ‰§è¡Œæ•ˆç‡ã€‚</p><p>æœ‰ä¸€ä¸ªç®€å•å¹¶ä¸”é€‚ç”¨é¢æ¯”è¾ƒå¹¿çš„å…¬å¼ï¼š</p><ul><li><p><code>CPU</code> å¯†é›†å‹ä»»åŠ¡(<code>N + 1</code>)ï¼šè¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ <code>CPU</code> èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º <code>Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+ 1</code>ï¼Œæ¯” <code>CPU</code> æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼Œ<code>CPU</code> å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ <code>CPU</code> çš„ç©ºé—²æ—¶é—´ã€‚</p></li><li><p><code>I/O</code> å¯†é›†å‹ä»»åŠ¡(<code>2N</code>)ï¼šè¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† <code>I/O</code> äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† <code>I/O</code> çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ <code>CPU</code> æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† <code>CPU</code> äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ <code>I/O</code> å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ <code>2N</code>ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¹¶å‘-å®¹å™¨</title>
    <link href="/2020/07/24/concurrent-container/"/>
    <url>/2020/07/24/concurrent-container/</url>
    
    <content type="html"><![CDATA[<h1 id="åŒæ­¥å®¹å™¨"><a class="markdownIt-Anchor" href="#åŒæ­¥å®¹å™¨"></a> åŒæ­¥å®¹å™¨</h1><h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2><p>åœ¨ <code>Java</code> ä¸­ï¼ŒåŒæ­¥å®¹å™¨ä¸»è¦åŒ…æ‹¬ <code>2</code> ç±»ï¼š</p><ul><li><p><code>Vector</code>, <code>Stack</code>, <code>HashTable</code></p><ul><li><code>Vector</code> - <code>Vector</code> å®ç°äº† <code>List</code> æ¥å£ã€‚<code>Vector</code> å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå’Œ <code>ArrayList</code> ç±»ä¼¼ã€‚ä½†æ˜¯ <code>Vector</code> ä¸­çš„æ–¹æ³•éƒ½æ˜¯ <code>synchronized</code> æ–¹æ³•ï¼Œå³è¿›è¡Œäº†åŒæ­¥æªæ–½ã€‚</li><li><code>Stack</code> - <code>Stack</code> ç»§æ‰¿äº <code>Vector</code> ç±»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨ï¼Œå®ƒçš„æ–¹æ³•ä¹Ÿç”¨ <code>synchronized</code> è¿›è¡Œäº†åŒæ­¥ã€‚</li><li><code>Hashtable</code>- <code>Hashtable</code> å®ç°äº† <code>Map</code> æ¥å£ï¼Œä½†æ˜¯ <code>Hashtable</code> ç”¨ <code>synchronized</code> è¿›è¡Œäº†åŒæ­¥ã€‚</li></ul></li><li><p><code>Collections</code> ç±»ä¸­æä¾›çš„é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºçš„ç±»ï¼ˆç”± <code>Collections.synchronizedXXX</code> ç­‰æ–¹æ³•ï¼‰ã€‚</p></li></ul><h2 id="é—®é¢˜"><a class="markdownIt-Anchor" href="#é—®é¢˜"></a> é—®é¢˜</h2><p>åŒæ­¥å®¹å™¨çš„åŒæ­¥åŸç†å°±æ˜¯åœ¨æ–¹æ³•ä¸Šç”¨ <code>synchronized</code> ä¿®é¥°ã€‚</p><h3 id="æ€§èƒ½é—®é¢˜"><a class="markdownIt-Anchor" href="#æ€§èƒ½é—®é¢˜"></a> æ€§èƒ½é—®é¢˜</h3><p><code>synchronized</code> çš„äº’æ–¥åŒæ­¥ä¼šäº§ç”Ÿé˜»å¡å’Œå”¤é†’çº¿ç¨‹çš„å¼€é”€ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼æ¯”æ²¡æœ‰ä½¿ç”¨ <code>synchronized</code> çš„å®¹å™¨æ€§èƒ½è¦å·®ã€‚</p><h3 id="å®‰å…¨é—®é¢˜"><a class="markdownIt-Anchor" href="#å®‰å…¨é—®é¢˜"></a> å®‰å…¨é—®é¢˜</h3><p>åŒæ­¥å®¹å™¨çœŸçš„ç»å¯¹å®‰å…¨å—ï¼Ÿ</p><p>å…¶å®ä¹Ÿæœªå¿…ã€‚åœ¨åšå¤åˆæ“ä½œï¼ˆéåŸå­æ“ä½œï¼‰æ—¶ï¼Œä»ç„¶éœ€è¦åŠ é”æ¥ä¿æŠ¤ã€‚å¸¸è§å¤åˆæ“ä½œå¦‚ä¸‹ï¼š</p><ul><li><p>è¿­ä»£ï¼šåå¤è®¿é—®å…ƒç´ ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨å…ƒç´ ï¼›</p></li><li><p>è·³è½¬ï¼šæ ¹æ®æŒ‡å®šé¡ºåºå¯»æ‰¾å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªï¼ˆä¸‹ <code>n</code> ä¸ªï¼‰å…ƒç´ ï¼›</p></li><li><p>æ¡ä»¶è¿ç®—ï¼šä¾‹å¦‚è‹¥æ²¡æœ‰åˆ™æ·»åŠ ç­‰ï¼›</p></li></ul><p>âŒ ä¸å®‰å…¨çš„ç¤ºä¾‹</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : ConcurrentContainerTest.java 2020/07/24 Fri 1:56 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcurrentContainerTest</span> </span>&#123;    <span class="hljs-keyword">static</span> Vector&lt;Integer&gt; vector = <span class="hljs-keyword">new</span> Vector&lt;&gt;();    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;            vector.clear();            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;                vector.add(i);            &#125;            Thread t1 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vector.size(); i++) &#123;                    vector.remove(i);                &#125;            &#125;);            Thread t2 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vector.size(); i++) &#123;                    vector.get(i);                &#125;            &#125;);            t1.start();            t2.start();            <span class="hljs-keyword">while</span> (Thread.activeCount() &gt; <span class="hljs-number">10</span>) &#123;                System.out.println(<span class="hljs-string">"åŒæ—¶å­˜åœ¨åä¸ªä»¥ä¸Šçº¿ç¨‹ï¼Œ é€€å‡º"</span>);                <span class="hljs-keyword">return</span>;            &#125;        &#125;    &#125;&#125;</code></pre><p>ä»¥ä¸Šç¨‹åºæ‰§è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°æ•°ç»„è¶Šç•Œé”™è¯¯ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œå¯¹äº <code>Vector</code>ï¼Œè™½ç„¶èƒ½ä¿è¯æ¯ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œä½†æ˜¯ä¸æ’é™¤è¿™ç§å¯èƒ½ï¼š<br />å½“æŸä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»åˆ é™¤äº†è¯¥çº¿ç¨‹æ‰€è¦è¯»çš„é‚£ä¸ªå…ƒç´ ã€‚</p><p>å› æ­¤ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¿…é¡»åœ¨æ–¹æ³•è°ƒç”¨ç«¯åšé¢å¤–çš„åŒæ­¥æªæ–½ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span> (vector) &#123;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vector.size(); i++) &#123;        vector.remove(i);    &#125;&#125;<span class="hljs-keyword">synchronized</span> (vector) &#123;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vector.size(); i++) &#123;        vector.remove(i);    &#125;&#125;</code></pre><h1 id="å¹¶å‘å®¹å™¨ç®€ä»‹"><a class="markdownIt-Anchor" href="#å¹¶å‘å®¹å™¨ç®€ä»‹"></a> å¹¶å‘å®¹å™¨ç®€ä»‹</h1><blockquote><p>åŒæ­¥å®¹å™¨å°†æ‰€æœ‰å¯¹å®¹å™¨çŠ¶æ€çš„è®¿é—®éƒ½ä¸²è¡ŒåŒ–ï¼Œä»¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œè¿™ç§ç­–ç•¥ä¼šä¸¥é‡é™ä½å¹¶å‘æ€§ã€‚</p><p>Java 1.5 åæä¾›äº†å¤šç§å¹¶å‘å®¹å™¨ï¼Œä½¿ç”¨å¹¶å‘å®¹å™¨æ¥æ›¿ä»£åŒæ­¥å®¹å™¨ï¼Œå¯ä»¥æå¤§åœ°æé«˜ä¼¸ç¼©æ€§å¹¶é™ä½é£é™©ã€‚</p></blockquote><p>J.U.C åŒ…ä¸­æä¾›äº†å‡ ä¸ªéå¸¸æœ‰ç”¨çš„å¹¶å‘å®¹å™¨ä½œä¸ºçº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼š</p><table><thead><tr><th style="text-align:center">å¹¶å‘å®¹å™¨</th><th style="text-align:center">å¯¹åº”çš„æ™®é€šå®¹å™¨</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center"><code>ConcurrentHashMap</code></td><td style="text-align:center"><code>HashMap</code></td><td style="text-align:center"><code>Java 1.8</code> ä¹‹å‰é‡‡ç”¨<strong>åˆ†æ®µé”æœºåˆ¶</strong>ç»†åŒ–é”ç²’åº¦ï¼Œé™ä½é˜»å¡ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ï¼›<code>Java 1.8</code> ä¹‹ååŸºäº <code>CAS</code> å®ç°ã€‚</td></tr><tr><td style="text-align:center"><code>ConcurrentSkipListMap</code></td><td style="text-align:center"><code>SortedMap</code></td><td style="text-align:center">åŸºäºè·³è¡¨å®ç°çš„</td></tr><tr><td style="text-align:center"><code>CopyOnWriteArrayList</code></td><td style="text-align:center"><code>ArrayList</code></td><td style="text-align:center">å†™æ—¶å¤åˆ¶</td></tr><tr><td style="text-align:center"><code>CopyOnWriteArraySet</code></td><td style="text-align:center"><code>Set</code></td><td style="text-align:center">åŸºäº <code>CopyOnWriteArrayList</code> å®ç°ã€‚</td></tr><tr><td style="text-align:center"><code>ConcurrentSkipListSet</code></td><td style="text-align:center"><code>SortedSet</code></td><td style="text-align:center">åŸºäº <code>ConcurrentSkipListMap</code> å®ç°ã€‚</td></tr><tr><td style="text-align:center"><code>ConcurrentLinkedQueue</code></td><td style="text-align:center"><code>Queue</code></td><td style="text-align:center">çº¿ç¨‹å®‰å…¨çš„æ— ç•Œé˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨å•é“¾è¡¨ã€‚æ”¯æŒ <code>FIFO</code>ã€‚</td></tr><tr><td style="text-align:center"><code>ConcurrentLinkedDeque</code></td><td style="text-align:center"><code>Deque</code></td><td style="text-align:center">çº¿ç¨‹å®‰å…¨çš„æ— ç•ŒåŒç«¯é˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨åŒå‘é“¾è¡¨ã€‚æ”¯æŒ <code>FIFO</code> å’Œ <code>FILO</code>ã€‚</td></tr><tr><td style="text-align:center"><code>ArrayBlockingQueue</code></td><td style="text-align:center"><code>Queue</code></td><td style="text-align:center">æ•°ç»„å®ç°çš„é˜»å¡é˜Ÿåˆ—ã€‚</td></tr><tr><td style="text-align:center"><code>LinkedBlockingQueue</code></td><td style="text-align:center"><code>Queue</code></td><td style="text-align:center">é“¾è¡¨å®ç°çš„é˜»å¡é˜Ÿåˆ—ã€‚</td></tr><tr><td style="text-align:center"><code>LinkedBlockingDeque</code></td><td style="text-align:center"><code>Deque</code></td><td style="text-align:center">åŒå‘é“¾è¡¨å®ç°çš„åŒç«¯é˜»å¡é˜Ÿåˆ—ã€‚</td></tr></tbody></table><h1 id="concurrenthashmap"><a class="markdownIt-Anchor" href="#concurrenthashmap"></a> <code>ConcurrentHashMap</code></h1><blockquote><p><code>ConcurrentHashMap</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ <code>HashMap</code> ï¼Œç”¨äºæ›¿ä»£ <code>Hashtable</code>ã€‚</p></blockquote><h2 id="ç‰¹æ€§"><a class="markdownIt-Anchor" href="#ç‰¹æ€§"></a> ç‰¹æ€§</h2><p><code>ConcurrentHashMap</code> å®ç°äº† <code>ConcurrentMap</code> æ¥å£ï¼Œè€Œ <code>ConcurrentMap</code> æ¥å£æ‰©å±•äº† <code>Map</code> æ¥å£ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcurrentHashMap</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMap</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt;</span><span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">ConcurrentMap</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt;, <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-comment">// ...</span>&#125;</code></pre><p><code>ConcurrentHashMap</code> çš„å®ç°åŒ…å«äº† <code>HashMap</code> æ‰€æœ‰çš„åŸºæœ¬ç‰¹æ€§ï¼Œå¦‚ï¼šæ•°æ®ç»“æ„ã€è¯»å†™ç­–ç•¥ç­‰ã€‚</p><p><code>ConcurrentHashMap</code> æ²¡æœ‰å®ç°å¯¹ <code>Map</code> åŠ é”ä»¥æä¾›ç‹¬å è®¿é—®ã€‚å› æ­¤æ— æ³•é€šè¿‡åœ¨å®¢æˆ·ç«¯åŠ é”çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„åŸå­æ“ä½œã€‚ä½†æ˜¯ï¼Œä¸€äº›å¸¸è§çš„å¤åˆæ“ä½œï¼Œå¦‚ï¼šâ€œè‹¥æ²¡æœ‰åˆ™æ·»åŠ â€ã€â€œè‹¥ç›¸ç­‰åˆ™ç§»é™¤â€ã€â€œè‹¥ç›¸ç­‰åˆ™æ›¿æ¢â€ï¼Œéƒ½å·²ç»å®ç°ä¸ºåŸå­æ“ä½œï¼Œå¹¶ä¸”æ˜¯å›´ç»• <code>ConcurrentMap</code> çš„æ‰©å±•æ¥å£è€Œå®ç°ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ConcurrentMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Map</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; </span>&#123;    <span class="hljs-comment">// ä»…å½“ K æ²¡æœ‰ç›¸åº”çš„æ˜ å°„å€¼æ‰æ’å…¥</span>    <span class="hljs-function">V <span class="hljs-title">putIfAbsent</span><span class="hljs-params">(K key, V value)</span></span>;    <span class="hljs-comment">// ä»…å½“ K è¢«æ˜ å°„åˆ° V æ—¶æ‰ç§»é™¤</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object key, Object value)</span></span>;    <span class="hljs-comment">// ä»…å½“ K è¢«æ˜ å°„åˆ° oldValue æ—¶æ‰æ›¿æ¢ä¸º newValue</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">replace</span><span class="hljs-params">(K key, V oldValue, V newValue)</span></span>;    <span class="hljs-comment">// ä»…å½“ K è¢«æ˜ å°„åˆ°æŸä¸ªå€¼æ—¶æ‰æ›¿æ¢ä¸º newValue</span>    <span class="hljs-function">V <span class="hljs-title">replace</span><span class="hljs-params">(K key, V value)</span></span>;&#125;</code></pre><p>ä¸åŒäº <code>Hashtable</code>ï¼Œ<code>ConcurrentHashMap</code> æä¾›çš„è¿­ä»£å™¨ä¸ä¼šæŠ›å‡º <code>ConcurrentModificationException</code>ï¼Œå› æ­¤ä¸éœ€è¦åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯¹å®¹å™¨åŠ é”ã€‚</p><blockquote><p>ğŸ”” æ³¨æ„ï¼šä¸€äº›éœ€è¦å¯¹æ•´ä¸ª <code>Map</code> è¿›è¡Œè®¡ç®—çš„æ–¹æ³•ï¼Œå¦‚ <code>size</code> å’Œ <code>isEmpty</code> ï¼Œç”±äºè¿”å›çš„ç»“æœåœ¨è®¡ç®—æ—¶å¯èƒ½å·²ç»è¿‡æœŸï¼Œæ‰€ä»¥å¹¶éå®æ—¶çš„ç²¾ç¡®å€¼ã€‚è¿™æ˜¯ä¸€ç§ç­–ç•¥ä¸Šçš„æƒè¡¡ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œè¿™ç±»æ–¹æ³•ç”±äºæ€»åœ¨ä¸æ–­å˜åŒ–ï¼Œæ‰€ä»¥è·å–å…¶å®æ—¶ç²¾ç¡®å€¼çš„æ„ä¹‰ä¸å¤§ã€‚<code>ConcurrentHashMap</code> å¼±åŒ–è¿™ç±»æ–¹æ³•ï¼Œä»¥æ¢å–æ›´é‡è¦æ“ä½œï¼ˆå¦‚ï¼š<code>get</code>ã€<code>put</code>ã€<code>containesKey</code>ã€<code>remove</code> ç­‰ï¼‰çš„æ€§èƒ½ã€‚</p></blockquote><h2 id="ç”¨æ³•"><a class="markdownIt-Anchor" href="#ç”¨æ³•"></a> ç”¨æ³•</h2><p>åŒ <code>HashMap</code></p><h2 id="åŸç†"><a class="markdownIt-Anchor" href="#åŸç†"></a> åŸç†</h2><p><code>ConcurrentHashMap</code> åœ¨ <code>Java 1.8</code> ä¹‹å‰å’Œ <code>Java 1.8</code> ä¹‹åçš„å®ç°æœ‰å¾ˆå¤§å·®å¼‚ï¼š</p><ul><li><code>Java 1.8</code> ä¹‹å‰é‡‡ç”¨<strong>åˆ†æ®µé”æœºåˆ¶</strong>ç»†åŒ–é”ç²’åº¦ï¼Œé™ä½é˜»å¡ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ã€‚</li><li><code>Java 1.8</code> ä¹‹ååŸºäº <code>CAS</code> å®ç°ã€‚</li></ul><h3 id="java-17-çš„å®ç°"><a class="markdownIt-Anchor" href="#java-17-çš„å®ç°"></a> Java 1.7 çš„å®ç°</h3><p>æ¯ä¸€ä¸ª <code>segment</code> éƒ½æ˜¯ä¸€ä¸ª <code>HashEntry&lt;K,V&gt;[] table</code>ï¼Œ <code>table</code> ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ª <code>HashEntry</code> çš„å•å‘é˜Ÿåˆ—ã€‚æ¯”å¦‚ <code>table[3]</code> ä¸ºé¦–èŠ‚ç‚¹ï¼Œ<code>table[3]-&gt;next</code> ä¸ºèŠ‚ç‚¹ <code>1</code>ï¼Œä¹‹åä¸ºèŠ‚ç‚¹ <code>2</code>ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcurrentHashMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt;</span><span class="hljs-class">        <span class="hljs-keyword">implements</span> <span class="hljs-title">ConcurrentMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt;, <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-comment">// å°†æ•´ä¸ª hashmap åˆ†æˆå‡ ä¸ªå°çš„ mapï¼Œæ¯ä¸ª segment éƒ½æ˜¯ä¸€ä¸ªé”ï¼›ä¸ hashtable ç›¸æ¯”ï¼Œè¿™ä¹ˆè®¾è®¡çš„ç›®çš„æ˜¯å¯¹äº put, remove ç­‰æ“ä½œï¼Œå¯ä»¥å‡å°‘å¹¶å‘å†²çªï¼Œå¯¹</span>    <span class="hljs-comment">// ä¸å±äºåŒä¸€ä¸ªç‰‡æ®µçš„èŠ‚ç‚¹å¯ä»¥å¹¶å‘æ“ä½œï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½</span>    <span class="hljs-keyword">final</span> Segment&lt;K,V&gt;[] segments;    <span class="hljs-comment">// æœ¬è´¨ä¸Š Segment ç±»å°±æ˜¯ä¸€ä¸ªå°çš„ hashmapï¼Œé‡Œé¢ table æ•°ç»„å­˜å‚¨äº†å„ä¸ªèŠ‚ç‚¹çš„æ•°æ®ï¼Œç»§æ‰¿äº† ReentrantLock, å¯ä»¥ä½œä¸ºäº’æ–¥é”ä½¿ç”¨</span>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Segment</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;        <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;        <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> count;    &#125;    <span class="hljs-comment">// åŸºæœ¬èŠ‚ç‚¹ï¼Œå­˜å‚¨ Key, Value å€¼</span>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HashEntry</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; </span>&#123;        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> hash;        <span class="hljs-keyword">final</span> K key;        <span class="hljs-keyword">volatile</span> V value;        <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt; next;    &#125;&#125;</code></pre><h3 id="java-18-çš„å®ç°"><a class="markdownIt-Anchor" href="#java-18-çš„å®ç°"></a> Java 1.8 çš„å®ç°</h3><p><code>JDK 8</code> ä¸­ä¸»è¦åšäº† 2 æ–¹é¢çš„æ”¹è¿›</p><ul><li><p>å–æ¶ˆ <code>segments</code> å­—æ®µï¼Œç›´æ¥é‡‡ç”¨ <code>transient volatile HashEntry&lt;K,V&gt;[] table</code> ä¿å­˜æ•°æ®ï¼Œé‡‡ç”¨ <code>table</code> æ•°ç»„å…ƒç´ ä½œä¸ºé”ï¼Œä»è€Œå®ç°äº†å¯¹æ¯ä¸€è¡Œæ•°æ®è¿›è¡ŒåŠ é”ï¼Œè¿›ä¸€æ­¥å‡å°‘å¹¶å‘å†²çªçš„æ¦‚ç‡ã€‚</p></li><li><p>å°†åŸå…ˆ <strong>æ•°ç»„ï¼‹å•é“¾è¡¨</strong> çš„æ•°æ®ç»“æ„ï¼Œå˜æ›´ä¸º <strong>æ•°ç»„ï¼‹å•é“¾è¡¨ï¼‹çº¢é»‘æ ‘</strong> çš„ç»“æ„ã€‚å¯¹äº <code>hash</code> è¡¨æ¥è¯´ï¼Œæœ€æ ¸å¿ƒçš„èƒ½åŠ›åœ¨äºå°† <code>key hash</code> ä¹‹åèƒ½å‡åŒ€çš„åˆ†å¸ƒåœ¨æ•°ç»„ä¸­ã€‚å¦‚æœ <code>hash</code> ä¹‹åæ•£åˆ—çš„å¾ˆå‡åŒ€ï¼Œé‚£ä¹ˆ <code>table</code> æ•°ç»„ä¸­çš„æ¯ä¸ªé˜Ÿåˆ—é•¿åº¦ä¸»è¦ä¸º <code>0</code> æˆ–è€… <code>1</code>ã€‚ä½†å®é™…æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ç†æƒ³ï¼Œè™½ç„¶ <code>ConcurrentHashMap</code> ç±»é»˜è®¤çš„åŠ è½½å› å­ä¸º <code>0.75</code>ï¼Œä½†æ˜¯åœ¨æ•°æ®é‡è¿‡å¤§æˆ–è€…è¿æ°”ä¸ä½³çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ä¸€äº›é˜Ÿåˆ—é•¿åº¦è¿‡é•¿çš„æƒ…å†µï¼Œå¦‚æœè¿˜æ˜¯é‡‡ç”¨å•å‘åˆ—è¡¨æ–¹å¼ï¼Œé‚£ä¹ˆæŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code>ï¼›å› æ­¤ï¼Œå¯¹äºä¸ªæ•°è¶…è¿‡ <code>8</code>(é»˜è®¤å€¼)çš„åˆ—è¡¨ï¼Œ<code>JDK 1.8</code> ä¸­é‡‡ç”¨äº†çº¢é»‘æ ‘çš„ç»“æ„ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥é™ä½åˆ° <code>O(logN)</code>ï¼Œå¯ä»¥æ”¹è¿›æ€§èƒ½ã€‚</p></li></ul><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> V <span class="hljs-title">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;    <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span> || value == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();    <span class="hljs-keyword">int</span> hash = spread(key.hashCode());    <span class="hljs-keyword">int</span> binCount = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;        Node&lt;K,V&gt; f; <span class="hljs-keyword">int</span> n, i, fh;        <span class="hljs-comment">// å¦‚æœ table ä¸ºç©ºï¼Œåˆå§‹åŒ–ï¼›å¦åˆ™ï¼Œæ ¹æ® hash å€¼è®¡ç®—å¾—åˆ°æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœ tab[i] ä¸ºç©ºï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹ Node å³å¯ã€‚æ³¨ï¼štab[i] å®è´¨ä¸ºé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ã€‚</span>        <span class="hljs-keyword">if</span> (tab == <span class="hljs-keyword">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)            tab = initTable();        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-keyword">null</span>,                         <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="hljs-keyword">null</span>)))                <span class="hljs-keyword">break</span>;                   <span class="hljs-comment">// no lock when adding to empty bin</span>        &#125;        <span class="hljs-comment">// å¦‚æœ tab[i] ä¸ä¸ºç©ºå¹¶ä¸” hash å€¼ä¸º MOVEDï¼Œè¯´æ˜è¯¥é“¾è¡¨æ­£åœ¨è¿›è¡Œ transfer æ“ä½œï¼Œè¿”å›æ‰©å®¹å®Œæˆåçš„ tableã€‚</span>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)            tab = helpTransfer(tab, f);        <span class="hljs-keyword">else</span> &#123;            V oldVal = <span class="hljs-keyword">null</span>;            <span class="hljs-comment">// é’ˆå¯¹é¦–ä¸ªèŠ‚ç‚¹è¿›è¡ŒåŠ é”æ“ä½œï¼Œè€Œä¸æ˜¯ segmentï¼Œè¿›ä¸€æ­¥å‡å°‘çº¿ç¨‹å†²çª</span>            <span class="hljs-keyword">synchronized</span> (f) &#123;                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) &#123;                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) &#123;                        binCount = <span class="hljs-number">1</span>;                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;                            K ek;                            <span class="hljs-comment">// å¦‚æœåœ¨é“¾è¡¨ä¸­æ‰¾åˆ°å€¼ä¸º key çš„èŠ‚ç‚¹ eï¼Œç›´æ¥è®¾ç½® e.val = value å³å¯ã€‚</span>                            <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;                                ((ek = e.key) == key ||                                 (ek != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;                                oldVal = e.val;                                <span class="hljs-keyword">if</span> (!onlyIfAbsent)                                    e.val = value;                                <span class="hljs-keyword">break</span>;                            &#125;                            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å€¼ä¸º key çš„èŠ‚ç‚¹ï¼Œç›´æ¥æ–°å»º Node å¹¶åŠ å…¥é“¾è¡¨å³å¯ã€‚</span>                            Node&lt;K,V&gt; pred = e;                            <span class="hljs-keyword">if</span> ((e = e.next) == <span class="hljs-keyword">null</span>) &#123;                                pred.next = <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(hash, key,                                                          value, <span class="hljs-keyword">null</span>);                                <span class="hljs-keyword">break</span>;                            &#125;                        &#125;                    &#125;                    <span class="hljs-comment">// å¦‚æœé¦–èŠ‚ç‚¹ä¸º TreeBin ç±»å‹ï¼Œè¯´æ˜ä¸ºçº¢é»‘æ ‘ç»“æ„ï¼Œæ‰§è¡Œ utTreeVal æ“ä½œã€‚</span>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) &#123;                        Node&lt;K,V&gt; p;                        binCount = <span class="hljs-number">2</span>;                        <span class="hljs-keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,                                                       value)) != <span class="hljs-keyword">null</span>) &#123;                            oldVal = p.val;                            <span class="hljs-keyword">if</span> (!onlyIfAbsent)                                p.val = value;                        &#125;                    &#125;                &#125;            &#125;            <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) &#123;                <span class="hljs-comment">// å¦‚æœèŠ‚ç‚¹æ•° &gt;ï¼8ï¼Œé‚£ä¹ˆè½¬æ¢é“¾è¡¨ç»“æ„ä¸ºçº¢é»‘æ ‘ç»“æ„ã€‚</span>                <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)                    treeifyBin(tab, i);                <span class="hljs-keyword">if</span> (oldVal != <span class="hljs-keyword">null</span>)                    <span class="hljs-keyword">return</span> oldVal;                <span class="hljs-keyword">break</span>;            &#125;        &#125;    &#125;    <span class="hljs-comment">// è®¡æ•°å¢åŠ 1ï¼Œæœ‰å¯èƒ½è§¦å‘ transfer æ“ä½œ(æ‰©å®¹)ã€‚</span>    addCount(<span class="hljs-number">1L</span>, binCount);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;</code></pre><h1 id="copyonwritearraylist"><a class="markdownIt-Anchor" href="#copyonwritearraylist"></a> <code>CopyOnWriteArrayList</code></h1><p>æ¯ä¸ª <code>CopyOnWriteArrayList</code> å¯¹è±¡é‡Œæœ‰ä¸€ä¸ª <code>array</code> æ•°ç»„ç”¨æ¥å­˜æ”¾å…·ä½“å…ƒç´ ã€‚<code>ReentrantLock</code> ç‹¬å é”ç”¨æ¥ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹ <code>array</code> è¿›è¡Œä¿®æ”¹ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200724151232.png" srcset="/img/loading.gif" alt="" /></p><h2 id="è¦ç‚¹"><a class="markdownIt-Anchor" href="#è¦ç‚¹"></a> è¦ç‚¹</h2><ul><li><p>å¥½å¤„ï¼š<strong>ä»»ä½•çš„è¯»æ“ä½œéƒ½ä¸ç”¨åŠ é”</strong>ï¼Œè€Œä¸”ä¿è¯è¯»å–åˆ°çš„æ˜¯è¯»é‚£ä¸€åˆ» <code>List</code> å®Œæ•´çš„å¿«ç…§æ•°æ®ã€‚ç”±äºè¯»æ“ä½œæ— æ³•æ„ŸçŸ¥æœ€æ–°æ­£åœ¨å˜åŒ–çš„æ•°æ®ï¼Œæ‰€ä»¥ <code>CopyOnWriteArrayList</code> æ˜¯<strong>å¼±ä¸€è‡´æ€§</strong>çš„ã€‚</p></li><li><p>å†™æ—¶å¤åˆ¶æŠ€æœ¯å› ä¸ºæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦å®Œæ•´æ‹·è´ä¸€æ¬¡åº•å±‚æ•°ç»„ï¼Œæ‰€ä»¥æœ‰é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼Œä½†æ˜¯ç‰¹åˆ«é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„æ•°æ®è®¿é—®åœºæ™¯ã€‚</p></li></ul><h2 id="å¼±ä¸€è‡´æ€§é—®é¢˜"><a class="markdownIt-Anchor" href="#å¼±ä¸€è‡´æ€§é—®é¢˜"></a> å¼±ä¸€è‡´æ€§é—®é¢˜</h2><p>çº¿ç¨‹1åœ¨æ‰§è¡Œå®Œæ­¥éª¤ <code>A</code> åï¼Œæ‰§è¡Œæ­¥éª¤ <code>B</code> å‰ï¼Œçº¿ç¨‹2è¿›è¡Œäº† <code>remove</code> æ“ä½œã€‚<br />è™½ç„¶çº¿ç¨‹2å·²ç»åˆ é™¤äº† <code>index</code> å¤„çš„å…ƒç´ ï¼Œä½†ç”±äº <code>array</code>æŒ‡å‘çš„æ•°ç»„å¼•ç”¨è®¡æ•°ä¸º 1 è€Œä¸æ˜¯ 0ï¼Œä»ä¼šè¿”å› <code>index</code> å¤„çš„å…ƒç´ ã€‚</p><h2 id="æ·»åŠ å…ƒç´ "><a class="markdownIt-Anchor" href="#æ·»åŠ å…ƒç´ "></a> æ·»åŠ å…ƒç´ </h2><p>å…ˆå°†åŸå®¹å™¨ copy ä¸€ä»½ï¼Œç„¶ååœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œä¹‹åå†åˆ‡æ¢å¼•ç”¨ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123;    <span class="hljs-comment">// 1.è·å–ç‹¬å é”</span>    <span class="hljs-keyword">final</span> ReentrantLock lock = <span class="hljs-keyword">this</span>.lock;    lock.lock();    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">// 2.è·å– array æ•°ç»„</span>        Object[] elements = getArray();        <span class="hljs-keyword">int</span> len = elements.length;        <span class="hljs-comment">// 3.å¤åˆ¶ array åˆ°æ–°æ•°ç»„</span>        Object[] newElements = Arrays.copyOf(elements, len + <span class="hljs-number">1</span>);        <span class="hljs-comment">// 4.æ·»åŠ å…ƒç´ åˆ°æ–°æ•°ç»„</span>        newElements[len] = e;        <span class="hljs-comment">// 5.ç”¨æ–°æ•°ç»„æ›¿æ¢åŸæ•°ç»„</span>        setArray(newElements);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    &#125; <span class="hljs-keyword">finally</span> &#123;        <span class="hljs-comment">// 6.é‡Šæ”¾é”</span>        lock.unlock();    &#125;&#125;</code></pre><h2 id="åˆ é™¤å…ƒç´ "><a class="markdownIt-Anchor" href="#åˆ é™¤å…ƒç´ "></a> åˆ é™¤å…ƒç´ </h2><p>å°†é™¤è¦åˆ é™¤å…ƒç´ ä¹‹å¤–çš„å…¶ä»–å…ƒç´ æ‹·è´åˆ°æ–°å‰¯æœ¬ä¸­ï¼Œç„¶ååˆ‡æ¢å¼•ç”¨ï¼Œå°†åŸå®¹å™¨å¼•ç”¨æŒ‡å‘æ–°å‰¯æœ¬ã€‚åŒå±å†™æ“ä½œï¼Œéœ€è¦åŠ é”ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;    <span class="hljs-comment">// è·å–ç‹¬å é”</span>    <span class="hljs-keyword">final</span> ReentrantLock lock = <span class="hljs-keyword">this</span>.lock;    lock.lock();    <span class="hljs-keyword">try</span> &#123;        Object[] elements = getArray();        <span class="hljs-keyword">int</span> len = elements.length;        E oldValue = get(elements, index);        <span class="hljs-comment">// éœ€è¦ç§»åŠ¨çš„å…ƒç´ ä¸ªæ•°</span>        <span class="hljs-keyword">int</span> numMoved = len - index - <span class="hljs-number">1</span>;        <span class="hljs-comment">// è‹¥åˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ </span>        <span class="hljs-keyword">if</span> (numMoved == <span class="hljs-number">0</span>)           <span class="hljs-comment">// æ‹·è´å‰len-1ä¸ªæ•°æ®åˆ°æ–°å‰¯æœ¬ä¸Šï¼Œå†åˆ‡æ¢å¼•ç”¨</span>           setArray(Arrays.copyOf(elements, len - <span class="hljs-number">1</span>));        <span class="hljs-keyword">else</span> &#123;            Object[] newElements = <span class="hljs-keyword">new</span> Object[len - <span class="hljs-number">1</span>];            <span class="hljs-comment">// åˆ†ä¸¤å—å¤åˆ¶åˆ°æ–°æ•°ç»„</span>            System.arraycopy(elements, <span class="hljs-number">0</span>, newElements, <span class="hljs-number">0</span>, index);            System.arraycopy(elements, index + <span class="hljs-number">1</span>, newElements, index,                             numMoved);            <span class="hljs-comment">// è®¾ç½®æ–°æ•°ç»„</span>            setArray(newElements);        &#125;        <span class="hljs-keyword">return</span> oldValue;    &#125; <span class="hljs-keyword">finally</span> &#123;        <span class="hljs-comment">// é‡Šæ”¾é”</span>        lock.unlock();    &#125;&#125;</code></pre><h2 id="è¯»æ“ä½œ"><a class="markdownIt-Anchor" href="#è¯»æ“ä½œ"></a> è¯»æ“ä½œ</h2><p><code>E get(int index)</code><br />è¯»æ“ä½œæ˜¯ä¸ç”¨åŠ é”çš„ï¼Œæ€§èƒ½å¾ˆé«˜ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;    <span class="hljs-keyword">return</span> get(getArray(), index);&#125;<span class="hljs-comment">// A.è·å– array æ•°ç»„</span><span class="hljs-keyword">final</span> Object[] getArray() &#123;    <span class="hljs-keyword">return</span> array;&#125;<span class="hljs-comment">// B.é€šè¿‡ä¸‹æ ‡è®¿é—®æŒ‡å®šä½ç½®çš„æ•°ç»„å…ƒç´ </span><span class="hljs-function"><span class="hljs-keyword">private</span> E <span class="hljs-title">get</span><span class="hljs-params">(Object[] a, <span class="hljs-keyword">int</span> index)</span> </span>&#123;    <span class="hljs-keyword">return</span> (E) a[index];&#125;</code></pre><h2 id="ä¿®æ”¹æŒ‡å®šå…ƒç´ "><a class="markdownIt-Anchor" href="#ä¿®æ”¹æŒ‡å®šå…ƒç´ "></a> ä¿®æ”¹æŒ‡å®šå…ƒç´ </h2><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>&#123;    <span class="hljs-comment">// è·å–ç‹¬å é”</span>    <span class="hljs-keyword">final</span> ReentrantLock lock = <span class="hljs-keyword">this</span>.lock;    lock.lock();    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">// è·å– array æ•°ç»„</span>        Object[] elements = getArray();        <span class="hljs-comment">// æ‰¾åˆ°åŸä½ç½®ä¸Šçš„å€¼</span>        E oldValue = get(elements, index);        <span class="hljs-keyword">if</span> (oldValue != element) &#123;            <span class="hljs-keyword">int</span> len = elements.length;            <span class="hljs-comment">// å¤åˆ¶ array åˆ°æ–°æ•°ç»„</span>            Object[] newElements = Arrays.copyOf(elements, len);            <span class="hljs-comment">// è®¾ç½® index ä½ç½®çš„å…ƒç´ </span>            newElements[index] = element;            <span class="hljs-comment">// ç”¨æ–°æ•°ç»„æ›¿æ¢æ—§æ•°ç»„</span>            setArray(newElements);        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// Not quite a no-op; ensures volatile write semantics</span>            setArray(elements);        &#125;        <span class="hljs-keyword">return</span> oldValue;    &#125; <span class="hljs-keyword">finally</span> &#123;        <span class="hljs-comment">// é‡Šæ”¾é”</span>        lock.unlock();    &#125;&#125;</code></pre><h1 id="blockingqueue"><a class="markdownIt-Anchor" href="#blockingqueue"></a> <code>BlockingQueue</code></h1><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BlockingQueue</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Queue</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;&#125;</code></pre><p>åœ¨ <code>BlockingQueue</code> ä¸­ï¼Œå¦‚æœè·å–é˜Ÿåˆ—å…ƒç´ ä½†æ˜¯é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¼šé˜»å¡ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ å†è¿”å›ï¼›å¦‚æœæ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆç­‰åˆ°é˜Ÿåˆ—å¯ä»¥æ”¾å…¥æ–°å…ƒç´ æ—¶å†æ”¾å…¥ã€‚</p><p><code>BlockingQueue</code> å¯¹æ’å…¥æ“ä½œã€ç§»é™¤æ“ä½œã€è·å–å…ƒç´ æ“ä½œæä¾›äº†å››ç§ä¸åŒçš„æ–¹æ³•ç”¨äºä¸åŒçš„åœºæ™¯ä¸­ä½¿ç”¨ï¼š</p><p>æŠ›å‡ºå¼‚å¸¸ï¼›</p><ul><li>è¿”å›ç‰¹æ®Šå€¼ï¼ˆ<code>null</code> æˆ– <code>true</code>/<code>false</code>ï¼Œå–å†³äºå…·ä½“çš„æ“ä½œï¼‰ï¼›</li><li>é˜»å¡ç­‰å¾…æ­¤æ“ä½œï¼Œç›´åˆ°è¿™ä¸ªæ“ä½œæˆåŠŸï¼›</li><li>é˜»å¡ç­‰å¾…æ­¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸæˆ–è€…è¶…æ—¶æŒ‡å®šæ—¶é—´ã€‚<br />æ€»ç»“å¦‚ä¸‹ï¼š</li></ul><table><thead><tr><th style="text-align:center">Operation</th><th style="text-align:center">Throws exception</th><th style="text-align:center">Special value</th><th style="text-align:center">Blocks</th><th style="text-align:center">Times out</th></tr></thead><tbody><tr><td style="text-align:center">Insert</td><td style="text-align:center">add(e)</td><td style="text-align:center">offer(e)</td><td style="text-align:center">put(e)</td><td style="text-align:center">offer(e, time, unit)</td></tr><tr><td style="text-align:center">Remove</td><td style="text-align:center">remove()</td><td style="text-align:center">poll()</td><td style="text-align:center">take()</td><td style="text-align:center">poll(time, unit)</td></tr><tr><td style="text-align:center">Examine</td><td style="text-align:center">element()</td><td style="text-align:center">peek()</td><td style="text-align:center">not applicable</td><td style="text-align:center">not applicable</td></tr></tbody></table><p><code>BlockingQueue</code> çš„å„ä¸ªå®ç°ç±»éƒ½éµå¾ªäº†è¿™äº›è§„åˆ™ã€‚</p><p><code>BlockingQueue</code> ä¸æ¥å— <code>null</code> å€¼å…ƒç´ ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
      <tag>å®¹å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¹¶å‘-åŸå­ç±»</title>
    <link href="/2020/07/21/concurrent-atomic/"/>
    <url>/2020/07/21/concurrent-atomic/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h1><h2 id="ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»"><a class="markdownIt-Anchor" href="#ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»"></a> ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»</h2><p>ä¿è¯çº¿ç¨‹å®‰å…¨æ˜¯ <code>Java</code> å¹¶å‘ç¼–ç¨‹å¿…é¡»è¦è§£å†³çš„é‡è¦é—®é¢˜ã€‚<code>Java</code> ä»åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§è¿™ä¸‰å¤§ç‰¹æ€§å…¥æ‰‹ï¼Œç¡®ä¿å¤šçº¿ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><ul><li><p>ç¡®ä¿çº¿ç¨‹å®‰å…¨æœ€å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨é”æœºåˆ¶ï¼ˆ<code>Lock</code>ã€<code>sychronized</code>ï¼‰æ¥å¯¹å…±äº«æ•°æ®åšäº’æ–¥åŒæ­¥ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—ï¼Œé‚£ä¹ˆæ“ä½œå¿…ç„¶æ˜¯åŸå­æ€§çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</p></li><li><p><code>volatile</code> æ˜¯è½»é‡çº§çš„é”ï¼ˆè‡ªç„¶æ¯”æ™®é€šé”æ€§èƒ½è¦å¥½ï¼‰ï¼Œå®ƒä¿è¯äº†å…±äº«å˜é‡åœ¨å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§ï¼Œä½†æ— æ³•ä¿è¯åŸå­æ€§ã€‚æ‰€ä»¥ï¼Œå®ƒåªèƒ½åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p></li><li><p>ä¸ºäº†å…¼é¡¾åŸå­æ€§ä»¥åŠé”å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œ<code>Java</code> å¼•å…¥äº† <code>CAS</code> ï¼ˆä¸»è¦ä½“ç°åœ¨ Unsafe ç±»ï¼‰æ¥å®ç°éé˜»å¡åŒæ­¥ï¼ˆä¹Ÿå«ä¹è§‚é”ï¼‰ã€‚å¹¶åŸºäº <code>CAS</code> ï¼Œæä¾›äº†ä¸€å¥—åŸå­å·¥å…·ç±»ã€‚</p></li></ul><h2 id="åŸå­å˜é‡ç±»çš„ä½œç”¨"><a class="markdownIt-Anchor" href="#åŸå­å˜é‡ç±»çš„ä½œç”¨"></a> åŸå­å˜é‡ç±»çš„ä½œç”¨</h2><p>åŸå­å˜é‡ç±» <strong>æ¯”é”çš„ç²’åº¦æ›´ç»†ï¼Œæ›´è½»é‡çº§</strong>ï¼Œå¹¶ä¸”å¯¹äºåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šå®ç°é«˜æ€§èƒ½çš„å¹¶å‘ä»£ç æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ã€‚åŸå­å˜é‡å°†å‘ç”Ÿç«äº‰çš„èŒƒå›´ç¼©å°åˆ°å•ä¸ªå˜é‡ä¸Šã€‚</p><p>åŸå­å˜é‡ç±»ç›¸å½“äºä¸€ç§æ³›åŒ–çš„ <code>volatile</code> å˜é‡ï¼Œèƒ½å¤Ÿæ”¯æŒ<strong>åŸå­çš„ã€æœ‰æ¡ä»¶çš„è¯»/æ”¹/å†™</strong>æ“ä½œã€‚</p><p>åŸå­ç±»åœ¨å†…éƒ¨ä½¿ç”¨ <code>CAS</code> æŒ‡ä»¤ï¼ˆåŸºäºç¡¬ä»¶çš„æ”¯æŒï¼‰æ¥å®ç°åŒæ­¥ã€‚è¿™äº›æŒ‡ä»¤é€šå¸¸æ¯”é”æ›´å¿«ã€‚</p><p>åŸå­å˜é‡ç±»å¯ä»¥åˆ†ä¸º <code>4</code> ç»„ï¼š</p><ul><li>åŸºæœ¬ç±»å‹<ul><li><code>AtomicBoolean</code> - å¸ƒå°”ç±»å‹åŸå­ç±»</li><li><code>AtomicInteger</code> - æ•´å‹åŸå­ç±»</li><li><code>AtomicLong</code> - é•¿æ•´å‹åŸå­ç±»</li></ul></li><li>å¼•ç”¨ç±»å‹<ul><li><code>AtomicReference</code> - å¼•ç”¨ç±»å‹åŸå­ç±»</li><li><code>AtomicMarkableReference</code> - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li><li><code>AtomicStampedReference</code> - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li></ul></li><li>æ•°ç»„ç±»å‹<ul><li><code>AtomicIntegerArray</code> - æ•´å½¢æ•°ç»„åŸå­ç±»</li><li><code>AtomicLongArray</code> - é•¿æ•´å‹æ•°ç»„åŸå­ç±»</li><li><code>AtomicReferenceArray</code> - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li></ul></li><li>å±æ€§æ›´æ–°å™¨ç±»å‹<ul><li><code>AtomicIntegerFieldUpdater</code> - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li><li><code>AtomicLongFieldUpdater</code> - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li><li><code>AtomicReferenceFieldUpdater</code> - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</li></ul></li></ul><h1 id="åŸºæœ¬ç±»å‹"><a class="markdownIt-Anchor" href="#åŸºæœ¬ç±»å‹"></a> åŸºæœ¬ç±»å‹</h1><p>è¿™ä¸€ç±»å‹çš„åŸå­ç±»æ˜¯é’ˆå¯¹ <code>Java</code> åŸºæœ¬ç±»å‹è¿›è¡Œæ“ä½œã€‚</p><ul><li><p><code>AtomicBoolean</code> - å¸ƒå°”ç±»å‹åŸå­ç±»</p></li><li><p><code>AtomicInteger</code> - æ•´å‹åŸå­ç±»</p></li><li><p><code>AtomicLong</code> - é•¿æ•´å‹åŸå­ç±»</p></li></ul><p>ä»¥ä¸Šç±»éƒ½æ”¯æŒ <code>CAS</code>ï¼Œæ­¤å¤–ï¼Œ<code>AtomicInteger</code>ã€<code>AtomicLong</code> è¿˜æ”¯æŒç®—æœ¯è¿ç®—ã€‚</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-comment">// è·å–å½“å‰å€¼</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAndSet</span><span class="hljs-params">(<span class="hljs-keyword">int</span> newValue)</span> <span class="hljs-comment">// è·å–å½“å‰å€¼ï¼Œå¹¶è®¾ç½®æ–°å€¼</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAndIncrement</span><span class="hljs-params">()</span><span class="hljs-comment">// è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå¢</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAndDecrement</span><span class="hljs-params">()</span> <span class="hljs-comment">// è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå‡</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAndAdd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> delta)</span> <span class="hljs-comment">// è·å–å½“å‰å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸå€¼</span></span><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">compareAndSet</span><span class="hljs-params">(<span class="hljs-keyword">int</span> expect, <span class="hljs-keyword">int</span> update)</span> <span class="hljs-comment">// å¦‚æœè¾“å…¥å€¼ï¼ˆupdateï¼‰ç­‰äºé¢„æœŸå€¼ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼</span></span><span class="hljs-function"><span class="hljs-comment">// æœ€ç»ˆè®¾ç½®ä¸º newValueï¼Œä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lazySet</span><span class="hljs-params">(<span class="hljs-keyword">int</span> newValue)</span></span></code></pre><h1 id="å¼•ç”¨ç±»å‹"><a class="markdownIt-Anchor" href="#å¼•ç”¨ç±»å‹"></a> å¼•ç”¨ç±»å‹</h1><ul><li><p><code>AtomicReference</code> - å¼•ç”¨ç±»å‹åŸå­ç±»</p></li><li><p><code>AtomicMarkableReference</code> - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»</p></li><li><p><code>AtomicStampedReference</code> - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»</p></li></ul><blockquote><p><code>AtomicStampedReference</code> ç±»åœ¨å¼•ç”¨ç±»å‹åŸå­ç±»ä¸­ï¼Œå½»åº•åœ°è§£å†³äº† <code>ABA</code> é—®é¢˜ï¼Œå…¶å®ƒçš„ <code>CAS</code> èƒ½åŠ›ä¸å¦å¤–ä¸¤ä¸ªç±»ç›¸è¿‘ï¼Œæ‰€ä»¥æœ€å…·ä»£è¡¨æ€§ã€‚å› æ­¤ï¼Œæœ¬èŠ‚åªé’ˆå¯¹ <code>AtomicStampedReference</code> è¿›è¡Œè¯´æ˜ã€‚</p></blockquote><h2 id="atomicreference"><a class="markdownIt-Anchor" href="#atomicreference"></a> AtomicReference</h2><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åŸºäº AtomicReference å®ç°è‡ªæ—‹é”</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : AtomicRefTest.java 2020/07/21 Tue 4:00 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicRefTest</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> ticket = <span class="hljs-number">10</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpinLock lock = <span class="hljs-keyword">new</span> SpinLock();        ExecutorService executorService = Executors.newFixedThreadPool(<span class="hljs-number">3</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;            executorService.execute(<span class="hljs-keyword">new</span> MyThread(lock));        &#125;        executorService.shutdown();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * SpinLock</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpinLock</span> </span>&#123;        <span class="hljs-keyword">private</span> AtomicReference&lt;Thread&gt; atomicReference = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;();        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;            Thread current = Thread.currentThread();            <span class="hljs-comment">// è‡ªæ—‹ï¼Œä¸ºå½“å‰çº¿ç¨‹åŠ é”</span>            <span class="hljs-keyword">while</span> (!atomicReference.compareAndSet(<span class="hljs-keyword">null</span>, current)) &#123;            &#125;        &#125;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;            Thread current = Thread.currentThread();            <span class="hljs-comment">// åªæœ‰å½“å‰çº¿ç¨‹æ‰é‡Šæ”¾é”</span>            atomicReference.compareAndSet(current, <span class="hljs-keyword">null</span>);        &#125;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * sell ticket by spin lock</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;        <span class="hljs-keyword">private</span> SpinLock lock;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyThread</span><span class="hljs-params">(SpinLock lock)</span> </span>&#123;            <span class="hljs-keyword">this</span>.lock = lock;        &#125;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-keyword">while</span> (ticket &gt; <span class="hljs-number">0</span>) &#123;                lock.lock();                <span class="hljs-keyword">if</span> (ticket &gt; <span class="hljs-number">0</span>) &#123;                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" sell ticket "</span> + ticket);                    ticket--;                &#125;                lock.unlock();            &#125;        &#125;            &#125;&#125;</code></pre><h2 id="atomicmarkablereference"><a class="markdownIt-Anchor" href="#atomicmarkablereference"></a> AtomicMarkableReference</h2><p>åŸå­ç±»çš„å®ç°åŸºäº <code>CAS</code> æœºåˆ¶ï¼Œè€Œ <code>CAS</code> å­˜åœ¨ <code>ABA</code> é—®é¢˜ã€‚æ­£æ˜¯ä¸ºäº†è§£å†³ <code>ABA</code> é—®é¢˜ï¼Œæ‰æœ‰äº† <code>AtomicMarkableReference</code> å’Œ <code>AtomicStampedReference</code>ã€‚</p><p><code>AtomicMarkableReference</code> ä½¿ç”¨ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºæ ‡è®°ï¼Œä¿®æ”¹æ—¶åœ¨ <code>true</code> / <code>false</code> ä¹‹é—´åˆ‡æ¢ã€‚è¿™ç§ç­–ç•¥ä¸èƒ½æ ¹æœ¬ä¸Šè§£å†³ <code>ABA</code> é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é™ä½ <code>ABA</code> å‘ç”Ÿçš„å‡ ç‡ã€‚å¸¸ç”¨äºç¼“å­˜æˆ–è€…çŠ¶æ€æè¿°è¿™æ ·çš„åœºæ™¯ã€‚</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * AtomicMarkableReference ä½¿ç”¨</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : AtomicMarkableRefTest.java 2020/07/21 Tue 4:32 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicMarkableRefTest</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String INIT_TEXT = <span class="hljs-string">"abc"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        <span class="hljs-keyword">final</span> AtomicMarkableReference&lt;String&gt; amr = <span class="hljs-keyword">new</span> AtomicMarkableReference&lt;&gt;(INIT_TEXT, <span class="hljs-keyword">false</span>);        ExecutorService executorService = Executors.newFixedThreadPool(<span class="hljs-number">3</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;            executorService.submit(() -&gt; &#123;                <span class="hljs-keyword">try</span> &#123;                    Thread.sleep(Math.abs((<span class="hljs-keyword">int</span>) Math.random() * <span class="hljs-number">100</span>));                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;                String name = Thread.currentThread().getName(); Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è‹¥å˜é‡ä¸º INIT &amp;&amp; å·²è¢«æ ‡è®°ï¼Œåˆ™ä¿®æ”¹</span> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (amr.compareAndSet(INIT_TEXT, name, amr.isMarked(), !amr.isMarked())) &#123; Â  Â  Â  Â  Â  Â  Â  Â String name = Thread.currentThread().getName();                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" ä¿®æ”¹äº†å¯¹è±¡"</span>);                    System.out.println(<span class="hljs-string">"æ–°çš„å¯¹è±¡ä¸ºï¼š"</span> + amr.getReference());                &#125;            &#125;);        &#125;        executorService.shutdown();        executorService.awaitTermination(<span class="hljs-number">3</span>, TimeUnit.SECONDS);    &#125;&#125;</code></pre><h2 id="atomicstampedreference"><a class="markdownIt-Anchor" href="#atomicstampedreference"></a> AtomicStampedReference</h2><p><code>AtomicStampedReference</code> ä½¿ç”¨ä¸€ä¸ªæ•´å‹å€¼åšä¸ºç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°å‰å…ˆæ¯”è¾ƒç‰ˆæœ¬å·ï¼Œå¦‚æœä¸€è‡´ï¼Œæ‰è¿›è¡Œä¿®æ”¹ã€‚é€šè¿‡è¿™ç§ç­–ç•¥ï¼Œå¯ä»¥æ ¹æœ¬ä¸Šè§£å†³ <code>ABA</code> é—®é¢˜ã€‚</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * AtomicStampedReference ä½¿ç”¨</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : AtomicStampedRefTest.java 2020/07/21 Tue 7:02 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicStampedRefTest</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String INIT_REF = <span class="hljs-string">"pool-1-thread-3"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> AtomicStampedReference&lt;String&gt; asr = <span class="hljs-keyword">new</span> AtomicStampedReference&lt;&gt;(INIT_REF, <span class="hljs-number">0</span>);    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        System.out.println(<span class="hljs-string">"åˆå§‹å¯¹è±¡ä¸º: "</span> + asr.getReference());        ExecutorService executorService = Executors.newFixedThreadPool(<span class="hljs-number">3</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;            executorService.submit(() -&gt; &#123;                <span class="hljs-keyword">try</span> &#123;                    Thread.sleep(Math.abs((<span class="hljs-keyword">int</span>) Math.random() * <span class="hljs-number">100</span>));                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                    e.printStackTrace();                &#125;                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> stamp = asr.getStamp();                String name = Thread.currentThread().getName(); Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è‹¥å˜é‡ä¸º INIT &amp;&amp; ç‰ˆæœ¬å·ä¸º stampï¼Œåˆ™ä¿®æ”¹</span>                <span class="hljs-keyword">if</span> (asr.compareAndSet(INIT_REF, name, stamp, stamp + <span class="hljs-number">1</span>)) &#123;                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" ä¿®æ”¹äº†å¯¹è±¡"</span>);                    System.out.println(<span class="hljs-string">"æ–°çš„å¯¹è±¡ä¸ºï¼š"</span> + asr.getReference());                &#125;            &#125;);        &#125;        executorService.shutdown();        executorService.awaitTermination(<span class="hljs-number">3</span>, TimeUnit.SECONDS);    &#125;&#125;</code></pre><h1 id="æ•°ç»„ç±»å‹"><a class="markdownIt-Anchor" href="#æ•°ç»„ç±»å‹"></a> æ•°ç»„ç±»å‹</h1><ul><li><p><code>AtomicIntegerArray</code> - æ•´å½¢æ•°ç»„åŸå­ç±»</p></li><li><p><code>AtomicLongArray</code> - é•¿æ•´å‹æ•°ç»„åŸå­ç±»</p></li><li><p><code>AtomicReferenceArray</code> - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</p></li></ul><p>æ•°ç»„ç±»å‹çš„åŸå­ç±»ä¸º <strong>æ•°ç»„å…ƒç´ </strong> æä¾›äº† <code>volatile</code> ç±»å‹çš„è®¿é—®è¯­ä¹‰ï¼Œè¿™æ˜¯æ™®é€šæ•°ç»„æ‰€ä¸å…·å¤‡çš„ç‰¹æ€§ â€”â€” <code>volatile</code> ç±»å‹çš„æ•°ç»„ä»…åœ¨<strong>æ•°ç»„å¼•ç”¨</strong>ä¸Šå…·æœ‰ <code>volatile</code> è¯­ä¹‰ã€‚</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * AtomicIntegerArray ä½¿ç”¨</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : AtomicIntegerArrayTest.java 2020/07/21 Tue 7:17 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicIntegerArrayTest</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AtomicIntegerArray atomicIntegerArray = <span class="hljs-keyword">new</span> AtomicIntegerArray(<span class="hljs-number">10</span>);    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;        System.out.println(<span class="hljs-string">"Init Values: "</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; atomicIntegerArray.length(); i++) &#123;            atomicIntegerArray.set(i, i);            System.out.print(atomicIntegerArray.get(i) + <span class="hljs-string">" "</span>);        &#125;        System.out.println();        Thread t1 = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Increasement());        Thread t2 = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Compare());        t1.start();        t2.start();        t1.join();        t2.join();        System.out.println(<span class="hljs-string">"Final Values: "</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; atomicIntegerArray.length(); i++) &#123;            System.out.print(atomicIntegerArray.get(i) + <span class="hljs-string">" "</span>);        &#125;        System.out.println();    &#125;    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Increasement</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123; Â  Â  Â   <span class="hljs-comment">// å¯¹æ•°ç»„çš„æ¯ä¸ªå…ƒç´ è‡ªå¢ 1</span> Â  Â  Â  Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; atomicIntegerArray.length(); i++) &#123;                <span class="hljs-keyword">int</span> value = atomicIntegerArray.incrementAndGet(i);                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">", index = "</span> + i + <span class="hljs-string">", value = "</span> + value);            &#125;        &#125;    &#125;    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Compare</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123; Â  Â  Â   <span class="hljs-comment">// æ‰¾åˆ°æ•°ç»„å€¼ä¸º 2 çš„å…ƒç´ ï¼Œä¿®æ”¹ä¸º 3</span> Â  Â  Â  Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; atomicIntegerArray.length(); i++) &#123;                <span class="hljs-keyword">boolean</span> swapped = atomicIntegerArray.compareAndSet(i, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);                <span class="hljs-keyword">if</span> (swapped) &#123;                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" swapped, index = "</span> + i + <span class="hljs-string">", value = 3"</span>);                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><h1 id="å±æ€§æ›´æ–°å™¨ç±»å‹"><a class="markdownIt-Anchor" href="#å±æ€§æ›´æ–°å™¨ç±»å‹"></a> å±æ€§æ›´æ–°å™¨ç±»å‹</h1><p>æ›´æ–°å™¨ç±»æ”¯æŒåŸºäº<strong>åå°„</strong>æœºåˆ¶çš„æ›´æ–°å­—æ®µå€¼çš„åŸå­æ“ä½œã€‚</p><ul><li><p><code>AtomicIntegerFieldUpdater</code> - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</p></li><li><p><code>AtomicLongFieldUpdater</code> - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</p></li><li><p><code>AtomicReferenceFieldUpdater</code> - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</p></li></ul><p>è¿™äº›ç±»çš„ä½¿ç”¨æœ‰ä¸€å®šé™åˆ¶ï¼š</p><ul><li>å› ä¸ºå¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä½¿ç”¨é™æ€æ–¹æ³• <code>newUpdater()</code> åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®æƒ³è¦æ›´æ–°çš„ç±»å’Œå±æ€§ã€‚</li><li>å­—æ®µå¿…é¡»æ˜¯ <code>volatile</code> ç±»å‹çš„ï¼›</li><li>ä¸èƒ½ä½œç”¨äºé™æ€å˜é‡ï¼ˆ<code>static</code>ï¼‰ï¼›</li><li>ä¸èƒ½ä½œç”¨äºå¸¸é‡ï¼ˆ<code>final</code>ï¼‰ï¼›</li></ul><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * AtomicReferenceFieldUpdater ä½¿ç”¨</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> likailee.llk</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> : AtomicFieldUpdaterTest.java 2020/07/21 Tue 7:33 PM likai</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicFieldUpdaterTest</span> </span>&#123;    <span class="hljs-keyword">static</span> User user = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"begin"</span>);    <span class="hljs-keyword">static</span> AtomicReferenceFieldUpdater&lt;User, String&gt; updater =            AtomicReferenceFieldUpdater.newUpdater(User.class, String.class, "name");    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        ExecutorService executorService = Executors.newFixedThreadPool(<span class="hljs-number">3</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;            executorService.submit(() -&gt; &#123; Â  Â  Â  Â  Â   <span class="hljs-comment">// è‹¥ name çš„å€¼ä¸º â€beginâ€œï¼Œåˆ™ä¿®æ”¹ä¸º â€œendâ€œ</span> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (updater.compareAndSet(user, <span class="hljs-string">"begin"</span>, <span class="hljs-string">"end"</span>)) &#123;                    <span class="hljs-keyword">try</span> &#123;                        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                        e.printStackTrace();                    &#125;                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" å·²ä¿®æ”¹ name = "</span> + user.getName());                &#125; <span class="hljs-keyword">else</span> &#123;                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹"</span>);                &#125;            &#125;);        &#125;        executorService.shutdown();    &#125;    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;        <span class="hljs-keyword">volatile</span> String name;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String name)</span> </span>&#123;            <span class="hljs-keyword">this</span>.name = name;        &#125;        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-keyword">return</span> name;        &#125;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;            <span class="hljs-keyword">this</span>.name = name;        &#125;    &#125;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å¹¶å‘-é”åŸç†</title>
    <link href="/2020/07/17/concurrent-lock/"/>
    <url>/2020/07/17/concurrent-lock/</url>
    
    <content type="html"><![CDATA[<h1 id="å¹¶å‘é”"><a class="markdownIt-Anchor" href="#å¹¶å‘é”"></a> å¹¶å‘é”</h1><h2 id="ä¹è§‚é”å’Œæ‚²è§‚é”"><a class="markdownIt-Anchor" href="#ä¹è§‚é”å’Œæ‚²è§‚é”"></a> ä¹è§‚é”å’Œæ‚²è§‚é”</h2><p>ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä¸¤ç§æ€æƒ³ï¼Œç”¨äºè§£å†³å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚</p><h3 id="ä¹è§‚é”"><a class="markdownIt-Anchor" href="#ä¹è§‚é”"></a> ä¹è§‚é”</h3><p>ä¹è§‚é”åœ¨æ“ä½œæ•°æ®æ—¶éå¸¸ä¹è§‚ï¼Œè®¤ä¸ºåˆ«äººä¸ä¼šåŒæ—¶ä¿®æ”¹æ•°æ®ã€‚å› æ­¤<strong>ä¹è§‚é”ä¸ä¼šä¸Šé”</strong>ï¼Œåªæ˜¯åœ¨æ‰§è¡Œæ›´æ–°çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæ˜¯å¦ä¿®æ”¹äº†æ•°æ®ï¼šå¦‚æœåˆ«äººä¿®æ”¹äº†æ•°æ®åˆ™æ”¾å¼ƒæ“ä½œï¼Œå¦åˆ™æ‰§è¡Œæ“ä½œã€‚</p><h4 id="å®ç°æ–¹å¼"><a class="markdownIt-Anchor" href="#å®ç°æ–¹å¼"></a> å®ç°æ–¹å¼</h4><ol><li><code>CAS</code> æœºåˆ¶</li></ol><p><code>CAS</code> æ“ä½œåŒ…æ‹¬äº† 3 ä¸ªæ“ä½œæ•°ï¼š<br />(1) éœ€è¦è¯»å†™çš„å†…å­˜ä½ç½®(<code>V</code>)<br />(2) è¿›è¡Œæ¯”è¾ƒçš„é¢„æœŸå€¼(<code>A</code>)<br />(3) æ‹Ÿå†™å…¥çš„æ–°å€¼(<code>B</code>)</p><p><code>CAS</code> æ“ä½œé€»è¾‘å¦‚ä¸‹ï¼šå¦‚æœå†…å­˜ä½ç½® <code>V</code> çš„å€¼ç­‰äºé¢„æœŸçš„ <code>A</code> å€¼ï¼Œåˆ™å°†è¯¥ä½ç½®æ›´æ–°ä¸ºæ–°å€¼ <code>B</code>ï¼Œå¦åˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚è®¸å¤š <code>CAS</code> çš„æ“ä½œæ˜¯è‡ªæ—‹çš„ï¼šå¦‚æœæ“ä½œä¸æˆåŠŸï¼Œä¼šä¸€ç›´é‡è¯•ï¼Œç›´åˆ°æ“ä½œæˆåŠŸä¸ºæ­¢ã€‚</p><blockquote><p><code>CAS</code> æ˜¯ç”± <code>CPU</code> æ”¯æŒçš„åŸå­æ“ä½œï¼Œå…¶åŸå­æ€§æ˜¯åœ¨ç¡¬ä»¶å±‚é¢è¿›è¡Œä¿è¯çš„ã€‚</p></blockquote><ol start="2"><li>ç‰ˆæœ¬å·æœºåˆ¶<br />ç‰ˆæœ¬å·æœºåˆ¶çš„åŸºæœ¬æ€è·¯æ˜¯åœ¨æ•°æ®ä¸­å¢åŠ ä¸€ä¸ªå­—æ®µ <code>version</code>ï¼Œè¡¨ç¤ºè¯¥æ•°æ®çš„ç‰ˆæœ¬å·ï¼Œæ¯å½“æ•°æ®è¢«ä¿®æ”¹ï¼Œç‰ˆæœ¬å· <code>+1</code>ã€‚</li></ol><ul><li>å½“æŸä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå°†è¯¥æ•°æ®çš„ç‰ˆæœ¬å·ä¸€èµ·æŸ¥å‡ºæ¥ï¼›</li><li>å½“è¯¥çº¿ç¨‹æ›´æ–°æ•°æ®æ—¶ï¼Œåˆ¤æ–­å½“å‰ç‰ˆæœ¬å·ä¸ä¹‹å‰è¯»å–çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´æ‰è¿›è¡Œæ“ä½œã€‚</li></ul><h3 id="æ‚²è§‚é”"><a class="markdownIt-Anchor" href="#æ‚²è§‚é”"></a> æ‚²è§‚é”</h3><p>æ‚²è§‚é”åœ¨æ“ä½œæ•°æ®æ—¶æ¯”è¾ƒæ‚²è§‚ï¼Œè®¤ä¸ºåˆ«äººä¼šåŒæ—¶ä¿®æ”¹æ•°æ®ã€‚å› æ­¤æ“ä½œæ•°æ®æ—¶ç›´æ¥æŠŠæ•°æ®é”ä½ï¼Œç›´åˆ°æ“ä½œå®Œæˆåæ‰ä¼šé‡Šæ”¾é”ï¼›ä¸Šé”æœŸé—´å…¶ä»–äººä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚</p><h4 id="å®ç°æ–¹å¼-2"><a class="markdownIt-Anchor" href="#å®ç°æ–¹å¼-2"></a> å®ç°æ–¹å¼</h4><p>æ‚²è§‚é”çš„å®ç°æ–¹å¼æ˜¯<strong>åŠ é”</strong>ï¼ŒåŠ é”æ—¢å¯ä»¥æ˜¯å¯¹<strong>ä»£ç å—åŠ é”</strong>ï¼ˆå¦‚ <code>Java</code>çš„ <code>synchronized</code> å…³é”®å­—å’Œ <code>Lock</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹<strong>æ•°æ®åŠ é”</strong>ï¼ˆå¦‚ <code>MySQL</code> ä¸­çš„æ’å®ƒé”ï¼‰ã€‚</p><h2 id="å…¬å¹³é”ä¸éå…¬å¹³é”"><a class="markdownIt-Anchor" href="#å…¬å¹³é”ä¸éå…¬å¹³é”"></a> å…¬å¹³é”ä¸éå…¬å¹³é”</h2><p>æ ¹æ®çº¿ç¨‹è·å–é”çš„æŠ¢å æœºåˆ¶ï¼Œé”å¯åˆ†ä¸ºå…¬å¹³é”ä¸éå…¬å¹³é”ã€‚</p><ul><li>å…¬å¹³é”è¡¨ç¤ºçº¿ç¨‹è·å–é”çš„é¡ºåºæ˜¯æŒ‰ç…§çº¿ç¨‹è¯·æ±‚é”çš„æ—¶é—´æ—©æ™šæ¥å†³å®šçš„ï¼Œä¹Ÿå°±æ˜¯æœ€æ—©è¯·æ±‚é”çš„çº¿ç¨‹å°†æœ€æ—©è·å–åˆ°é”ã€‚</li><li>éå…¬å¹³é”åœ¨è¿è¡Œæ—¶é—¯å…¥ï¼Œä¹Ÿå°±æ˜¯å…ˆæ¥ä¸ä¸€å®šå…ˆå¾—ï¼Œå¦‚ <code>synchronized</code>ã€‚</li><li><code>ReentrantLock</code>ã€<code>ReentrantReadWriteLock</code>ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†æ”¯æŒå…¬å¹³é”ã€‚</li><li>åœ¨æ²¡æœ‰å…¬å¹³æ€§éœ€æ±‚çš„æƒ…å†µä¸‹å°½é‡ä½¿ç”¨éå…¬å¹³é”ï¼Œå› ä¸ºå…¬å¹³é”ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ã€‚</li></ul><h2 id="ç‹¬å é”ä¸å…±äº«é”"><a class="markdownIt-Anchor" href="#ç‹¬å é”ä¸å…±äº«é”"></a> ç‹¬å é”ä¸å…±äº«é”</h2><p>æ ¹æ®é”åªèƒ½è¢«å•ä¸ªçº¿ç¨‹æŒæœ‰è¿˜æ˜¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹å…±åŒæŒæœ‰ï¼Œé”å¯åˆ†ä¸ºç‹¬å é”ä¸å…±äº«é”ã€‚</p><ul><li>ç‹¬å é”æ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œæ¯æ¬¡è®¿é—®èµ„æºéƒ½åŠ ä¸Šäº†äº’æ–¥é”ï¼Œåœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¯»å–æ•°æ®ã€‚</li><li>å…±äº«é”æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œå®ƒæ”¾å®½äº†åŠ é”çš„æ¡ä»¶ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»æ“ä½œã€‚</li></ul><h2 id="å¯é‡å…¥é”"><a class="markdownIt-Anchor" href="#å¯é‡å…¥é”"></a> å¯é‡å…¥é”</h2><p>å½“ä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å–å®ƒå·²ç»è·å–çš„çæ—¶ï¼Œå¦‚æœä¸è¢«é˜»å¡ï¼Œé‚£ä¹ˆè¯¥é”æ˜¯å¯è¢«é‡å…¥çš„ã€‚</p><p><code>synchronized</code> å†…éƒ¨é”æ˜¯å¯é‡å…¥é”ï¼Œåœ¨å…¶å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæ ‡ç¤ºï¼Œç”¨æ¥æ ‡ç¤ºè¯¥é”ç›®å‰è¢«å“ªä¸ªçº¿ç¨‹å ç”¨ï¼Œç„¶åå…³è”ä¸€ä¸ªè®¡æ•°å™¨ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†è¯¥é”æ—¶ï¼Œè®¡æ•°å™¨çš„å€¼ä¼šå˜æˆ <code>1</code>ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹å†æ¥è·å–è¯¥é”æ—¶ä¼šå‘ç°é”çš„æ‰€æœ‰è€…ä¸æ˜¯è‡ªå·±è€Œè¢«é˜»å¡æŒ‚èµ·ã€‚</p><p>ä½†æ˜¯å½“è·å–äº†è¯¥é”çš„çº¿ç¨‹å†æ¬¡è·å–é”æ—¶å‘ç°é”æ‹¥æœ‰è€…æ˜¯è‡ªå·±ï¼Œå°±ä¼šæŠŠè®¡æ•°å™¨å€¼ <code>+1</code>ï¼Œå½“é‡Šæ”¾é”åå€¼ <code>-1</code>ã€‚å½“è®¡æ•°å™¨å€¼ä¸º <code>0</code>ï¼Œçº¿ç¨‹æ ‡ç¤ºè¢«é‡ç½®ä¸º <code>null</code>ï¼Œè¿™æ—¶å€™è¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’æ¥ç«äº‰è¯¥é”ã€‚</p><h2 id="è‡ªæ—‹é”"><a class="markdownIt-Anchor" href="#è‡ªæ—‹é”"></a> è‡ªæ—‹é”</h2><p>å½“å‰çº¿ç¨‹åœ¨è·å–é”æ—¶ï¼Œå¦‚æœå‘ç°é”å·²è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œå®ƒä¸é©¬ä¸Šé˜»å¡è‡ªå·±ï¼Œåœ¨ä¸æ”¾å¼ƒ <code>CPU</code> ä½¿ç”¨æƒçš„æƒ…å†µä¸‹ï¼Œå¤šæ¬¡å°è¯•è·å–ï¼ˆé»˜è®¤10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>-XX:PreBlockSpinsh</code> å‚æ•°è®¾ç½®è¯¥å€¼ï¼‰ï¼Œå¾ˆæœ‰å¯èƒ½åœ¨åé¢å‡ æ¬¡å°è¯•ä¸­å…¶ä»–çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ã€‚å¦‚æœå°è¯•æŒ‡å®šæ¬¡æ•°åä»æ²¡æœ‰è·å–åˆ°é”åˆ™å½“å‰çº¿ç¨‹æ‰ä¼šè¢«é˜»å¡æŒ‚èµ·ã€‚<br />è‡ªæ—‹é”æ˜¯ä½¿ç”¨ <code>CPU</code> æ—¶é—´æ¢å–çº¿ç¨‹é˜»å¡ä¸è°ƒåº¦çš„å¼€é”€ï¼Œä½†æ˜¯å¾ˆæœ‰å¯èƒ½è¿™äº› <code>CPU</code> æ—¶é—´ç™½ç™½æµªè´¹äº†ã€‚</p><h1 id="æ­»é”"><a class="markdownIt-Anchor" href="#æ­»é”"></a> æ­»é”</h1><h2 id="å®šä¹‰"><a class="markdownIt-Anchor" href="#å®šä¹‰"></a> å®šä¹‰</h2><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ç›¸äº’ç­‰å¾…çš„ç°è±¡ï¼Œåœ¨æ— å¤–åŠ›ä½œç”¨çš„æƒ…å†µä¸‹ï¼Œè¿™äº›çº¿ç¨‹ä¼šä¸€ç›´ç›¸äº’ç­‰å¾…è€Œæ— æ³•ç»§ç»­è¿è¡Œä¸‹å»</p><h2 id="åŸºæœ¬æ¡ä»¶"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¡ä»¶"></a> åŸºæœ¬æ¡ä»¶</h2><ol><li>äº’æ–¥</li><li>è¯·æ±‚å¹¶æŒæœ‰</li><li>ä¸å¯å‰¥å¤º</li><li>ç¯è·¯ç­‰å¾…</li></ol><h2 id="é¿å…æ­»é”"><a class="markdownIt-Anchor" href="#é¿å…æ­»é”"></a> é¿å…æ­»é”</h2><blockquote><p>ä½¿ç”¨ç”³è¯·èµ„æºçš„æœ‰åºæ€§ï¼Œç ´åè¯·æ±‚å¹¶æŒæœ‰å’Œç¯è·¯ç­‰å¾…æ¡ä»¶ã€‚</p></blockquote><ul><li><p>é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ã€‚</p></li><li><p>é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æºã€‚</p></li><li><p>å°è¯•ä½¿ç”¨å®šæ—¶é” <code>lock.tryLock(timeout)</code>ï¼Œé¿å…é”ä¸€ç›´ä¸èƒ½é‡Šæ”¾ã€‚</p></li><li><p>å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µã€‚</p></li></ul><h1 id="aqs"><a class="markdownIt-Anchor" href="#aqs"></a> AQS</h1><blockquote><p><code>AbstractQueuedSynchronizer</code>ï¼ˆç®€ç§° <code>AQS</code>ï¼‰æ˜¯é˜Ÿåˆ—åŒæ­¥å™¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¤„ç†åŒæ­¥ã€‚å®ƒæ˜¯å¹¶å‘é”å’Œå¾ˆå¤šåŒæ­¥å·¥å…·ç±»çš„å®ç°åŸºçŸ³ï¼ˆå¦‚ <code>ReentrantLock</code>ã€<code>ReentrantReadWriteLock</code>ã€<code>Semaphore</code> ç­‰ï¼‰ã€‚</p><p>å› æ­¤ï¼Œè¦æƒ³æ·±å…¥ç†è§£ <code>ReentrantLock</code>ã€<code>ReentrantReadWriteLock</code> ç­‰å¹¶å‘é”å’ŒåŒæ­¥å·¥å…·ï¼Œå¿…é¡»å…ˆç†è§£ <code>AQS</code> çš„è¦ç‚¹å’ŒåŸç†ã€‚</p></blockquote><h2 id="aqs-çš„è¦ç‚¹"><a class="markdownIt-Anchor" href="#aqs-çš„è¦ç‚¹"></a> <code>AQS</code> çš„è¦ç‚¹</h2><p>åœ¨ <code>java.util.concurrent.locks</code> åŒ…ä¸­çš„ç›¸å…³é”(å¸¸ç”¨çš„æœ‰ <code>ReentrantLock</code>ã€ <code>ReadWriteLock</code>)éƒ½æ˜¯åŸºäº <code>AQS</code> æ¥å®ç°ã€‚è¿™äº›é”éƒ½æ²¡æœ‰ç›´æ¥ç»§æ‰¿ <code>AQS</code>ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ª <code>Sync</code> ç±»å»ç»§æ‰¿ <code>AQS</code>ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿå› ä¸ºé”é¢å‘çš„æ˜¯ä½¿ç”¨ç”¨æˆ·ï¼Œè€ŒåŒæ­¥å™¨é¢å‘çš„åˆ™æ˜¯çº¿ç¨‹æ§åˆ¶ï¼Œé‚£ä¹ˆåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨è€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿ <code>AQS</code> å°±å¯ä»¥å¾ˆå¥½çš„éš”ç¦»äºŒè€…æ‰€å…³æ³¨çš„äº‹æƒ…ã€‚</p><p><strong><code>AQS</code> æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒã€‚</strong></p><h3 id="ç‹¬äº«é”-api"><a class="markdownIt-Anchor" href="#ç‹¬äº«é”-api"></a> ç‹¬äº«é” <code>API</code></h3><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquire</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquireInterruptibly</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryAcquireNanos</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg, <span class="hljs-keyword">long</span> nanosTimeout)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">release</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span></span></code></pre><ul><li><code>acquire</code> - è·å–ç‹¬å é”ã€‚</li><li><code>acquireInterruptibly</code> - è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚</li><li><code>tryAcquireNanos</code> - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹å›è¿”å›ï¼š<ul><li>åœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè·å–äº†é”ï¼›</li><li>å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ï¼›</li><li>è¶…æ—¶æ—¶é—´ç»“æŸï¼Œä»æœªè·å¾—é”è¿”å› falseã€‚</li></ul></li><li><code>release</code> - é‡Šæ”¾ç‹¬å é”ã€‚</li></ul><h3 id="å…±äº«é”-api"><a class="markdownIt-Anchor" href="#å…±äº«é”-api"></a> å…±äº«é” <code>API</code></h3><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquireShared</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquireSharedInterruptibly</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryAcquireSharedNanos</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg, <span class="hljs-keyword">long</span> nanosTimeout)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">releaseShared</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span></span></code></pre><ul><li><code>acquireShared</code> - è·å–å…±äº«é”ã€‚</li><li><code>acquireSharedInterruptibly</code> - è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚</li><li><code>tryAcquireSharedNanos</code> - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚</li><li><code>release</code> - é‡Šæ”¾å…±äº«é”ã€‚</li></ul><h2 id="aqs-çš„åŸç†"><a class="markdownIt-Anchor" href="#aqs-çš„åŸç†"></a> <code>AQS</code> çš„åŸç†</h2><h3 id="aqs-çš„æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#aqs-çš„æ•°æ®ç»“æ„"></a> <code>AQS</code> çš„æ•°æ®ç»“æ„</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractQueuedSynchronizer</span></span><span class="hljs-class">    <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractOwnableSynchronizer</span></span><span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-comment">/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå¤´ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ setHead æ–¹æ³•ä¿®æ”¹ã€‚ */</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node head;    <span class="hljs-comment">/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ enq æ–¹æ³•æ·»åŠ æ–°çš„ç­‰å¾…èŠ‚ç‚¹ã€‚*/</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node tail;    <span class="hljs-comment">/** åŒæ­¥çŠ¶æ€ */</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> state;&#125;</code></pre><ul><li><p><code>state</code> - <code>AQS</code> ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ <code>volatile</code> å˜é‡æ¥ ç»´æŠ¤åŒæ­¥çŠ¶æ€ã€‚</p><ul><li>è¿™ä¸ªæ•´æ•°çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»æ¥èµ‹äºˆï¼Œå¦‚ <code>ReentrantLock</code> ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼Œ<code>Semaphore</code> ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ã€‚</li></ul></li><li><p><code>head</code> å’Œ <code>tail</code> - <code>AQS</code> ç»´æŠ¤äº†ä¸€ä¸ª <code>Node</code> ç±»å‹ï¼ˆ<code>AQS</code> çš„å†…éƒ¨ç±»ï¼‰çš„åŒé“¾è¡¨æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ã€‚è¿™ä¸ªåŒé“¾è¡¨æ˜¯ä¸€ä¸ªåŒå‘çš„ <code>FIFO</code> é˜Ÿåˆ—ï¼Œé€šè¿‡ <code>head</code> å’Œ <code>tail</code> æŒ‡é’ˆè¿›è¡Œè®¿é—®ã€‚å½“æœ‰çº¿ç¨‹è·å–é”å¤±è´¥åï¼Œå°±è¢«æ·»åŠ åˆ°é˜Ÿåˆ—æœ«å°¾ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200718161601.png" srcset="/img/loading.gif" alt="AQSç»“æ„" /></p><p><code>Node</code> çš„æºç </p><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;    <span class="hljs-comment">/** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºå…±äº«æ¨¡å¼ */</span>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Node SHARED = <span class="hljs-keyword">new</span> Node();    <span class="hljs-comment">/** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºç‹¬å æ¨¡å¼ */</span>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Node EXCLUSIVE = <span class="hljs-keyword">null</span>;    <span class="hljs-comment">/** çº¿ç¨‹ç­‰å¾…çŠ¶æ€ï¼ŒçŠ¶æ€å€¼æœ‰: 0ã€1ã€-1ã€-2ã€-3 */</span>    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> waitStatus;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CANCELLED =  <span class="hljs-number">1</span>;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SIGNAL    = -<span class="hljs-number">1</span>;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CONDITION = -<span class="hljs-number">2</span>;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> PROPAGATE = -<span class="hljs-number">3</span>;    <span class="hljs-comment">/** å‰é©±èŠ‚ç‚¹ */</span>    <span class="hljs-keyword">volatile</span> Node prev;    <span class="hljs-comment">/** åç»§èŠ‚ç‚¹ */</span>    <span class="hljs-keyword">volatile</span> Node next;    <span class="hljs-comment">/** ç­‰å¾…é”çš„çº¿ç¨‹ */</span>    <span class="hljs-keyword">volatile</span> Thread thread;        <span class="hljs-comment">/** å’ŒèŠ‚ç‚¹æ˜¯å¦å…±äº«æœ‰å…³ */</span>    Node nextWaiter;&#125;</code></pre><p>å¾ˆæ˜¾ç„¶ï¼Œ<code>Node</code> æ˜¯ä¸€ä¸ªåŒé“¾è¡¨ç»“æ„ã€‚</p><p><code>waitStatus</code> - <code>Node</code> ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ <code>volatile</code> å˜é‡æ¥ ç»´æŠ¤ <code>AQS</code> åŒæ­¥é˜Ÿåˆ—ä¸­çº¿ç¨‹èŠ‚ç‚¹çš„çŠ¶æ€ã€‚<code>waitStatus</code> æœ‰äº”ä¸ªçŠ¶æ€å€¼ï¼š</p><ul><li><p><code>CANCELLED(1)</code> - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹å¯èƒ½ç”±äºè¶…æ—¶æˆ–è¢«ä¸­æ–­è€Œ <strong>å¤„äºè¢«å–æ¶ˆ(ä½œåºŸ)çŠ¶æ€</strong>ï¼Œä¸€æ—¦å¤„äºè¿™ä¸ªçŠ¶æ€ï¼Œè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹åº”è¯¥ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚</p></li><li><p><code>SIGNAL(-1)</code> - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šåç»§èŠ‚ç‚¹ä¼šè¢«æŒ‚èµ·ï¼Œå› æ­¤åœ¨å½“å‰èŠ‚ç‚¹é‡Šæ”¾é”æˆ–è¢«å–æ¶ˆä¹‹åï¼Œå¿…é¡»å”¤é†’(<code>unparking</code>)å…¶åç»§ç»“ç‚¹ã€‚</p></li><li><p><code>CONDITION(-2)</code> - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ å¤„äºç­‰å¾…æ¡ä»¶çŠ¶æ€ï¼Œä¸ä¼šè¢«å½“ä½œæ˜¯åŒæ­¥é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹ï¼Œç›´åˆ°è¢«å”¤é†’(<code>signal</code>)ï¼Œè®¾ç½®å…¶å€¼ä¸º 0ï¼Œå†é‡æ–°è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p></li><li><p><code>PROPAGATE(-3)</code> - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šä¸‹ä¸€ä¸ª <code>acquireShared</code> åº”æ— æ¡ä»¶ä¼ æ’­ã€‚</p></li><li><p><code>0</code> - éä»¥ä¸ŠçŠ¶æ€ã€‚</p></li></ul><h3 id="ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾"><a class="markdownIt-Anchor" href="#ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾"></a> ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾</h3><h4 id="è·å–ç‹¬å é”"><a class="markdownIt-Anchor" href="#è·å–ç‹¬å é”"></a> è·å–ç‹¬å é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>acquire(int arg)</code> æ–¹æ³•è·å–ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å…ˆå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚</p></li><li><p>å¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼Œ<code>AQS</code> ä¼šä¸æ–­å°è¯•åˆ©ç”¨ <code>CAS</code> æ“ä½œå°†å½“å‰çº¿ç¨‹æ’å…¥ç­‰å¾…åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p></li><li><p>æ¥ç€ï¼Œä¸æ–­å°è¯•ä¸ºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹èŠ‚ç‚¹è·å–ç‹¬å é”ã€‚<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200718161748.png" srcset="/img/loading.gif" alt="è·å–é”å‰" /><br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200718162338.png" srcset="/img/loading.gif" alt="è·å–é”" /><br />è¯¦ç»†æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼Œè¯·ç»“åˆæºç æ¥ç†è§£ï¼ˆä¸€å›¾èƒœåƒè¨€ï¼‰ï¼š<br /><img src="https://raw.githubusercontent.com/LikaiLee/likailee.github.io/img/20200718162114.png" srcset="/img/loading.gif" alt="AQSè·å–é”å·¥ä½œæµç¨‹" /></p></li></ol><h4 id="é‡Šæ”¾ç‹¬å é”"><a class="markdownIt-Anchor" href="#é‡Šæ”¾ç‹¬å é”"></a> é‡Šæ”¾ç‹¬å é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>release(int arg)</code> æ–¹æ³•é‡Šæ”¾ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å…ˆå°è¯•è·å–è§£é”çº¿ç¨‹çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚</p></li><li><p>å¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œ<code>AQS</code> ä¼šå°è¯•å”¤é†’å½“å‰çº¿ç¨‹èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚</p></li></ol><h4 id="è·å–å¯ä¸­æ–­çš„ç‹¬å é”"><a class="markdownIt-Anchor" href="#è·å–å¯ä¸­æ–­çš„ç‹¬å é”"></a> è·å–å¯ä¸­æ–­çš„ç‹¬å é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>acquireInterruptibly(int arg)</code> æ–¹æ³•è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚</p><p><code>acquireInterruptibly(int arg)</code> å®ç°æ–¹å¼ç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ<code>acquire</code>ï¼‰éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºå®ƒä¼šé€šè¿‡ <code>Thread.interrupted</code> æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç«‹å³æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼ˆ<code>InterruptedException</code>ï¼‰ã€‚</p><h4 id="è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”"><a class="markdownIt-Anchor" href="#è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”"></a> è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>tryAcquireNanos(int arg)</code> æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…çš„ç‹¬å é”ã€‚</p><p><code>doAcquireNanos</code> çš„å®ç°æ–¹å¼ ç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ <code>acquire</code>ï¼‰éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå®ƒä¼šæ ¹æ®è¶…æ—¶æ—¶é—´å’Œå½“å‰æ—¶é—´è®¡ç®—å‡ºæˆªæ­¢æ—¶é—´ã€‚åœ¨è·å–é”çš„æµç¨‹ä¸­ï¼Œä¼šä¸æ–­åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œç›´æ¥è¿”å› <code>false</code>ï¼›å¦‚æœæ²¡è¶…æ—¶ï¼Œåˆ™ç”¨ <code>LockSupport.parkNanos</code> æ¥é˜»å¡å½“å‰çº¿ç¨‹ã€‚</p><h3 id="å…±äº«é”çš„è·å–å’Œé‡Šæ”¾"><a class="markdownIt-Anchor" href="#å…±äº«é”çš„è·å–å’Œé‡Šæ”¾"></a> å…±äº«é”çš„è·å–å’Œé‡Šæ”¾</h3><h4 id="è·å–å…±äº«é”"><a class="markdownIt-Anchor" href="#è·å–å…±äº«é”"></a> è·å–å…±äº«é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>acquireShared(int arg)</code> æ–¹æ³•è·å–å…±äº«é”ã€‚</p><p><code>acquireShared</code> æ–¹æ³•å’Œ <code>acquire</code> æ–¹æ³•çš„é€»è¾‘å¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè‡ªæ—‹çš„æ¡ä»¶ä»¥åŠèŠ‚ç‚¹å‡ºé˜Ÿçš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚</p><p>æˆåŠŸè·å¾—å…±äº«é”çš„æ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li><p><code>tryAcquireShared(arg)</code> è¿”å›å€¼å¤§äºç­‰äº <code>0</code> ï¼ˆè¿™æ„å‘³ç€å…±äº«é”çš„ permit è¿˜æ²¡æœ‰ç”¨å®Œï¼‰ã€‚</p></li><li><p>å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ã€‚</p></li></ul><h4 id="é‡Šæ”¾å…±äº«é”"><a class="markdownIt-Anchor" href="#é‡Šæ”¾å…±äº«é”"></a> é‡Šæ”¾å…±äº«é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>releaseShared(int arg)</code> æ–¹æ³•é‡Šæ”¾å…±äº«é”ã€‚</p><p><code>releaseShared</code> é¦–å…ˆä¼šå°è¯•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è§£é”ä¸€ä¸ªæˆ–å¤šä¸ªåç»§çº¿ç¨‹èŠ‚ç‚¹ã€‚é‡Šæ”¾å…±äº«é”å’Œé‡Šæ”¾ç‹¬äº«é”æµç¨‹å¤§ä½“ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š</p><p>å¯¹äºç‹¬äº«æ¨¡å¼ï¼Œå¦‚æœéœ€è¦ <code>SIGNAL</code>ï¼Œé‡Šæ”¾ä»…ç›¸å½“äºè°ƒç”¨å¤´èŠ‚ç‚¹çš„ <code>unparkSuccessor</code>ã€‚</p><h4 id="è·å–å¯ä¸­æ–­çš„å…±äº«é”"><a class="markdownIt-Anchor" href="#è·å–å¯ä¸­æ–­çš„å…±äº«é”"></a> è·å–å¯ä¸­æ–­çš„å…±äº«é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>acquireSharedInterruptibly(int arg)</code> æ–¹æ³•è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚</p><p><code>acquireSharedInterruptibly</code> æ–¹æ³•ä¸ <code>acquireInterruptibly</code> å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚</p><h4 id="è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”"><a class="markdownIt-Anchor" href="#è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”"></a> è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”</h4><p><code>AQS</code> ä¸­ä½¿ç”¨ <code>tryAcquireSharedNanos(int arg)</code> æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”ã€‚</p><p><code>tryAcquireSharedNanos</code> æ–¹æ³•ä¸ <code>tryAcquireNanos</code> å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚</p><h1 id="reentrantlock"><a class="markdownIt-Anchor" href="#reentrantlock"></a> <code>ReentrantLock</code></h1><blockquote><p><code>ReentrantLock</code> ç±»æ˜¯ <code>Lock</code> æ¥å£çš„å…·ä½“å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚ä¸å†…ç½®é” <code>synchronized</code> ä¸åŒï¼Œ<code>ReentrantLock</code> æä¾›äº†ä¸€ç»„æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”æ“ä½œï¼Œæ‰€æœ‰è·å–é”ã€é‡Šæ”¾é”çš„æ“ä½œéƒ½æ˜¯æ˜¾å¼çš„æ“ä½œã€‚</p></blockquote><h2 id="ç‰¹æ€§"><a class="markdownIt-Anchor" href="#ç‰¹æ€§"></a> ç‰¹æ€§</h2><ul><li><p><code>ReentrantLock</code> æä¾›äº†ä¸ <code>synchronized</code> ç›¸åŒçš„äº’æ–¥æ€§ã€å†…å­˜å¯è§æ€§å’Œå¯é‡å…¥æ€§ã€‚</p></li><li><p><code>ReentrantLock</code> æ”¯æŒå…¬å¹³é”å’Œ**éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰**ä¸¤ç§æ¨¡å¼ã€‚</p></li><li><p><code>ReentrantLock</code> å®ç°äº† <code>Lock</code> æ¥å£ï¼Œæ”¯æŒäº† <code>synchronized</code> æ‰€ä¸å…·å¤‡çš„çµæ´»æ€§ã€‚</p><ul><li><p><code>synchronized</code> æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹</p></li><li><p><code>synchronized</code> æ— æ³•åœ¨è¯·æ±‚è·å–ä¸€ä¸ªé”æ—¶æ— ä¼‘æ­¢åœ°ç­‰å¾…</p></li></ul></li></ul><p><code>Lcok</code> æ¥å£</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Lock</span> </span>&#123;    <span class="hljs-comment">// è·å–é”</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è·å–é”ã€‚</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;    <span class="hljs-comment">// å°è¯•è·å–é”ï¼Œä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”ã€‚</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// å’Œ tryLock() ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºé™å®šæ—¶é—´ï¼Œå¦‚æœé™å®šæ—¶é—´å†…æœªè·å–åˆ°é”ï¼Œè§†ä¸ºå¤±è´¥ã€‚</span>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;    <span class="hljs-comment">// é‡Šæ”¾é”</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// è¿”å›ä¸€ä¸ªç»‘å®šåˆ° Lock å¯¹è±¡ä¸Šçš„ Condition å®ä¾‹</span>    <span class="hljs-function">Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h2 id="ç”¨æ³•"><a class="markdownIt-Anchor" href="#ç”¨æ³•"></a> ç”¨æ³•</h2><h3 id="æ„é€ æ–¹æ³•"><a class="markdownIt-Anchor" href="#æ„é€ æ–¹æ³•"></a> æ„é€ æ–¹æ³•</h3><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReentrantLock</span><span class="hljs-params">()</span> </span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReentrantLock</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> fair)</span> </span>&#123;&#125;</code></pre><ul><li><code>ReentrantLock()</code> - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ªéå…¬å¹³é”ï¼ˆ<code>NonfairSync</code>ï¼‰ï¼›</li><li><code>ReentrantLock(boolean)</code> - <code>new ReentrantLock(true)</code> ä¼šåˆå§‹åŒ–ä¸€ä¸ªå…¬å¹³é”ï¼ˆ<code>FairSync</code>ï¼‰ã€‚</li></ul><h3 id="lock-å’Œ-unlock-æ–¹æ³•"><a class="markdownIt-Anchor" href="#lock-å’Œ-unlock-æ–¹æ³•"></a> <code>lock</code> å’Œ <code>unlock</code> æ–¹æ³•</h3><ul><li><p><code>lock()</code> - <strong>æ— æ¡ä»¶è·å–é”</strong>ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ— æ³•è·å–é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ä¸å¯ç”¨ï¼Œç›´è‡³å½“å‰çº¿ç¨‹è·å–åˆ°é”ã€‚å¦‚æœè¯¥é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™è·å–è¯¥é”å¹¶ç«‹å³è¿”å›ï¼Œå°†é”çš„æŒæœ‰è®¡æ•°è®¾ç½®ä¸º <code>1</code>ã€‚</p></li><li><p><code>unlock()</code> - ç”¨äºé‡Šæ”¾é”ã€‚</p></li></ul><blockquote><p>ğŸ”” æ³¨æ„ï¼šè·å–é”æ“ä½œ <code>lock()</code> å¿…é¡»åœ¨ <code>try catch</code> å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”æ“ä½œ <code>unlock()</code> æ”¾åœ¨ <code>finally</code> å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚</p></blockquote><h3 id="trylock-æ–¹æ³•"><a class="markdownIt-Anchor" href="#trylock-æ–¹æ³•"></a> <code>tryLock</code> æ–¹æ³•</h3><p>ä¸æ— æ¡ä»¶è·å–é”ç›¸æ¯”ï¼Œ<code>tryLock</code> æœ‰æ›´å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚</p><ul><li><p><code>tryLock()</code> - å¯è½®è¯¢è·å–é”ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› <code>false</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•æ— è®ºæˆè´¥éƒ½ä¼š<strong>ç«‹å³è¿”å›</strong>ï¼Œè·å–ä¸åˆ°é”ï¼ˆé”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰æ—¶ä¸ä¼šä¸€ç›´ç­‰å¾…ã€‚</p></li><li><p><code>tryLock(long, TimeUnit)</code> - å¯å®šæ—¶è·å–é”ã€‚å’Œ <code>tryLock()</code> ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨è·å–ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜è·å–ä¸åˆ°é”ï¼Œå°±è¿”å› <code>false</code>ã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</p></li></ul><h3 id="lockinterruptibly-æ–¹æ³•"><a class="markdownIt-Anchor" href="#lockinterruptibly-æ–¹æ³•"></a> <code>lockInterruptibly</code> æ–¹æ³•</h3><p><code>lockInterruptibly()</code> - å¯ä¸­æ–­è·å–é”ã€‚å¯ä¸­æ–­è·å–é”å¯ä»¥åœ¨è·å¾—é”çš„åŒæ—¶ä¿æŒå¯¹ä¸­æ–­çš„å“åº”ã€‚å¯ä¸­æ–­è·å–é”æ¯”å…¶å®ƒè·å–é”çš„æ–¹å¼ç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦ä¸¤ä¸ª <code>try-catch</code> å—ï¼ˆå¦‚æœåœ¨è·å–é”çš„æ“ä½œä¸­æŠ›å‡ºäº† <code>InterruptedException</code> ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ <code>try-finally</code> åŠ é”æ¨¡å¼ï¼‰ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼šå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ <code>lock.lockInterruptibly()</code> è·å–æŸä¸ªé”æ—¶ï¼Œè‹¥çº¿ç¨‹ <code>A</code> è·å–åˆ°äº†é”ï¼Œåˆ™çº¿ç¨‹ <code>B</code> åªèƒ½ç­‰å¾…ã€‚è‹¥æ­¤æ—¶å¯¹çº¿ç¨‹ <code>B</code> è°ƒç”¨ <code>threadB.interrupt()</code> æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ <code>B</code> çš„ç­‰å¾…è¿‡ç¨‹ã€‚ç”±äº <code>lockInterruptibly()</code> çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥ <code>lock.lockInterruptibly()</code> å¿…é¡»æ”¾åœ¨ <code>try</code> å—ä¸­æˆ–è€…åœ¨è°ƒç”¨ <code>lockInterruptibly()</code> çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡º <code>InterruptedException</code>ã€‚</p><blockquote><p>ğŸ”” æ³¨æ„ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢« <code>interrupt()</code> æ–¹æ³•ä¸­æ–­çš„ã€‚å•ç‹¬è°ƒç”¨ <code>interrupt()</code> æ–¹æ³•ä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹ï¼Œåªèƒ½ä¸­æ–­é˜»å¡çŠ¶æ€ä¸­çš„çº¿ç¨‹ã€‚å› æ­¤å½“é€šè¿‡ <code>lockInterruptibly()</code> æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœæœªè·å–åˆ°é”ï¼Œåªæœ‰åœ¨ç­‰å¾…çš„çŠ¶æ€ä¸‹ï¼Œæ‰å¯ä»¥å“åº”ä¸­æ–­ã€‚</p></blockquote><h3 id="newcondition-æ–¹æ³•"><a class="markdownIt-Anchor" href="#newcondition-æ–¹æ³•"></a> <code>newCondition</code> æ–¹æ³•</h3><p><code>newCondition()</code> - è¿”å›ä¸€ä¸ªç»‘å®šåˆ° <code>Lock</code> å¯¹è±¡ä¸Šçš„ <code>Condition</code> å®ä¾‹ã€‚</p><h2 id="åŸç†"><a class="markdownIt-Anchor" href="#åŸç†"></a> åŸç†</h2><h3 id="reentrantlock-çš„æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#reentrantlock-çš„æ•°æ®ç»“æ„"></a> <code>ReentrantLock</code> çš„æ•°æ®ç»“æ„</h3><p>å®ƒæœ‰ä¸€ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;</code></pre><p><code>sync</code> - å†…éƒ¨æŠ½è±¡ç±» <code>ReentrantLock.Sync</code> å¯¹è±¡ï¼Œ<code>Sync</code> ç»§æ‰¿è‡ª <code>AQS</code>ã€‚å®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š</p><ol><li><p><code>ReentrantLock.FairSync</code> - å…¬å¹³é”ã€‚</p></li><li><p><code>ReentrantLock.NonfairSync</code> - éå…¬å¹³é”ã€‚</p></li></ol><h3 id="è·å–é”å’Œé‡Šæ”¾é”"><a class="markdownIt-Anchor" href="#è·å–é”å’Œé‡Šæ”¾é”"></a> è·å–é”å’Œé‡Šæ”¾é”</h3><p><code>ReentrantLock</code> è·å–é”å’Œé‡Šæ”¾é”çš„æ¥å£ï¼Œä»è¡¨è±¡çœ‹ï¼Œæ˜¯è°ƒç”¨ <code>ReentrantLock.FairSync</code> æˆ– <code>ReentrantLock.NonfairSync</code> ä¸­å„è‡ªçš„å®ç°ï¼›ä»æœ¬è´¨ä¸Šçœ‹ï¼Œæ˜¯åŸºäº <code>AQS</code> çš„å®ç°ã€‚</p><ul><li><p><code>void lock()</code> è°ƒç”¨ <code>Sync</code> çš„ <code>lock()</code> æ–¹æ³•ã€‚</p></li><li><p><code>void lockInterruptibly()</code> ç›´æ¥è°ƒç”¨ <code>AQS</code> çš„ è·å–å¯ä¸­æ–­çš„ç‹¬å é” æ–¹æ³• <code>lockInterruptibly()</code>ã€‚</p></li><li><p><code>boolean tryLock()</code> è°ƒç”¨ <code>Sync</code> çš„ <code>nonfairTryAcquire()</code> ã€‚</p></li><li><p><code>boolean tryLock(long time, TimeUnit unit)</code> ç›´æ¥è°ƒç”¨ <code>AQS</code> çš„ è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é” æ–¹æ³• <code>tryAcquireNanos(int arg, long nanosTimeout)</code>ã€‚</p></li><li><p><code>void unlock()</code> ç›´æ¥è°ƒç”¨ <code>AQS</code> çš„ é‡Šæ”¾ç‹¬å é” æ–¹æ³• <code>release(int arg)</code> ã€‚</p></li></ul><h1 id="reentrantreadwritelock"><a class="markdownIt-Anchor" href="#reentrantreadwritelock"></a> <code>ReentrantReadWriteLock</code></h1><blockquote><p><code>ReentrantReadWriteLock</code> ç±»æ˜¯ <code>ReadWriteLock</code> æ¥å£çš„å…·ä½“å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å¯é‡å…¥</strong>çš„è¯»å†™é”ã€‚<code>ReentrantReadWriteLock</code> ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼Œå°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚</p></blockquote><p><code>ReentrantLock</code> å®ç°äº†ä¸€ç§æ ‡å‡†çš„äº’æ–¥é”ï¼šæ¯æ¬¡æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ <code>ReentrantLock</code>ã€‚ä½†å¯¹äºç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§æ¥è¯´ï¼Œäº’æ–¥é€šå¸¸æ˜¯ä¸€ç§è¿‡äºå¼ºç¡¬çš„åŠ é”ç­–ç•¥ï¼Œå› æ­¤ä¹Ÿå°±ä¸å¿…è¦åœ°é™åˆ¶äº†å¹¶å‘æ€§ã€‚å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¯»æ“ä½œæ¯”å†™æ“ä½œé¢‘ç¹ï¼Œåªè¦ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°æœ€æ–°æ•°æ®ï¼Œå¹¶ä¸”åœ¨è¯»æ•°æ®æ—¶ä¸ä¼šæœ‰å…¶å®ƒçº¿ç¨‹åœ¨ä¿®æ”¹æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚è¿™ç§ç­–ç•¥å‡å°‘äº†äº’æ–¥åŒæ­¥ï¼Œè‡ªç„¶ä¹Ÿæå‡äº†å¹¶å‘æ€§èƒ½ï¼Œ<code>ReentrantReadWriteLock</code> å°±æ˜¯è¿™ç§ç­–ç•¥çš„å…·ä½“å®ç°ã€‚</p><h2 id="ç‰¹æ€§-2"><a class="markdownIt-Anchor" href="#ç‰¹æ€§-2"></a> ç‰¹æ€§</h2><ul><li><p><code>ReentrantReadWriteLock</code> é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚å¦‚æœæ˜¯å†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œç”±äº <code>ReentrantReadWriteLock</code> å…¶å†…éƒ¨å®ç°æ¯” <code>ReentrantLock</code> å¤æ‚ï¼Œæ€§èƒ½å¯èƒ½åè€Œè¦å·®ä¸€äº›ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚ç”±äº <code>ReentrantReadWriteLock</code> çš„è¯»å†™é”ï¼ˆ<code>ReadLock</code>ã€<code>WriteLock</code>ï¼‰éƒ½å®ç°äº† <code>Lock</code> æ¥å£ï¼Œæ‰€ä»¥è¦æ›¿æ¢ä¸º <code>ReentrantLock</code> ä¹Ÿè¾ƒä¸ºå®¹æ˜“ã€‚</p></li><li><p><code>ReentrantReadWriteLock</code> å®ç°äº† <code>ReadWriteLock</code> æ¥å£ï¼Œæ”¯æŒäº† <code>ReentrantLock</code> æ‰€ä¸å…·å¤‡çš„è¯»å†™é”åˆ†ç¦»ã€‚<code>ReentrantReadWriteLock</code> ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼ˆ<code>ReadLock</code>ã€<code>WriteLock</code>ï¼‰ã€‚å°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚<code>ReentrantReadWriteLock</code> çš„åŠ é”ç­–ç•¥æ˜¯ï¼š<strong>å…è®¸å¤šä¸ªè¯»æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä½†æ¯æ¬¡åªå…è®¸ä¸€ä¸ªå†™æ“ä½œ</strong>ã€‚</p></li><li><p><code>ReentrantReadWriteLock</code> ä¸ºè¯»å†™é”éƒ½æä¾›äº†å¯é‡å…¥çš„åŠ é”è¯­ä¹‰ã€‚</p></li><li><p><code>ReentrantReadWriteLock</code> æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚</p></li></ul><p><code>ReadWriteLock</code> æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ReadWriteLock</span> </span>&#123;    <span class="hljs-comment">// è¿”å›ç”¨äºè¯»æ“ä½œçš„é”</span>    <span class="hljs-function">Lock <span class="hljs-title">readLock</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// è¿”å›ç”¨äºå†™æ“ä½œçš„é”</span>    <span class="hljs-function">Lock <span class="hljs-title">writeLock</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h2 id="ç”¨æ³•-2"><a class="markdownIt-Anchor" href="#ç”¨æ³•-2"></a> ç”¨æ³•</h2><h3 id="æ„é€ æ–¹æ³•-2"><a class="markdownIt-Anchor" href="#æ„é€ æ–¹æ³•-2"></a> æ„é€ æ–¹æ³•</h3><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReentrantReadWriteLock</span><span class="hljs-params">()</span> </span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReentrantReadWriteLock</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> fair)</span> </span>&#123;&#125;</code></pre><ul><li><p><code>ReentrantReadWriteLock()</code> - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ªéå…¬å¹³é”ï¼ˆ<code>NonfairSync</code>ï¼‰ã€‚åœ¨éå…¬å¹³çš„é”ä¸­ï¼Œçº¿ç¨‹è·å¾—é”çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚å†™çº¿ç¨‹é™çº§ä¸ºè¯»çº¿ç¨‹æ˜¯å¯ä»¥çš„ï¼Œä½†è¯»çº¿ç¨‹å‡çº§ä¸ºå†™çº¿ç¨‹æ˜¯ä¸å¯ä»¥çš„ï¼ˆè¿™æ ·ä¼šå¯¼è‡´æ­»é”ï¼‰ã€‚</p></li><li><p><code>ReentrantReadWriteLock(boolean)</code> - <code>new ReentrantLock(true)</code> ä¼šåˆå§‹åŒ–ä¸€ä¸ªå…¬å¹³é”ï¼ˆ<code>FairSync</code>ï¼‰ã€‚å¯¹äºå…¬å¹³é”ï¼Œç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å°†ä¼˜å…ˆè·å¾—é”ã€‚å¦‚æœè¿™ä¸ªé”æ˜¯è¯»çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å¦ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™é”ï¼Œé‚£ä¹ˆå…¶ä»–è¯»çº¿ç¨‹éƒ½ä¸èƒ½è·å¾—è¯»é”ï¼Œç›´åˆ°å†™çº¿ç¨‹é‡Šæ”¾å†™é”ã€‚</p></li></ul><h3 id="ä½¿ç”¨å®ä¾‹"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å®ä¾‹"></a> ä½¿ç”¨å®ä¾‹</h3><p><code>ReentrantReadWriteLock</code> ä¸ <code>ReentrantLock</code> ç”¨æ³•ä¸Šçš„å·®å¼‚ï¼Œä¸»è¦åœ¨äº<strong>è¯»å†™é”çš„é…åˆä½¿ç”¨</strong>ã€‚æœ¬æ–‡ä»¥ä¸€ä¸ªå…¸å‹ä½¿ç”¨åœºæ™¯æ¥è¿›è¡Œè®²è§£ã€‚</p><p>ç¤ºä¾‹ï¼šåŸºäº <code>ReentrantReadWriteLock</code> å®ç°ä¸€ä¸ªç®€å•çš„æœ¬åœ°ç¼“å­˜</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ç®€å•çš„æ— ç•Œç¼“å­˜å®ç°</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * ä½¿ç”¨ WeakHashMap å­˜å‚¨é”®å€¼å¯¹ã€‚WeakHashMap ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚</span><span class="hljs-comment"> */</span><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnboundedCache</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;K, V&gt; cacheMap = <span class="hljs-keyword">new</span> WeakHashMap&lt;&gt;();    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock cacheLock = <span class="hljs-keyword">new</span> ReentrantReadWriteLock();    <span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">get</span><span class="hljs-params">(K key)</span> </span>&#123;        cacheLock.readLock().lock();        V value;        <span class="hljs-keyword">try</span> &#123;            value = cacheMap.get(key);            String log = String.format(<span class="hljs-string">"%s è¯»æ•°æ® %s:%s"</span>, Thread.currentThread().getName(), key, value);            System.out.println(log);        &#125; <span class="hljs-keyword">finally</span> &#123;            cacheLock.readLock().unlock();        &#125;        <span class="hljs-keyword">return</span> value;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">put</span><span class="hljs-params">(K key, V value)</span> </span>&#123;        cacheLock.writeLock().lock();        <span class="hljs-keyword">try</span> &#123;            cacheMap.put(key, value);            String log = String.format(<span class="hljs-string">"%s å†™å…¥æ•°æ® %s:%s"</span>, Thread.currentThread().getName(), key, value);            System.out.println(log);        &#125; <span class="hljs-keyword">finally</span> &#123;            cacheLock.writeLock().unlock();        &#125;        <span class="hljs-keyword">return</span> value;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">remove</span><span class="hljs-params">(K key)</span> </span>&#123;        cacheLock.writeLock().lock();        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">return</span> cacheMap.remove(key);        &#125; <span class="hljs-keyword">finally</span> &#123;            cacheLock.writeLock().unlock();        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;        cacheLock.writeLock().lock();        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">this</span>.cacheMap.clear();        &#125; <span class="hljs-keyword">finally</span> &#123;            cacheLock.writeLock().unlock();        &#125;    &#125;&#125;</code></pre><ul><li><p>ä½¿ç”¨ <code>WeakHashMap</code> è€Œä¸æ˜¯ <code>HashMap</code> æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚<code>WeakHashMap</code> ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼Œ<code>JVM GC</code> æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚</p></li><li><p>å‘ Map å†™æ•°æ®å‰åŠ å†™é”ï¼Œå†™å®Œåï¼Œé‡Šæ”¾å†™é”ã€‚</p></li><li><p>å‘ Map è¯»æ•°æ®å‰åŠ è¯»é”ï¼Œè¯»å®Œåï¼Œé‡Šæ”¾è¯»é”ã€‚</p></li></ul><h2 id="åŸç†-2"><a class="markdownIt-Anchor" href="#åŸç†-2"></a> åŸç†</h2><h3 id="reentrantreadwritelock-çš„æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#reentrantreadwritelock-çš„æ•°æ®ç»“æ„"></a> <code>ReentrantReadWriteLock</code> çš„æ•°æ®ç»“æ„</h3><pre><code class="hljs java"><span class="hljs-comment">/** Inner class providing readlock */</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock.ReadLock readerLock;<span class="hljs-comment">/** Inner class providing writelock */</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock.WriteLock writerLock;<span class="hljs-comment">/** Performs all synchronization mechanics */</span><span class="hljs-keyword">final</span> Sync sync;<span class="hljs-keyword">public</span> ReentrantReadWriteLock.<span class="hljs-function">WriteLock <span class="hljs-title">writeLock</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> writerLock; &#125;<span class="hljs-keyword">public</span> ReentrantReadWriteLock.<span class="hljs-function">ReadLock  <span class="hljs-title">readLock</span><span class="hljs-params">()</span>  </span>&#123; <span class="hljs-keyword">return</span> readerLock; &#125;</code></pre><ul><li><p><code>sync</code> - å†…éƒ¨ç±» <code>ReentrantReadWriteLock.Sync</code> å¯¹è±¡ã€‚ä¸ <code>ReentrantLock</code> ç±»ä¼¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š<code>ReentrantReadWriteLock.FairSync</code> å’Œ <code>ReentrantReadWriteLock.NonfairSync</code> ï¼Œåˆ†åˆ«è¡¨ç¤ºå…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚</p></li><li><p><code>readerLock</code> - å†…éƒ¨ç±» <code>ReentrantReadWriteLock.ReadLock</code> å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠè¯»é”ã€‚</p></li><li><p><code>writerLock</code> - å†…éƒ¨ç±» <code>ReentrantReadWriteLock.WriteLock</code> å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠå†™é”ã€‚</p></li></ul><h3 id="è·å–é”å’Œé‡Šæ”¾é”-2"><a class="markdownIt-Anchor" href="#è·å–é”å’Œé‡Šæ”¾é”-2"></a> è·å–é”å’Œé‡Šæ”¾é”</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReadLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lock</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-comment">// è°ƒç”¨ AQS è·å–å…±äº«é”æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;        sync.acquireShared(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-comment">// è°ƒç”¨ AQS é‡Šæ”¾å…±äº«é”æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;        sync.releaseShared(<span class="hljs-number">1</span>);    &#125;&#125;<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WriteLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lock</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-comment">// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;        sync.acquire(<span class="hljs-number">1</span>);    &#125;    <span class="hljs-comment">// è°ƒç”¨ AQS é‡Šæ”¾ç‹¬å é”æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;        sync.release(<span class="hljs-number">1</span>);    &#125;&#125;</code></pre><h1 id="condition"><a class="markdownIt-Anchor" href="#condition"></a> Condition</h1><p><code>Java 1.5</code> ä¹‹å‰ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ <code>Object</code> ç±»ä¸­çš„ <code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code> é…åˆ <code>synchronized</code> æ¥è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ã€‚</p><p><code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code> éœ€è¦é…åˆ <code>synchronized</code> ä½¿ç”¨ï¼Œä¸é€‚ç”¨äº <code>Lock</code>ã€‚è€Œä½¿ç”¨ <code>Lock</code> çš„çº¿ç¨‹ï¼Œå½¼æ­¤é—´é€šä¿¡åº”è¯¥ä½¿ç”¨ <code>Condition</code>ã€‚<br />è¿™å¯ä»¥ç†è§£ä¸ºï¼Œä»€ä¹ˆæ ·çš„é”é…ä»€ä¹ˆæ ·çš„é’¥åŒ™ã€‚å†…ç½®é”ï¼ˆ<code>synchronized</code>ï¼‰é…åˆå†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ<code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code>ï¼‰ï¼Œæ˜¾å¼é”ï¼ˆ<code>Lock</code>ï¼‰é…åˆæ˜¾å¼æ¡ä»¶é˜Ÿåˆ—ï¼ˆ<code>Condition</code>ï¼‰ã€‚</p><h2 id="ç‰¹æ€§-3"><a class="markdownIt-Anchor" href="#ç‰¹æ€§-3"></a> ç‰¹æ€§</h2><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Condition</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">awaitUninterruptibly</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">awaitNanos</span><span class="hljs-params">(<span class="hljs-keyword">long</span> nanosTimeout)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">await</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">awaitUntil</span><span class="hljs-params">(Date deadline)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">signal</span><span class="hljs-params">()</span></span>;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">signalAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre><p>å…¶ä¸­ï¼Œ<code>await</code>ã€<code>signal</code>ã€<code>signalAll</code> ä¸ <code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code> ç›¸å¯¹åº”ï¼ŒåŠŸèƒ½ä¹Ÿç›¸ä¼¼ã€‚é™¤æ­¤ä»¥å¤–ï¼Œ<code>Condition</code> ç›¸æ¯”å†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ<code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code>ï¼‰ï¼Œæä¾›äº†æ›´ä¸ºä¸°å¯Œçš„åŠŸèƒ½ï¼š</p><ul><li><p>æ¯ä¸ªé”ï¼ˆ<code>Lock</code>ï¼‰ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ª <code>Condition</code>ï¼Œè¿™æ„å‘³ç€é”çš„çŠ¶æ€æ¡ä»¶å¯ä»¥æœ‰å¤šä¸ªã€‚</p></li><li><p>æ”¯æŒå…¬å¹³çš„æˆ–éå…¬å¹³çš„é˜Ÿåˆ—æ“ä½œã€‚</p></li><li><p>æ”¯æŒå¯ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š<code>awaitUninterruptibly()</code>ã€‚</p></li><li><p>æ”¯æŒå¯å®šæ—¶çš„ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š<code>awaitNanos(long)</code> ã€<code>await(long, TimeUnit)</code>ã€<code>awaitUntil(Date)</code>ã€‚</p></li></ul><h2 id="ç”¨æ³•-3"><a class="markdownIt-Anchor" href="#ç”¨æ³•-3"></a> ç”¨æ³•</h2><p>è¿™é‡Œä»¥ <code>Condition</code> æ¥å®ç°ä¸€ä¸ªæ¶ˆè´¹è€…ã€ç”Ÿäº§è€…æ¨¡å¼ã€‚</p><blockquote><p>ğŸ”” æ³¨æ„ï¼šäº‹å®ä¸Šï¼Œè§£å†³æ­¤ç±»é—®é¢˜ä½¿ç”¨ <code>CountDownLatch</code>ã€<code>Semaphore</code> ç­‰å·¥å…·æ›´ä¸ºä¾¿æ·ã€å®‰å…¨ã€‚</p></blockquote><p>æ¶ˆæ¯ç±»ï¼š</p><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Lock lock = <span class="hljs-keyword">new</span> ReentrantLock();    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition consumeCondition = lock.newCondition();    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition produceCondition = lock.newCondition();    <span class="hljs-keyword">private</span> String message;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> state;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> end;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">consume</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//lock</span>        lock.lock();        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">// no new message wait for new message</span>            <span class="hljs-keyword">while</span> (!state) &#123;                consumeCondition.await();            &#125;            System.out.println(<span class="hljs-string">"consume message : "</span> + message);            state = <span class="hljs-keyword">false</span>;            <span class="hljs-comment">// message consumed, notify waiting thread</span>            produceCondition.signal();        &#125; <span class="hljs-keyword">catch</span> (InterruptedException ie) &#123;            System.out.println(<span class="hljs-string">"Thread interrupted - viewMessage"</span>);        &#125; <span class="hljs-keyword">finally</span> &#123;            lock.unlock();        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">produce</span><span class="hljs-params">(String message)</span> </span>&#123;        lock.lock();        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">// last message not consumed, wait for it be consumed</span>            <span class="hljs-keyword">while</span> (state) &#123;                produceCondition.await();            &#125;            System.out.println(<span class="hljs-string">"produce msg: "</span> + message);            <span class="hljs-keyword">this</span>.message = message;            state = <span class="hljs-keyword">true</span>;            <span class="hljs-comment">// new message added, notify waiting thread</span>            consumeCondition.signal();        &#125; <span class="hljs-keyword">catch</span> (InterruptedException ie) &#123;            System.out.println(<span class="hljs-string">"Thread interrupted - publishMessage"</span>);        &#125; <span class="hljs-keyword">finally</span> &#123;            lock.unlock();        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnd</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> end;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEnd</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> end)</span> </span>&#123;        <span class="hljs-keyword">this</span>.end = end;    &#125;&#125;</code></pre><p>ç”Ÿäº§è€…ï¼š</p><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageProducer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;    <span class="hljs-keyword">private</span> Message message;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MessageProducer</span><span class="hljs-params">(Message msg)</span> </span>&#123;        message = msg;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;        produce();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span> </span>&#123;        List&lt;String&gt; msgs = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        msgs.add(<span class="hljs-string">"Begin"</span>);        msgs.add(<span class="hljs-string">"Msg1"</span>);        msgs.add(<span class="hljs-string">"Msg2"</span>);        <span class="hljs-keyword">for</span> (String msg : msgs) &#123;            message.produce(msg);            <span class="hljs-keyword">try</span> &#123;                Thread.sleep(<span class="hljs-number">100</span>);            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;                e.printStackTrace();            &#125;        &#125;        message.produce(<span class="hljs-string">"End"</span>);        message.setEnd(<span class="hljs-keyword">true</span>);    &#125;&#125;</code></pre><p>æ¶ˆè´¹è€…ï¼š</p><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;    <span class="hljs-keyword">private</span> Message message;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MessageConsumer</span><span class="hljs-params">(Message msg)</span> </span>&#123;        message = msg;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">while</span> (!message.isEnd()) &#123; message.consume(); &#125;    &#125;&#125;</code></pre><p>æµ‹è¯•ï¼š</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LockConditionDemo</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Message msg = <span class="hljs-keyword">new</span> Message();        Thread producer = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> MessageProducer(msg));        Thread consumer = <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> MessageConsumer(msg));        producer.start();        consumer.start();    &#125;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>å¹¶å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é”</tag>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Overview</title>
    <link href="/2018/12/28/overview/"/>
    <url>/2018/12/28/overview/</url>
    
    <content type="html"><![CDATA[<p>During the past six months, I was focusing on preparing for the entrance exam of postgraduate schools, owing to that, I could barely write posts or sorting out my blog. Whatâ€™s worse, I figured out that I got my server expired and lost most of my posts that I have written in the almost past three years, in which I have made some records in my study and lives, including programming thoughts and life experiences.</p><p>As youâ€™ll find out, I plan to migrate my blog from cloud server to git pages, itâ€™s kind of a large project. Thanks to the exam which I have mentioned above, actually I did not expect that I could spend a surprisingly large amount of time in concentrating on one thing. Itâ€™s helpful in building up a hard-working, persistent personality.</p><p>In short, now that Iâ€™ve finished my exam, I plan to get a vacation for a couple of weeks and then back to my blogâ€™s migration.</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
